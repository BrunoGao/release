# 批量数据模拟系统

## 功能说明
模拟1000个用户，每分钟插入一次健康数据，每天工作12小时，连续30天的数据。

## 数据规模
- **用户数量**: 1000个
- **工作时间**: 每天12小时 (8:00-20:00)
- **数据频率**: 每分钟1次
- **模拟天数**: 30天
- **总记录数**: 1000 × 12 × 60 × 30 = **21,600,000条**

## 文件结构
```
ljwx-bigscreen/bigscreen/
├── batch_insert_1000_users.py    # 主程序 (完整版)
├── demo_batch_insert.py          # 演示版本
├── test_batch_insert.py          # 测试版本
├── batch_config.py               # 配置文件
├── start_batch_insert.sh         # 启动脚本
└── BATCH_INSERT_README.md        # 说明文档
```

## 配置参数
在`batch_config.py`中可调整以下参数：
- `TOTAL_USERS`: 用户总数 (默认1000)
- `WORK_HOURS`: 每天工作小时数 (默认12)
- `DAYS_TO_SIMULATE`: 模拟天数 (默认30)
- `BATCH_SIZE`: 批处理大小 (默认100)
- `THREAD_COUNT`: 线程数 (默认10)

## 使用方法

### 1. 环境准备
```bash
# 安装依赖
pip3 install mysql-connector-python

# 确保数据库连接正常
mysql -u root -p -h 127.0.0.1 lj-03
```

### 2. 启动批处理

#### 完整版本 (21,600,000条记录)
```bash
# 方式1: 使用启动脚本 (推荐)
./start_batch_insert.sh

# 方式2: 直接运行Python
python3 batch_insert_1000_users.py
```

#### 演示版本 (7,200条记录)
```bash
# 快速演示版本 - 100用户×3天×2小时
python3 demo_batch_insert.py
```

#### 测试版本 (60条记录)
```bash
# 小规模测试版本 - 10用户×1小时
python3 test_batch_insert.py
```

### 3. 监控进度
程序会实时显示：
- 当前处理的天数和时间
- 已插入的记录数
- 进度百分比
- 预计剩余时间

## 性能优化
- **批量插入**: 每次插入100条记录
- **多线程**: 10个线程并发处理
- **连接池**: 每个线程独立数据库连接
- **内存优化**: 分批处理避免内存溢出

## 数据特点
- **部门分布**: 5个部门均匀分布
- **移动轨迹**: 每个部门有独特的移动路线
- **健康数据**: 根据部门特点生成差异化数据
- **时间连续**: 严格按分钟间隔生成时间戳

## 注意事项
⚠️ **重要警告**:
1. 执行前会**清空**`t_user_health_data`表
2. 大量数据插入会占用磁盘空间 (~2GB)
3. 建议在非生产环境执行
4. 执行时间约30-60分钟

## 故障排除

### 常见错误
1. **数据库连接失败**
   - 检查数据库配置
   - 确认数据库服务运行

2. **内存不足**
   - 减少`BATCH_SIZE`
   - 减少`THREAD_COUNT`

3. **磁盘空间不足**
   - 清理临时文件
   - 减少`DAYS_TO_SIMULATE`

### 性能调优
- 增加`BATCH_SIZE`提升插入速度
- 调整`THREAD_COUNT`平衡并发性能
- 使用SSD硬盘提升I/O性能

## 日志文件
执行过程会生成日志文件：
- 文件名: `batch_insert_YYYYMMDD_HHMMSS.log`
- 包含详细的执行过程和错误信息
- 用于问题排查和性能分析 