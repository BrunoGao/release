<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½ç©¿æˆ´ä¸ªäººå¥åº·å¤§å± v1.3.5</title>
    
    <!-- ä¾èµ–å¼•å…¥ -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.0/dist/echarts.min.js" onerror="loadEChartsBackup()"></script>
    
    <script>
        // EChartså¤‡ç”¨CDNåŠ è½½
        function loadEChartsBackup() {
            console.log('âš ï¸ ä¸»è¦ECharts CDNåŠ è½½å¤±è´¥ï¼Œå°è¯•å¤‡ç”¨CDN...');
            const script = document.createElement('script');
            script.src = 'https://unpkg.com/echarts@5.4.0/dist/echarts.min.js';
            script.onerror = function() {
                console.error('âŒ å¤‡ç”¨ECharts CDNä¹ŸåŠ è½½å¤±è´¥');
                // å¯ä»¥åœ¨è¿™é‡ŒåŠ è½½æœ¬åœ°EChartsæ–‡ä»¶
                loadLocalECharts();
            };
            document.head.appendChild(script);
        }
        
        function loadLocalECharts() {
            console.log('ğŸ”„ å°è¯•åŠ è½½æœ¬åœ°ECharts...');
            const script = document.createElement('script');
            script.src = '/static/js/echarts.min.js';
            script.onerror = function() {
                console.error('âŒ æœ¬åœ°EChartsæ–‡ä»¶ä¸å­˜åœ¨ï¼Œå°†ä½¿ç”¨é™çº§å›¾è¡¨');
            };
            document.head.appendChild(script);
        }
    </script>
    
    <link rel="stylesheet" href="/static/css/personal.css">
    <style>
        /* ============= åŸºç¡€æ ·å¼é‡ç½® ============= */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* ============= ä¸»é¢˜ç³»ç»Ÿ CSSå˜é‡ ============= */
        :root {
            /* é»˜è®¤ä¸»é¢˜ - é«˜ç§‘æŠ€è“ç»¿è‰² */
            --primary-color: #00ff9d;
            --secondary-color: #00e4ff;
            --accent-color: #ff6b6b;
            --background-primary: #0a1525;
            --background-secondary: rgba(0, 21, 41, 0.9);
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.8);
            --border-color: rgba(0, 255, 157, 0.3);
            --shadow-primary: rgba(0, 255, 157, 0.2);
            --chart-bg: rgba(13, 20, 33, 0.95);
        }

        /* æ·±è“ä¸»é¢˜ */
        .theme-deep-blue {
            --primary-color: #1890ff;
            --secondary-color: #40a9ff;
            --accent-color: #ff7875;
            --background-primary: #001529;
            --border-color: rgba(24, 144, 255, 0.3);
            --shadow-primary: rgba(24, 144, 255, 0.2);
        }

        /* ç´«ç½—å…°ä¸»é¢˜ */
        .theme-purple {
            --primary-color: #722ed1;
            --secondary-color: #9254de;
            --accent-color: #ff9c6e;
            --background-primary: #1a0d2e;
            --border-color: rgba(114, 46, 209, 0.3);
            --shadow-primary: rgba(114, 46, 209, 0.2);
        }

        /* ç»¿è‰²ç”Ÿæ€ä¸»é¢˜ */
        .theme-eco-green {
            --primary-color: #52c41a;
            --secondary-color: #73d13d;
            --accent-color: #ffa940;
            --background-primary: #162312;
            --border-color: rgba(82, 196, 26, 0.3);
            --shadow-primary: rgba(82, 196, 26, 0.2);
        }

        /* æ©™è‰²æš–é˜³ä¸»é¢˜ */
        .theme-warm-orange {
            --primary-color: #fa8c16;
            --secondary-color: #ffa940;
            --accent-color: #40a9ff;
            --background-primary: #2d1b0e;
            --border-color: rgba(250, 140, 22, 0.3);
            --shadow-primary: rgba(250, 140, 22, 0.2);
        }

        @font-face {
            font-family: "NumFont";
            src: url('{{ url_for("static", filename="fonts/num.otf") }}') format('truetype');
        }

        html, body {
            height: 100%;
            width: 100%;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', sans-serif;
        }

        /* ============= ä¸»ä½“å¸ƒå±€æ ·å¼ ============= */
        .app-container {
            height: 100vh;
            width: 100vw;
            background: 
                url('/static/health-assets/effects/particle-01.png') no-repeat top right,
                url('/static/health-assets/effects/particle-02.png') no-repeat bottom left,
                radial-gradient(ellipse at center, var(--background-primary) 0%, #041018 100%);
            background-size: 300px 300px, 250px 250px, 100% 100%;
            position: relative;
            overflow: hidden;
            transition: background 0.3s ease;
        }

        /* åŠ¨æ€èƒŒæ™¯ç²’å­ - ä½¿ç”¨CSSå˜é‡ */
        .app-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(2px 2px at 20px 30px, var(--shadow-primary), transparent),
                radial-gradient(2px 2px at 40px 70px, var(--border-color), transparent),
                radial-gradient(1px 1px at 90px 40px, var(--shadow-primary), transparent),
                radial-gradient(1px 1px at 130px 80px, var(--border-color), transparent);
            background-size: 200px 200px;
            animation: particles 20s linear infinite;
            opacity: 0.4;
            transition: background 0.3s ease;
        }

        @keyframes particles {
            0% { background-position: 0 0, 0 0, 0 0, 0 0; }
            100% { background-position: 200px 200px, -200px 200px, 200px -200px, -200px -200px; }
        }

        /* ä¸»ç½‘æ ¼å¸ƒå±€ */
        .main-grid {
            display: grid;
            grid-template-columns: 360px 1fr 360px;
            grid-template-rows: 90px 1fr;
            gap: 24px;
            height: 100vh;
            padding: 24px;
            position: relative;
            z-index: 1;
        }

        /* ============= å‘˜å·¥ä¿¡æ¯é¢æ¿ ============= */
        .employee-info-panel {
            background: linear-gradient(145deg, rgba(13, 20, 33, 0.95), rgba(6, 18, 25, 0.95));
            border: 1px solid rgba(0, 255, 157, 0.3);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .employee-info-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--primary-color), transparent);
            animation: scan 4s infinite;
        }

        .employee-avatar {
            position: relative;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            overflow: hidden;
            border: 3px solid var(--primary-color);
            box-shadow: 0 0 20px rgba(0, 255, 157, 0.4);
        }

        .employee-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .online-indicator {
            position: absolute;
            bottom: 5px;
            right: 5px;
            width: 20px;
            height: 20px;
            background: #00ff3c;
            border-radius: 50%;
            border: 3px solid #fff;
            box-shadow: 0 0 10px rgba(0, 255, 60, 0.8);
            animation: pulse 2s infinite;
        }

        .employee-details {
            flex: 1;
            color: #ffffff;
        }

        .employee-details h3 {
            margin: 0 0 8px 0;
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
        }

        .employee-details p {
            margin: 4px 0;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
        }

        .confirm-btn {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: #000;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-block;
            margin-top: 10px;
        }

        .confirm-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 255, 157, 0.4);
        }

        /* ============= é¡¶éƒ¨å¯¼èˆªæ  ============= */
        .top-header {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, rgba(13, 20, 33, 0.95), rgba(6, 18, 25, 0.95));
            border: 1px solid rgba(0, 255, 157, 0.2);
            border-radius: 12px;
            padding: 0 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
            min-height: 70px;
        }

        .top-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--primary-color), transparent);
            animation: scan 3s infinite;
        }

        @keyframes scan {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        /* ============= ç”¨æˆ·ä¿¡æ¯åŒºåŸŸ ============= */
        .header-user-info {
            display: flex;
            align-items: center;
            gap: 16px;
            background: linear-gradient(145deg, rgba(0, 255, 157, 0.05), rgba(0, 228, 255, 0.05));
            border: 1px solid rgba(0, 255, 157, 0.15);
            border-radius: 25px;
            padding: 8px 20px 8px 8px;
            backdrop-filter: blur(5px);
            transition: all 0.3s ease;
        }

        .header-user-info:hover {
            border-color: rgba(0, 255, 157, 0.3);
            box-shadow: 0 4px 20px rgba(0, 255, 157, 0.1);
            transform: translateY(-1px);
        }

        .user-avatar {
            position: relative;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            overflow: hidden;
            border: 2px solid rgba(0, 255, 157, 0.3);
            background: linear-gradient(45deg, rgba(0, 255, 157, 0.2), rgba(0, 228, 255, 0.2));
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .user-status-dot {
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 12px;
            height: 12px;
            background: #00ff3c;
            border: 2px solid rgba(13, 20, 33, 0.9);
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(0, 255, 60, 0.8);
            animation: pulse-dot 2s infinite;
        }

        @keyframes pulse-dot {
            0%, 100% { 
                box-shadow: 0 0 10px rgba(0, 255, 60, 0.8);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 0 15px rgba(0, 255, 60, 1);
                transform: scale(1.1);
            }
        }

        .user-details {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .user-name {
            font-size: 16px;
            font-weight: 700;
            color: #ffffff;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
        }

        .user-meta {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        .user-id {
            background: linear-gradient(45deg, rgba(0, 255, 157, 0.2), rgba(0, 228, 255, 0.2));
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: 600;
            border: 1px solid rgba(0, 255, 157, 0.3);
        }

        .user-separator {
            color: rgba(0, 255, 157, 0.6);
        }

        .user-dept {
            font-weight: 500;
        }

        .user-status {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 4px;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-badge.online {
            background: linear-gradient(45deg, rgba(0, 255, 60, 0.2), rgba(0, 255, 157, 0.2));
            color: #00ff3c;
            border: 1px solid rgba(0, 255, 60, 0.4);
            box-shadow: 0 0 10px rgba(0, 255, 60, 0.2);
        }

        .device-info {
            font-size: 10px;
            color: rgba(255, 255, 255, 0.6);
            text-align: right;
        }

        .device-label {
            color: rgba(0, 255, 157, 0.8);
            margin-right: 4px;
        }

        .device-sn {
            font-family: 'Courier New', monospace;
            background: rgba(0, 255, 157, 0.1);
            padding: 1px 4px;
            border-radius: 3px;
            color: rgba(255, 255, 255, 0.8);
        }

        .logo {
            width: 40px;
            height: 40px;
            background: linear-gradient(45deg, #00ff9d, #00e4ff);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: #041018;
            font-weight: bold;
        }

        .header-title {
            color: #ffffff;
            font-size: 24px;
            font-weight: 600;
            text-shadow: 0 0 10px rgba(0, 255, 157, 0.5);
        }

        .header-subtitle {
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
            margin-left: 10px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .device-status {
            display: flex;
            align-items: center;
            gap: 12px;
            color: #ffffff;
            padding: 8px 16px;
            background: rgba(0, 21, 41, 0.3);
            border-radius: 8px;
            border: 1px solid rgba(0, 255, 157, 0.2);
        }

        .status-indicator {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #00ff9d;
            box-shadow: 0 0 10px rgba(0, 255, 157, 0.8);
            animation: pulse 2s infinite;
            flex-shrink: 0;
        }

        #deviceStatusText {
            font-size: 16px;
            font-weight: 600;
            color: #ffffff;
            white-space: nowrap;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .close-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(255, 71, 87, 0.1);
            border: 1px solid rgba(255, 71, 87, 0.3);
            color: #ff4757;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: rgba(255, 71, 87, 0.2);
            transform: scale(1.1);
        }

        /* ============= ä¸ªæ€§åŒ–æ§åˆ¶æ ·å¼ ============= */
        .personalization-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 0 15px;
            border-right: 1px solid var(--border-color);
            margin-right: 15px;
        }

        .theme-selector, .layout-selector {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .control-label {
            font-size: 16px;
            color: var(--text-secondary);
        }

        .control-select {
            background: var(--background-secondary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
            padding: 6px 12px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .control-select:hover {
            border-color: var(--primary-color);
            box-shadow: 0 0 8px var(--shadow-primary);
        }

        .control-select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 12px var(--shadow-primary);
        }

        .settings-btn {
            background: transparent;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-secondary);
            padding: 8px 12px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .settings-btn:hover {
            background: var(--background-secondary);
            border-color: var(--primary-color);
            color: var(--primary-color);
            box-shadow: 0 0 8px var(--shadow-primary);
        }

        /* ============= å¸ƒå±€æ ·å¼å˜åŒ– ============= */
        /* ç´§å‡‘å¸ƒå±€ */
        .layout-compact .main-grid {
            grid-template-columns: 280px 1fr 280px;
            gap: 15px;
            padding: 15px;
        }

        .layout-compact .health-card {
            padding: 15px;
        }

        .layout-compact .advanced-gauge {
            width: 80px;
            height: 80px;
        }

        /* å±•å¼€å¸ƒå±€ */
        .layout-expanded .main-grid {
            grid-template-columns: 400px 1fr 400px;
            gap: 25px;
            padding: 25px;
        }

        .layout-expanded .health-card {
            padding: 25px;
        }

        .layout-expanded .advanced-gauge {
            width: 140px;
            height: 140px;
        }

        /* ============= å‘Šè­¦æ¨¡æ€æ¡†æ ·å¼ ============= */
        .alert-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .alert-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .alert-modal-content {
            background: var(--chart-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(20px);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .alert-modal.show .alert-modal-content {
            transform: scale(1);
        }

        .alert-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid var(--border-color);
            background: linear-gradient(135deg, var(--background-secondary), rgba(0, 21, 41, 0.7));
        }

        .alert-modal-header h3 {
            margin: 0;
            color: var(--text-primary);
            font-size: 18px;
        }

        .modal-close-btn {
            background: transparent;
            border: 1px solid rgba(255, 71, 87, 0.3);
            color: #ff4757;
            width: 32px;
            height: 32px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .modal-close-btn:hover {
            background: rgba(255, 71, 87, 0.1);
            border-color: rgba(255, 71, 87, 0.5);
        }

        .alert-modal-body {
            padding: 20px 24px;
            max-height: 400px;
            overflow-y: auto;
        }

        .no-alerts {
            text-align: center;
            color: var(--primary-color);
            font-size: 16px;
            padding: 40px 20px;
        }

        .alert-detail-item {
            background: linear-gradient(135deg, rgba(13, 20, 33, 0.7), rgba(6, 18, 25, 0.7));
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            transition: all 0.3s ease;
        }

        .alert-detail-item:hover {
            border-color: var(--primary-color);
            box-shadow: 0 4px 16px var(--shadow-primary);
        }

        .alert-detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .alert-level-badge {
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }

        .alert-level-badge.critical {
            background: rgba(255, 71, 87, 0.2);
            color: #ff4757;
            border: 1px solid rgba(255, 71, 87, 0.3);
        }

        .alert-level-badge.warning {
            background: rgba(255, 170, 0, 0.2);
            color: #ffaa00;
            border: 1px solid rgba(255, 170, 0, 0.3);
        }

        .alert-level-badge.info {
            background: rgba(0, 228, 255, 0.2);
            color: #00e4ff;
            border: 1px solid rgba(0, 228, 255, 0.3);
        }

        .alert-time {
            color: var(--text-secondary);
            font-size: 12px;
        }

        .alert-content {
            color: var(--text-primary);
            margin: 8px 0;
            line-height: 1.5;
        }

        .alert-status {
            color: var(--primary-color);
            font-size: 12px;
            margin-top: 6px;
            font-weight: bold;
        }

        .alert-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            flex-wrap: wrap;
        }

        .alert-action-btn {
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }

        .alert-action-btn.primary {
            background: var(--primary-color);
            color: #000;
        }

        .alert-action-btn.primary:hover {
            background: var(--secondary-color);
            box-shadow: 0 0 8px var(--shadow-primary);
        }

        .alert-action-btn.secondary {
            background: var(--background-secondary);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }

        .alert-action-btn.secondary:hover {
            background: var(--border-color);
            color: var(--text-primary);
        }

        .alert-action-btn.danger {
            background: rgba(255, 71, 87, 0.2);
            color: #ff4757;
            border: 1px solid rgba(255, 71, 87, 0.3);
        }

        .alert-action-btn.danger:hover {
            background: rgba(255, 71, 87, 0.3);
            box-shadow: 0 0 8px rgba(255, 71, 87, 0.4);
        }

        .alert-modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            padding: 16px 24px;
            border-top: 1px solid var(--border-color);
            background: var(--background-secondary);
        }

        .modal-btn {
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }

        .modal-btn.primary {
            background: var(--primary-color);
            color: #000;
        }

        .modal-btn.primary:hover {
            background: var(--secondary-color);
            box-shadow: 0 0 12px var(--shadow-primary);
        }

        .modal-btn.secondary {
            background: transparent;
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }

        .modal-btn.secondary:hover {
            background: var(--background-secondary);
            color: var(--text-primary);
            border-color: var(--primary-color);
        }

        /* ============= Toast é€šçŸ¥æ ·å¼ ============= */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--chart-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 16px 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            z-index: 10001;
            transform: translateX(100%);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .toast.show {
            transform: translateX(0);
            opacity: 1;
        }

        .toast-content {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .toast-icon {
            font-size: 16px;
        }

        .toast.toast-success {
            border-color: var(--primary-color);
        }

        .toast.toast-success .toast-icon {
            color: var(--primary-color);
        }

        .toast.toast-error {
            border-color: #ff4757;
        }

        .toast.toast-error .toast-icon {
            color: #ff4757;
        }

        .toast.toast-warning {
            border-color: #ffaa00;
        }

        .toast.toast-warning .toast-icon {
            color: #ffaa00;
        }

        .toast-message {
            color: var(--text-primary);
            font-size: 14px;
        }

        /* ============= ç§»åŠ¨ç«¯å“åº”å¼ä¼˜åŒ– ============= */
        /* å¤§å‹å¹³æ¿ - 1200pxä»¥ä¸Š */
        @media (min-width: 1200px) {
            .main-grid {
                grid-template-columns: 380px 1fr 380px;
                gap: 24px;
                padding: 24px;
            }
        }

        /* ä¸­å‹å±å¹• - 768px åˆ° 1199px */
        @media (max-width: 1199px) and (min-width: 768px) {
            .main-grid {
                grid-template-columns: 300px 1fr 300px;
                gap: 16px;
                padding: 16px;
            }

            .health-card {
                padding: 18px;
            }

            .advanced-gauge {
                width: 100px;
                height: 100px;
            }

            .gauge-value {
                font-size: 20px;
            }

            .header-title {
                font-size: 20px;
            }

            .personalization-controls {
                gap: 10px;
            }

            .control-select {
                font-size: 11px;
                padding: 4px 8px;
            }
        }

        /* å°å‹å¹³æ¿ - 600px åˆ° 767px */
        @media (max-width: 767px) and (min-width: 600px) {
            .main-grid {
                grid-template-columns: 1fr;
                grid-template-rows: 60px 1fr;
                gap: 12px;
                padding: 12px;
            }

            .top-header {
                padding: 0 20px;
                height: 60px;
            }

            .header-user-info {
                gap: 12px;
                padding: 6px 16px 6px 6px;
            }

            .user-avatar {
                width: 36px;
                height: 36px;
            }

            .user-name {
                font-size: 14px;
            }

            .user-meta {
                font-size: 11px;
            }

            .user-dept {
                display: none;
            }

            .header-title {
                font-size: 18px;
            }

            .header-subtitle {
                font-size: 12px;
            }

            /* é‡æ–°å¸ƒå±€ä¸ºå•åˆ—å¸ƒå±€ */
            .left-panel, .center-panel, .right-panel {
                width: 100%;
            }

            /* åˆ›å»ºæ‰‹æœºç‰ˆçš„ç½‘æ ¼å¸ƒå±€ */
            .mobile-content {
                display: grid;
                grid-template-columns: 1fr 1fr;
                grid-template-rows: auto auto 400px;
                gap: 12px;
            }

            .left-panel {
                grid-column: 1;
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 12px;
            }

            .right-panel {
                grid-column: 2;
                display: flex;
                flex-direction: column;
                gap: 12px;
            }

            .center-panel {
                grid-column: 1 / -1;
            }

            .health-card {
                padding: 16px;
            }

            .advanced-gauge {
                width: 80px;
                height: 80px;
            }

            .gauge-value {
                font-size: 16px;
            }

            .personalization-controls {
                display: none; /* åœ¨å°å±å¹•ä¸Šéšè—ä¸ªæ€§åŒ–æ§ä»¶ */
            }
        }

        /* æ‰‹æœºç«¯ - 599pxä»¥ä¸‹ */
        @media (max-width: 599px) {
            html, body {
                overflow-y: auto; /* å…è®¸å‚ç›´æ»šåŠ¨ */
            }

            .app-container {
                min-height: 100vh;
                height: auto;
            }

            .main-grid {
                grid-template-columns: 1fr;
                grid-template-rows: 50px auto;
                gap: 8px;
                padding: 8px;
                height: auto;
                min-height: 100vh;
            }

            .top-header {
                padding: 0 12px;
                height: 50px;
                min-height: 50px;
            }

            .header-user-info {
                gap: 8px;
                padding: 4px 10px 4px 4px;
                border-radius: 18px;
            }

            .user-avatar {
                width: 30px;
                height: 30px;
            }

            .user-status-dot {
                width: 8px;
                height: 8px;
                bottom: 1px;
                right: 1px;
            }

            .user-name {
                font-size: 11px;
            }

            .user-meta {
                font-size: 9px;
            }

            .user-separator,
            .user-dept {
                display: none;
            }

            .status-badge {
                padding: 2px 6px;
                font-size: 8px;
            }

            .device-info {
                display: none;
            }

            .logo {
                width: 28px;
                height: 28px;
                font-size: 14px;
            }

            .header-title {
                font-size: 16px;
            }

            .header-subtitle {
                font-size: 10px;
            }

            .device-status {
                font-size: 12px;
            }

            .status-indicator {
                width: 8px;
                height: 8px;
            }

            .close-btn {
                width: 28px;
                height: 28px;
                font-size: 12px;
            }

            .personalization-controls {
                display: none;
            }

            /* æ‰‹æœºç‰ˆå¸ƒå±€ */
            .mobile-layout {
                display: flex;
                flex-direction: column;
                gap: 8px;
            }

            /* å¥åº·æŒ‡æ ‡æ¨ªå‘æ’åˆ— */
            .health-metrics-row {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 8px;
            }

            .health-card {
                padding: 12px;
                min-height: auto;
            }

            .card-header {
                margin-bottom: 8px;
            }

            .card-title {
                font-size: 12px;
            }

            .card-icon {
                font-size: 14px;
            }

            .advanced-gauge {
                width: 60px;
                height: 60px;
                margin: 0 auto 8px;
            }

            .gauge-value {
                font-size: 14px;
            }

            .gauge-unit {
                font-size: 10px;
            }

            .health-details {
                display: none; /* åœ¨æ‰‹æœºä¸Šéšè—è¯¦ç»†ä¿¡æ¯ */
            }

            /* ä¸»å›¾è¡¨åŒºåŸŸ */
            .main-chart-container {
                padding: 16px;
                margin: 8px 0;
            }

            .chart-header h3 {
                font-size: 16px;
            }

            .time-controls {
                gap: 8px;
            }

            .control-btn {
                padding: 6px 12px;
                font-size: 12px;
            }

            /* æ¶ˆæ¯å’Œå‘Šè­¦åŒºåŸŸ */
            .message-alert-row {
                display: grid;
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .message-panel, .alert-panel {
                padding: 12px;
            }

            .panel-title {
                font-size: 14px;
            }

            .message-count, .alert-count {
                font-size: 12px;
                padding: 2px 6px;
            }

            .message-item, .alert-item {
                padding: 8px;
                margin-bottom: 6px;
            }

            .message-content, .alert-text {
                font-size: 12px;
            }

            .message-time, .alert-time {
                font-size: 10px;
            }

            /* æ¨¡æ€æ¡†ä¼˜åŒ– */
            .alert-modal-content {
                width: 95%;
                max-height: 90vh;
                margin: 0 10px;
            }

            .alert-modal-header {
                padding: 12px 16px;
            }

            .alert-modal-header h3 {
                font-size: 16px;
            }

            .alert-modal-body {
                padding: 12px 16px;
            }

            .alert-detail-item {
                padding: 12px;
            }

            .alert-actions {
                flex-direction: column;
            }

            .alert-action-btn {
                width: 100%;
                padding: 10px;
                font-size: 14px;
            }

            .modal-btn {
                padding: 12px 16px;
                font-size: 14px;
            }

            /* Toast ä¼˜åŒ– */
            .toast {
                right: 10px;
                left: 10px;
                top: 10px;
                right: 10px;
            }
        }

        /* è¶…å°å±å¹• - 360pxä»¥ä¸‹ */
        @media (max-width: 360px) {
            .main-grid {
                padding: 4px;
                gap: 4px;
            }

            .top-header {
                padding: 0 8px;
            }

            .header-title {
                font-size: 14px;
            }

            .header-subtitle {
                display: none; /* éšè—å‰¯æ ‡é¢˜ */
            }

            .health-metrics-row {
                grid-template-columns: 1fr; /* å•åˆ—å¸ƒå±€ */
            }

            .health-card {
                padding: 8px;
            }

            .advanced-gauge {
                width: 50px;
                height: 50px;
            }

            .gauge-value {
                font-size: 12px;
            }

            .main-chart-container {
                padding: 8px;
            }

            .control-btn {
                padding: 4px 8px;
                font-size: 11px;
            }
        }

        /* è§¦æ‘¸ä¼˜åŒ– */
        @media (hover: none) and (pointer: coarse) {
            .health-card:hover {
                transform: none; /* ç§»é™¤æ‚¬åœåŠ¨ç”» */
            }

            .control-btn {
                min-height: 44px; /* å¢åŠ è§¦æ‘¸ç›®æ ‡å¤§å° */
            }

            .alert-action-btn, .modal-btn {
                min-height: 44px;
            }

            .close-btn, .settings-btn {
                min-width: 44px;
                min-height: 44px;
            }
        }

        /* ============= å·¦ä¾§é¢æ¿ ============= */
        .left-panel {
            display: flex;
            flex-direction: column;
            gap: 8px;
            height: 100%;
            overflow: hidden;
            padding: 0;
        }

        /* ============= å¥åº·æŒ‡æ ‡å¡ç‰‡ ============= */
        /* å¥åº·å¡ç‰‡ç‚¹å‡»æ•ˆæœå’Œæç¤º */
        .health-card {
            background: linear-gradient(145deg, rgba(13, 20, 33, 0.95), rgba(6, 18, 25, 0.95));
            border: 1px solid rgba(0, 255, 157, 0.2);
            border-radius: 12px;
            padding: 12px;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            text-align: center; /* æ°´å¹³å±…ä¸­ */
            filter: none; /* ç§»é™¤è“è‰²æ»¤é•œ */
            cursor: pointer; /* æ·»åŠ ç‚¹å‡»æ‰‹åŠ¿ */
            flex: 1;
            min-height: 0;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        /* å‡å°‘å¿ƒç‡å’Œè¡€æ°§å¡ç‰‡é«˜åº¦30% */
        #heartRateCard,
        #bloodOxygenCard {
            flex: 0.7; /* å‡å°‘30%é«˜åº¦ */
        }

        /* ä½“æ¸©å¡ç‰‡ä¿æŒæ­£å¸¸é«˜åº¦ï¼Œç¡®ä¿æ˜¾ç¤ºæ­£å¸¸ */
        #temperatureCard {
            flex: 1;
            min-height: 200px; /* ç¡®ä¿ä½“æ¸©å¡ç‰‡æœ‰è¶³å¤Ÿç©ºé—´æ˜¾ç¤º */
            visibility: visible !important; /* å¼ºåˆ¶ç¡®ä¿ä½“æ¸©å¡ç‰‡å¯è§ */
            display: flex !important; /* å¼ºåˆ¶ç¡®ä¿ä½“æ¸©å¡ç‰‡æ˜¾ç¤º */
            z-index: 2; /* ç¡®ä¿ä½“æ¸©å¡ç‰‡åœ¨æœ€ä¸Šå±‚ */
        }


        .health-card:hover {
            transform: translateY(-5px) scale(1.02);
            border-color: rgba(0, 255, 157, 0.5);
            box-shadow: 0 10px 30px rgba(0, 255, 157, 0.2);
        }

        .health-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, #00ff9d, transparent);
            animation: scan 4s infinite;
        }

        .health-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 255, 157, 0.2);
            border-color: rgba(0, 255, 157, 0.5);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .card-title {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #ffffff;
            font-size: 18px; /* å¢å¤§æ ‡é¢˜å­—ä½“ */
            font-weight: 600;
            margin-bottom: 15px; /* å¢åŠ é—´è·é¿å…é‡å  */
            line-height: 1.5;
            word-spacing: 2px;
            justify-content: center; /* å±…ä¸­å¯¹é½ */
        }

        .card-icon {
            font-size: 20px;
        }

        .health-status {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #00ff9d;
            box-shadow: 0 0 8px rgba(0, 255, 157, 0.8);
        }

        .health-status.warning {
            background: #ffaa00;
            box-shadow: 0 0 8px rgba(255, 170, 0, 0.8);
        }

        .health-status.critical {
            background: #ff4757;
            box-shadow: 0 0 8px rgba(255, 71, 87, 0.8);
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        /* ============= é«˜çº§ä»ªè¡¨ç›˜æ ·å¼ ============= */
        .advanced-gauge {
            position: relative;
            width: 80px;
            height: 80px;
            margin: 0 auto 4px; /* å‡å°‘åº•éƒ¨è¾¹è·ï¼Œä¼˜åŒ–3Då›¾åƒå‘¨å›´ç©ºé—´ */
        }

        /* é’ˆå¯¹å¿ƒç‡å’Œè¡€æ°§å¡ç‰‡ä¼˜åŒ–3Då›¾åƒç©ºé—´ */
        #heartRateCard .advanced-gauge,
        #bloodOxygenCard .advanced-gauge {
            margin: 0 auto 2px; /* è¿›ä¸€æ­¥å‡å°‘3Då›¾åƒå‘¨å›´ç©ºé—´ */
        }

        /* ä½“æ¸©å¡ç‰‡ä¿æŒæ›´å¤šç©ºé—´ä»¥ç¡®ä¿æ­£å¸¸æ˜¾ç¤º */
        #temperatureCard .advanced-gauge {
            margin: 0 auto 6px;
        }

        .gauge-container {
            width: 100%;
            height: 100%;
            position: relative;
        }

        .gauge-value-display {
            position: absolute;
            top: 45%; /* è°ƒæ•´ä½ç½®é¿å…é‡å  */
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 10; /* æé«˜å±‚çº§ */
            width: 100%;
        }

        .gauge-value {
            font-family: "NumFont", monospace;
            font-size: 24px;
            font-weight: 900;
            color: #00ff9d;
            text-shadow: 0 0 15px rgba(0, 255, 157, 1);
            line-height: 1;
            text-align: center;
            letter-spacing: 1px;
        }

        .gauge-unit {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.9);
            margin-top: 4px;
            text-align: center;
            font-weight: 600;
            letter-spacing: 1px;
        }

        .health-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4px;
            font-size: 10px;
            text-align: center;
            justify-content: center;
            margin-top: 6px;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            padding: 3px 5px;
            background: rgba(0, 21, 41, 0.3);
            border-radius: 3px;
            border: 1px solid rgba(0, 255, 157, 0.1);
        }

        .detail-label {
            color: rgba(255, 255, 255, 0.7);
            font-size: 9px;
        }

        .detail-value {
            color: #00e4ff;
            font-weight: 700;
            font-size: 10px;
        }

        /* ============= ä¸­å¤®åŒºåŸŸ ============= */
        .center-panel {
            display: grid;
            grid-template-rows: auto 300px 1fr 200px; /* å››å±‚å¸ƒå±€ */
            gap: 20px;
        }

        /* å¥åº·ç»¼åˆè¯„åˆ†åŒºåŸŸ */
        .health-score-section {
            background: linear-gradient(145deg, rgba(13, 20, 33, 0.95), rgba(6, 18, 25, 0.95));
            border: 1px solid rgba(0, 255, 157, 0.3);
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(10px);
            position: relative;
            display: grid;
            grid-template-columns: 1fr 280px 1fr;
            gap: 25px;
            align-items: center;
        }

        .score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: conic-gradient(from 0deg, var(--primary-color), var(--secondary-color), var(--accent-color), var(--primary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            position: relative;
            animation: rotate 20s linear infinite;
        }

        .score-circle::before {
            content: '';
            position: absolute;
            inset: 4px;
            background: var(--background-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .score-number {
            position: absolute;
            font-size: 36px;
            font-weight: 900;
            color: var(--primary-color);
            z-index: 2;
        }

        .health-score-center {
            text-align: center;
        }

        /* ============= å¥åº·é¢„æµ‹æ¨¡å— ============= */
        .health-prediction {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .prediction-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .prediction-icon {
            width: 28px;
            height: 28px;
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            box-shadow: 0 0 12px rgba(255, 107, 107, 0.4);
        }

        .prediction-title {
            color: #ffffff;
            font-size: 16px;
            font-weight: 700;
            text-shadow: 0 0 8px rgba(255, 255, 255, 0.3);
        }

        .prediction-item {
            background: rgba(255, 107, 107, 0.08);
            border: 1px solid rgba(255, 107, 107, 0.25);
            border-radius: 6px;
            padding: 10px;
            position: relative;
            transition: all 0.3s ease;
        }

        .prediction-item:hover {
            border-color: rgba(255, 107, 107, 0.4);
            background: rgba(255, 107, 107, 0.12);
        }

        .prediction-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(to bottom, #ff6b6b, #ff4757);
            border-radius: 0 2px 2px 0;
        }

        .prediction-label {
            font-size: 11px;
            color: rgba(255, 107, 107, 0.9);
            font-weight: 600;
            margin-bottom: 3px;
        }

        .prediction-content {
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            line-height: 1.3;
        }

        .prediction-risk {
            display: inline-flex;
            align-items: center;
            gap: 3px;
            background: rgba(255, 107, 107, 0.2);
            padding: 1px 6px;
            border-radius: 8px;
            font-size: 9px;
            font-weight: 600;
            color: #ff6b6b;
            margin-left: 6px;
        }

        /* ============= å¥åº·å»ºè®®æ¨¡å— ============= */
        .health-recommendations {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .recommendations-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .recommendations-icon {
            width: 28px;
            height: 28px;
            background: linear-gradient(45deg, #00e4ff, #00b8d4);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            box-shadow: 0 0 12px rgba(0, 228, 255, 0.4);
        }

        .recommendations-title {
            color: #ffffff;
            font-size: 16px;
            font-weight: 700;
            text-shadow: 0 0 8px rgba(255, 255, 255, 0.3);
        }

        .recommendation-item {
            background: rgba(0, 228, 255, 0.08);
            border: 1px solid rgba(0, 228, 255, 0.25);
            border-radius: 6px;
            padding: 8px 10px;
            display: flex;
            align-items: flex-start;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .recommendation-item:hover {
            border-color: rgba(0, 228, 255, 0.4);
            background: rgba(0, 228, 255, 0.12);
            transform: translateX(2px);
        }

        .recommendation-icon {
            color: #00e4ff;
            font-size: 12px;
            margin-top: 1px;
            flex-shrink: 0;
        }

        .recommendation-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 11px;
            line-height: 1.3;
        }

        .recommendation-priority {
            display: inline-block;
            background: linear-gradient(45deg, #00e4ff, #00b8d4);
            color: #000;
            padding: 1px 5px;
            border-radius: 6px;
            font-size: 8px;
            font-weight: 700;
            margin-top: 3px;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* å“åº”å¼è®¾è®¡ - å¥åº·è¯„åˆ†åŒºåŸŸ */
        @media (max-width: 1200px) {
            .health-score-section {
                grid-template-columns: 1fr 240px 1fr;
                gap: 20px;
                padding: 15px;
            }
            
            .prediction-title,
            .recommendations-title {
                font-size: 14px;
            }
            
            .prediction-content,
            .recommendation-text {
                font-size: 11px;
            }
        }

        @media (max-width: 768px) {
            .health-score-section {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto;
                text-align: center;
                gap: 20px;
            }
            
            .health-prediction,
            .health-recommendations {
                max-width: 400px;
                margin: 0 auto;
            }
            
            .score-circle {
                width: 100px;
                height: 100px;
            }
            
            .score-number {
                font-size: 28px;
            }
        }

        @media (max-width: 599px) {
            .health-score-section {
                padding: 12px;
                gap: 15px;
            }
            
            .prediction-header,
            .recommendations-header {
                justify-content: center;
            }
            
            .prediction-item,
            .recommendation-item {
                padding: 8px;
            }
            
            .score-circle {
                width: 80px;
                height: 80px;
            }
            
            .score-number {
                font-size: 24px;
            }
        }

        /* å®æ—¶æ³¢å½¢å›¾åŒºåŸŸ */
        .vital-wave-section {
            background: linear-gradient(145deg, rgba(13, 20, 33, 0.95), rgba(6, 18, 25, 0.95));
            border: 1px solid rgba(255, 107, 107, 0.3);
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .wave-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .wave-controls {
            display: flex;
            gap: 8px;
        }

        .wave-btn {
            padding: 6px 12px;
            background: rgba(255, 107, 107, 0.1);
            border: 1px solid rgba(255, 107, 107, 0.3);
            border-radius: 6px;
            color: #ff6b6b;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
        }

        .wave-btn.active {
            background: rgba(255, 107, 107, 0.3);
            box-shadow: 0 0 10px rgba(255, 107, 107, 0.5);
        }

        /* å¥åº·å¯¹æ¯”è¶‹åŠ¿åŒºåŸŸ */
        .trend-comparison {
            background: linear-gradient(145deg, rgba(13, 20, 33, 0.95), rgba(6, 18, 25, 0.95));
            border: 1px solid rgba(0, 228, 255, 0.3);
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(10px);
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .trend-item {
            text-align: center;
            padding: 15px;
            background: rgba(0, 21, 41, 0.3);
            border-radius: 8px;
            border: 1px solid rgba(0, 255, 157, 0.1);
        }

        .trend-label {
            display: block;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 8px;
        }

        .trend-value {
            font-size: 24px;
            font-weight: bold;
            display: block;
        }

        .trend-value.positive {
            color: #00ff3c;
        }

        .trend-value.negative {
            color: #ff4757;
        }

        .trend-value.neutral {
            color: #ffaa00;
        }

        .main-chart-container {
            flex: 1;
            background: linear-gradient(145deg, rgba(13, 20, 33, 0.95), rgba(6, 18, 25, 0.95));
            border: 1px solid rgba(0, 255, 157, 0.2);
            border-radius: 12px;
            padding: 30px;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .chart-title {
            color: #ffffff;
            font-size: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chart-controls {
            display: flex;
            gap: 10px;
        }

        .control-btn {
            padding: 8px 16px;
            background: rgba(0, 255, 157, 0.1);
            border: 1px solid rgba(0, 255, 157, 0.3);
            border-radius: 6px;
            color: #00ff9d;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
        }

        .control-btn:hover,
        .control-btn.active {
            background: rgba(0, 255, 157, 0.2);
            box-shadow: 0 0 10px rgba(0, 255, 157, 0.3);
        }

        .main-chart {
            height: 400px;
            width: 100%;
        }

        /* ============= å³ä¾§é¢æ¿ ============= */
        .right-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* ============= æ¶ˆæ¯é€šçŸ¥é¢æ¿ ============= */
        .message-panel {
            background: linear-gradient(145deg, rgba(13, 20, 33, 0.95), rgba(6, 18, 25, 0.95));
            border: 1px solid rgba(0, 228, 255, 0.2);
            border-radius: 12px;
            padding: 20px;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
            height: 300px;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(0, 228, 255, 0.2);
        }

        .panel-title {
            color: #ffffff;
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .message-count {
            background: linear-gradient(45deg, #ff6b6b, #ff4757);
            color: #ffffff;
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 12px;
            font-weight: 600;
            min-width: 20px;
            text-align: center;
        }

        .message-list {
            max-height: 240px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: rgba(0, 228, 255, 0.3) rgba(0, 21, 41, 0.2);
        }

        .message-list::-webkit-scrollbar {
            width: 4px;
        }

        .message-list::-webkit-scrollbar-track {
            background: rgba(0, 21, 41, 0.2);
            border-radius: 2px;
        }

        .message-list::-webkit-scrollbar-thumb {
            background: rgba(0, 228, 255, 0.3);
            border-radius: 2px;
        }

        .message-list::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 228, 255, 0.5);
        }

        /* ä¸“ä¸šæ¶ˆæ¯é€šçŸ¥æ ·å¼ */
        .message-item {
            background: linear-gradient(135deg, rgba(0, 21, 41, 0.8), rgba(0, 21, 41, 0.6));
            border: 1px solid rgba(0, 228, 255, 0.15);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .message-item:hover {
            background: linear-gradient(135deg, rgba(0, 21, 41, 0.9), rgba(0, 21, 41, 0.7));
            border-color: rgba(0, 228, 255, 0.4);
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(0, 228, 255, 0.1);
        }

        .message-item.unread {
            border-left: 4px solid #00e4ff;
            background: linear-gradient(135deg, rgba(0, 228, 255, 0.1), rgba(0, 21, 41, 0.8));
        }

        .message-item.unread::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, #00e4ff, #0099cc);
            animation: pulse-glow 2s ease-in-out infinite alternate;
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .message-type-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 16px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .msg-warning .message-type-badge {
            background: linear-gradient(135deg, #ff6b6b, #ff4757);
            color: white;
            box-shadow: 0 2px 8px rgba(255, 107, 107, 0.3);
        }

        .msg-system .message-type-badge {
            background: linear-gradient(135deg, #00e4ff, #0099cc);
            color: white;
            box-shadow: 0 2px 8px rgba(0, 228, 255, 0.3);
        }

        .msg-info .message-type-badge {
            background: linear-gradient(135deg, #2ed573, #1dd1a1);
            color: white;
            box-shadow: 0 2px 8px rgba(46, 213, 115, 0.3);
        }

        .message-status {
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .message-status.unread {
            background: #ff4757;
            color: white;
            animation: pulse-status 2s ease-in-out infinite;
        }

        .message-status.read {
            background: rgba(46, 213, 115, 0.2);
            color: #2ed573;
            border: 1px solid #2ed573;
        }

        .message-content {
            color: #ffffff;
            font-size: 13px;
            line-height: 1.5;
            margin: 10px 0;
            font-weight: 400;
        }

        .message-details {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 10px 0;
        }

        .message-details span {
            background: rgba(0, 228, 255, 0.1);
            color: #00e4ff;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            border: 1px solid rgba(0, 228, 255, 0.2);
        }

        .message-time {
            display: flex;
            align-items: center;
            gap: 4px;
            color: #8892b0;
            font-size: 11px;
            margin-top: 8px;
        }

        .message-content {
            color: #ffffff;
            font-size: 14px;
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .message-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .message-type {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .message-type.alert {
            background: rgba(255, 71, 87, 0.2);
            color: #ff4757;
        }

        .message-type.system {
            background: rgba(0, 228, 255, 0.2);
            color: #00e4ff;
        }

        .message-time {
            color: rgba(255, 255, 255, 0.5);
            font-size: 11px;
        }

        /* ============= å‘Šè­¦é¢æ¿ ============= */
        .alert-panel {
            background: linear-gradient(145deg, rgba(13, 20, 33, 0.95), rgba(6, 18, 25, 0.95));
            border: 1px solid rgba(255, 71, 87, 0.2);
            border-radius: 12px;
            padding: 20px;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .alert-panel:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 71, 87, 0.2);
            border-color: rgba(255, 71, 87, 0.4);
        }

        .alert-summary {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .alert-count {
            font-family: "NumFont", monospace;
            font-size: 32px;
            font-weight: bold;
            color: #ff4757;
            text-shadow: 0 0 10px rgba(255, 71, 87, 0.8);
        }

        .alert-trend {
            color: rgba(255, 255, 255, 0.7);
            font-size: 12px;
        }

        .alert-list {
            max-height: 240px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: rgba(255, 107, 107, 0.3) rgba(0, 21, 41, 0.2);
        }

        .alert-list::-webkit-scrollbar {
            width: 4px;
        }

        .alert-list::-webkit-scrollbar-track {
            background: rgba(0, 21, 41, 0.2);
            border-radius: 2px;
        }

        .alert-list::-webkit-scrollbar-thumb {
            background: rgba(255, 107, 107, 0.3);
            border-radius: 2px;
        }

        .alert-list::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 107, 107, 0.5);
        }

        /* ä¸“ä¸šå¥åº·å‘Šè­¦æ ·å¼ */
        .alert-item {
            background: linear-gradient(135deg, rgba(0, 21, 41, 0.8), rgba(0, 21, 41, 0.6));
            border: 1px solid rgba(255, 107, 107, 0.15);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .alert-item:hover {
            background: linear-gradient(135deg, rgba(0, 21, 41, 0.9), rgba(0, 21, 41, 0.7));
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(255, 107, 107, 0.1);
        }

        .alert-item.status-pending {
            border-left: 4px solid #ff4757;
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.1), rgba(0, 21, 41, 0.8));
        }

        .alert-item.status-pending::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, #ff4757, #ff6b6b);
            animation: pulse-glow 2s ease-in-out infinite alternate;
        }

        .alert-item.status-resolved {
            border-left: 4px solid #2ed573;
            opacity: 0.8;
        }

        .alert-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .alert-level-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 16px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .alert-status {
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .alert-status.status-pending {
            background: rgba(255, 107, 107, 0.2);
            color: #ff6b6b;
            border: 1px solid #ff6b6b;
            animation: pulse-status 2s ease-in-out infinite;
        }

        .alert-status.status-resolved {
            background: rgba(46, 213, 115, 0.2);
            color: #2ed573;
            border: 1px solid #2ed573;
        }

        .alert-type {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 8px;
            color: #00e4ff;
            font-size: 12px;
            font-weight: 600;
        }

        .alert-description {
            color: #ffffff;
            font-size: 13px;
            line-height: 1.5;
            margin: 10px 0;
            font-weight: 400;
        }

        .alert-details {
            margin: 10px 0;
        }

        .detail-row {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 4px;
        }

        .alert-details span {
            background: rgba(0, 228, 255, 0.1);
            color: #00e4ff;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            border: 1px solid rgba(0, 228, 255, 0.2);
        }

        .alert-time {
            display: flex;
            align-items: center;
            gap: 4px;
            color: #8892b0;
            font-size: 11px;
            margin-top: 8px;
            flex-wrap: wrap;
        }

        .responded-time {
            background: rgba(46, 213, 115, 0.1);
            color: #2ed573;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 9px;
            margin-left: 8px;
        }

        /* ============= å“åº”å¼è®¾è®¡ ============= */
        @media (max-width: 1440px) {
            .main-grid {
                grid-template-columns: 320px 1fr 320px;
                gap: 15px;
                padding: 15px;
            }
        }

        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto 1fr;
            }
            
            .left-panel,
            .right-panel {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 15px;
            }
        }

        /* ============= åŠ è½½åŠ¨ç”» ============= */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(0, 255, 157, 0.2);
            border-top-color: #00ff9d;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* ============= å·¥å…·æç¤º ============= */
        .tooltip {
            position: absolute;
            background: rgba(13, 20, 33, 0.95);
            border: 1px solid rgba(0, 255, 157, 0.3);
            border-radius: 6px;
            padding: 8px 12px;
            color: #ffffff;
            font-size: 12px;
            z-index: 1000;
            pointer-events: none;
            backdrop-filter: blur(10px);
        }

        /* ============= æ¨¡æ€æ¡†æ ·å¼ ============= */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
        }

        .modal-content {
            background: linear-gradient(145deg, rgba(13, 20, 33, 0.95), rgba(6, 18, 25, 0.95));
            border: 1px solid rgba(0, 255, 157, 0.3);
            border-radius: 12px;
            padding: 30px;
            max-width: 80vw;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            color: #ffffff !important;
        }
        
        /* å¥åº·æ•°æ®å¼¹å‡ºæ¡†æ ·å¼ä¿®å¤ */
        .modal-content, 
        .modal-content *,
        .health-popup,
        .health-popup *,
        .alert-popup,
        .alert-popup *,
        div[style*="background: white"],
        div[style*="background-color: white"],
        div[style*="background:#fff"],
        div[style*="background-color:#fff"] {
            color: #1a1a1a !important;
            background: rgba(255, 255, 255, 0.95) !important;
        }
        
        /* ç‰¹æ®Šä¿®å¤ï¼šé’ˆå¯¹ç™½è‰²èƒŒæ™¯çš„å¼¹å‡ºæ¡†ç¡®ä¿æ–‡å­—ä¸ºæ·±è‰² */
        div[style*="background: white"] *,
        div[style*="background-color: white"] *,
        div[style*="background:#fff"] *,
        div[style*="background-color:#fff"] *,
        .white-bg-popup,
        .white-bg-popup * {
            color: #1a1a1a !important;
        }
        
        /* å¥åº·æŒ‡æ ‡å›¾æ ‡å’Œæ•°å€¼çš„é¢œè‰²ä¿®å¤ */
        .health-indicator-icon {
            color: #ff6b6b !important;
        }
        
        .health-indicator-value {
            color: #1a1a1a !important;
            font-weight: bold !important;
        }
        
        .health-indicator-unit {
            color: #666666 !important;
        }
        
        /* é€šç”¨å¼¹å‡ºæ¡†ç¾åŒ–æ ·å¼ */
        .popup-container, 
        .info-popup,
        .health-data-popup {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(248, 249, 250, 0.98)) !important;
            border-radius: 16px !important;
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.15),
                0 0 20px rgba(0, 255, 157, 0.1) !important;
            backdrop-filter: blur(20px) !important;
            border: 1px solid rgba(0, 255, 157, 0.2) !important;
            padding: 20px !important;
            color: #1a1a1a !important;
        }
        
        /* å¥åº·æŒ‡æ ‡è¡Œæ ·å¼ä¼˜åŒ– */
        .health-metric-row {
            display: flex !important;
            align-items: center !important;
            justify-content: space-between !important;
            padding: 8px 0 !important;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1) !important;
            margin-bottom: 8px !important;
        }
        
        .health-metric-row:last-child {
            border-bottom: none !important;
            margin-bottom: 0 !important;
        }
        
        /* å¥åº·æŒ‡æ ‡å›¾æ ‡ç¾åŒ– */
        .health-metric-icon {
            font-size: 20px !important;
            margin-right: 12px !important;
            width: 24px !important;
            text-align: center !important;
        }
        
        /* å¥åº·æŒ‡æ ‡æ•°å€¼æ ·å¼ */
        .health-metric-value {
            font-weight: 600 !important;
            font-size: 16px !important;
            color: #1a1a1a !important;
        }
        
        .health-metric-unit {
            color: #666666 !important;
            font-size: 14px !important;
            margin-left: 4px !important;
        }
        
        /* ä½ç½®ä¿¡æ¯ç‰¹æ®Šæ ·å¼ */
        .location-info {
            background: rgba(34, 139, 34, 0.1) !important;
            border-radius: 8px !important;
            padding: 10px !important;
            margin-top: 10px !important;
            border-left: 3px solid #228B22 !important;
        }
        
        .location-info .health-metric-value {
            color: #228B22 !important;
            font-family: monospace !important;
            font-size: 14px !important;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: #ff4757;
            font-size: 20px;
            cursor: pointer;
        }

        /* ============= 3Då¥åº·å›¾è¡¨åŠ¨ç”»æ•ˆæœ ============= */
        @keyframes heartbeat-fast {
            0%, 100% {
                transform: scale(1);
                filter: drop-shadow(0 0 5px #ff6b6b);
            }
            25% {
                transform: scale(1.05);
                filter: drop-shadow(0 0 15px #ff4757);
            }
            50% {
                transform: scale(1.02);
                filter: drop-shadow(0 0 10px #ff6b6b);
            }
            75% {
                transform: scale(1.03);
                filter: drop-shadow(0 0 12px #ff4757);
            }
        }

        @keyframes heartbeat-slow {
            0%, 100% {
                transform: scale(1);
                filter: drop-shadow(0 0 5px #ff6b6b);
            }
            50% {
                transform: scale(1.02);
                filter: drop-shadow(0 0 8px #ff4757);
            }
        }

        @keyframes heartbeat-moderate {
            0%, 100% {
                transform: scale(1);
                filter: drop-shadow(0 0 5px #ffaa00);
            }
            33% {
                transform: scale(1.03);
                filter: drop-shadow(0 0 12px #ffaa00);
            }
            66% {
                transform: scale(1.01);
                filter: drop-shadow(0 0 8px #ffaa00);
            }
        }

        @keyframes fever-warning {
            0%, 100% {
                transform: scale(1);
                filter: drop-shadow(0 0 5px #ff4757) hue-rotate(0deg);
            }
            25% {
                transform: scale(1.02);
                filter: drop-shadow(0 0 15px #ff4757) hue-rotate(10deg);
            }
            50% {
                transform: scale(1.01);
                filter: drop-shadow(0 0 20px #ff6600) hue-rotate(20deg);
            }
            75% {
                transform: scale(1.015);
                filter: drop-shadow(0 0 12px #ff4757) hue-rotate(10deg);
            }
        }

        @keyframes blood-oxygen-critical {
            0%, 100% {
                transform: scale(1);
                filter: drop-shadow(0 0 8px #ff4757);
            }
            50% {
                transform: scale(1.03);
                filter: drop-shadow(0 0 20px #ff0000);
            }
        }

        /* å¢å¼º3Dä»ªè¡¨ç›˜æ•ˆæœ - ä½¿ç”¨çœŸå®ç«‹ä½“æ¸²æŸ“ */
        .advanced-gauge {
            position: relative;
            perspective: 1000px;
            transform-style: preserve-3d;
        }

        /* ä¸»è¦3Då¤–ç¯æ•ˆæœ */
        .advanced-gauge::before {
            content: '';
            position: absolute;
            top: -8px;
            left: -8px;
            right: -8px;
            bottom: -8px;
            background: 
                radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.3), transparent 50%),
                radial-gradient(circle at 70% 70%, rgba(0, 255, 157, 0.2), transparent 50%),
                conic-gradient(from 45deg, 
                    rgba(0, 255, 157, 0.4), 
                    rgba(0, 228, 255, 0.3), 
                    rgba(255, 107, 107, 0.2), 
                    rgba(255, 170, 0, 0.3),
                    rgba(0, 255, 157, 0.4));
            border-radius: 50%;
            z-index: -1;
            transform: translateZ(-20px);
            filter: blur(2px);
            animation: gauge-glow-3d 4s ease-in-out infinite;
        }

        /* å†…éƒ¨é«˜å…‰æ•ˆæœ */
        .advanced-gauge::after {
            content: '';
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            bottom: 10px;
            background: 
                radial-gradient(circle at 25% 25%, rgba(255, 255, 255, 0.6), transparent 30%),
                radial-gradient(circle at center, transparent 40%, rgba(0, 255, 157, 0.1) 70%);
            border-radius: 50%;
            z-index: 1;
            pointer-events: none;
            transform: translateZ(10px);
            animation: inner-glow 3s ease-in-out infinite alternate;
        }

        /* 3Dç«‹ä½“å‘å…‰åŠ¨ç”» */
        @keyframes gauge-glow-3d {
            0% {
                opacity: 0.4;
                transform: translateZ(-20px) rotateX(0deg) rotateY(0deg);
                filter: blur(2px) brightness(1);
            }
            25% {
                opacity: 0.7;
                transform: translateZ(-15px) rotateX(5deg) rotateY(5deg);
                filter: blur(1px) brightness(1.2);
            }
            50% {
                opacity: 0.8;
                transform: translateZ(-10px) rotateX(0deg) rotateY(10deg);
                filter: blur(3px) brightness(1.1);
            }
            75% {
                opacity: 0.6;
                transform: translateZ(-15px) rotateX(-5deg) rotateY(5deg);
                filter: blur(2px) brightness(1.3);
            }
            100% {
                opacity: 0.5;
                transform: translateZ(-20px) rotateX(0deg) rotateY(0deg);
                filter: blur(2px) brightness(1);
            }
        }

        /* å†…éƒ¨é«˜å…‰åŠ¨ç”» */
        @keyframes inner-glow {
            0% {
                opacity: 0.3;
                transform: translateZ(10px) scale(0.95);
            }
            100% {
                opacity: 0.8;
                transform: translateZ(15px) scale(1.02);
            }
        }

        /* ä¸ºä¸åŒå¥åº·æŒ‡æ ‡å®šåˆ¶çš„3Dç¯å¢ƒå…‰ */
        #heartRateCard .advanced-gauge::before {
            background: 
                radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.3), transparent 50%),
                conic-gradient(from 45deg, 
                    rgba(255, 107, 107, 0.5), 
                    rgba(255, 71, 87, 0.4), 
                    rgba(255, 56, 56, 0.3), 
                    rgba(255, 107, 107, 0.5));
            box-shadow: 
                inset 0 0 30px rgba(255, 107, 107, 0.3),
                0 0 50px rgba(255, 107, 107, 0.2),
                0 0 100px rgba(255, 107, 107, 0.1);
        }

        #bloodOxygenCard .advanced-gauge::before {
            background: 
                radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.3), transparent 50%),
                conic-gradient(from 45deg, 
                    rgba(0, 228, 255, 0.5), 
                    rgba(0, 191, 204, 0.4), 
                    rgba(0, 153, 204, 0.3), 
                    rgba(0, 228, 255, 0.5));
            box-shadow: 
                inset 0 0 30px rgba(0, 228, 255, 0.3),
                0 0 50px rgba(0, 228, 255, 0.2),
                0 0 100px rgba(0, 228, 255, 0.1);
        }

        #temperatureCard .advanced-gauge::before {
            background: 
                radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.3), transparent 50%),
                conic-gradient(from 45deg, 
                    rgba(255, 170, 0, 0.5), 
                    rgba(255, 153, 0, 0.4), 
                    rgba(255, 136, 0, 0.3), 
                    rgba(255, 170, 0, 0.5));
            box-shadow: 
                inset 0 0 30px rgba(255, 170, 0, 0.3),
                0 0 50px rgba(255, 170, 0, 0.2),
                0 0 100px rgba(255, 170, 0, 0.1);
        }

        /* 3Dä»ªè¡¨ç›˜å®¹å™¨ç«‹ä½“æ•ˆæœ */
        .gauge-container {
            transform-style: preserve-3d;
            transform: translateZ(0);
            filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.3));
        }

        /* EChartså›¾è¡¨å®¹å™¨3Då¢å¼º */
        .gauge-container > div {
            border-radius: 50%;
            background: 
                radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.1), transparent 70%),
                radial-gradient(circle at center, rgba(13, 20, 33, 0.9), rgba(6, 18, 25, 0.95));
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.2),
                inset 0 -1px 0 rgba(0, 0, 0, 0.2),
                0 5px 15px rgba(0, 0, 0, 0.3);
        }

        /* ä¸“ä¸šåŒ»ç–—çº§å¥åº·çŠ¶æ€æŒ‡ç¤ºå™¨ */
        .health-status.normal {
            background: linear-gradient(135deg, #00ff3c, #00cc30);
            animation: status-pulse-normal 2s ease-in-out infinite;
        }

        .health-status.warning {
            background: linear-gradient(135deg, #ffaa00, #ff9900);
            animation: status-pulse-warning 1.5s ease-in-out infinite;
        }

        .health-status.critical {
            background: linear-gradient(135deg, #ff4757, #ff0000);
            animation: status-pulse-critical 1s ease-in-out infinite;
        }

        @keyframes status-pulse-normal {
            0%, 100% { box-shadow: 0 0 5px rgba(0, 255, 60, 0.5); }
            50% { box-shadow: 0 0 15px rgba(0, 255, 60, 0.8); }
        }

        @keyframes status-pulse-warning {
            0%, 100% { box-shadow: 0 0 8px rgba(255, 170, 0, 0.6); }
            50% { box-shadow: 0 0 20px rgba(255, 170, 0, 0.9); }
        }

        @keyframes status-pulse-critical {
            0%, 100% { box-shadow: 0 0 10px rgba(255, 71, 87, 0.7); }
            50% { box-shadow: 0 0 25px rgba(255, 71, 87, 1); }
        }

        /* å¥åº·æ•°æ®å¡ç‰‡å¢å¼º - ä½¿ç”¨è®¾è®¡ç´ æèƒŒæ™¯ */
        .health-card {
            position: relative;
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .health-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                url('/static/health-assets/effects/glow-01.png') no-repeat center,
                radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.05), transparent 50%);
            background-size: contain, 100% 100%;
            opacity: 0.3;
            z-index: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .health-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 
                0 15px 40px rgba(0, 255, 157, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .health-card:hover::before {
            opacity: 0.6;
        }

        /* ä¸ºä¸åŒå¥åº·å¡ç‰‡è®¾ç½®ä¸“ç”¨èƒŒæ™¯æ•ˆæœ */
        #heartRateCard::before {
            background: 
                url('/static/health-assets/effects/glow-01.png') no-repeat center,
                radial-gradient(circle at 30% 30%, rgba(255, 107, 107, 0.1), transparent 60%);
            background-size: 80% 80%, 100% 100%;
        }

        #bloodOxygenCard::before {
            background: 
                url('/static/health-assets/effects/glow-02.png') no-repeat center,
                radial-gradient(circle at 70% 30%, rgba(0, 228, 255, 0.1), transparent 60%);
            background-size: 80% 80%, 100% 100%;
        }

        #temperatureCard::before {
            background: 
                url('/static/health-assets/effects/glow-03.png') no-repeat center,
                radial-gradient(circle at 50% 70%, rgba(255, 170, 0, 0.1), transparent 60%);
            background-size: 80% 80%, 100% 100%;
        }

        /* ç¡®ä¿å¡ç‰‡å†…å®¹å±‚çº§æ­£ç¡® */
        .health-card > * {
            position: relative;
            z-index: 1;
        }

        .health-card.alert-high {
            animation: card-alert-high 2s ease-in-out infinite;
        }

        .health-card.alert-critical {
            animation: card-alert-critical 1s ease-in-out infinite;
        }

        @keyframes card-alert-high {
            0%, 100% {
                border-color: rgba(255, 170, 0, 0.5);
                box-shadow: 0 8px 25px rgba(255, 170, 0, 0.2);
            }
            50% {
                border-color: rgba(255, 170, 0, 0.8);
                box-shadow: 0 12px 35px rgba(255, 170, 0, 0.4);
            }
        }

        @keyframes card-alert-critical {
            0%, 100% {
                border-color: rgba(255, 71, 87, 0.6);
                box-shadow: 0 10px 30px rgba(255, 71, 87, 0.3);
            }
            50% {
                border-color: rgba(255, 71, 87, 1);
                box-shadow: 0 15px 40px rgba(255, 71, 87, 0.6);
            }
        }

        /* ============= å¥åº·ç´ æå¢å¼ºåŠ¨ç”»æ•ˆæœ ============= */
        
        /* å¢å¼ºç²’å­åŠ¨ç”» - é€‚é…å¥åº·ç´ æ */
        @keyframes particles-enhanced {
            0% {
                transform: translate(0, 0) scale(1) rotate(0deg);
                opacity: 0.5;
            }
            25% {
                transform: translate(10px, -5px) scale(1.05) rotate(90deg);
                opacity: 0.7;
            }
            50% {
                transform: translate(20px, -10px) scale(1) rotate(180deg);
                opacity: 0.4;
            }
            75% {
                transform: translate(15px, -3px) scale(0.95) rotate(270deg);
                opacity: 0.6;
            }
            100% {
                transform: translate(0, 0) scale(1) rotate(360deg);
                opacity: 0.5;
            }
        }

        /* å‘å…‰èˆåŠ¨æ•ˆæœ */
        @keyframes glow-dance {
            0% {
                transform: translate(0, 0) scale(1);
                opacity: 0.2;
            }
            33% {
                transform: translate(-10px, 5px) scale(1.1);
                opacity: 0.4;
            }
            66% {
                transform: translate(5px, -8px) scale(0.9);
                opacity: 0.3;
            }
            100% {
                transform: translate(0, 0) scale(1);
                opacity: 0.2;
            }
        }

        /* å¥åº·å¡ç‰‡å‘¼å¸æ•ˆæœ */
        @keyframes health-card-breathe {
            0%, 100% {
                transform: scale(1) translateZ(0);
                filter: brightness(1);
            }
            50% {
                transform: scale(1.02) translateZ(5px);
                filter: brightness(1.05);
            }
        }

        /* æ¶ˆæ¯é€šçŸ¥å’Œå‘Šè­¦ä¸“ç”¨åŠ¨ç”» */
        @keyframes pulse-glow {
            0% { 
                opacity: 0.6;
                transform: scaleX(1);
            }
            100% { 
                opacity: 1;
                transform: scaleX(1.05);
            }
        }

        @keyframes pulse-status {
            0%, 100% { 
                opacity: 1;
                transform: scale(1);
            }
            50% { 
                opacity: 0.7;
                transform: scale(1.05);
            }
        }

        /* åº”ç”¨å‘¼å¸æ•ˆæœåˆ°å¥åº·å¡ç‰‡ */
        .health-card {
            animation: health-card-breathe 4s ease-in-out infinite;
        }

        .health-card:hover {
            animation: none; /* æ‚¬åœæ—¶åœæ­¢å‘¼å¸åŠ¨ç”» */
        }
    </style>
</head>

<body>
    <div class="app-container">
        <div class="main-grid">
            <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
            <header class="top-header">
                <div class="header-left">
                    <div class="logo">L</div>
                    <div>
                        <div class="header-title">æ™ºèƒ½å¥åº·ç›‘æ§</div>
                        <div class="header-subtitle">ä¸ªäººå¥åº·å¤§å± v1.3.5</div>
                    </div>
                </div>
                
                <!-- ç”¨æˆ·ä¿¡æ¯åŒºåŸŸ -->
                <div class="header-user-info">
                    <div class="user-avatar">
                        <img id="headerEmployeePhoto" src="/static/health-assets/default-avatar.png" alt="ç”¨æˆ·å¤´åƒ" onerror="this.src='/static/images/avatar.jpeg'">
                        <div class="user-status-dot"></div>
                    </div>
                    <div class="user-details">
                        <div class="user-name" id="headerEmployeeName">æå»ºå</div>
                        <div class="user-meta">
                            <span class="user-role" id="headerEmployeeRole">æ™®é€šå‘˜å·¥</span>
                            <span class="user-separator">â€¢</span>
                            <span class="user-device" id="headerEmployeeDevice">{{ device_sn or "" }}</span>
                        </div>
                    </div>
                    <div class="user-status">
                        <div class="status-badge online">åœ¨çº¿</div>
                        <div class="device-info">
                            <span class="device-label">è®¾å¤‡ï¼š</span>
                            <span class="device-sn">{{ device_sn or "" }}</span>
                        </div>
                    </div>
                </div>
                
                <div class="header-right">
                    <!-- ä¸ªæ€§åŒ–æ§åˆ¶åŒºåŸŸ -->
                    <div class="personalization-controls">
                        <!-- ä¸»é¢˜åˆ‡æ¢å™¨ -->
                        <div class="theme-selector">
                            <label class="control-label">ğŸ¨</label>
                            <select id="themeSelect" class="control-select" onchange="switchTheme(this.value)">
                                <option value="default">é»˜è®¤ä¸»é¢˜</option>
                                <option value="deep-blue">æ·±è“ä¸»é¢˜</option>
                                <option value="purple">ç´«ç½—å…°ä¸»é¢˜</option>
                                <option value="eco-green">ç”Ÿæ€ç»¿</option>
                                <option value="warm-orange">æš–é˜³æ©™</option>
                            </select>
                        </div>
                        
                        <!-- å¸ƒå±€é€‰æ‹©å™¨ -->
                        <div class="layout-selector">
                            <label class="control-label">ğŸ“Š</label>
                            <select id="layoutSelect" class="control-select" onchange="switchLayout(this.value)">
                                <option value="standard">æ ‡å‡†å¸ƒå±€</option>
                                <option value="compact">ç´§å‡‘å¸ƒå±€</option>
                                <option value="expanded">å±•å¼€å¸ƒå±€</option>
                            </select>
                        </div>

                        <!-- è®¾ç½®æŒ‰é’® -->
                        <button class="settings-btn" onclick="toggleSettings()" title="ä¸ªæ€§åŒ–è®¾ç½®">âš™ï¸</button>
                    </div>
                    
                    <div class="device-status" onclick="navigateToDeviceView()" style="cursor: pointer;" title="ç‚¹å‡»æŸ¥çœ‹è®¾å¤‡è¯¦æƒ…">
                        <div class="status-indicator"></div>
                        <span id="deviceStatusText">è®¾å¤‡åœ¨çº¿</span>
                        <span style="margin-left: 8px; color: rgba(0,228,255,0.6); font-size: 10px;">â–¶</span>
                    </div>
                    <button class="close-btn" onclick="window.close()">âœ•</button>
                </div>
            </header>

            <!-- å·¦ä¾§å¥åº·æŒ‡æ ‡é¢æ¿ -->
            <aside class="left-panel">
                <!-- å¿ƒç‡å¡ç‰‡ -->
                <div class="health-card" id="heartRateCard" onclick="showHealthDetails('heartRate')">
                    <div class="card-header">
                        <div class="card-title">
                            <span class="card-icon">ğŸ’“</span>
                            <span>å®æ—¶å¿ƒç‡</span>
                        </div>
                        <div class="health-status" id="heartRateStatus"></div>
                    </div>
                    <div class="advanced-gauge">
                        <div class="gauge-container">
                            <div id="heartRateGauge" style="width: 100%; height: 100%;"></div>
                            <div class="gauge-value-display">
                                <div class="gauge-value" id="heartRateValue">--</div>
                                <div class="gauge-unit">BPM</div>
                            </div>
                        </div>
                    </div>
                    <div class="health-details">
                        <div class="detail-item">
                            <span class="detail-label">æœ€é«˜</span>
                            <span class="detail-value" id="heartRateMax">--</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">æœ€ä½</span>
                            <span class="detail-value" id="heartRateMin">--</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">å¹³å‡</span>
                            <span class="detail-value" id="heartRateAvg">--</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">çŠ¶æ€</span>
                            <span class="detail-value" id="heartRateLevel">æ­£å¸¸</span>
                        </div>
                    </div>
                </div>

                <!-- è¡€æ°§å¡ç‰‡ -->
                <div class="health-card" id="bloodOxygenCard" onclick="showHealthDetails('bloodOxygen')">
                    <div class="card-header">
                        <div class="card-title">
                            <span class="card-icon">ğŸ©¸</span>
                            <span>è¡€æ°§é¥±å’Œåº¦</span>
                        </div>
                        <div class="health-status" id="bloodOxygenStatus"></div>
                    </div>
                    <div class="advanced-gauge">
                        <div class="gauge-container">
                            <div id="bloodOxygenGauge" style="width: 100%; height: 100%;"></div>
                            <div class="gauge-value-display">
                                <div class="gauge-value" id="bloodOxygenValue">--</div>
                                <div class="gauge-unit">%</div>
                            </div>
                        </div>
                    </div>
                    <div class="health-details">
                        <div class="detail-item">
                            <span class="detail-label">æœ€é«˜</span>
                            <span class="detail-value" id="bloodOxygenMax">--</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">æœ€ä½</span>
                            <span class="detail-value" id="bloodOxygenMin">--</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">å¹³å‡</span>
                            <span class="detail-value" id="bloodOxygenAvg">--</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">çŠ¶æ€</span>
                            <span class="detail-value" id="bloodOxygenLevel">æ­£å¸¸</span>
                        </div>
                    </div>
                </div>

                <!-- ä½“æ¸©å¡ç‰‡ -->
                <div class="health-card" id="temperatureCard" onclick="showHealthDetails('temperature')">
                    <div class="card-header">
                        <div class="card-title">
                            <span class="card-icon">ğŸŒ¡ï¸</span>
                            <span>ä½“æ¸©</span>
                        </div>
                        <div class="health-status" id="temperatureStatus"></div>
                    </div>
                    <div class="advanced-gauge">
                        <div class="gauge-container">
                            <div id="temperatureGauge" style="width: 100%; height: 100%;"></div>
                            <div class="gauge-value-display">
                                <div class="gauge-value" id="temperatureValue">--</div>
                                <div class="gauge-unit">Â°C</div>
                            </div>
                        </div>
                    </div>
                    <div class="health-details">
                        <div class="detail-item">
                            <span class="detail-label">æ”¶ç¼©å‹</span>
                            <span class="detail-value" id="systolicValue">--</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">èˆ’å¼ å‹</span>
                            <span class="detail-value" id="diastolicValue">--</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">æ­¥æ•°</span>
                            <span class="detail-value" id="stepCount">--</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">æ´»åŠ¨</span>
                            <span class="detail-value" id="activityLevel">è½»åº¦</span>
                        </div>
                    </div>
                </div>
            </aside>
            <main class="center-panel">
                <!-- å¥åº·ç»¼åˆè¯„åˆ† -->
                <div class="health-score-section">
                    <!-- å¥åº·é¢„æµ‹ -->
                    <div class="health-prediction">
                        <div class="prediction-header">
                            <div class="prediction-icon">ğŸ”®</div>
                            <div class="prediction-title">å¥åº·é¢„æµ‹</div>
                        </div>
                        <div class="prediction-item">
                            <div class="prediction-label">ç–²åŠ³é£é™©</div>
                            <div class="prediction-content">
                                åŸºäºè¿ç»­6å°æ—¶ä½œä¸šç›‘æµ‹ï¼Œå»ºè®®åœ¨1å°æ—¶å†…å®‰æ’ä¼‘æ¯
                                <span class="prediction-risk">âš ï¸ è½»åº¦ç–²åŠ³</span>
                            </div>
                        </div>
                        <div class="prediction-item">
                            <div class="prediction-label">ä½œä¸šå®‰å…¨æŒ‡æ•°</div>
                            <div class="prediction-content">
                                å½“å‰ç”Ÿç†æŒ‡æ ‡é€‚å®œç»§ç»­ç²¾å¯†æ“ä½œä»»åŠ¡
                                <span class="prediction-risk">âœ… ä¼˜ç§€</span>
                            </div>
                        </div>
                        <div class="prediction-item">
                            <div class="prediction-label">ç¯å¢ƒé€‚åº”æ€§</div>
                            <div class="prediction-content">
                                è½¦é—´ç¯å¢ƒæ¸©åº¦é€‚å®œï¼Œå»ºè®®ä¿æŒå½“å‰ä½œä¸šå¼ºåº¦
                                <span class="prediction-risk">ğŸ“ˆ ç†æƒ³</span>
                            </div>
                        </div>
                    </div>

                    <!-- å¥åº·ç»¼åˆè¯„åˆ†ä¸­å¿ƒ -->
                    <div class="health-score-center">
                        <div class="score-circle" id="healthScoreCircle">
                            <div class="score-number" id="healthScore">95</div>
                        </div>
                        <h3 style="color: #ffffff; margin: 0;">å¥åº·ç»¼åˆè¯„åˆ†</h3>
                        <p style="color: rgba(255,255,255,0.7); font-size: 12px; margin: 5px 0 0 0;">åŸºäºå®æ—¶ä½“å¾æ•°æ®æ™ºèƒ½è¯„ä¼°</p>
                    </div>

                    <!-- å¥åº·å»ºè®® -->
                    <div class="health-recommendations">
                        <div class="recommendations-header">
                            <div class="recommendations-icon">ğŸ’¡</div>
                            <div class="recommendations-title">å¥åº·å»ºè®®</div>
                        </div>
                        <div class="recommendation-item">
                            <div class="recommendation-icon">ğŸ’§</div>
                            <div class="recommendation-text">
                                é€‚å½“è¡¥å……æ°´åˆ†ï¼Œå»ºè®®æ¯å°æ—¶é¥®æ°´200ml
                                <div class="recommendation-priority">é«˜ä¼˜å…ˆçº§</div>
                            </div>
                        </div>
                        <div class="recommendation-item">
                            <div class="recommendation-icon">ğŸƒ</div>
                            <div class="recommendation-text">
                                å¿ƒç‡è¾ƒä¸ºå¹³ç¨³ï¼Œå¯è¿›è¡Œä¸­ç­‰å¼ºåº¦è¿åŠ¨
                                <div class="recommendation-priority">å»ºè®®</div>
                            </div>
                        </div>
                        <div class="recommendation-item">
                            <div class="recommendation-icon">ğŸ˜´</div>
                            <div class="recommendation-text">
                                ä¿è¯7-8å°æ—¶ä¼˜è´¨ç¡çœ æ—¶é—´
                                <div class="recommendation-priority">æ—¥å¸¸</div>
                            </div>
                        </div>
                        <div class="recommendation-item">
                            <div class="recommendation-icon">ğŸ¥—</div>
                            <div class="recommendation-text">
                                å»ºè®®æ‘„å…¥å¯Œå«ç»´ç”Ÿç´ çš„è”¬æœç±»é£Ÿç‰©
                                <div class="recommendation-priority">è¥å…»</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- å®æ—¶ç”Ÿå‘½ä½“å¾æ³¢å½¢ -->
                <div class="vital-wave-section">
                    <div class="wave-header">
                        <h4 style="color: #ffffff; margin: 0;">ğŸ“ˆ å®æ—¶ç”Ÿå‘½ä½“å¾</h4>
                        <div class="wave-controls">
                            <button class="wave-btn active" onclick="switchWaveType('heart')">å¿ƒç‡æ³¢å½¢</button>
                            <button class="wave-btn" onclick="switchWaveType('oxygen')">è¡€æ°§å˜åŒ–</button>
                            <button class="wave-btn" onclick="switchWaveType('temp')">ä½“æ¸©æ›²çº¿</button>
                        </div>
                    </div>
                    <div id="vitalWaveChart" style="height: 200px; width: 100%;"></div>
                </div>

                <!-- åŸæœ‰ä¸»è¶‹åŠ¿å›¾ -->
                <div class="main-chart-container">
                    <div class="chart-header">
                        <div class="chart-title">
                            <span>ğŸ“Š</span>
                            <span>å¥åº·æ•°æ®è¶‹åŠ¿</span>
                        </div>
                        <div class="chart-controls">
                            <button class="control-btn active" onclick="switchTimeRange('1h')">1å°æ—¶</button>
                            <button class="control-btn" onclick="switchTimeRange('6h')">6å°æ—¶</button>
                            <button class="control-btn" onclick="switchTimeRange('24h')">24å°æ—¶</button>
                            <button class="control-btn" onclick="switchTimeRange('7d')">7å¤©</button>
                        </div>
                    </div>
                    <div id="mainChart" class="main-chart"></div>
                </div>

                <!-- å¥åº·å¯¹æ¯”è¶‹åŠ¿ -->
                <div class="trend-comparison">
                    <div class="trend-item">
                        <span class="trend-label">è¾ƒæ˜¨æ—¥</span>
                        <span class="trend-value positive" id="yesterdayTrend">+2%</span>
                    </div>
                    <div class="trend-item">
                        <span class="trend-label">è¾ƒæœ¬å‘¨</span>
                        <span class="trend-value negative" id="weekTrend">-1%</span>
                    </div>
                    <div class="trend-item">
                        <span class="trend-label">è¾ƒæœ¬æœˆ</span>
                        <span class="trend-value neutral" id="monthTrend">+0%</span>
                    </div>
                </div>
            </main>

            <!-- å³ä¾§æ¶ˆæ¯å’Œå‘Šè­¦é¢æ¿ -->
            <aside class="right-panel">

                <!-- æ¶ˆæ¯é€šçŸ¥é¢æ¿ -->
                <div class="message-panel" onclick="navigateToMessageView()" style="cursor: pointer;">
                    <div class="panel-header">
                        <div class="panel-title">
                            <span>ğŸ’¬</span>
                            <span>æ¶ˆæ¯é€šçŸ¥</span>
                            <span style="float: right; color: rgba(0,228,255,0.6); font-size: 10px; margin-left: 10px;">ç‚¹å‡»æŸ¥çœ‹ â–¶</span>
                        </div>
                        <div class="message-count" id="messageCount">0</div>
                    </div>
                    <div class="message-list" id="messageList">
                        <!-- æ¶ˆæ¯å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                        <div class="message-item">
                            <div class="message-content">ç³»ç»Ÿæ­£åœ¨åŠ è½½æ¶ˆæ¯...</div>
                            <div class="message-meta">
                                <div class="message-type system">ç³»ç»Ÿ</div>
                                <div class="message-time">--:--</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- å‘Šè­¦é¢æ¿ -->
                <div class="alert-panel" onclick="navigateToAlertView()" style="cursor: pointer;">
                    <div class="panel-header">
                        <div class="panel-title">
                            <span>ğŸš¨</span>
                            <span>å¥åº·å‘Šè­¦</span>
                        </div>
                        <div class="alert-trend">ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ… â–¶</div>
                    </div>
                    <div class="alert-summary">
                        <div class="alert-count" id="alertCount">0</div>
                        <div class="alert-trend" id="alertTrend">ä»Šæ—¥æ–°å¢ 0 æ¡</div>
                    </div>
                    <div class="alert-list" id="alertList">
                        <!-- å‘Šè­¦å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <script>
        // ============= å…¨å±€å˜é‡ =============
        let deviceSn = '';
        // WebSocket removed for performance optimization
        let currentTimeRange = '1h';
        let healthData = {};
        let chartInstances = {};
        let currentWaveType = 'heart';
        let employeeData = {
            name: 'æå»ºå',
            id: 'EMP20241108', 
            department: 'æ™ºèƒ½åˆ¶é€ è½¦é—´',
            avatar: '/static/health-assets/default-avatar.png',
            confirmed: true
        };

        // ============= åˆå§‹åŒ–å‡½æ•° =============
        document.addEventListener('DOMContentLoaded', function() {
            // ç­‰å¾…EChartsåº“åŠ è½½å®Œæˆ
            waitForECharts(() => {
                initializeApp();
            });
        });

        function waitForECharts(callback) {
            if (typeof echarts !== 'undefined') {
                callback();
            } else {
                console.log('â³ ç­‰å¾…EChartsåº“åŠ è½½...');
                setTimeout(() => waitForECharts(callback), 100);
            }
        }

        function initializeApp() {
            // ä»URLè·å–è®¾å¤‡åºåˆ—å·
            const urlParams = new URLSearchParams(window.location.search);
            deviceSn = urlParams.get('deviceSn') || '';
            
            console.log('ğŸš€ åˆå§‹åŒ–ä¸ªäººå¥åº·å¤§å± v1.3.5');
            console.log('ğŸ“± è®¾å¤‡åºåˆ—å·:', deviceSn);
            
            // åˆå§‹åŒ–è®¾å¤‡çŠ¶æ€æ˜¾ç¤º
            initializeDeviceStatusDisplay();
            
            // åˆå§‹åŒ–å›¾è¡¨
            try {
                initializeCharts();
                console.log('âœ… EChartså›¾è¡¨åˆå§‹åŒ–æˆåŠŸ');
            } catch (error) {
                console.error('âŒ EChartså›¾è¡¨åˆå§‹åŒ–å¤±è´¥:', error);
                // æä¾›é™çº§æ–¹æ¡ˆ
                initializeFallbackCharts();
            }
            
            // åˆå§‹åŒ–å‘˜å·¥ä¿¡æ¯
            initializeEmployeeInfo();
            
            // åŠ è½½ä¸ªæ€§åŒ–è®¾ç½®
            loadPersonalizationSettings();
            
            // åŠ è½½å¥åº·æ•°æ®
            loadHealthData();
            
            // åŠ è½½æ¶ˆæ¯å’Œå‘Šè­¦
            loadMessages();
            loadAlerts();
            
            // åŠ è½½è®¾å¤‡çŠ¶æ€
            loadDeviceStatus();
            
            // åŠ è½½å†å²è¶‹åŠ¿æ•°æ®
            loadHistoryChart();
            
            // WebSocket removed for performance optimization
            
            // åˆå§‹åŒ–å“åº”å¼å¸ƒå±€
            initializeResponsive();
            
            // åˆå§‹åŒ–æ³¢å½¢å›¾è¡¨
            initializeWaveChart();
            
            // è®¾ç½®å®šæ—¶åˆ·æ–°
            setInterval(loadHealthData, 10000);     // 10ç§’åˆ·æ–°å¥åº·æ•°æ®
            setInterval(loadMessages, 30000);       // 30ç§’åˆ·æ–°æ¶ˆæ¯
            setInterval(loadAlerts, 30000);         // 30ç§’åˆ·æ–°å‘Šè­¦
            setInterval(loadDeviceStatus, 60000);   // 60ç§’åˆ·æ–°è®¾å¤‡çŠ¶æ€
            setInterval(loadHistoryChart, 300000);  // 5åˆ†é’Ÿåˆ·æ–°å†å²æ•°æ®
        }

        // ============= å‘˜å·¥ä¿¡æ¯ç®¡ç† =============
        function initializeEmployeeInfo() {
            // æ£€æŸ¥å‘˜å·¥ä¿¡æ¯å…ƒç´ æ˜¯å¦å­˜åœ¨ï¼ˆå› ä¸ºå¯èƒ½å·²è¢«ç§»é™¤ï¼‰
            const employeeNameEl = document.getElementById('employeeName');
            const employeeIdEl = document.getElementById('employeeId');
            const employeeDeptEl = document.getElementById('employeeDept');
            const photoElement = document.getElementById('employeePhoto');
            
            // æ›´æ–°å¤´éƒ¨ç”¨æˆ·ä¿¡æ¯
            const headerEmployeeNameEl = document.getElementById('headerEmployeeName');
            const headerEmployeeIdEl = document.getElementById('headerEmployeeId');
            const headerEmployeeDeptEl = document.getElementById('headerEmployeeDept');
            const headerPhotoElement = document.getElementById('headerEmployeePhoto');
            
            if (employeeNameEl) employeeNameEl.textContent = employeeData.name;
            if (employeeIdEl) employeeIdEl.textContent = `å·¥å·: ${employeeData.id}`;
            if (employeeDeptEl) employeeDeptEl.textContent = `éƒ¨é—¨: ${employeeData.department}`;
            if (photoElement) photoElement.src = employeeData.avatar;
            
            // æ›´æ–°å¤´éƒ¨æ˜¾ç¤º
            if (headerEmployeeNameEl) headerEmployeeNameEl.textContent = employeeData.name;
            // Note: These elements have been renamed to headerEmployeeRole and headerEmployeeDevice
            if (headerPhotoElement) headerPhotoElement.src = employeeData.avatar;
            
            console.log('ğŸ‘¤ å‘˜å·¥ä¿¡æ¯åˆå§‹åŒ–å®Œæˆ:', employeeData);
        }

        function confirmEmployee() {
            if (!employeeData.confirmed) {
                employeeData.confirmed = true;
                const confirmBtn = document.querySelector('.confirm-btn');
                confirmBtn.textContent = 'âœ“ å·²ç¡®è®¤';
                confirmBtn.style.background = 'linear-gradient(45deg, #00ff3c, #00e635)';
                
                // æ·»åŠ ç¡®è®¤åŠ¨æ•ˆ
                confirmBtn.style.transform = 'scale(1.1)';
                setTimeout(() => {
                    confirmBtn.style.transform = 'scale(1)';
                }, 200);
                
                console.log('âœ… å‘˜å·¥èº«ä»½å·²ç¡®è®¤:', employeeData.name);
                showToast(`å‘˜å·¥ ${employeeData.name} èº«ä»½ç¡®è®¤æˆåŠŸ`, 'success');
            }
        }

        // ============= æ³¢å½¢å›¾è¡¨åŠŸèƒ½ =============
        function initializeWaveChart() {
            if (typeof echarts === 'undefined') {
                console.warn('âš ï¸ EChartsæœªåŠ è½½ï¼Œè·³è¿‡æ³¢å½¢å›¾åˆå§‹åŒ–');
                return;
            }
            
            const waveChartElement = document.getElementById('vitalWaveChart');
            if (!waveChartElement) {
                console.warn('âš ï¸ æ³¢å½¢å›¾å®¹å™¨ä¸å­˜åœ¨');
                return;
            }
            
            try {
                // åˆå§‹åŒ–å®æ—¶æ³¢å½¢å›¾
                chartInstances.vitalWaveChart = echarts.init(waveChartElement);
                const option = {
                backgroundColor: 'transparent',
                grid: {
                    left: '5%', right: '5%', top: '10%', bottom: '15%'
                },
                xAxis: {
                    type: 'category',
                    data: [],
                    axisLine: { 
                        lineStyle: { color: 'rgba(255,107,107,0.4)' }
                    },
                    axisLabel: { 
                        color: 'rgba(255,255,255,0.8)',
                        fontSize: 10
                    }
                },
                yAxis: {
                    type: 'value',
                    axisLine: { 
                        lineStyle: { color: 'rgba(255,107,107,0.4)' }
                    },
                    axisLabel: { 
                        color: 'rgba(255,255,255,0.8)',
                        fontSize: 10
                    },
                    splitLine: {
                        lineStyle: { 
                            color: 'rgba(255,255,255,0.1)',
                            type: 'dashed'
                        }
                    }
                },
                series: [{
                    type: 'line',
                    data: [],
                    smooth: true,
                    lineStyle: {
                        color: '#ff6b6b',
                        width: 3,
                        shadowColor: '#ff6b6b',
                        shadowBlur: 10
                    },
                    itemStyle: {
                        color: '#ff6b6b'
                    },
                    areaStyle: {
                        color: {
                            type: 'linear',
                            x: 0, y: 0, x2: 0, y2: 1,
                            colorStops: [
                                { offset: 0, color: 'rgba(255,107,107,0.3)' },
                                { offset: 1, color: 'rgba(255,107,107,0.05)' }
                            ]
                        }
                    }
                }]
            };
            
            chartInstances.vitalWaveChart.setOption(option);
            
            // ç”Ÿæˆæ¨¡æ‹Ÿå®æ—¶æ•°æ®
            generateWaveData('heart');
            
            } catch (error) {
                console.error('âŒ æ³¢å½¢å›¾åˆå§‹åŒ–å¤±è´¥:', error);
                // æ˜¾ç¤ºé”™è¯¯æç¤º
                waveChartElement.innerHTML = `
                    <div style="
                        display: flex; 
                        align-items: center; 
                        justify-content: center; 
                        height: 200px; 
                        color: #ff6b6b; 
                        font-size: 14px;
                    ">
                        æ³¢å½¢å›¾æš‚æ—¶æ— æ³•æ˜¾ç¤º
                    </div>
                `;
            }
        }

        function switchWaveType(waveType) {
            currentWaveType = waveType;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.wave-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            generateWaveData(waveType);
            console.log('ğŸ“ˆ åˆ‡æ¢æ³¢å½¢å›¾ç±»å‹:', waveType);
        }

        function generateWaveData(type) {
            const now = new Date();
            const data = [];
            const timeLabels = [];
            
            for (let i = 29; i >= 0; i--) {
                const time = new Date(now - i * 2000); // æ¯2ç§’ä¸€ä¸ªæ•°æ®ç‚¹
                timeLabels.push(time.toLocaleTimeString().slice(-8));
                
                let value;
                if (type === 'heart') {
                    // å¿ƒç‡æ³¢å½¢ (60-100 BPM)
                    value = 75 + Math.sin(i * 0.3) * 15 + Math.random() * 10 - 5;
                } else if (type === 'oxygen') {
                    // è¡€æ°§æ³¢å½¢ (95-100%)
                    value = 97 + Math.sin(i * 0.2) * 2 + Math.random() * 2 - 1;
                } else if (type === 'temp') {
                    // ä½“æ¸©æ³¢å½¢ (36-38Â°C)
                    value = 36.5 + Math.sin(i * 0.1) * 0.8 + Math.random() * 0.4 - 0.2;
                }
                data.push(Math.round(value * 100) / 100);
            }
            
            // æ›´æ–°å›¾è¡¨é¢œè‰²å’Œæ ‡é¢˜
            let color, title;
            if (type === 'heart') {
                color = '#ff6b6b';
                title = 'å¿ƒç‡æ³¢å½¢ (BPM)';
            } else if (type === 'oxygen') {
                color = '#00e4ff';
                title = 'è¡€æ°§é¥±å’Œåº¦ (%)';
            } else if (type === 'temp') {
                color = '#ffaa00';
                title = 'ä½“æ¸©å˜åŒ– (Â°C)';
            }
            
            chartInstances.vitalWaveChart.setOption({
                title: {
                    text: title,
                    textStyle: { 
                        color: color, 
                        fontSize: 14 
                    },
                    left: 'center'
                },
                xAxis: { data: timeLabels },
                series: [{
                    data: data,
                    lineStyle: { color: color, shadowColor: color },
                    itemStyle: { color: color },
                    areaStyle: {
                        color: {
                            type: 'linear',
                            x: 0, y: 0, x2: 0, y2: 1,
                            colorStops: [
                                { offset: 0, color: color + '40' },
                                { offset: 1, color: color + '08' }
                            ]
                        }
                    }
                }]
            });
        }

        // ============= å¥åº·è¯¦æƒ…äºŒçº§ç•Œé¢ =============
        function showHealthDetails(cardType) {
            const titles = {
                heartRate: 'ğŸ’“ å¿ƒç‡è¯¦ç»†åˆ†æ',
                bloodOxygen: 'ğŸ©¸ è¡€æ°§è¯¦ç»†åˆ†æ', 
                temperature: 'ğŸŒ¡ï¸ ä½“æ¸©è¯¦ç»†åˆ†æ'
            };
            
            const detailModal = `
                <div class="health-detail-modal" id="healthDetailModal" style="
                    position: fixed; top: 0; left: 0; right: 0; bottom: 0;
                    background: rgba(0,0,0,0.8); z-index: 10000;
                    display: flex; align-items: center; justify-content: center;
                    opacity: 0; transition: opacity 0.3s ease;
                ">
                    <div class="detail-content" style="
                        background: linear-gradient(145deg, rgba(13,20,33,0.95), rgba(6,18,25,0.95));
                        border: 1px solid rgba(0,255,157,0.3);
                        border-radius: 16px; width: 90%; max-width: 800px; 
                        max-height: 80vh; overflow-y: auto;
                        backdrop-filter: blur(20px);
                        transform: scale(0.9); transition: transform 0.3s ease;
                    ">
                        <div class="detail-header" style="
                            padding: 20px; border-bottom: 1px solid rgba(0,255,157,0.2);
                            display: flex; justify-content: space-between; align-items: center;
                        ">
                            <h2 style="color: #ffffff; margin: 0; font-size: 20px;">${titles[cardType]}</h2>
                            <button onclick="closeHealthDetail()" style="
                                background: transparent; border: 1px solid rgba(255,71,87,0.3);
                                color: #ff4757; width: 32px; height: 32px; border-radius: 6px;
                                cursor: pointer; font-size: 18px;
                            ">âœ•</button>
                        </div>
                        <div class="detail-tabs" style="
                            display: flex; background: rgba(0,21,41,0.3);
                            border-bottom: 1px solid rgba(0,255,157,0.2);
                        ">
                            <button class="detail-tab active" data-tab="realtime" onclick="switchDetailTab('realtime')" style="
                                flex: 1; padding: 15px; background: rgba(0,255,157,0.2);
                                border: none; color: #00ff9d; cursor: pointer;
                            ">å®æ—¶ç›‘æµ‹</button>
                            <button class="detail-tab" data-tab="history" onclick="switchDetailTab('history')" style="
                                flex: 1; padding: 15px; background: transparent;
                                border: none; color: rgba(255,255,255,0.7); cursor: pointer;
                            ">å†å²è¶‹åŠ¿</button>
                            <button class="detail-tab" data-tab="analysis" onclick="switchDetailTab('analysis')" style="
                                flex: 1; padding: 15px; background: transparent;
                                border: none; color: rgba(255,255,255,0.7); cursor: pointer;
                            ">AIåˆ†æ</button>
                        </div>
                        <div class="tab-content" id="detailTabContent" style="padding: 20px;">
                            ${generateDetailContent(cardType, 'realtime')}
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', detailModal);
            
            // æ˜¾ç¤ºåŠ¨ç”»
            setTimeout(() => {
                const modal = document.getElementById('healthDetailModal');
                modal.style.opacity = '1';
                modal.querySelector('.detail-content').style.transform = 'scale(1)';
            }, 10);
            
            console.log('ğŸ” æ˜¾ç¤ºå¥åº·è¯¦æƒ…:', cardType);
        }

        function closeHealthDetail() {
            const modal = document.getElementById('healthDetailModal');
            if (modal) {
                modal.style.opacity = '0';
                modal.querySelector('.detail-content').style.transform = 'scale(0.9)';
                setTimeout(() => modal.remove(), 300);
            }
        }

        function switchDetailTab(tabType) {
            // æ›´æ–°æ ‡ç­¾çŠ¶æ€
            document.querySelectorAll('.detail-tab').forEach(tab => {
                tab.classList.remove('active');
                tab.style.background = 'transparent';
                tab.style.color = 'rgba(255,255,255,0.7)';
            });
            
            event.target.classList.add('active');
            event.target.style.background = 'rgba(0,255,157,0.2)';
            event.target.style.color = '#00ff9d';
            
            // æ›´æ–°å†…å®¹
            const contentArea = document.getElementById('detailTabContent');
            contentArea.innerHTML = generateDetailContent('heartRate', tabType); // ç¤ºä¾‹ç”¨å¿ƒç‡
        }

        function generateDetailContent(cardType, tabType) {
            if (tabType === 'realtime') {
                return `
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div style="text-align: center;">
                            <h4 style="color: #00ff9d; margin-bottom: 15px;">å½“å‰æ•°å€¼</h4>
                            <div style="font-size: 48px; font-weight: bold; color: #ff6b6b; margin: 20px 0;">75</div>
                            <div style="color: rgba(255,255,255,0.8);">BPM</div>
                            <div style="margin-top: 15px; padding: 10px; background: rgba(0,255,60,0.1); border-radius: 8px; color: #00ff3c;">
                                âœ“ æ­£å¸¸èŒƒå›´
                            </div>
                        </div>
                        <div>
                            <h4 style="color: #00ff9d; margin-bottom: 15px;">ä»Šæ—¥ç»Ÿè®¡</h4>
                            <div style="display: flex; justify-content: space-between; margin: 10px 0; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.1);">
                                <span style="color: rgba(255,255,255,0.7);">æœ€é«˜:</span>
                                <span style="color: #ffffff; font-weight: bold;">89 BPM</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin: 10px 0; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.1);">
                                <span style="color: rgba(255,255,255,0.7);">æœ€ä½:</span>
                                <span style="color: #ffffff; font-weight: bold;">62 BPM</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin: 10px 0; padding: 8px 0;">
                                <span style="color: rgba(255,255,255,0.7);">å¹³å‡:</span>
                                <span style="color: #ffffff; font-weight: bold;">75 BPM</span>
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: 20px;">
                        <h4 style="color: #00ff9d; margin-bottom: 10px;">å¥åº·å»ºè®®</h4>
                        <div style="background: rgba(0,228,255,0.1); padding: 15px; border-radius: 8px; border-left: 3px solid #00e4ff;">
                            <p style="color: #ffffff; margin: 0; line-height: 1.6;">
                                æ‚¨çš„å¿ƒç‡å¤„äºæ­£å¸¸èŒƒå›´å†…ï¼Œå»ºè®®ä¿æŒè§„å¾‹çš„ä½œæ¯æ—¶é—´ï¼Œé€‚é‡è¿åŠ¨ï¼Œé¿å…è¿‡åº¦åŠ³ç´¯ã€‚
                            </p>
                        </div>
                    </div>
                `;
            } else if (tabType === 'history') {
                return `
                    <div style="text-align: center; color: rgba(255,255,255,0.8); padding: 40px;">
                        <div style="font-size: 48px; margin-bottom: 20px;">ğŸ“Š</div>
                        <h3 style="color: #00ff9d;">å†å²è¶‹åŠ¿åˆ†æ</h3>
                        <p>æ˜¾ç¤ºè¿‡å»7å¤©çš„å¥åº·æ•°æ®å˜åŒ–è¶‹åŠ¿</p>
                        <div style="margin-top: 20px; padding: 15px; background: rgba(0,255,157,0.1); border-radius: 8px;">
                            åŠŸèƒ½å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…...
                        </div>
                    </div>
                `;
            } else if (tabType === 'analysis') {
                return `
                    <div style="text-align: center; color: rgba(255,255,255,0.8); padding: 40px;">
                        <div style="font-size: 48px; margin-bottom: 20px;">ğŸ¤–</div>
                        <h3 style="color: #00ff9d;">AIæ™ºèƒ½åˆ†æ</h3>
                        <p>åŸºäºæœºå™¨å­¦ä¹ ç®—æ³•çš„å¥åº·çŠ¶æ€è¯„ä¼°</p>
                        <div style="margin-top: 20px; padding: 15px; background: rgba(255,170,0,0.1); border-radius: 8px;">
                            AIåˆ†æåŠŸèƒ½æ­£åœ¨è®­ç»ƒä¸­...
                        </div>
                    </div>
                `;
            }
        }

        // ============= è®¾å¤‡çŠ¶æ€ç®¡ç† =============
        function updateDeviceStatus() {
            const statusText = document.getElementById('deviceStatusText');
            const statusIndicator = document.querySelector('.status-indicator');
            
            // è¿™é‡Œå¯ä»¥æ ¹æ®å®é™…æƒ…å†µæ›´æ–°è®¾å¤‡çŠ¶æ€
            statusText.textContent = `è®¾å¤‡ ${deviceSn} åœ¨çº¿`;
            statusIndicator.style.background = '#00ff9d';
        }

        // ============= å›¾è¡¨åˆå§‹åŒ– =============
        function initializeCharts() {
            if (typeof echarts === 'undefined') {
                throw new Error('EChartsåº“æœªåŠ è½½');
            }
            
            // åˆå§‹åŒ–å¿ƒç‡ä»ªè¡¨ç›˜
            const heartRateElement = document.getElementById('heartRateGauge');
            if (heartRateElement) {
                chartInstances.heartRateGauge = echarts.init(heartRateElement);
                chartInstances.heartRateGauge._chartName = 'å¿ƒç‡'; // æ ‡è®°å›¾è¡¨ç±»å‹
                initGaugeChart(chartInstances.heartRateGauge, 'å¿ƒç‡', 'BPM', 180, '#ff6b6b');
            }
            
            // åˆå§‹åŒ–è¡€æ°§ä»ªè¡¨ç›˜
            const bloodOxygenElement = document.getElementById('bloodOxygenGauge');
            if (bloodOxygenElement) {
                chartInstances.bloodOxygenGauge = echarts.init(bloodOxygenElement);
                chartInstances.bloodOxygenGauge._chartName = 'è¡€æ°§'; // æ ‡è®°å›¾è¡¨ç±»å‹
                initGaugeChart(chartInstances.bloodOxygenGauge, 'è¡€æ°§', '%', 100, '#00e4ff');
            }
            
            // åˆå§‹åŒ–ä½“æ¸©ä»ªè¡¨ç›˜
            const temperatureElement = document.getElementById('temperatureGauge');
            if (temperatureElement) {
                console.log('ğŸŒ¡ï¸ åˆå§‹åŒ–ä½“æ¸©ä»ªè¡¨ç›˜...');
                chartInstances.temperatureGauge = echarts.init(temperatureElement);
                chartInstances.temperatureGauge._chartName = 'ä½“æ¸©'; // æ ‡è®°å›¾è¡¨ç±»å‹
                initGaugeChart(chartInstances.temperatureGauge, 'ä½“æ¸©', 'Â°C', 50, '#ffaa00');
                
                // ç¡®ä¿ä½“æ¸©å¡ç‰‡å¯è§æ€§
                const tempCard = document.getElementById('temperatureCard');
                if (tempCard) {
                    tempCard.style.visibility = 'visible';
                    tempCard.style.display = 'flex';
                    console.log('âœ… ä½“æ¸©å¡ç‰‡å¯è§æ€§å·²ç¡®ä¿');
                }
            } else {
                console.error('âŒ ä½“æ¸©ä»ªè¡¨ç›˜å…ƒç´ æœªæ‰¾åˆ°');
            }
            
            // åˆå§‹åŒ–ä¸»è¶‹åŠ¿å›¾
            const mainChartElement = document.getElementById('mainChart');
            if (mainChartElement) {
                chartInstances.mainChart = echarts.init(mainChartElement);
                initTrendChart(chartInstances.mainChart);
            }
        }

        function initializeFallbackCharts() {
            console.log('ğŸ”„ åˆå§‹åŒ–é™çº§å›¾è¡¨...');
            // ä¸ºæ¯ä¸ªå›¾è¡¨å®¹å™¨æ˜¾ç¤ºé™æ€å†…å®¹
            const fallbackElements = [
                { id: 'heartRateGauge', text: 'å¿ƒç‡å›¾è¡¨åŠ è½½ä¸­...', color: '#ff6b6b' },
                { id: 'bloodOxygenGauge', text: 'è¡€æ°§å›¾è¡¨åŠ è½½ä¸­...', color: '#00e4ff' },
                { id: 'temperatureGauge', text: 'ä½“æ¸©å›¾è¡¨åŠ è½½ä¸­...', color: '#ffaa00' },
                { id: 'mainChart', text: 'ä¸»å›¾è¡¨åŠ è½½ä¸­...', color: '#00ff9d' }
            ];
            
            fallbackElements.forEach(item => {
                const element = document.getElementById(item.id);
                if (element) {
                    element.innerHTML = `
                        <div style="
                            display: flex; 
                            align-items: center; 
                            justify-content: center; 
                            height: 100%; 
                            color: ${item.color}; 
                            font-size: 14px;
                            background: rgba(13, 20, 33, 0.9);
                            border-radius: 8px;
                        ">
                            ${item.text}
                        </div>
                    `;
                }
            });
        }

        function initGaugeChart(chartInstance, name, unit, max, color) {
            // æ ¹æ®ä¸åŒçš„å¥åº·æŒ‡æ ‡åˆ›å»ºä¸“ä¸šçš„3Då¯è§†åŒ–
            if (name === 'å¿ƒç‡') {
                init3DHeartRateChart(chartInstance, color);
            } else if (name === 'è¡€æ°§') {
                init3DBloodOxygenChart(chartInstance, color);
            } else if (name === 'ä½“æ¸©') {
                init3DTemperatureChart(chartInstance, color);
            } else {
                // é»˜è®¤å¢å¼ºå‹ä»ªè¡¨ç›˜
                initEnhanced3DGauge(chartInstance, name, unit, max, color);
            }
        }

        function init3DHeartRateChart(chartInstance, color) {
            const option = {
                backgroundColor: 'transparent',
                graphic: [
                    // èƒŒæ™¯ç«‹ä½“ç¯
                    {
                        type: 'group',
                        left: 'center',
                        top: 'middle',
                        children: [
                            {
                                type: 'ring',
                                shape: {
                                    cx: 0, cy: 0,
                                    r: 120, r0: 100
                                },
                                style: {
                                    fill: {
                                        type: 'linear',
                                        x: 0, y: 0, x2: 1, y2: 1,
                                        colorStops: [
                                            {offset: 0, color: 'rgba(255, 107, 107, 0.1)'},
                                            {offset: 0.5, color: 'rgba(255, 107, 107, 0.3)'},
                                            {offset: 1, color: 'rgba(255, 107, 107, 0.05)'}
                                        ]
                                    },
                                    shadowColor: 'rgba(255, 107, 107, 0.5)',
                                    shadowBlur: 25,
                                    shadowOffsetX: 0,
                                    shadowOffsetY: 5
                                }
                            },
                            // å†…éƒ¨å‘å…‰ç¯
                            {
                                type: 'ring',
                                shape: {
                                    cx: 0, cy: -2,
                                    r: 105, r0: 95
                                },
                                style: {
                                    fill: {
                                        type: 'radial',
                                        x: 0.3, y: 0.3, r: 0.8,
                                        colorStops: [
                                            {offset: 0, color: 'rgba(255, 255, 255, 0.8)'},
                                            {offset: 0.4, color: 'rgba(255, 107, 107, 0.6)'},
                                            {offset: 1, color: 'rgba(255, 107, 107, 0.1)'}
                                        ]
                                    },
                                    shadowColor: 'rgba(255, 255, 255, 0.8)',
                                    shadowBlur: 15
                                }
                            }
                        ]
                    }
                ],
                series: [{
                    name: 'å¿ƒç‡ç›‘æµ‹',
                    type: 'gauge',
                    startAngle: 200,
                    endAngle: -40,
                    min: 40,
                    max: 180,
                    radius: '85%',
                    center: ['50%', '58%'],
                    splitNumber: 8,
                    
                    // å¢å¼º3Då¤–åœˆæ•ˆæœ
                    axisLine: {
                        lineStyle: {
                            width: 20,
                            color: [
                                [0.3, {
                                    type: 'linear',
                                    x: 0, y: 0, x2: 1, y2: 0,
                                    colorStops: [
                                        {offset: 0, color: '#00ff3c'},
                                        {offset: 0.5, color: '#00e635'},
                                        {offset: 1, color: '#00cc30'}
                                    ]
                                }], // æ­£å¸¸å¿ƒç‡åŒºé—´ - ç»¿è‰²æ¸å˜
                                [0.7, {
                                    type: 'linear',
                                    x: 0, y: 0, x2: 1, y2: 0,
                                    colorStops: [
                                        {offset: 0, color: '#ffaa00'},
                                        {offset: 0.5, color: '#ff9900'},
                                        {offset: 1, color: '#ff8800'}
                                    ]
                                }], // è½»åº¦å¼‚å¸¸ - æ©™è‰²æ¸å˜
                                [1, {
                                    type: 'linear',
                                    x: 0, y: 0, x2: 1, y2: 0,
                                    colorStops: [
                                        {offset: 0, color: '#ff4757'},
                                        {offset: 0.5, color: '#ff3838'},
                                        {offset: 1, color: '#ff2929'}
                                    ]
                                }]    // å±é™©åŒºé—´ - çº¢è‰²æ¸å˜
                            ],
                            shadowColor: `${color}99`,
                            shadowBlur: 30,
                            shadowOffsetX: 0,
                            shadowOffsetY: 8
                        }
                    },
                    
                    // 3Dåˆ»åº¦çº¿
                    axisTick: {
                        show: true,
                        splitNumber: 4,
                        length: 8,
                        lineStyle: {
                            color: '#ffffff66',
                            width: 2,
                            shadowColor: '#ffffff',
                            shadowBlur: 5
                        }
                    },
                    
                    // 3Dåˆ†å‰²çº¿
                    splitLine: {
                        show: true,
                        length: 15,
                        lineStyle: {
                            color: '#ffffff88',
                            width: 3,
                            shadowColor: '#ffffff',
                            shadowBlur: 8
                        }
                    },
                    
                    // åˆ»åº¦æ ‡ç­¾
                    axisLabel: {
                        show: true,
                        distance: 25,
                        color: '#ffffff',
                        fontSize: 12,
                        fontWeight: 'bold',
                        formatter: function(value) {
                            if (value === 60) return 'æ­£å¸¸';
                            if (value === 100) return 'åé«˜';
                            if (value === 140) return 'å±é™©';
                            return value;
                        }
                    },
                    
                    // 3DæŒ‡é’ˆ
                    pointer: {
                        show: true,
                        length: '75%',
                        width: 6,
                        itemStyle: {
                            color: {
                                type: 'linear',
                                x: 0, y: 0, x2: 0, y2: 1,
                                colorStops: [
                                    { offset: 0, color: '#ff6b6b' },
                                    { offset: 0.7, color: '#ff4757' },
                                    { offset: 1, color: '#2f1b14' }
                                ]
                            },
                            shadowColor: '#ff4757',
                            shadowBlur: 15,
                            shadowOffsetX: 0,
                            shadowOffsetY: 0
                        }
                    },
                    
                    // é”šç‚¹
                    anchor: {
                        show: true,
                        showAbove: true,
                        size: 12,
                        itemStyle: {
                            color: '#ff4757',
                            shadowColor: '#ff4757',
                            shadowBlur: 10
                        }
                    },
                    
                    // æ ‡é¢˜
                    title: {
                        show: true,
                        offsetCenter: [0, '85%'],
                        fontSize: 14,
                        fontWeight: 'bold',
                        color: '#ffffff'
                    },
                    
                    // æ•°å€¼æ˜¾ç¤º - ç¦ç”¨EChartsè‡ªå¸¦çš„æ˜¾ç¤ºï¼Œä½¿ç”¨HTMLè¦†ç›–å±‚
                    detail: {
                        show: false
                    },
                    
                    data: [{ 
                        value: 75,
                        name: 'ğŸ’“ å®æ—¶å¿ƒç‡'
                    }]
                }]
            };
            
            chartInstance.setOption(option);
        }

        function init3DBloodOxygenChart(chartInstance, color) {
            const option = {
                backgroundColor: 'transparent',
                series: [{
                    name: 'è¡€æ°§é¥±å’Œåº¦',
                    type: 'gauge',
                    startAngle: 200,
                    endAngle: -40,
                    min: 88,
                    max: 100,
                    radius: '88%',
                    center: ['50%', '58%'],
                    splitNumber: 6,
                    
                    // è¡€æ°§ä¸“ç”¨é¢œè‰²åˆ†åŒº
                    axisLine: {
                        lineStyle: {
                            width: 18,
                            color: [
                                [0.2, '#ff4757'], // å±é™©åŒºåŸŸ 88-90% - çº¢è‰²
                                [0.5, '#ffaa00'], // è­¦å‘ŠåŒºåŸŸ 90-95% - æ©™è‰²  
                                [1, '#00e4ff']    // æ­£å¸¸åŒºåŸŸ 95-100% - è“è‰²
                            ],
                            shadowColor: `${color}99`,
                            shadowBlur: 25,
                            shadowOffsetX: 0,
                            shadowOffsetY: 0
                        }
                    },
                    
                    // è¡€æ°§ç›‘æµ‹ä¸“ç”¨åˆ»åº¦
                    axisTick: {
                        show: true,
                        splitNumber: 3,
                        length: 10,
                        lineStyle: {
                            color: '#00e4ff88',
                            width: 3,
                            shadowColor: '#00e4ff',
                            shadowBlur: 8
                        }
                    },
                    
                    splitLine: {
                        show: true,
                        length: 20,
                        lineStyle: {
                            color: '#ffffff99',
                            width: 4,
                            shadowColor: '#ffffff',
                            shadowBlur: 10
                        }
                    },
                    
                    axisLabel: {
                        show: true,
                        distance: 30,
                        color: '#ffffff',
                        fontSize: 12,
                        fontWeight: 'bold',
                        formatter: function(value) {
                            if (value === 90) return 'ä½æ°§';
                            if (value === 95) return 'æ­£å¸¸';
                            if (value === 100) return 'ä¼˜ç§€';
                            return value + '%';
                        }
                    },
                    
                    // è¡€æ°§ä¸“ç”¨æŒ‡é’ˆ
                    pointer: {
                        show: true,
                        length: '80%',
                        width: 8,
                        itemStyle: {
                            color: {
                                type: 'radial',
                                x: 0.5, y: 0.5, r: 0.5,
                                colorStops: [
                                    { offset: 0, color: '#ffffff' },
                                    { offset: 0.7, color: '#00e4ff' },
                                    { offset: 1, color: '#0099cc' }
                                ]
                            },
                            shadowColor: '#00e4ff',
                            shadowBlur: 20
                        }
                    },
                    
                    anchor: {
                        show: true,
                        showAbove: true,
                        size: 15,
                        itemStyle: {
                            color: '#00e4ff',
                            shadowColor: '#00e4ff',
                            shadowBlur: 15
                        }
                    },
                    
                    title: {
                        show: true,
                        offsetCenter: [0, '85%'],
                        fontSize: 14,
                        fontWeight: 'bold',
                        color: '#ffffff'
                    },
                    
                    // æ•°å€¼æ˜¾ç¤º - ç¦ç”¨EChartsè‡ªå¸¦çš„æ˜¾ç¤ºï¼Œä½¿ç”¨HTMLè¦†ç›–å±‚
                    detail: {
                        show: false
                    },
                    
                    data: [{ 
                        value: 98,
                        name: 'ğŸ©¸ è¡€æ°§é¥±å’Œåº¦'
                    }]
                }]
            };
            
            chartInstance.setOption(option);
        }

        function init3DTemperatureChart(chartInstance, color) {
            const option = {
                backgroundColor: 'transparent',
                series: [{
                    name: 'ä½“æ¸©ç›‘æµ‹',
                    type: 'gauge',
                    startAngle: 200,
                    endAngle: -40,
                    min: 35.0,
                    max: 40.0,
                    radius: '88%',
                    center: ['50%', '58%'],
                    splitNumber: 10,
                    
                    // ä½“æ¸©ä¸“ç”¨é¢œè‰²åˆ†åŒº
                    axisLine: {
                        lineStyle: {
                            width: 16,
                            color: [
                                [0.2, '#00d4ff'], // ä½æ¸©åŒºåŸŸ 35.0-36.1Â°C - è“è‰²
                                [0.6, '#00ff3c'], // æ­£å¸¸åŒºåŸŸ 36.1-37.3Â°C - ç»¿è‰²
                                [0.8, '#ffaa00'], // å¾®çƒ­åŒºåŸŸ 37.3-38.0Â°C - æ©™è‰²
                                [1, '#ff4757']    // å‘çƒ­åŒºåŸŸ 38.0-40.0Â°C - çº¢è‰²
                            ],
                            shadowColor: `${color}77`,
                            shadowBlur: 22,
                            shadowOffsetX: 0,
                            shadowOffsetY: 0
                        }
                    },
                    
                    axisTick: {
                        show: true,
                        splitNumber: 5,
                        length: 8,
                        lineStyle: {
                            color: '#ffaa0088',
                            width: 2,
                            shadowColor: '#ffaa00',
                            shadowBlur: 6
                        }
                    },
                    
                    splitLine: {
                        show: true,
                        length: 18,
                        lineStyle: {
                            color: '#ffffff77',
                            width: 3,
                            shadowColor: '#ffffff',
                            shadowBlur: 8
                        }
                    },
                    
                    axisLabel: {
                        show: true,
                        distance: 28,
                        color: '#ffffff',
                        fontSize: 11,
                        fontWeight: 'bold',
                        formatter: function(value) {
                            if (value === 36.1) return 'æ­£å¸¸';
                            if (value === 37.3) return 'åé«˜';
                            if (value === 38.0) return 'å‘çƒ­';
                            return value.toFixed(1) + 'Â°C';
                        }
                    },
                    
                    // æ¸©åº¦è®¡æ ·å¼æŒ‡é’ˆ
                    pointer: {
                        show: true,
                        length: '78%',
                        width: 6,
                        itemStyle: {
                            color: {
                                type: 'linear',
                                x: 0, y: 0, x2: 0, y2: 1,
                                colorStops: [
                                    { offset: 0, color: '#ffffff' },
                                    { offset: 0.3, color: '#ffaa00' },
                                    { offset: 0.7, color: '#ff6600' },
                                    { offset: 1, color: '#cc0000' }
                                ]
                            },
                            shadowColor: '#ffaa00',
                            shadowBlur: 18
                        }
                    },
                    
                    anchor: {
                        show: true,
                        showAbove: true,
                        size: 14,
                        itemStyle: {
                            color: '#ffaa00',
                            shadowColor: '#ffaa00',
                            shadowBlur: 12
                        }
                    },
                    
                    title: {
                        show: true,
                        offsetCenter: [0, '85%'],
                        fontSize: 14,
                        fontWeight: 'bold',
                        color: '#ffffff'
                    },
                    
                    // æ•°å€¼æ˜¾ç¤º - ç¦ç”¨EChartsè‡ªå¸¦çš„æ˜¾ç¤ºï¼Œä½¿ç”¨HTMLè¦†ç›–å±‚
                    detail: {
                        show: false
                    },
                    
                    data: [{ 
                        value: 36.5,
                        name: 'ğŸŒ¡ï¸ ä½“æ¸©ç›‘æµ‹'
                    }]
                }]
            };
            
            chartInstance.setOption(option);
        }

        function initEnhanced3DGauge(chartInstance, name, unit, max, color) {
            const option = {
                series: [{
                    name: name,
                    type: 'gauge',
                    startAngle: 200,
                    endAngle: -40,
                    min: 0,
                    max: max,
                    radius: '85%',
                    center: ['50%', '55%'],
                    splitNumber: 10,
                    itemStyle: {
                        color: color,
                        shadowColor: `${color}88`,
                        shadowBlur: 15
                    },
                    progress: {
                        show: true,
                        width: 12,
                        itemStyle: {
                            color: {
                                type: 'linear',
                                x: 0, y: 0, x2: 1, y2: 0,
                                colorStops: [
                                    { offset: 0, color: color + '33' },
                                    { offset: 0.5, color: color + '88' },
                                    { offset: 1, color: color }
                                ]
                            },
                            shadowColor: color,
                            shadowBlur: 20
                        }
                    },
                    pointer: {
                        show: true,
                        length: '75%',
                        width: 5,
                        itemStyle: {
                            color: color,
                            shadowColor: color,
                            shadowBlur: 10
                        }
                    },
                    axisLine: {
                        lineStyle: {
                            width: 12,
                            color: [[1, `${color}33`]],
                            shadowColor: `${color}66`,
                            shadowBlur: 15
                        }
                    },
                    axisTick: { 
                        show: true,
                        lineStyle: {
                            color: '#ffffff66',
                            shadowBlur: 5
                        }
                    },
                    splitLine: { 
                        show: true,
                        lineStyle: {
                            color: '#ffffff88',
                            shadowBlur: 8
                        }
                    },
                    axisLabel: { 
                        show: true,
                        color: '#ffffff',
                        fontSize: 11
                    },
                    title: { 
                        show: true,
                        color: '#ffffff',
                        fontSize: 14
                    },
                    detail: { 
                        show: true,
                        color: color,
                        fontSize: 18,
                        fontWeight: 'bold'
                    },
                    data: [{ value: 0 }]
                }]
            };
            
            chartInstance.setOption(option);
        }

        function initTrendChart(chartInstance) {
            const option = {
                backgroundColor: 'transparent',
                
                // ä¸“ä¸šåŒ»ç–—çº§åˆ«å·¥å…·æç¤º
                tooltip: {
                    trigger: 'axis',
                    backgroundColor: 'rgba(13, 20, 33, 0.95)',
                    borderColor: 'rgba(0, 255, 157, 0.5)',
                    borderWidth: 2,
                    textStyle: { 
                        color: '#ffffff', 
                        fontSize: 13,
                        fontWeight: 'bold'
                    },
                    shadowBlur: 20,
                    shadowColor: 'rgba(0, 255, 157, 0.3)',
                    formatter: function(params) {
                        let html = `<div style="padding: 10px;">`;
                        html += `<div style="color: #00ff9d; font-size: 14px; margin-bottom: 8px;">ğŸ“Š å¥åº·ç›‘æµ‹æ•°æ®</div>`;
                        html += `<div style="color: #ffffff88; font-size: 12px; margin-bottom: 10px;">${new Date(params[0].axisValue).toLocaleString()}</div>`;
                        
                        params.forEach(param => {
                            const color = param.color;
                            const name = param.seriesName;
                            const value = param.value[1];
                            let icon = '';
                            let status = '';
                            let unit = '';
                            
                            if (name === 'å¿ƒç‡') {
                                icon = 'ğŸ’“';
                                unit = ' BPM';
                                if (value < 60) status = ' <span style="color: #ff4757;">åä½</span>';
                                else if (value > 100) status = ' <span style="color: #ff4757;">åé«˜</span>';
                                else status = ' <span style="color: #00ff3c;">æ­£å¸¸</span>';
                            } else if (name === 'è¡€æ°§') {
                                icon = 'ğŸ©¸';
                                unit = '%';
                                if (value < 95) status = ' <span style="color: #ff4757;">ä½æ°§</span>';
                                else status = ' <span style="color: #00ff3c;">æ­£å¸¸</span>';
                            } else if (name === 'ä½“æ¸©') {
                                icon = 'ğŸŒ¡ï¸';
                                unit = 'Â°C';
                                if (value < 36.1) status = ' <span style="color: #00d4ff;">åä½</span>';
                                else if (value > 37.3) status = ' <span style="color: #ff4757;">åé«˜</span>';
                                else status = ' <span style="color: #00ff3c;">æ­£å¸¸</span>';
                            }
                            
                            html += `<div style="margin: 5px 0; display: flex; align-items: center;">`;
                            html += `<span style="color: ${color}; font-size: 16px; margin-right: 8px;">${icon}</span>`;
                            html += `<span style="color: ${color}; font-weight: bold;">${name}: ${value}${unit}</span>`;
                            html += `<span style="margin-left: 10px;">${status}</span>`;
                            html += `</div>`;
                        });
                        
                        html += `</div>`;
                        return html;
                    }
                },
                
                // å›¾ä¾‹å¢å¼º
                legend: {
                    top: 15,
                    textStyle: { 
                        color: '#ffffff',
                        fontSize: 13,
                        fontWeight: 'bold'
                    },
                    itemWidth: 25,
                    itemHeight: 14,
                    itemGap: 30,
                    icon: 'roundRect',
                    selectedMode: 'multiple'
                },
                
                // ç½‘æ ¼å¢å¼º
                grid: {
                    left: '8%',
                    right: '8%',
                    top: '18%',
                    bottom: '15%',
                    containLabel: true,
                    borderColor: 'rgba(255, 255, 255, 0.1)',
                    borderWidth: 1
                },
                
                // Xè½´æ—¶é—´è½´å¢å¼º
                xAxis: {
                    type: 'time',
                    axisLine: { 
                        lineStyle: { 
                            color: 'rgba(0, 255, 157, 0.4)',
                            width: 2
                        } 
                    },
                    axisLabel: { 
                        color: 'rgba(255, 255, 255, 0.8)',
                        fontSize: 11,
                        fontWeight: 'bold',
                        formatter: function(value) {
                            const date = new Date(value);
                            return `${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
                        }
                    },
                    axisTick: {
                        show: true,
                        lineStyle: {
                            color: 'rgba(255, 255, 255, 0.3)'
                        }
                    },
                    splitLine: {
                        show: true,
                        lineStyle: {
                            color: 'rgba(255, 255, 255, 0.1)',
                            type: 'dashed'
                        }
                    }
                },
                
                // åŒYè½´ç³»ç»Ÿ
                yAxis: [
                    {
                        type: 'value',
                        name: 'å¿ƒç‡ (BPM) / è¡€æ°§ (%)',
                        nameTextStyle: {
                            color: '#ff6b6b',
                            fontSize: 12,
                            fontWeight: 'bold'
                        },
                        position: 'left',
                        axisLine: { 
                            lineStyle: { 
                                color: 'rgba(255, 107, 107, 0.6)',
                                width: 2
                            } 
                        },
                        axisLabel: { 
                            color: 'rgba(255, 255, 255, 0.8)',
                            fontSize: 11,
                            fontWeight: 'bold'
                        },
                        splitLine: {
                            show: true,
                            lineStyle: {
                                color: 'rgba(255, 107, 107, 0.1)',
                                type: 'dashed'
                            }
                        }
                    },
                    {
                        type: 'value',
                        name: 'ä½“æ¸© (Â°C)',
                        nameTextStyle: {
                            color: '#ffaa00',
                            fontSize: 12,
                            fontWeight: 'bold'
                        },
                        position: 'right',
                        min: 35.0,
                        max: 40.0,
                        axisLine: { 
                            lineStyle: { 
                                color: 'rgba(255, 170, 0, 0.6)',
                                width: 2
                            } 
                        },
                        axisLabel: { 
                            color: 'rgba(255, 255, 255, 0.8)',
                            fontSize: 11,
                            fontWeight: 'bold',
                            formatter: '{value}Â°C'
                        },
                        splitLine: {
                            show: false
                        }
                    }
                ],
                
                // å¢å¼ºç³»åˆ—æ•°æ®
                series: [
                    {
                        name: 'å¿ƒç‡',
                        type: 'line',
                        smooth: true,
                        symbol: 'circle',
                        symbolSize: 8,
                        
                        // 3Dçº¿æ¡æ•ˆæœ
                        lineStyle: { 
                            color: {
                                type: 'linear',
                                x: 0, y: 0, x2: 1, y2: 0,
                                colorStops: [
                                    { offset: 0, color: '#ff6b6b' },
                                    { offset: 0.5, color: '#ff4757' },
                                    { offset: 1, color: '#ff3838' }
                                ]
                            },
                            width: 3,
                            shadowColor: '#ff6b6b',
                            shadowBlur: 15,
                            shadowOffsetY: 0
                        },
                        
                        // 3Dæ•°æ®ç‚¹
                        itemStyle: { 
                            color: '#ff6b6b',
                            borderColor: '#ffffff',
                            borderWidth: 2,
                            shadowColor: '#ff6b6b',
                            shadowBlur: 10
                        },
                        
                        // åŒºåŸŸå¡«å……
                        areaStyle: {
                            color: {
                                type: 'linear',
                                x: 0, y: 0, x2: 0, y2: 1,
                                colorStops: [
                                    { offset: 0, color: 'rgba(255, 107, 107, 0.3)' },
                                    { offset: 1, color: 'rgba(255, 107, 107, 0.05)' }
                                ]
                            }
                        },
                        
                        emphasis: {
                            scale: 1.1,
                            itemStyle: {
                                shadowColor: '#ff6b6b',
                                shadowBlur: 20
                            }
                        },
                        
                        // æ ‡è®°å¥åº·åŒºé—´
                        markLine: {
                            data: [
                                { yAxis: 60, name: 'æ­£å¸¸ä¸‹é™', lineStyle: { color: '#00ff3c', type: 'dashed', opacity: 0.6 } },
                                { yAxis: 100, name: 'æ­£å¸¸ä¸Šé™', lineStyle: { color: '#00ff3c', type: 'dashed', opacity: 0.6 } }
                            ],
                            label: { show: false }
                        },
                        
                        data: []
                    },
                    
                    {
                        name: 'è¡€æ°§',
                        type: 'line',
                        smooth: true,
                        symbol: 'diamond',
                        symbolSize: 8,
                        
                        lineStyle: { 
                            color: {
                                type: 'linear',
                                x: 0, y: 0, x2: 1, y2: 0,
                                colorStops: [
                                    { offset: 0, color: '#00e4ff' },
                                    { offset: 0.5, color: '#00d2ee' },
                                    { offset: 1, color: '#00bfcc' }
                                ]
                            },
                            width: 3,
                            shadowColor: '#00e4ff',
                            shadowBlur: 15
                        },
                        
                        itemStyle: { 
                            color: '#00e4ff',
                            borderColor: '#ffffff',
                            borderWidth: 2,
                            shadowColor: '#00e4ff',
                            shadowBlur: 10
                        },
                        
                        areaStyle: {
                            color: {
                                type: 'linear',
                                x: 0, y: 0, x2: 0, y2: 1,
                                colorStops: [
                                    { offset: 0, color: 'rgba(0, 228, 255, 0.25)' },
                                    { offset: 1, color: 'rgba(0, 228, 255, 0.05)' }
                                ]
                            }
                        },
                        
                        emphasis: {
                            scale: 1.1,
                            itemStyle: {
                                shadowColor: '#00e4ff',
                                shadowBlur: 20
                            }
                        },
                        
                        markLine: {
                            data: [
                                { yAxis: 95, name: 'æ­£å¸¸ä¸‹é™', lineStyle: { color: '#00ff3c', type: 'dashed', opacity: 0.6 } }
                            ],
                            label: { show: false }
                        },
                        
                        data: []
                    },
                    
                    {
                        name: 'ä½“æ¸©',
                        type: 'line',
                        smooth: true,
                        symbol: 'rect',
                        symbolSize: [10, 6],
                        yAxisIndex: 1,
                        
                        lineStyle: { 
                            color: {
                                type: 'linear',
                                x: 0, y: 0, x2: 1, y2: 0,
                                colorStops: [
                                    { offset: 0, color: '#ffaa00' },
                                    { offset: 0.5, color: '#ff9900' },
                                    { offset: 1, color: '#ff8800' }
                                ]
                            },
                            width: 3,
                            shadowColor: '#ffaa00',
                            shadowBlur: 15
                        },
                        
                        itemStyle: { 
                            color: '#ffaa00',
                            borderColor: '#ffffff',
                            borderWidth: 2,
                            shadowColor: '#ffaa00',
                            shadowBlur: 10
                        },
                        
                        areaStyle: {
                            color: {
                                type: 'linear',
                                x: 0, y: 0, x2: 0, y2: 1,
                                colorStops: [
                                    { offset: 0, color: 'rgba(255, 170, 0, 0.2)' },
                                    { offset: 1, color: 'rgba(255, 170, 0, 0.05)' }
                                ]
                            }
                        },
                        
                        emphasis: {
                            scale: 1.1,
                            itemStyle: {
                                shadowColor: '#ffaa00',
                                shadowBlur: 20
                            }
                        },
                        
                        markLine: {
                            data: [
                                { yAxis: 36.1, name: 'æ­£å¸¸ä¸‹é™', lineStyle: { color: '#00ff3c', type: 'dashed', opacity: 0.6 } },
                                { yAxis: 37.3, name: 'æ­£å¸¸ä¸Šé™', lineStyle: { color: '#00ff3c', type: 'dashed', opacity: 0.6 } }
                            ],
                            label: { show: false }
                        },
                        
                        data: []
                    }
                ],
                
                // æ•°æ®ç¼©æ”¾æ§åˆ¶
                dataZoom: [
                    {
                        type: 'inside',
                        start: 0,
                        end: 100,
                        filterMode: 'filter'
                    },
                    {
                        show: true,
                        type: 'slider',
                        bottom: '2%',
                        start: 0,
                        end: 100,
                        height: 20,
                        textStyle: {
                            color: '#ffffff'
                        },
                        borderColor: 'rgba(0, 255, 157, 0.3)',
                        fillerColor: 'rgba(0, 255, 157, 0.2)',
                        handleStyle: {
                            color: '#00ff9d'
                        }
                    }
                ],
                
                // åŠ¨ç”»é…ç½®
                animation: true,
                animationDuration: 2000,
                animationEasing: 'cubicOut',
                animationDelay: function (idx) {
                    return idx * 200;
                }
            };
            
            chartInstance.setOption(option);
        }

        // ============= æ•°æ®åŠ è½½å‡½æ•° =============
        function loadHealthData() {
            console.log('ğŸ“Š åŠ è½½å®æ—¶å¥åº·æ•°æ®...');
            
            fetch(`/get_personal_info?deviceSn=${deviceSn}`)
                .then(response => response.json())
                .then(result => {
                    if (result.success && result.data) {
                        console.log('âœ… ä¸ªäººä¿¡æ¯åŠ è½½æˆåŠŸ:', result.data);
                        
                        // æ›´æ–°å‘˜å·¥ä¿¡æ¯
                        if (result.data.user_info && result.data.user_info.data && result.data.user_info.data.users && result.data.user_info.data.users.length > 0) {
                            updateEmployeeInfo(result.data.user_info.data.users);
                        }
                        
                        // æ›´æ–°å¥åº·æ•°æ®
                        if (result.data.health_data && result.data.health_data.data && result.data.health_data.data.healthData) {
                            const healthData = extractLatestHealthData(result.data.health_data.data.healthData);
                            updateHealthDisplay(healthData);
                        }
                        
                        // æ›´æ–°æ¶ˆæ¯æ•°æ®
                        if (result.data.message_info && result.data.message_info.data && result.data.message_info.data.messages) {
                            updateMessageDisplay(result.data.message_info.data.messages);
                        }
                        
                        // æ›´æ–°å‘Šè­¦æ•°æ®  
                        if (result.data.alert_info && result.data.alert_info.data && result.data.alert_info.data.alerts) {
                            updateAlertDisplay(result.data.alert_info.data.alerts);
                        }
                        
                        // æ›´æ–°è®¾å¤‡çŠ¶æ€
                        if (result.data.device_info && result.data.device_info.data) {
                            updateDeviceStatusFromInfo(result.data.device_info.data);
                        }
                        
                    } else {
                        console.warn('âš ï¸ ä¸ªäººä¿¡æ¯åŠ è½½å¤±è´¥:', result.error);
                        // ä½¿ç”¨å¤‡ç”¨æ¨¡æ‹Ÿæ•°æ®
                        const mockData = generateMockHealthData();
                        updateHealthDisplay(mockData);
                    }
                })
                .catch(error => {
                    console.error('âŒ ä¸ªäººä¿¡æ¯APIè¯·æ±‚å¤±è´¥:', error);
                    // ä½¿ç”¨å¤‡ç”¨æ¨¡æ‹Ÿæ•°æ®
                    const mockData = generateMockHealthData();
                    updateHealthDisplay(mockData);
                });
        }

        function generateMockHealthData() {
            const now = Date.now();
            return {
                timestamp: now,
                heartRate: Math.floor(Math.random() * 40) + 60,
                bloodOxygen: Math.floor(Math.random() * 10) + 95,
                temperature: (Math.random() * 2 + 36).toFixed(1),
                systolic: Math.floor(Math.random() * 40) + 110,
                diastolic: Math.floor(Math.random() * 20) + 70,
                stepCount: Math.floor(Math.random() * 5000) + 2000
            };
        }

        // æ–°å¢ï¼šå¤„ç†çœŸå®APIæ•°æ®çš„è¾…åŠ©å‡½æ•°
        function extractLatestHealthData(healthDataArray) {
            console.log('ğŸ” å¥åº·æ•°æ®è¾“å…¥å‚æ•°:', healthDataArray);
            if (!healthDataArray || healthDataArray.length === 0) {
                console.log('âš ï¸ å¥åº·æ•°æ®ä¸ºç©ºï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®');
                return generateMockHealthData();
            }
            
            // è·å–æœ€æ–°çš„å¥åº·æ•°æ®è®°å½•
            const latestData = healthDataArray[0];
            console.log('ğŸ“Š æœ€æ–°å¥åº·æ•°æ®:', latestData);
            
            return {
                timestamp: Date.now(),
                heartRate: parseInt(latestData.heart_rate) || Math.floor(Math.random() * 40) + 60,
                bloodOxygen: parseInt(latestData.blood_oxygen) || Math.floor(Math.random() * 10) + 95,
                temperature: parseFloat(latestData.temperature) || (Math.random() * 2 + 36).toFixed(1),
                systolic: parseInt(latestData.pressure_high) || Math.floor(Math.random() * 40) + 110,
                diastolic: parseInt(latestData.pressure_low) || Math.floor(Math.random() * 20) + 70,
                stepCount: parseInt(latestData.step) || Math.floor(Math.random() * 5000) + 2000,
                pressure: latestData.stress || '0',
                location: latestData.latitude && latestData.longitude ? `${latestData.latitude},${latestData.longitude}` : null
            };
        }

        function updateEmployeeInfo(userData) {
            if (!userData || userData.length === 0) return;
            
            const user = userData[0]; // è·å–ç¬¬ä¸€ä¸ªç”¨æˆ·æ•°æ®
            console.log('ğŸ‘¤ æ›´æ–°å‘˜å·¥ä¿¡æ¯:', user);
            
            // æ›´æ–°å‘˜å·¥æ•°æ®å¯¹è±¡ - ä¿®æ­£å±æ€§ååŒ¹é…APIè¿”å›ç»“æ„
            employeeData.name = user.user_name || user.userName || user.name || employeeData.name;
            employeeData.role = user.position || 'æ™®é€šå‘˜å·¥';
            employeeData.deviceSn = user.device_sn || employeeData.deviceSn;
            employeeData.department = user.department || user.dept_name || employeeData.department;
            employeeData.confirmed = true;
            
            // æ›´æ–°é¡µé¢æ˜¾ç¤º
            const headerEmployeeNameEl = document.getElementById('headerEmployeeName');
            const headerEmployeeRoleEl = document.getElementById('headerEmployeeRole');
            const headerEmployeeDeviceEl = document.getElementById('headerEmployeeDevice');
            
            if (headerEmployeeNameEl) headerEmployeeNameEl.textContent = employeeData.name;
            if (headerEmployeeRoleEl) headerEmployeeRoleEl.textContent = employeeData.role;
            if (headerEmployeeDeviceEl) headerEmployeeDeviceEl.textContent = employeeData.deviceSn;
            
            console.log('âœ… å‘˜å·¥ä¿¡æ¯æ›´æ–°å®Œæˆ:', employeeData);
        }

        function updateDeviceStatusFromInfo(deviceData) {
            if (!deviceData || deviceData.length === 0) return;
            
            const device = deviceData[0];
            console.log('ğŸ“± æ›´æ–°è®¾å¤‡çŠ¶æ€:', device);
            
            const deviceStatus = {
                batteryLevel: device.batteryLevel || Math.floor(Math.random() * (100 - 20)) + 20,
                status: device.status || 'ACTIVE',
                lastUpdate: new Date(device.lastHeartbeat || Date.now())
            };
            
            updateDeviceStatus(deviceStatus);
        }

        function updateHealthDisplay(data) {
            healthData = data;
            
            console.log('ğŸ”„ æ›´æ–°å¥åº·æ•°æ®æ˜¾ç¤º:', data);
            
            // æ›´æ–°å¿ƒç‡ - ä½¿ç”¨å¢å¼ºçš„3Då›¾è¡¨
            updateGaugeValue(chartInstances.heartRateGauge, data.heartRate, 180);
            document.getElementById('heartRateValue').textContent = data.heartRate;
            updateHealthStatus('heartRate', data.heartRate, 60, 100);
            updateHealthCardStatus('heartRateCard', data.heartRate, 60, 100, 120);
            
            // æ›´æ–°è¡€æ°§ - ä½¿ç”¨å¢å¼ºçš„3Då›¾è¡¨
            updateGaugeValue(chartInstances.bloodOxygenGauge, data.bloodOxygen, 100);
            document.getElementById('bloodOxygenValue').textContent = data.bloodOxygen;
            updateHealthStatus('bloodOxygen', data.bloodOxygen, 95, 100);
            updateHealthCardStatus('bloodOxygenCard', data.bloodOxygen, 95, 100, 90);
            
            // æ›´æ–°ä½“æ¸© - ä½¿ç”¨å¢å¼ºçš„3Då›¾è¡¨å’ŒåŒ»ç–—çº§æ¸©åº¦èŒƒå›´
            const tempValue = parseFloat(data.temperature);
            updateGaugeValue(chartInstances.temperatureGauge, tempValue, 40);
            document.getElementById('temperatureValue').textContent = data.temperature;
            updateHealthStatus('temperature', tempValue, 36.1, 37.3);
            updateHealthCardStatus('temperatureCard', tempValue, 36.1, 37.3, 38.0);
            
            // æ›´æ–°å…¶ä»–ç”Ÿå‘½ä½“å¾æŒ‡æ ‡
            updateVitalSigns(data);
            
            // æ›´æ–°å¥åº·ç»Ÿè®¡å’Œè¶‹åŠ¿åˆ†æ
            updateHealthStatistics(data);
            
            // æ›´æ–°å¥åº·ç»¼åˆè¯„åˆ†
            updateHealthScore(data);
            
            // æ›´æ–°æ³¢å½¢å›¾è¡¨æ•°æ®
            updateWaveChart(data);
            
            console.log('âœ… å¥åº·æ•°æ®æ˜¾ç¤ºæ›´æ–°å®Œæˆ');
        }

        function updateHealthScore(data) {
            // è®¡ç®—ç»¼åˆå¥åº·è¯„åˆ†
            let score = 100;
            
            // å¿ƒç‡è¯„åˆ† (30%)
            if (data.heartRate < 60 || data.heartRate > 100) {
                score -= 15;
            } else if (data.heartRate < 70 || data.heartRate > 90) {
                score -= 5;
            }
            
            // è¡€æ°§è¯„åˆ† (30%) 
            if (data.bloodOxygen < 95) {
                score -= 20;
            } else if (data.bloodOxygen < 98) {
                score -= 5;
            }
            
            // ä½“æ¸©è¯„åˆ† (25%)
            const temp = parseFloat(data.temperature);
            if (temp < 36.1 || temp > 37.3) {
                score -= 15;
            } else if (temp < 36.5 || temp > 37.0) {
                score -= 3;
            }
            
            // è¡€å‹è¯„åˆ† (15%)
            if (data.systolic > 140 || data.diastolic > 90) {
                score -= 10;
            } else if (data.systolic > 130 || data.diastolic > 85) {
                score -= 3;
            }
            
            score = Math.max(0, Math.min(100, Math.round(score)));
            
            const scoreElement = document.getElementById('healthScore');
            if (scoreElement) {
                scoreElement.textContent = score;
                
                // æ ¹æ®è¯„åˆ†æ›´æ–°é¢œè‰²
                if (score >= 90) {
                    scoreElement.style.color = '#00ff3c';
                } else if (score >= 75) {
                    scoreElement.style.color = '#00ff9d';
                } else if (score >= 60) {
                    scoreElement.style.color = '#ffaa00';
                } else {
                    scoreElement.style.color = '#ff4757';
                }
            }
        }

        function updateWaveChart(data) {
            // å®æ—¶æ›´æ–°æ³¢å½¢å›¾è¡¨æ•°æ®
            if (chartInstances.vitalWaveChart) {
                generateWaveData(currentWaveType);
            }
        }

        function updateHealthCardStatus(cardId, value, minNormal, maxNormal, criticalThreshold) {
            const card = document.getElementById(cardId);
            if (!card) return;
            
            // æ¸…é™¤ä¹‹å‰çš„çŠ¶æ€ç±»
            card.classList.remove('alert-high', 'alert-critical');
            
            // æ ¹æ®å¥åº·æ•°å€¼åº”ç”¨ç›¸åº”çš„è§†è§‰æ•ˆæœ
            if (value < minNormal || value > maxNormal) {
                if ((cardId.includes('heartRate') && (value < 50 || value > criticalThreshold)) ||
                    (cardId.includes('bloodOxygen') && value < criticalThreshold) ||
                    (cardId.includes('temperature') && value > criticalThreshold)) {
                    card.classList.add('alert-critical');
                } else {
                    card.classList.add('alert-high');
                }
            }
        }

        function updateVitalSigns(data) {
            // æ›´æ–°è¡€å‹æŒ‡æ ‡
            const systolicElement = document.getElementById('systolicValue');
            const diastolicElement = document.getElementById('diastolicValue');
            
            if (systolicElement && data.systolic) {
                systolicElement.textContent = data.systolic + ' mmHg';
                // è¡€å‹åˆ†çº§æ˜¾ç¤º
                if (data.systolic > 140 || data.diastolic > 90) {
                    systolicElement.style.color = '#ff4757';
                    systolicElement.style.fontWeight = 'bold';
                } else if (data.systolic > 130 || data.diastolic > 85) {
                    systolicElement.style.color = '#ffaa00';
                } else {
                    systolicElement.style.color = '#00ff3c';
                }
            }
            
            if (diastolicElement && data.diastolic) {
                diastolicElement.textContent = data.diastolic + ' mmHg';
                if (data.diastolic > 90) {
                    diastolicElement.style.color = '#ff4757';
                    diastolicElement.style.fontWeight = 'bold';
                } else if (data.diastolic > 85) {
                    diastolicElement.style.color = '#ffaa00';
                } else {
                    diastolicElement.style.color = '#00ff3c';
                }
            }
            
            // æ›´æ–°æ­¥æ•°å’Œæ´»åŠ¨ç­‰çº§
            const stepCountElement = document.getElementById('stepCount');
            const activityLevelElement = document.getElementById('activityLevel');
            
            if (stepCountElement && data.stepCount !== undefined) {
                stepCountElement.textContent = data.stepCount.toLocaleString();
                
                // æ ¹æ®æ­¥æ•°æ˜¾ç¤ºæ´»åŠ¨ç­‰çº§
                let activityLevel = 'è½»åº¦';
                let activityColor = '#ffaa00';
                
                if (data.stepCount > 10000) {
                    activityLevel = 'éå¸¸æ´»è·ƒ';
                    activityColor = '#00ff3c';
                } else if (data.stepCount > 7000) {
                    activityLevel = 'æ´»è·ƒ';
                    activityColor = '#00e4ff';
                } else if (data.stepCount > 5000) {
                    activityLevel = 'ä¸­ç­‰';
                    activityColor = '#ffaa00';
                } else if (data.stepCount < 2000) {
                    activityLevel = 'ä¹…å';
                    activityColor = '#ff4757';
                }
                
                if (activityLevelElement) {
                    activityLevelElement.textContent = activityLevel;
                    activityLevelElement.style.color = activityColor;
                    activityLevelElement.style.fontWeight = 'bold';
                }
            }
        }

        function updateHealthStatistics(data) {
            // æ›´æ–°å¥åº·è¯¦æƒ…ç»Ÿè®¡
            try {
                // å¿ƒç‡ç»Ÿè®¡
                if (data.heartRate) {
                    updateStatDetail('heartRateMax', Math.max(data.heartRate, getStoredMaxValue('heartRate', data.heartRate)));
                    updateStatDetail('heartRateMin', Math.min(data.heartRate, getStoredMinValue('heartRate', data.heartRate)));
                    updateStatDetail('heartRateAvg', calculateRunningAverage('heartRate', data.heartRate));
                }
                
                // è¡€æ°§ç»Ÿè®¡
                if (data.bloodOxygen) {
                    updateStatDetail('bloodOxygenMax', Math.max(data.bloodOxygen, getStoredMaxValue('bloodOxygen', data.bloodOxygen)));
                    updateStatDetail('bloodOxygenMin', Math.min(data.bloodOxygen, getStoredMinValue('bloodOxygen', data.bloodOxygen)));
                    updateStatDetail('bloodOxygenAvg', calculateRunningAverage('bloodOxygen', data.bloodOxygen));
                }
                
                // å­˜å‚¨å½“å‰æ•°æ®ç”¨äºç»Ÿè®¡
                storeHealthDataForStats(data);
                
            } catch (error) {
                console.warn('âš ï¸ å¥åº·ç»Ÿè®¡æ›´æ–°å‡ºé”™:', error);
            }
        }

        function updateStatDetail(elementId, value) {
            const element = document.getElementById(elementId);
            if (element && value !== undefined) {
                if (elementId.includes('heartRate')) {
                    element.textContent = Math.round(value) + ' BPM';
                } else if (elementId.includes('bloodOxygen')) {
                    element.textContent = Math.round(value) + '%';
                } else if (elementId.includes('temperature')) {
                    element.textContent = value.toFixed(1) + 'Â°C';
                }
            }
        }

        function getStoredMaxValue(type, currentValue) {
            const stored = localStorage.getItem(`health_max_${type}`);
            const maxVal = stored ? Math.max(parseFloat(stored), currentValue) : currentValue;
            localStorage.setItem(`health_max_${type}`, maxVal.toString());
            return maxVal;
        }

        function getStoredMinValue(type, currentValue) {
            const stored = localStorage.getItem(`health_min_${type}`);
            const minVal = stored ? Math.min(parseFloat(stored), currentValue) : currentValue;
            localStorage.setItem(`health_min_${type}`, minVal.toString());
            return minVal;
        }

        function calculateRunningAverage(type, currentValue) {
            const history = JSON.parse(localStorage.getItem(`health_history_${type}`) || '[]');
            history.push(currentValue);
            if (history.length > 100) history.shift(); // ä¿æŒæœ€è¿‘100ä¸ªæ•°æ®ç‚¹
            
            localStorage.setItem(`health_history_${type}`, JSON.stringify(history));
            
            const avg = history.reduce((sum, val) => sum + val, 0) / history.length;
            return Math.round(avg * 10) / 10; // ä¿ç•™ä¸€ä½å°æ•°
        }

        function storeHealthDataForStats(data) {
            const timestamp = Date.now();
            const statsEntry = {
                timestamp,
                heartRate: data.heartRate,
                bloodOxygen: data.bloodOxygen,
                temperature: parseFloat(data.temperature),
                systolic: data.systolic,
                diastolic: data.diastolic
            };
            
            const recentStats = JSON.parse(localStorage.getItem('recent_health_stats') || '[]');
            recentStats.push(statsEntry);
            
            // ä¿æŒæœ€è¿‘1000ä¸ªæ•°æ®ç‚¹
            if (recentStats.length > 1000) recentStats.shift();
            
            localStorage.setItem('recent_health_stats', JSON.stringify(recentStats));
        }

        function updateGaugeValue(chartInstance, value, max) {
            // æ›´æ–°ä»ªè¡¨ç›˜æ•°å€¼å¹¶æ·»åŠ åŠ¨æ€é¢œè‰²å’ŒåŠ¨ç”»æ•ˆæœ
            const seriesConfig = {
                data: [{ value: Math.min(value, max) }]
            };
            
            // æ ¹æ®æ•°å€¼åŠ¨æ€è°ƒæ•´é¢œè‰²å’Œæ•ˆæœ
            if (chartInstance._chartName === 'å¿ƒç‡') {
                updateHeartRateGauge(chartInstance, value);
            } else if (chartInstance._chartName === 'è¡€æ°§') {
                updateBloodOxygenGauge(chartInstance, value);
            } else if (chartInstance._chartName === 'ä½“æ¸©') {
                updateTemperatureGauge(chartInstance, value);
            } else {
                // é€šç”¨ä»ªè¡¨ç›˜æ›´æ–°
                chartInstance.setOption(seriesConfig);
            }
        }

        function updateHeartRateGauge(chartInstance, heartRate) {
            // å¿ƒç‡ä¸“ç”¨æ›´æ–°é€»è¾‘
            let status = 'normal';
            let alertColor = '#00ff3c';
            let pulseEffect = '';
            
            if (heartRate < 50) {
                status = 'low';
                alertColor = '#ff4757';
                pulseEffect = 'slow';
            } else if (heartRate > 120) {
                status = 'high';
                alertColor = '#ff4757';
                pulseEffect = 'fast';
            } else if (heartRate > 100) {
                status = 'elevated';
                alertColor = '#ffaa00';
                pulseEffect = 'moderate';
            }
            
            const option = {
                series: [{
                    data: [{ 
                        value: heartRate,
                        name: ''
                    }],
                    // ç¦ç”¨detailæ˜¾ç¤ºï¼Œä½¿ç”¨HTMLè¦†ç›–å±‚
                    detail: {
                        show: false
                    },
                    pointer: {
                        itemStyle: {
                            shadowBlur: status === 'normal' ? 15 : 25,
                            shadowColor: alertColor
                        }
                    }
                }]
            };
            
            chartInstance.setOption(option);
            
            // æ·»åŠ å¿ƒç‡è¿‡é«˜/è¿‡ä½çš„è§†è§‰è­¦å‘Šæ•ˆæœ
            if (status !== 'normal') {
                addHeartBeatAnimation(chartInstance, pulseEffect);
            }
        }

        function updateBloodOxygenGauge(chartInstance, spo2) {
            // è¡€æ°§é¥±å’Œåº¦ä¸“ç”¨æ›´æ–°é€»è¾‘
            let status = 'normal';
            let alertColor = '#00e4ff';
            
            if (spo2 < 90) {
                status = 'critical';
                alertColor = '#ff4757';
            } else if (spo2 < 95) {
                status = 'low';
                alertColor = '#ffaa00';
            } else if (spo2 >= 98) {
                status = 'excellent';
                alertColor = '#00ff3c';
            }
            
            const option = {
                series: [{
                    data: [{ 
                        value: spo2,
                        name: ''
                    }],
                    // ç¦ç”¨detailæ˜¾ç¤ºï¼Œä½¿ç”¨HTMLè¦†ç›–å±‚
                    detail: {
                        show: false
                    },
                    pointer: {
                        itemStyle: {
                            shadowBlur: status === 'critical' ? 30 : 20,
                            shadowColor: alertColor
                        }
                    }
                }]
            };
            
            chartInstance.setOption(option);
        }

        function updateTemperatureGauge(chartInstance, temperature) {
            // ä½“æ¸©ä¸“ç”¨æ›´æ–°é€»è¾‘
            let status = 'normal';
            let alertColor = '#ffaa00';
            let tempLevel = '';
            
            if (temperature < 36.1) {
                status = 'hypothermia';
                alertColor = '#00d4ff';
                tempLevel = 'ä½“æ¸©åä½';
            } else if (temperature > 38.0) {
                status = 'fever';
                alertColor = '#ff4757';
                tempLevel = 'å‘çƒ­';
            } else if (temperature > 37.3) {
                status = 'elevated';
                alertColor = '#ffaa00';
                tempLevel = 'è½»å¾®åé«˜';
            } else {
                tempLevel = 'ä½“æ¸©æ­£å¸¸';
                alertColor = '#00ff3c';
            }
            
            const option = {
                series: [{
                    data: [{ 
                        value: temperature,
                        name: ''
                    }],
                    // ç¦ç”¨detailæ˜¾ç¤ºï¼Œä½¿ç”¨HTMLè¦†ç›–å±‚  
                    detail: {
                        show: false
                    },
                    pointer: {
                        itemStyle: {
                            shadowBlur: status === 'fever' ? 30 : 18,
                            shadowColor: alertColor
                        }
                    }
                }]
            };
            
            chartInstance.setOption(option);
            
            // å‘çƒ­æ—¶æ·»åŠ ç‰¹æ®Šæ•ˆæœ
            if (status === 'fever') {
                addFeverAnimation(chartInstance);
            }
        }

        function addHeartBeatAnimation(chartInstance, intensity) {
            // å¿ƒç‡å¼‚å¸¸æ—¶çš„åŠ¨ç”»æ•ˆæœ
            const animationDuration = intensity === 'fast' ? 800 : intensity === 'slow' ? 2000 : 1200;
            
            chartInstance.setOption({
                animation: true,
                animationDuration: animationDuration,
                animationEasing: 'elasticOut'
            });
            
            // æ·»åŠ DOMçº§åˆ«çš„è„‰å†²æ•ˆæœ
            const chartDom = chartInstance.getDom();
            if (chartDom) {
                chartDom.style.animation = `heartbeat-${intensity} ${animationDuration}ms infinite`;
            }
        }

        function addFeverAnimation(chartInstance) {
            // å‘çƒ­æ—¶çš„è§†è§‰è­¦å‘Šæ•ˆæœ
            const chartDom = chartInstance.getDom();
            if (chartDom) {
                chartDom.style.animation = 'fever-warning 1500ms infinite';
                chartDom.style.filter = 'drop-shadow(0 0 10px #ff4757)';
            }
        }

        function updateHealthStatus(type, value, minNormal, maxNormal) {
            const statusElement = document.getElementById(type + 'Status');
            const levelElement = document.getElementById(type + 'Level');
            
            let status = 'normal';
            let level = 'æ­£å¸¸';
            
            if (value < minNormal || value > maxNormal) {
                status = 'warning';
                level = 'å¼‚å¸¸';
                if (type === 'heartRate' && (value < 50 || value > 120)) {
                    status = 'critical';
                    level = 'å±é™©';
                }
            }
            
            statusElement.className = 'health-status ' + status;
            if (levelElement) {
                levelElement.textContent = level;
            }
        }

        function updateTrendChart(historyData) {
            if (!historyData || !chartInstances.mainChart) {
                console.warn('âš ï¸ å›¾è¡¨å®ä¾‹æˆ–å†å²æ•°æ®ä¸å¯ç”¨');
                return;
            }
            
            const option = {
                series: [
                    {
                        data: historyData.heartRate || []
                    },
                    {
                        data: historyData.bloodOxygen || []
                    },
                    {
                        data: historyData.temperature || []
                    }
                ]
            };
            
            chartInstances.mainChart.setOption(option, true); // trueè¡¨ç¤ºä¸åˆå¹¶ï¼Œå®Œå…¨æ›¿æ¢æ•°æ®
            console.log('ğŸ“Š è¶‹åŠ¿å›¾è¡¨å·²æ›´æ–°');
        }

        // ============= æ¶ˆæ¯å’Œå‘Šè­¦åŠ è½½ =============
        function loadMessages() {
            // æ¶ˆæ¯æ•°æ®ç°åœ¨é€šè¿‡ get_personal_info API åŠ è½½ï¼Œæ— éœ€å•ç‹¬è°ƒç”¨
            console.log('ğŸ’¬ æ¶ˆæ¯æ•°æ®é€šè¿‡ä¸»APIåŠ è½½');
        }
        
        function loadAlerts() {
            // å‘Šè­¦æ•°æ®ç°åœ¨é€šè¿‡ get_personal_info API åŠ è½½ï¼Œæ— éœ€å•ç‹¬è°ƒç”¨
            console.log('ğŸš¨ å‘Šè­¦æ•°æ®é€šè¿‡ä¸»APIåŠ è½½');
        }

        function loadDeviceStatus() {
            // è®¾å¤‡çŠ¶æ€ç°åœ¨é€šè¿‡ get_personal_info API åŠ è½½ï¼Œæ— éœ€å•ç‹¬è°ƒç”¨
            console.log('ğŸ“± è®¾å¤‡çŠ¶æ€é€šè¿‡ä¸»APIåŠ è½½');
        }

        // ============= æ•°æ®æ˜¾ç¤ºæ›´æ–°å‡½æ•° =============
        function updateMessageDisplay(messages) {
            const messageList = document.getElementById('messageList');
            const messageCount = document.getElementById('messageCount');
            
            if (!messages || messages.length === 0) {
                if (messageCount) messageCount.textContent = '0';
                if (messageList) messageList.innerHTML = '<div class="message-item"><div class="message-content">æš‚æ— æ¶ˆæ¯</div></div>';
                return;
            }
            
            // å¤„ç†çœŸå®APIæ•°æ®æ ¼å¼ - ä¿®æ­£å±æ€§ååŒ¹é…APIç»“æ„
            const processedMessages = messages.map(msg => ({
                type: msg.message_type || msg.type || 'warning',
                content: msg.message || msg.content || 'ç³»ç»Ÿæ¶ˆæ¯',
                time: msg.sent_time || new Date().toISOString(),
                status: msg.message_status == '1' ? 'unread' : 'read',
                deviceSn: msg.device_sn || '',
                userName: msg.user_name || '',
                department: msg.department_name || '',
                messageId: msg.message_id || ''
            }));
            
            // ç»Ÿè®¡æœªè¯»æ¶ˆæ¯æ•°é‡
            const unreadCount = processedMessages.filter(msg => msg.status === 'unread').length;
            if (messageCount) messageCount.textContent = unreadCount;
            
            if (messageList) {
                messageList.innerHTML = processedMessages.map(msg => {
                    const formattedTime = new Date(msg.time).toLocaleString('zh-CN', {
                        month: '2-digit',
                        day: '2-digit', 
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    
                    const typeInfo = {
                        'warning': { label: 'å‘Šè­¦æ¶ˆæ¯', icon: 'âš ï¸', class: 'msg-warning' },
                        'system': { label: 'ç³»ç»Ÿæ¶ˆæ¯', icon: 'ğŸ””', class: 'msg-system' },
                        'info': { label: 'é€šçŸ¥æ¶ˆæ¯', icon: 'â„¹ï¸', class: 'msg-info' }
                    };
                    
                    const msgType = typeInfo[msg.type] || typeInfo['system'];
                    
                    return `
                        <div class="message-item ${msg.status === 'unread' ? 'unread' : 'read'} ${msgType.class}">
                            <div class="message-header">
                                <div class="message-type-badge">
                                    <span class="type-icon">${msgType.icon}</span>
                                    <span class="type-label">${msgType.label}</span>
                                </div>
                                <div class="message-status ${msg.status}">
                                    ${msg.status === 'unread' ? 'æœªè¯»' : 'å·²è¯»'}
                                </div>
                            </div>
                            <div class="message-content">${msg.content}</div>
                            <div class="message-details">
                                ${msg.deviceSn ? `<span class="device-info">ğŸ“± è®¾å¤‡: ${msg.deviceSn}</span>` : ''}
                                ${msg.userName ? `<span class="user-info">ğŸ‘¤ ç”¨æˆ·: ${msg.userName}</span>` : ''}
                                ${msg.department ? `<span class="dept-info">ğŸ¢ éƒ¨é—¨: ${msg.department}</span>` : ''}
                            </div>
                            <div class="message-time">
                                <span class="time-icon">ğŸ•</span>
                                <span class="time-text">${formattedTime}</span>
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            console.log('ğŸ’¬ æ¶ˆæ¯æ˜¾ç¤ºå·²æ›´æ–°:', processedMessages.length, 'æ¡æ¶ˆæ¯');
        }

        function updateAlertDisplay(alerts) {
            const alertList = document.getElementById('alertList');
            const alertCountEl = document.getElementById('alertCount');
            const alertTrendEl = document.getElementById('alertTrend');
            
            if (!alerts || alerts.length === 0) {
                if (alertList) alertList.innerHTML = '<div class="alert-item"><div class="alert-text">æš‚æ— å‘Šè­¦</div></div>';
                if (alertCountEl) alertCountEl.textContent = '0';
                if (alertTrendEl) alertTrendEl.textContent = 'ä»Šæ—¥æ— æ–°å¢å‘Šè­¦';
                return;
            }
            
            // å¤„ç†çœŸå®APIæ•°æ®æ ¼å¼ - ä¿®æ­£å±æ€§ååŒ¹é…APIç»“æ„
            const processedAlerts = alerts.map(alert => ({
                level: alert.severity_level || alert.level || 'high',
                content: alert.alert_desc || alert.content || 'å¥åº·å‘Šè­¦',
                time: alert.alert_timestamp || new Date().toISOString(),
                status: alert.alert_status || 'pending',
                id: alert.alert_id,
                type: alert.alert_type || 'HEALTH_ALERT',
                deviceSn: alert.device_sn || '',
                userName: alert.user_name || '',
                orgName: alert.org_name || '',
                location: alert.latitude && alert.longitude ? `${alert.latitude},${alert.longitude}` : '',
                respondedTime: alert.responded_time
            }));
            
            // æ›´æ–°å‘Šè­¦ç»Ÿè®¡
            const pendingCount = processedAlerts.filter(alert => alert.status === 'pending').length;
            if (alertCountEl) alertCountEl.textContent = pendingCount;
            if (alertTrendEl) alertTrendEl.textContent = `ä»Šæ—¥æ–°å¢ ${alerts.length} æ¡`;
            
            if (alertList) {
                alertList.innerHTML = processedAlerts.slice(0, 10).map(alert => {
                    const formattedTime = new Date(alert.time).toLocaleString('zh-CN', {
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit', 
                        minute: '2-digit'
                    });
                    
                    const levelInfo = {
                        'critical': { label: 'ä¸¥é‡', icon: 'ğŸ”¥', class: 'alert-critical', color: '#ff4757' },
                        'high': { label: 'é«˜å±', icon: 'ğŸš¨', class: 'alert-high', color: '#ff6b6b' },
                        'medium': { label: 'ä¸­ç­‰', icon: 'âš ï¸', class: 'alert-medium', color: '#ffa502' },
                        'low': { label: 'ä½å±', icon: 'â„¹ï¸', class: 'alert-low', color: '#3742fa' },
                        'info': { label: 'ä¿¡æ¯', icon: 'ğŸ’¡', class: 'alert-info', color: '#2ed573' }
                    };
                    
                    const alertLevel = levelInfo[alert.level.toLowerCase()] || levelInfo['high'];
                    
                    const typeLabels = {
                        'WEAR_STATUS_CHANGED': 'ä½©æˆ´çŠ¶æ€å˜åŒ–',
                        'HEART_RATE_ABNORMAL': 'å¿ƒç‡å¼‚å¸¸',
                        'BLOOD_PRESSURE_HIGH': 'è¡€å‹åé«˜',
                        'BLOOD_OXYGEN_LOW': 'è¡€æ°§åä½',
                        'TEMPERATURE_ABNORMAL': 'ä½“æ¸©å¼‚å¸¸',
                        'SOS_ALERT': 'SOSå‘Šè­¦',
                        'FALL_DETECTION': 'æ‘”å€’æ£€æµ‹'
                    };
                    
                    const typeLabel = typeLabels[alert.type] || alert.type;
                    const statusLabel = alert.status === 'pending' ? 'å¾…å¤„ç†' : alert.status === 'responded' ? 'å·²å¤„ç†' : 'å·²ç¡®è®¤';
                    const statusClass = alert.status === 'pending' ? 'status-pending' : 'status-resolved';
                    
                    return `
                        <div class="alert-item ${alertLevel.class} ${statusClass}">
                            <div class="alert-header">
                                <div class="alert-level-badge" style="background-color: ${alertLevel.color}">
                                    <span class="level-icon">${alertLevel.icon}</span>
                                    <span class="level-text">${alertLevel.label}</span>
                                </div>
                                <div class="alert-status ${statusClass}">
                                    ${statusLabel}
                                </div>
                            </div>
                            <div class="alert-type">
                                <span class="type-icon">ğŸ“‹</span>
                                <span class="type-text">${typeLabel}</span>
                            </div>
                            <div class="alert-description">${alert.content}</div>
                            <div class="alert-details">
                                <div class="detail-row">
                                    ${alert.deviceSn ? `<span class="device-info">ğŸ“± ${alert.deviceSn}</span>` : ''}
                                    ${alert.userName ? `<span class="user-info">ğŸ‘¤ ${alert.userName}</span>` : ''}
                                </div>
                                <div class="detail-row">
                                    ${alert.orgName ? `<span class="org-info">ğŸ¢ ${alert.orgName}</span>` : ''}
                                    ${alert.location ? `<span class="location-info">ğŸ“ ä½ç½®</span>` : ''}
                                </div>
                            </div>
                            <div class="alert-time">
                                <span class="time-icon">ğŸ•</span>
                                <span class="time-text">${formattedTime}</span>
                                ${alert.respondedTime ? `<span class="responded-time">å·²äº${new Date(alert.respondedTime).toLocaleString('zh-CN')}å¤„ç†</span>` : ''}
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            console.log('ğŸš¨ å‘Šè­¦æ˜¾ç¤ºå·²æ›´æ–°:', processedAlerts.length, 'æ¡å‘Šè­¦');
        }

        function loadHistoryChart() {
            console.log('ğŸ“ˆ åŠ è½½å†å²æ•°æ®å›¾è¡¨...');
            
            fetch(`/api/personal/health_history?deviceSn=${deviceSn}&timeRange=${currentTimeRange}`)
                .then(response => response.json())
                .then(result => {
                    if (result.success) {
                        console.log('âœ… å†å²æ•°æ®åŠ è½½æˆåŠŸ:', result.data.totalRecords, 'æ¡è®°å½•');
                        updateTrendChart(result.data);
                    } else {
                        console.warn('âš ï¸ å†å²æ•°æ®åŠ è½½å¤±è´¥:', result.error);
                        // ä½¿ç”¨å¤‡ç”¨æ¨¡æ‹Ÿæ•°æ®
                        const now = new Date();
                        const historyData = [];
                        for (let i = 23; i >= 0; i--) {
                            const timestamp = new Date(now - i * 3600000);
                            historyData.push({
                                timestamp: timestamp,
                                heartRate: Math.floor(Math.random() * (90 - 60)) + 60,
                                bloodOxygen: Math.floor(Math.random() * (100 - 95)) + 95,
                                temperature: (Math.random() * (37.2 - 36.2) + 36.2).toFixed(1)
                            });
                        }
                        const formattedData = {
                            heartRate: historyData.map(d => [d.timestamp.toISOString(), d.heartRate]),
                            bloodOxygen: historyData.map(d => [d.timestamp.toISOString(), d.bloodOxygen]),
                            temperature: historyData.map(d => [d.timestamp.toISOString(), parseFloat(d.temperature)])
                        };
                        updateTrendChart(formattedData);
                    }
                })
                .catch(error => {
                    console.error('âŒ å†å²æ•°æ®APIè¯·æ±‚å¤±è´¥:', error);
                    // ä½¿ç”¨å¤‡ç”¨æ¨¡æ‹Ÿæ•°æ®
                    const now = new Date();
                    const historyData = [];
                    for (let i = 23; i >= 0; i--) {
                        const timestamp = new Date(now - i * 3600000);
                        historyData.push({
                            timestamp: timestamp,
                            heartRate: Math.floor(Math.random() * (90 - 60)) + 60,
                            bloodOxygen: Math.floor(Math.random() * (100 - 95)) + 95,
                            temperature: (Math.random() * (37.2 - 36.2) + 36.2).toFixed(1)
                        });
                    }
                    const formattedData = {
                        heartRate: historyData.map(d => [d.timestamp.toISOString(), d.heartRate]),
                        bloodOxygen: historyData.map(d => [d.timestamp.toISOString(), d.bloodOxygen]),
                        temperature: historyData.map(d => [d.timestamp.toISOString(), parseFloat(d.temperature)])
                    };
                    updateTrendChart(formattedData);
                });
        }

        function initializeDeviceStatusDisplay() {
            // åˆå§‹åŒ–è®¾å¤‡çŠ¶æ€æ˜¾ç¤º
            const statusText = document.getElementById('deviceStatusText');
            const statusIndicator = document.querySelector('.status-indicator');
            
            if (statusText) {
                statusText.textContent = deviceSn ? `è®¾å¤‡ ${deviceSn} åˆå§‹åŒ–ä¸­...` : 'è®¾å¤‡åˆå§‹åŒ–ä¸­...';
            }
            if (statusIndicator) {
                statusIndicator.style.background = '#ffaa00'; // åˆå§‹åŒ–ä¸ºé»„è‰²
            }
            
            console.log('ğŸ“± è®¾å¤‡çŠ¶æ€æ˜¾ç¤ºåˆå§‹åŒ–å®Œæˆ');
        }

        function updateDeviceStatus(deviceData) {
            if (!deviceData) {
                console.warn('âš ï¸ updateDeviceStatus: deviceData å‚æ•°ä¸ºç©º');
                return;
            }
            
            // æ›´æ–°è®¾å¤‡çŠ¶æ€æ˜¾ç¤º
            const statusText = document.getElementById('deviceStatusText');
            const statusIndicator = document.querySelector('.status-indicator');
            
            if (statusText) {
                const statusDesc = deviceData.status === 'ACTIVE' ? 'åœ¨çº¿' : 'ç¦»çº¿';
                statusText.textContent = deviceSn ? `è®¾å¤‡ ${deviceSn} ${statusDesc}` : `è®¾å¤‡${statusDesc}`;
            }
            
            if (statusIndicator) {
                statusIndicator.style.background = deviceData.status === 'ACTIVE' ? '#00ff9d' : '#ff4757';
            }
            
            console.log('ğŸ“± è®¾å¤‡çŠ¶æ€å·²æ›´æ–°:', deviceData);
        }

        // WebSocket functionality removed for performance optimization

        // ============= å¡ç‰‡å¯¼èˆªåŠŸèƒ½ =============
        function createModalWindow(url, title, width, height) {
            const modalContainer = document.createElement('div');
            modalContainer.className = 'modal-container';
            modalContainer.innerHTML = `
                <div class="modal-content">
                    <button class="modal-close">âœ–</button>
                    <iframe src="${url}" class="user-view-iframe"></iframe>
                </div>
            `;
            
            document.body.appendChild(modalContainer);
            
            // æ·»åŠ æ¨¡æ€çª—å£æ ·å¼
            if (!document.getElementById('modalStyles')) {
                const style = document.createElement('style');
                style.id = 'modalStyles';
                style.textContent = `
                    .modal-container {
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        background: rgba(0, 0, 0, 0.8);
                        display: flex;
                        justify-content: center;
                        align-items: center;
                        z-index: 10000;
                    }
                    .modal-content {
                        width: ${width || '90%'};
                        height: ${height || '90%'};
                        background: #001529;
                        border-radius: 8px;
                        position: relative;
                        border: 1px solid #00e4ff;
                        box-shadow: 0 0 30px rgba(0, 228, 255, 0.3);
                    }
                    .modal-close {
                        position: absolute;
                        top: 10px;
                        right: 15px;
                        background: #ff4757;
                        color: white;
                        border: none;
                        border-radius: 4px;
                        padding: 5px 10px;
                        cursor: pointer;
                        z-index: 10001;
                        font-size: 14px;
                    }
                    .modal-close:hover {
                        background: #ff3742;
                    }
                    .user-view-iframe {
                        width: 100%;
                        height: 100%;
                        border: none;
                        border-radius: 8px;
                    }
                `;
                document.head.appendChild(style);
            }
            
            // å…³é—­æŒ‰é’®äº‹ä»¶
            modalContainer.querySelector('.modal-close').addEventListener('click', function() {
                document.body.removeChild(modalContainer);
            });
            
            // ç‚¹å‡»èƒŒæ™¯å…³é—­
            modalContainer.addEventListener('click', function(e) {
                if (e.target === modalContainer) {
                    document.body.removeChild(modalContainer);
                }
            });
        }

        // æ¶ˆæ¯é€šçŸ¥é¢æ¿ç‚¹å‡»è·³è½¬å‡½æ•°
        async function navigateToMessageView() {
            try {
                const deviceSn = "{{deviceSn}}"; // ä»URLè·å–deviceSn
                if (!deviceSn) {
                    alert('æ— æ³•è·å–è®¾å¤‡ä¿¡æ¯');
                    return;
                }
                
                // è°ƒç”¨åç«¯APIè·å–orgIdå’ŒuserId
                const response = await fetch(`/api/device/user_org?deviceSn=${deviceSn}`);
                const data = await response.json();
                
                if (data.success && data.orgId) {
                    createModalWindow(`/message_view.html?customerId=${data.orgId}&userId=${data.userId}`, 'æ¶ˆæ¯ç®¡ç†', '90%', '90%');
                } else {
                    alert('æ— æ³•è·å–ç”¨æˆ·ç»„ç»‡ä¿¡æ¯');
                }
            } catch (error) {
                console.error('è·³è½¬å¤±è´¥:', error);
                alert('è·³è½¬å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
            }
        }

        // å‘Šè­¦é¢æ¿ç‚¹å‡»è·³è½¬å‡½æ•°
        async function navigateToAlertView() {
            try {
                const deviceSn = "{{deviceSn}}"; // ä»URLè·å–deviceSn
                if (!deviceSn) {
                    alert('æ— æ³•è·å–è®¾å¤‡ä¿¡æ¯');
                    return;
                }
                
                // è°ƒç”¨åç«¯APIè·å–orgIdå’ŒuserId
                const response = await fetch(`/api/device/user_org?deviceSn=${deviceSn}`);
                const data = await response.json();
                
                if (data.success && data.orgId) {
                    createModalWindow(`/alert_view.html?customerId=${data.orgId}&userId=${data.userId}`, 'å‘Šè­¦ç®¡ç†', '90%', '90%');
                } else {
                    alert('æ— æ³•è·å–ç»„ç»‡ä¿¡æ¯');
                }
            } catch (error) {
                console.error('è·³è½¬å¤±è´¥:', error);
                alert('è·³è½¬å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
            }
        }

        // è®¾å¤‡çŠ¶æ€é¢æ¿ç‚¹å‡»è·³è½¬å‡½æ•°
        async function navigateToDeviceView() {
            try {
                const deviceSn = "{{deviceSn}}"; // ä»URLè·å–deviceSn
                if (!deviceSn) {
                    alert('æ— æ³•è·å–è®¾å¤‡ä¿¡æ¯');
                    return;
                }
                
                // è°ƒç”¨åç«¯APIè·å–orgIdå’ŒuserId
                const response = await fetch(`/api/device/user_org?deviceSn=${deviceSn}`);
                const data = await response.json();
                
                if (data.success && data.orgId) {
                    createModalWindow(`/device_view.html?customerId=${data.orgId}&userId=${data.userId}`, 'è®¾å¤‡ç®¡ç†', '90%', '90%');
                } else {
                    alert('æ— æ³•è·å–ç»„ç»‡ä¿¡æ¯');
                }
            } catch (error) {
                console.error('è·³è½¬å¤±è´¥:', error);
                alert('è·³è½¬å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
            }
        }

        // ============= ä¸ªæ€§åŒ–åŠŸèƒ½ ============= 
        function switchTheme(themeName) {
            console.log('ğŸ¨ åˆ‡æ¢ä¸»é¢˜:', themeName);
            
            // ç§»é™¤æ‰€æœ‰ä¸»é¢˜ç±»
            document.body.classList.remove('theme-deep-blue', 'theme-purple', 'theme-eco-green', 'theme-warm-orange');
            
            // æ·»åŠ æ–°ä¸»é¢˜ç±»
            if (themeName !== 'default') {
                document.body.classList.add(`theme-${themeName}`);
            }
            
            // ä¿å­˜ä¸»é¢˜åå¥½åˆ°localStorage
            localStorage.setItem('personalTheme', themeName);
            
            // é‡æ–°åŠ è½½å›¾è¡¨ä»¥æ›´æ–°é¢œè‰²
            updateChartsTheme();
        }

        function switchLayout(layoutType) {
            console.log('ğŸ“Š åˆ‡æ¢å¸ƒå±€:', layoutType);
            
            // ç§»é™¤æ‰€æœ‰å¸ƒå±€ç±»
            document.body.classList.remove('layout-compact', 'layout-expanded');
            
            // æ·»åŠ æ–°å¸ƒå±€ç±»
            if (layoutType !== 'standard') {
                document.body.classList.add(`layout-${layoutType}`);
            }
            
            // ä¿å­˜å¸ƒå±€åå¥½åˆ°localStorage
            localStorage.setItem('personalLayout', layoutType);
            
            // é‡æ–°è°ƒæ•´å›¾è¡¨å°ºå¯¸
            setTimeout(() => {
                Object.values(chartInstances).forEach(chart => {
                    if (chart && typeof chart.resize === 'function') {
                        chart.resize();
                    }
                });
            }, 300);
        }

        function toggleSettings() {
            console.log('âš™ï¸ åˆ‡æ¢è®¾ç½®é¢æ¿');
            // è¿™é‡Œå¯ä»¥æ·»åŠ é«˜çº§è®¾ç½®é¢æ¿çš„æ˜¾ç¤º/éšè—åŠŸèƒ½
            alert('é«˜çº§è®¾ç½®åŠŸèƒ½å¼€å‘ä¸­...');
        }

        function updateChartsTheme() {
            // è·å–å½“å‰ä¸»é¢˜é¢œè‰²
            const rootStyles = getComputedStyle(document.documentElement);
            const primaryColor = rootStyles.getPropertyValue('--primary-color').trim();
            const secondaryColor = rootStyles.getPropertyValue('--secondary-color').trim();
            const accentColor = rootStyles.getPropertyValue('--accent-color').trim();
            
            console.log('ğŸ“Š æ›´æ–°å›¾è¡¨ä¸»é¢˜é¢œè‰²:', { primaryColor, secondaryColor, accentColor });
            
            // æ›´æ–°ä»ªè¡¨ç›˜é¢œè‰²
            Object.entries(chartInstances).forEach(([key, chart]) => {
                if (chart && key.includes('Gauge')) {
                    let gaugeColor = primaryColor;
                    if (key === 'heartRateGauge') gaugeColor = accentColor;
                    else if (key === 'bloodOxygenGauge') gaugeColor = secondaryColor;
                    
                    chart.setOption({
                        series: [{
                            itemStyle: {
                                color: gaugeColor,
                                shadowColor: `${gaugeColor}66`,
                                shadowBlur: 10
                            },
                            progress: {
                                itemStyle: {
                                    color: {
                                        type: 'linear',
                                        x: 0, y: 0, x2: 1, y2: 0,
                                        colorStops: [
                                            { offset: 0, color: gaugeColor + '22' },
                                            { offset: 1, color: gaugeColor }
                                        ]
                                    }
                                }
                            },
                            axisLine: {
                                lineStyle: {
                                    color: [[1, `${gaugeColor}22`]]
                                }
                            }
                        }]
                    });
                }
            });
            
            // æ›´æ–°ä¸»è¶‹åŠ¿å›¾é¢œè‰²
            if (chartInstances.mainChart) {
                chartInstances.mainChart.setOption({
                    series: [
                        {
                            lineStyle: { color: accentColor },
                            itemStyle: { color: accentColor }
                        },
                        {
                            lineStyle: { color: secondaryColor },
                            itemStyle: { color: secondaryColor }
                        },
                        {
                            lineStyle: { color: primaryColor },
                            itemStyle: { color: primaryColor }
                        }
                    ]
                });
            }
        }

        function loadPersonalizationSettings() {
            // åŠ è½½ä¿å­˜çš„ä¸»é¢˜è®¾ç½®
            const savedTheme = localStorage.getItem('personalTheme') || 'default';
            const themeSelect = document.getElementById('themeSelect');
            if (themeSelect) {
                themeSelect.value = savedTheme;
                switchTheme(savedTheme);
            }
            
            // åŠ è½½ä¿å­˜çš„å¸ƒå±€è®¾ç½®
            const savedLayout = localStorage.getItem('personalLayout') || 'standard';
            const layoutSelect = document.getElementById('layoutSelect');
            if (layoutSelect) {
                layoutSelect.value = savedLayout;
                switchLayout(savedLayout);
            }
            
            console.log('âš™ï¸ åŠ è½½ä¸ªæ€§åŒ–è®¾ç½®:', { theme: savedTheme, layout: savedLayout });
        }

        // ============= äº¤äº’å‡½æ•° =============
        function switchTimeRange(range) {
            currentTimeRange = range;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.control-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            console.log('ğŸ“ˆ åˆ‡æ¢æ—¶é—´èŒƒå›´:', range);
            // é‡æ–°åŠ è½½å¯¹åº”æ—¶é—´èŒƒå›´çš„å†å²æ•°æ®
            loadHistoryChart();
        }

        function showAlertDetails() {
            console.log('ğŸš¨ æ˜¾ç¤ºå‘Šè­¦è¯¦æƒ…');
            
            // è·å–è¯¦ç»†çš„å‘Šè­¦ä¿¡æ¯
            fetch(`/api/personal/alerts?deviceSn=${deviceSn}`)
                .then(response => response.json())
                .then(result => {
                    if (result.success) {
                        showAlertModal(result.data.alerts);
                    } else {
                        console.error('è·å–å‘Šè­¦è¯¦æƒ…å¤±è´¥:', result.error);
                        showAlertModal([]); // æ˜¾ç¤ºç©ºå‘Šè­¦åˆ—è¡¨
                    }
                })
                .catch(error => {
                    console.error('å‘Šè­¦è¯¦æƒ…APIè¯·æ±‚å¤±è´¥:', error);
                    showAlertModal([]); // æ˜¾ç¤ºç©ºå‘Šè­¦åˆ—è¡¨
                });
        }

        function showAlertModal(alerts) {
            const modalHTML = `
                <div class="alert-modal" id="alertModal">
                    <div class="alert-modal-content">
                        <div class="alert-modal-header">
                            <h3>ğŸš¨ å¥åº·å‘Šè­¦è¯¦æƒ…</h3>
                            <button class="modal-close-btn" onclick="closeAlertModal()">âœ•</button>
                        </div>
                        <div class="alert-modal-body">
                            ${alerts.length === 0 ? 
                                '<div class="no-alerts">ğŸ‰ å¤ªæ£’äº†ï¼ç›®å‰æ²¡æœ‰ä»»ä½•å‘Šè­¦ã€‚</div>' : 
                                alerts.map(alert => `
                                    <div class="alert-detail-item alert-${alert.level}" data-alert-id="${alert.id}">
                                        <div class="alert-detail-header">
                                            <span class="alert-level-badge ${alert.level}">
                                                ${alert.level === 'critical' ? 'ğŸ”´ ä¸¥é‡' : 
                                                  alert.level === 'warning' ? 'âš ï¸ è­¦å‘Š' : 
                                                  alert.level === 'info' ? 'â„¹ï¸ ä¿¡æ¯' : 'ğŸ”µ é€šçŸ¥'}
                                            </span>
                                            <span class="alert-time">${alert.time}</span>
                                        </div>
                                        <div class="alert-content">${alert.content}</div>
                                        <div class="alert-actions">
                                            <button class="alert-action-btn primary" onclick="handleAlert('${alert.id}', 'acknowledge')">
                                                âœ“ ç¡®è®¤
                                            </button>
                                            <button class="alert-action-btn secondary" onclick="handleAlert('${alert.id}', 'dismiss')">
                                                âœ• å…³é—­
                                            </button>
                                            ${alert.level === 'critical' ? 
                                                `<button class="alert-action-btn danger" onclick="handleAlert('${alert.id}', 'emergency')">
                                                    ğŸ†˜ ç´§æ€¥å¤„ç†
                                                </button>` : ''}
                                        </div>
                                    </div>
                                `).join('')}
                        </div>
                        <div class="alert-modal-footer">
                            <button class="modal-btn secondary" onclick="closeAlertModal()">å…³é—­</button>
                            <button class="modal-btn primary" onclick="markAllAlertsRead()">å…¨éƒ¨æ ‡è®°ä¸ºå·²è¯»</button>
                        </div>
                    </div>
                </div>
            `;
            
            // æ·»åŠ æ¨¡æ€æ¡†åˆ°é¡µé¢
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            
            // æ˜¾ç¤ºåŠ¨ç”»
            setTimeout(() => {
                document.getElementById('alertModal').classList.add('show');
            }, 10);
        }

        function closeAlertModal() {
            const modal = document.getElementById('alertModal');
            if (modal) {
                modal.classList.remove('show');
                setTimeout(() => {
                    modal.remove();
                }, 300);
            }
        }

        function handleAlert(alertId, action) {
            console.log(`ğŸ› ï¸ å¤„ç†å‘Šè­¦ ${alertId}: ${action}`);
            
            // è¿™é‡Œå¯ä»¥å‘é€APIè¯·æ±‚æ¥å¤„ç†å‘Šè­¦
            const actionMessages = {
                acknowledge: 'å‘Šè­¦å·²ç¡®è®¤',
                dismiss: 'å‘Šè­¦å·²å…³é—­',
                emergency: 'å·²å¯åŠ¨ç´§æ€¥å¤„ç†æµç¨‹'
            };
            
            // æ›´æ–°UIæ˜¾ç¤º
            const alertElement = document.querySelector(`[data-alert-id="${alertId}"]`);
            if (alertElement) {
                alertElement.style.opacity = '0.5';
                alertElement.querySelector('.alert-content').innerHTML += 
                    `<div class="alert-status">âœ“ ${actionMessages[action]}</div>`;
            }
            
            // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
            showToast(actionMessages[action], 'success');
            
            // åœ¨çœŸå®å®ç°ä¸­ï¼Œè¿™é‡Œåº”è¯¥å‘é€APIè¯·æ±‚
            // fetch(`/api/alerts/${alertId}/handle`, {
            //     method: 'POST',
            //     headers: { 'Content-Type': 'application/json' },
            //     body: JSON.stringify({ action: action })
            // });
        }

        function markAllAlertsRead() {
            console.log('ğŸ“ æ ‡è®°æ‰€æœ‰å‘Šè­¦ä¸ºå·²è¯»');
            
            // æ›´æ–°æ‰€æœ‰å‘Šè­¦é¡¹çš„æ˜¾ç¤ºçŠ¶æ€
            document.querySelectorAll('.alert-detail-item').forEach(item => {
                item.style.opacity = '0.5';
                const content = item.querySelector('.alert-content');
                if (!content.querySelector('.alert-status')) {
                    content.innerHTML += '<div class="alert-status">âœ“ å·²è¯»</div>';
                }
            });
            
            showToast('æ‰€æœ‰å‘Šè­¦å·²æ ‡è®°ä¸ºå·²è¯»', 'success');
            
            // å»¶è¿Ÿå…³é—­æ¨¡æ€æ¡†
            setTimeout(() => {
                closeAlertModal();
                // åˆ·æ–°å‘Šè­¦åˆ—è¡¨
                loadAlerts();
            }, 1500);
        }

        function showToast(message, type = 'info') {
            const toastHTML = `
                <div class="toast toast-${type}" id="toast">
                    <div class="toast-content">
                        <span class="toast-icon">
                            ${type === 'success' ? 'âœ“' : 
                              type === 'error' ? 'âœ•' : 
                              type === 'warning' ? 'âš ï¸' : 'â„¹ï¸'}
                        </span>
                        <span class="toast-message">${message}</span>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', toastHTML);
            
            const toast = document.getElementById('toast');
            setTimeout(() => toast.classList.add('show'), 10);
            
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // ============= å·¥å…·å‡½æ•° =============
        function formatTime(timestamp) {
            return new Date(timestamp).toLocaleTimeString();
        }

        function formatNumber(num) {
            return num.toLocaleString();
        }

        // ============= å“åº”å¼å¤„ç† =============
        let currentBreakpoint = 'desktop';
        
        function detectBreakpoint() {
            const width = window.innerWidth;
            let newBreakpoint;
            
            if (width <= 360) {
                newBreakpoint = 'xs';
            } else if (width <= 599) {
                newBreakpoint = 'mobile';
            } else if (width <= 767) {
                newBreakpoint = 'tablet';
            } else if (width <= 1199) {
                newBreakpoint = 'laptop';
            } else {
                newBreakpoint = 'desktop';
            }
            
            if (newBreakpoint !== currentBreakpoint) {
                console.log('ğŸ“± å±å¹•å°ºå¯¸å˜åŒ–:', currentBreakpoint, '->', newBreakpoint);
                currentBreakpoint = newBreakpoint;
                handleBreakpointChange(newBreakpoint);
            }
        }
        
        function handleBreakpointChange(breakpoint) {
            const body = document.body;
            const mainContent = document.querySelector('.main-grid');
            
            // ç§»é™¤æ‰€æœ‰æ–­ç‚¹ç›¸å…³çš„ç±»
            body.classList.remove('breakpoint-xs', 'breakpoint-mobile', 'breakpoint-tablet', 'breakpoint-laptop', 'breakpoint-desktop');
            body.classList.add(`breakpoint-${breakpoint}`);
            
            // ç§»åŠ¨ç«¯ç‰¹æ®Šå¤„ç†
            if (breakpoint === 'mobile' || breakpoint === 'xs') {
                reorganizeMobileLayout();
            } else {
                restoreDesktopLayout();
            }
            
            // å»¶è¿Ÿé‡æ–°è°ƒæ•´å›¾è¡¨å°ºå¯¸
            setTimeout(() => {
                Object.values(chartInstances).forEach(chart => {
                    if (chart && typeof chart.resize === 'function') {
                        chart.resize();
                    }
                });
            }, 100);
        }
        
        function reorganizeMobileLayout() {
            console.log('ğŸ“± é‡ç»„ç§»åŠ¨ç«¯å¸ƒå±€');
            
            const leftPanel = document.querySelector('.left-panel');
            const centerPanel = document.querySelector('.center-panel');
            const rightPanel = document.querySelector('.right-panel');
            const mainGrid = document.querySelector('.main-grid');
            
            if (!leftPanel || !centerPanel || !rightPanel) return;
            
            // åˆ›å»ºç§»åŠ¨ç‰ˆå¸ƒå±€å®¹å™¨
            if (!document.querySelector('.mobile-layout')) {
                const mobileLayout = document.createElement('div');
                mobileLayout.className = 'mobile-layout';
                
                // å¥åº·æŒ‡æ ‡è¡Œ
                const healthRow = document.createElement('div');
                healthRow.className = 'health-metrics-row';
                
                // ç§»åŠ¨å¥åº·å¡ç‰‡åˆ°æ¨ªå‘å¸ƒå±€
                const healthCards = leftPanel.querySelectorAll('.health-card');
                healthCards.forEach(card => {
                    healthRow.appendChild(card.cloneNode(true));
                });
                
                // æ¶ˆæ¯å‘Šè­¦è¡Œ
                const messageAlertRow = document.createElement('div');
                messageAlertRow.className = 'message-alert-row';
                
                const rightPanels = rightPanel.querySelectorAll('.message-panel, .alert-panel');
                rightPanels.forEach(panel => {
                    messageAlertRow.appendChild(panel.cloneNode(true));
                });
                
                // ç»„è£…ç§»åŠ¨ç‰ˆå¸ƒå±€
                mobileLayout.appendChild(healthRow);
                mobileLayout.appendChild(centerPanel.cloneNode(true));
                mobileLayout.appendChild(messageAlertRow);
                
                // æ›¿æ¢åŸæœ‰å¸ƒå±€
                leftPanel.style.display = 'none';
                centerPanel.style.display = 'none';
                rightPanel.style.display = 'none';
                
                mainGrid.appendChild(mobileLayout);
                
                // é‡æ–°ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
                bindMobileEventListeners();
            }
        }
        
        function restoreDesktopLayout() {
            console.log('ğŸ–¥ï¸ æ¢å¤æ¡Œé¢ç«¯å¸ƒå±€');
            
            const mobileLayout = document.querySelector('.mobile-layout');
            if (mobileLayout) {
                mobileLayout.remove();
            }
            
            // æ¢å¤åŸæœ‰é¢æ¿æ˜¾ç¤º
            const leftPanel = document.querySelector('.left-panel');
            const centerPanel = document.querySelector('.center-panel');
            const rightPanel = document.querySelector('.right-panel');
            
            if (leftPanel) leftPanel.style.display = 'flex';
            if (centerPanel) centerPanel.style.display = 'flex';
            if (rightPanel) rightPanel.style.display = 'flex';
        }
        
        function bindMobileEventListeners() {
            // ä¸ºç§»åŠ¨ç‰ˆå¸ƒå±€ä¸­çš„å…ƒç´ é‡æ–°ç»‘å®šäº‹ä»¶
            const mobileAlertPanel = document.querySelector('.mobile-layout .alert-panel');
            if (mobileAlertPanel) {
                mobileAlertPanel.addEventListener('click', showAlertDetails);
            }
        }
        
        // ç›‘å¬çª—å£å°ºå¯¸å˜åŒ–
        window.addEventListener('resize', function() {
            detectBreakpoint();
        });
        
        // ç›‘å¬è®¾å¤‡æ–¹å‘å˜åŒ–
        window.addEventListener('orientationchange', function() {
            setTimeout(() => {
                detectBreakpoint();
            }, 100);
        });
        
        // åˆå§‹åŒ–æ—¶æ£€æµ‹æ–­ç‚¹
        function initializeResponsive() {
            detectBreakpoint();
        }

        // ============= é”™è¯¯å¤„ç† =============
        window.addEventListener('error', function(event) {
            console.error('âš ï¸ é¡µé¢é”™è¯¯:', event.error);
        });

    </script>

    <!-- å¤–éƒ¨JSæ–‡ä»¶å¼•ç”¨ -->
    <script src="/static/js/performance.js" defer></script>
    <script src="/static/js/personal.js" defer></script>
    
    <!-- é¡µé¢åˆå§‹åŒ–è„šæœ¬ -->
    <script>
        // é¡µé¢ç‰¹å®šé…ç½®
        const PAGE_CONFIG = {
            deviceSn: '{{ device_sn or "" }}',
            orgId: '{{ org_id or "" }}', 
            userId: '{{ user_id or "" }}',
            apiEndpoint: '/api',
            socketNamespace: '/personal',
            // æ€§èƒ½é…ç½®
            updateInterval: 8000,
            chartUpdateInterval: 2000,
            cacheEnabled: true
        };
        
        console.log('ğŸš€ ä¸ªäººå¥åº·å¤§å±é¡µé¢åŠ è½½å®Œæˆ');
    </script>
</body>
</html>