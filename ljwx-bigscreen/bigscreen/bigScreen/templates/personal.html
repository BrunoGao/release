<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Êô∫ËÉΩÁ©øÊà¥‰∏™‰∫∫ÂÅ•Â∫∑Â§ßÂ±è v1.3.5</title>
    
    <!-- ‰æùËµñÂºïÂÖ• -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.0/dist/echarts.min.js" onerror="loadEChartsBackup()"></script>
    
    <script>
        // EChartsÂ§áÁî®CDNÂä†ËΩΩ
        function loadEChartsBackup() {
            console.log('‚ö†Ô∏è ‰∏ªË¶ÅECharts CDNÂä†ËΩΩÂ§±Ë¥•ÔºåÂ∞ùËØïÂ§áÁî®CDN...');
            const script = document.createElement('script');
            script.src = 'https://unpkg.com/echarts@5.4.0/dist/echarts.min.js';
            script.onerror = function() {
                console.error('‚ùå Â§áÁî®ECharts CDN‰πüÂä†ËΩΩÂ§±Ë¥•');
                // ÂèØ‰ª•Âú®ËøôÈáåÂä†ËΩΩÊú¨Âú∞EChartsÊñá‰ª∂
                loadLocalECharts();
            };
            document.head.appendChild(script);
        }
        
        function loadLocalECharts() {
            console.log('üîÑ Â∞ùËØïÂä†ËΩΩÊú¨Âú∞ECharts...');
            const script = document.createElement('script');
            script.src = '/static/js/echarts.min.js';
            script.onerror = function() {
                console.error('‚ùå Êú¨Âú∞EChartsÊñá‰ª∂‰∏çÂ≠òÂú®ÔºåÂ∞Ü‰ΩøÁî®ÈôçÁ∫ßÂõæË°®');
            };
            document.head.appendChild(script);
        }
    </script>
    
    <link rel="stylesheet" href="/static/css/personal.css">
    <style>
        /* ============= Âü∫Á°ÄÊ†∑ÂºèÈáçÁΩÆ ============= */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* ============= ‰∏ªÈ¢òÁ≥ªÁªü CSSÂèòÈáè ============= */
        :root {
            /* ÈªòËÆ§‰∏ªÈ¢ò - È´òÁßëÊäÄËìùÁªøËâ≤ */
            --primary-color: #00ff9d;
            --secondary-color: #00e4ff;
            --accent-color: #ff6b6b;
            --background-primary: #0a1525;
            --background-secondary: rgba(0, 21, 41, 0.9);
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.8);
            --border-color: rgba(0, 255, 157, 0.3);
            --shadow-primary: rgba(0, 255, 157, 0.2);
            --chart-bg: rgba(13, 20, 33, 0.95);
        }

        /* Ê∑±Ëìù‰∏ªÈ¢ò */
        .theme-deep-blue {
            --primary-color: #1890ff;
            --secondary-color: #40a9ff;
            --accent-color: #ff7875;
            --background-primary: #001529;
            --border-color: rgba(24, 144, 255, 0.3);
            --shadow-primary: rgba(24, 144, 255, 0.2);
        }

        /* Á¥´ÁΩóÂÖ∞‰∏ªÈ¢ò */
        .theme-purple {
            --primary-color: #722ed1;
            --secondary-color: #9254de;
            --accent-color: #ff9c6e;
            --background-primary: #1a0d2e;
            --border-color: rgba(114, 46, 209, 0.3);
            --shadow-primary: rgba(114, 46, 209, 0.2);
        }

        /* ÁªøËâ≤ÁîüÊÄÅ‰∏ªÈ¢ò */
        .theme-eco-green {
            --primary-color: #52c41a;
            --secondary-color: #73d13d;
            --accent-color: #ffa940;
            --background-primary: #162312;
            --border-color: rgba(82, 196, 26, 0.3);
            --shadow-primary: rgba(82, 196, 26, 0.2);
        }

        /* Ê©ôËâ≤ÊöñÈò≥‰∏ªÈ¢ò */
        .theme-warm-orange {
            --primary-color: #fa8c16;
            --secondary-color: #ffa940;
            --accent-color: #40a9ff;
            --background-primary: #2d1b0e;
            --border-color: rgba(250, 140, 22, 0.3);
            --shadow-primary: rgba(250, 140, 22, 0.2);
        }

        @font-face {
            font-family: "NumFont";
            src: url('{{ url_for("static", filename="fonts/num.otf") }}') format('truetype');
        }

        html, body {
            height: 100%;
            width: 100%;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', sans-serif;
        }

        /* ============= ‰∏ª‰ΩìÂ∏ÉÂ±ÄÊ†∑Âºè ============= */
        .app-container {
            height: 100vh;
            width: 100vw;
            background: 
                url('/static/health-assets/effects/particle-01.png') no-repeat top right,
                url('/static/health-assets/effects/particle-02.png') no-repeat bottom left,
                radial-gradient(ellipse at center, var(--background-primary) 0%, #041018 100%);
            background-size: 300px 300px, 250px 250px, 100% 100%;
            position: relative;
            overflow: hidden;
            transition: background 0.3s ease;
        }

        /* Âä®ÊÄÅËÉåÊôØÁ≤íÂ≠ê - ‰ΩøÁî®CSSÂèòÈáè */
        .app-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(2px 2px at 20px 30px, var(--shadow-primary), transparent),
                radial-gradient(2px 2px at 40px 70px, var(--border-color), transparent),
                radial-gradient(1px 1px at 90px 40px, var(--shadow-primary), transparent),
                radial-gradient(1px 1px at 130px 80px, var(--border-color), transparent);
            background-size: 200px 200px;
            animation: particles 20s linear infinite;
            opacity: 0.4;
            transition: background 0.3s ease;
        }

        @keyframes particles {
            0% { background-position: 0 0, 0 0, 0 0, 0 0; }
            100% { background-position: 200px 200px, -200px 200px, 200px -200px, -200px -200px; }
        }

        /* ‰∏ªÁΩëÊ†ºÂ∏ÉÂ±Ä */
        .main-grid {
            display: grid;
            grid-template-columns: 360px 1fr 360px;
            grid-template-rows: 90px 1fr;
            gap: 24px;
            height: 100vh;
            padding: 24px;
            position: relative;
            z-index: 1;
        }

        /* ============= ÂëòÂ∑•‰ø°ÊÅØÈù¢Êùø ============= */
        .employee-info-panel {
            background: linear-gradient(145deg, rgba(13, 20, 33, 0.95), rgba(6, 18, 25, 0.95));
            border: 1px solid rgba(0, 255, 157, 0.3);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .employee-info-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--primary-color), transparent);
            animation: scan 4s infinite;
        }

        .employee-avatar {
            position: relative;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            overflow: hidden;
            border: 3px solid var(--primary-color);
            box-shadow: 0 0 20px rgba(0, 255, 157, 0.4);
        }

        .employee-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .online-indicator {
            position: absolute;
            bottom: 5px;
            right: 5px;
            width: 20px;
            height: 20px;
            background: #00ff3c;
            border-radius: 50%;
            border: 3px solid #fff;
            box-shadow: 0 0 10px rgba(0, 255, 60, 0.8);
            animation: pulse 2s infinite;
        }

        .employee-details {
            flex: 1;
            color: #ffffff;
        }

        .employee-details h3 {
            margin: 0 0 8px 0;
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
        }

        .employee-details p {
            margin: 4px 0;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
        }

        .confirm-btn {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: #000;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-block;
            margin-top: 10px;
        }

        .confirm-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 255, 157, 0.4);
        }

        /* ============= È°∂ÈÉ®ÂØºËà™Ê†è ============= */
        .top-header {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, rgba(13, 20, 33, 0.95), rgba(6, 18, 25, 0.95));
            border: 1px solid rgba(0, 255, 157, 0.2);
            border-radius: 12px;
            padding: 0 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
            min-height: 70px;
        }

        .top-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--primary-color), transparent);
            animation: scan 3s infinite;
        }

        @keyframes scan {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        /* ============= Áî®Êà∑‰ø°ÊÅØÂå∫Âüü ============= */
        .header-user-info {
            display: flex;
            align-items: center;
            gap: 16px;
            background: linear-gradient(145deg, rgba(0, 255, 157, 0.05), rgba(0, 228, 255, 0.05));
            border: 1px solid rgba(0, 255, 157, 0.15);
            border-radius: 25px;
            padding: 8px 20px 8px 8px;
            backdrop-filter: blur(5px);
            transition: all 0.3s ease;
        }

        .header-user-info:hover {
            border-color: rgba(0, 255, 157, 0.3);
            box-shadow: 0 4px 20px rgba(0, 255, 157, 0.1);
            transform: translateY(-1px);
        }

        .user-avatar {
            position: relative;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            overflow: hidden;
            border: 2px solid rgba(0, 255, 157, 0.3);
            background: linear-gradient(45deg, rgba(0, 255, 157, 0.2), rgba(0, 228, 255, 0.2));
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .user-status-dot {
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 12px;
            height: 12px;
            background: #00ff3c;
            border: 2px solid rgba(13, 20, 33, 0.9);
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(0, 255, 60, 0.8);
            animation: pulse-dot 2s infinite;
        }

        @keyframes pulse-dot {
            0%, 100% { 
                box-shadow: 0 0 10px rgba(0, 255, 60, 0.8);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 0 15px rgba(0, 255, 60, 1);
                transform: scale(1.1);
            }
        }

        .user-details {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .user-name {
            font-size: 16px;
            font-weight: 700;
            color: #ffffff;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
        }

        .user-meta {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        .user-id {
            background: linear-gradient(45deg, rgba(0, 255, 157, 0.2), rgba(0, 228, 255, 0.2));
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: 600;
            border: 1px solid rgba(0, 255, 157, 0.3);
        }

        .user-separator {
            color: rgba(0, 255, 157, 0.6);
        }

        .user-dept {
            font-weight: 500;
        }

        .user-status {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 4px;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-badge.online {
            background: linear-gradient(45deg, rgba(0, 255, 60, 0.2), rgba(0, 255, 157, 0.2));
            color: #00ff3c;
            border: 1px solid rgba(0, 255, 60, 0.4);
            box-shadow: 0 0 10px rgba(0, 255, 60, 0.2);
        }

        .device-info {
            font-size: 10px;
            color: rgba(255, 255, 255, 0.6);
            text-align: right;
        }

        .device-label {
            color: rgba(0, 255, 157, 0.8);
            margin-right: 4px;
        }

        .device-sn {
            font-family: 'Courier New', monospace;
            background: rgba(0, 255, 157, 0.1);
            padding: 1px 4px;
            border-radius: 3px;
            color: rgba(255, 255, 255, 0.8);
        }

        .logo {
            width: 40px;
            height: 40px;
            background: linear-gradient(45deg, #00ff9d, #00e4ff);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: #041018;
            font-weight: bold;
        }

        .header-title {
            color: #ffffff;
            font-size: 24px;
            font-weight: 600;
            text-shadow: 0 0 10px rgba(0, 255, 157, 0.5);
        }

        .header-subtitle {
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
            margin-left: 10px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .device-status {
            display: flex;
            align-items: center;
            gap: 12px;
            color: #ffffff;
            padding: 8px 16px;
            background: rgba(0, 21, 41, 0.3);
            border-radius: 8px;
            border: 1px solid rgba(0, 255, 157, 0.2);
        }

        .status-indicator {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #00ff9d;
            box-shadow: 0 0 10px rgba(0, 255, 157, 0.8);
            animation: pulse 2s infinite;
            flex-shrink: 0;
        }

        #deviceStatusText {
            font-size: 16px;
            font-weight: 600;
            color: #ffffff;
            white-space: nowrap;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .close-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(255, 71, 87, 0.1);
            border: 1px solid rgba(255, 71, 87, 0.3);
            color: #ff4757;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: rgba(255, 71, 87, 0.2);
            transform: scale(1.1);
        }

        /* ============= ‰∏™ÊÄßÂåñÊéßÂà∂Ê†∑Âºè ============= */
        .personalization-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 0 15px;
            border-right: 1px solid var(--border-color);
            margin-right: 15px;
        }

        .theme-selector, .layout-selector {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .control-label {
            font-size: 16px;
            color: var(--text-secondary);
        }

        .control-select {
            background: var(--background-secondary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
            padding: 6px 12px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .control-select:hover {
            border-color: var(--primary-color);
            box-shadow: 0 0 8px var(--shadow-primary);
        }

        .control-select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 12px var(--shadow-primary);
        }

        .settings-btn {
            background: transparent;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-secondary);
            padding: 8px 12px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .settings-btn:hover {
            background: var(--background-secondary);
            border-color: var(--primary-color);
            color: var(--primary-color);
            box-shadow: 0 0 8px var(--shadow-primary);
        }

        /* ============= Â∏ÉÂ±ÄÊ†∑ÂºèÂèòÂåñ ============= */
        /* Á¥ßÂáëÂ∏ÉÂ±Ä */
        .layout-compact .main-grid {
            grid-template-columns: 280px 1fr 280px;
            gap: 15px;
            padding: 15px;
        }

        .layout-compact .health-card {
            padding: 15px;
        }

        .layout-compact .advanced-gauge {
            width: 80px;
            height: 80px;
        }

        /* Â±ïÂºÄÂ∏ÉÂ±Ä */
        .layout-expanded .main-grid {
            grid-template-columns: 400px 1fr 400px;
            gap: 25px;
            padding: 25px;
        }

        .layout-expanded .health-card {
            padding: 25px;
        }

        .layout-expanded .advanced-gauge {
            width: 140px;
            height: 140px;
        }

        /* ============= ÂëäË≠¶Ê®°ÊÄÅÊ°ÜÊ†∑Âºè ============= */
        .alert-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .alert-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .alert-modal-content {
            background: var(--chart-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(20px);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .alert-modal.show .alert-modal-content {
            transform: scale(1);
        }

        .alert-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid var(--border-color);
            background: linear-gradient(135deg, var(--background-secondary), rgba(0, 21, 41, 0.7));
        }

        .alert-modal-header h3 {
            margin: 0;
            color: var(--text-primary);
            font-size: 18px;
        }

        .modal-close-btn {
            background: transparent;
            border: 1px solid rgba(255, 71, 87, 0.3);
            color: #ff4757;
            width: 32px;
            height: 32px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .modal-close-btn:hover {
            background: rgba(255, 71, 87, 0.1);
            border-color: rgba(255, 71, 87, 0.5);
        }

        .alert-modal-body {
            padding: 20px 24px;
            max-height: 400px;
            overflow-y: auto;
        }

        .no-alerts {
            text-align: center;
            color: var(--primary-color);
            font-size: 16px;
            padding: 40px 20px;
        }

        .alert-detail-item {
            background: linear-gradient(135deg, rgba(13, 20, 33, 0.7), rgba(6, 18, 25, 0.7));
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            transition: all 0.3s ease;
        }

        .alert-detail-item:hover {
            border-color: var(--primary-color);
            box-shadow: 0 4px 16px var(--shadow-primary);
        }

        .alert-detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .alert-level-badge {
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }

        .alert-level-badge.critical {
            background: rgba(255, 71, 87, 0.2);
            color: #ff4757;
            border: 1px solid rgba(255, 71, 87, 0.3);
        }

        .alert-level-badge.warning {
            background: rgba(255, 170, 0, 0.2);
            color: #ffaa00;
            border: 1px solid rgba(255, 170, 0, 0.3);
        }

        .alert-level-badge.info {
            background: rgba(0, 228, 255, 0.2);
            color: #00e4ff;
            border: 1px solid rgba(0, 228, 255, 0.3);
        }

        .alert-time {
            color: var(--text-secondary);
            font-size: 12px;
        }

        .alert-content {
            color: var(--text-primary);
            margin: 8px 0;
            line-height: 1.5;
        }

        .alert-status {
            color: var(--primary-color);
            font-size: 12px;
            margin-top: 6px;
            font-weight: bold;
        }

        .alert-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            flex-wrap: wrap;
        }

        .alert-action-btn {
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }

        .alert-action-btn.primary {
            background: var(--primary-color);
            color: #000;
        }

        .alert-action-btn.primary:hover {
            background: var(--secondary-color);
            box-shadow: 0 0 8px var(--shadow-primary);
        }

        .alert-action-btn.secondary {
            background: var(--background-secondary);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }

        .alert-action-btn.secondary:hover {
            background: var(--border-color);
            color: var(--text-primary);
        }

        .alert-action-btn.danger {
            background: rgba(255, 71, 87, 0.2);
            color: #ff4757;
            border: 1px solid rgba(255, 71, 87, 0.3);
        }

        .alert-action-btn.danger:hover {
            background: rgba(255, 71, 87, 0.3);
            box-shadow: 0 0 8px rgba(255, 71, 87, 0.4);
        }

        .alert-modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            padding: 16px 24px;
            border-top: 1px solid var(--border-color);
            background: var(--background-secondary);
        }

        .modal-btn {
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }

        .modal-btn.primary {
            background: var(--primary-color);
            color: #000;
        }

        .modal-btn.primary:hover {
            background: var(--secondary-color);
            box-shadow: 0 0 12px var(--shadow-primary);
        }

        .modal-btn.secondary {
            background: transparent;
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }

        .modal-btn.secondary:hover {
            background: var(--background-secondary);
            color: var(--text-primary);
            border-color: var(--primary-color);
        }

        /* ============= Toast ÈÄöÁü•Ê†∑Âºè ============= */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--chart-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 16px 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            z-index: 10001;
            transform: translateX(100%);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .toast.show {
            transform: translateX(0);
            opacity: 1;
        }

        .toast-content {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .toast-icon {
            font-size: 16px;
        }

        .toast.toast-success {
            border-color: var(--primary-color);
        }

        .toast.toast-success .toast-icon {
            color: var(--primary-color);
        }

        .toast.toast-error {
            border-color: #ff4757;
        }

        .toast.toast-error .toast-icon {
            color: #ff4757;
        }

        .toast.toast-warning {
            border-color: #ffaa00;
        }

        .toast.toast-warning .toast-icon {
            color: #ffaa00;
        }

        .toast-message {
            color: var(--text-primary);
            font-size: 14px;
        }

        /* ============= ÁßªÂä®Á´ØÂìçÂ∫îÂºè‰ºòÂåñ ============= */
        /* Â§ßÂûãÂπ≥Êùø - 1200px‰ª•‰∏ä */
        @media (min-width: 1200px) {
            .main-grid {
                grid-template-columns: 380px 1fr 380px;
                gap: 24px;
                padding: 24px;
            }
        }

        /* ‰∏≠ÂûãÂ±èÂπï - 768px Âà∞ 1199px */
        @media (max-width: 1199px) and (min-width: 768px) {
            .main-grid {
                grid-template-columns: 300px 1fr 300px;
                gap: 16px;
                padding: 16px;
            }

            .health-card {
                padding: 18px;
            }

            .advanced-gauge {
                width: 100px;
                height: 100px;
            }

            .gauge-value {
                font-size: 20px;
            }

            .header-title {
                font-size: 20px;
            }

            .personalization-controls {
                gap: 10px;
            }

            .control-select {
                font-size: 11px;
                padding: 4px 8px;
            }
        }

        /* Â∞èÂûãÂπ≥Êùø - 600px Âà∞ 767px */
        @media (max-width: 767px) and (min-width: 600px) {
            .main-grid {
                grid-template-columns: 1fr;
                grid-template-rows: 60px 1fr;
                gap: 12px;
                padding: 12px;
            }

            .top-header {
                padding: 0 20px;
                height: 60px;
            }

            .header-user-info {
                gap: 12px;
                padding: 6px 16px 6px 6px;
            }

            .user-avatar {
                width: 36px;
                height: 36px;
            }

            .user-name {
                font-size: 14px;
            }

            .user-meta {
                font-size: 11px;
            }

            .user-dept {
                display: none;
            }

            .header-title {
                font-size: 18px;
            }

            .header-subtitle {
                font-size: 12px;
            }

            /* ÈáçÊñ∞Â∏ÉÂ±Ä‰∏∫ÂçïÂàóÂ∏ÉÂ±Ä */
            .left-panel, .center-panel, .right-panel {
                width: 100%;
            }

            /* ÂàõÂª∫ÊâãÊú∫ÁâàÁöÑÁΩëÊ†ºÂ∏ÉÂ±Ä */
            .mobile-content {
                display: grid;
                grid-template-columns: 1fr 1fr;
                grid-template-rows: auto auto 400px;
                gap: 12px;
            }

            .left-panel {
                grid-column: 1;
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 12px;
            }

            .right-panel {
                grid-column: 2;
                display: flex;
                flex-direction: column;
                gap: 12px;
            }

            .center-panel {
                grid-column: 1 / -1;
            }

            .health-card {
                padding: 16px;
            }

            .advanced-gauge {
                width: 80px;
                height: 80px;
            }

            .gauge-value {
                font-size: 16px;
            }

            .personalization-controls {
                display: none; /* Âú®Â∞èÂ±èÂπï‰∏äÈöêËóè‰∏™ÊÄßÂåñÊéß‰ª∂ */
            }
        }

        /* ÊâãÊú∫Á´Ø - 599px‰ª•‰∏ã */
        @media (max-width: 599px) {
            html, body {
                overflow-y: auto; /* ÂÖÅËÆ∏ÂûÇÁõ¥ÊªöÂä® */
            }

            .app-container {
                min-height: 100vh;
                height: auto;
            }

            .main-grid {
                grid-template-columns: 1fr;
                grid-template-rows: 50px auto;
                gap: 8px;
                padding: 8px;
                height: auto;
                min-height: 100vh;
            }

            .top-header {
                padding: 0 12px;
                height: 50px;
                min-height: 50px;
            }

            .header-user-info {
                gap: 8px;
                padding: 4px 10px 4px 4px;
                border-radius: 18px;
            }

            .user-avatar {
                width: 30px;
                height: 30px;
            }

            .user-status-dot {
                width: 8px;
                height: 8px;
                bottom: 1px;
                right: 1px;
            }

            .user-name {
                font-size: 11px;
            }

            .user-meta {
                font-size: 9px;
            }

            .user-separator,
            .user-dept {
                display: none;
            }

            .status-badge {
                padding: 2px 6px;
                font-size: 8px;
            }

            .device-info {
                display: none;
            }

            .logo {
                width: 28px;
                height: 28px;
                font-size: 14px;
            }

            .header-title {
                font-size: 16px;
            }

            .header-subtitle {
                font-size: 10px;
            }

            .device-status {
                font-size: 12px;
            }

            .status-indicator {
                width: 8px;
                height: 8px;
            }

            .close-btn {
                width: 28px;
                height: 28px;
                font-size: 12px;
            }

            .personalization-controls {
                display: none;
            }

            /* ÊâãÊú∫ÁâàÂ∏ÉÂ±Ä */
            .mobile-layout {
                display: flex;
                flex-direction: column;
                gap: 8px;
            }

            /* ÂÅ•Â∫∑ÊåáÊ†áÊ®™ÂêëÊéíÂàó */
            .health-metrics-row {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 8px;
            }

            .health-card {
                padding: 12px;
                min-height: auto;
            }

            .card-header {
                margin-bottom: 8px;
            }

            .card-title {
                font-size: 12px;
            }

            .card-icon {
                font-size: 14px;
            }

            .advanced-gauge {
                width: 60px;
                height: 60px;
                margin: 0 auto 8px;
            }

            .gauge-value {
                font-size: 14px;
            }

            .gauge-unit {
                font-size: 10px;
            }

            .health-details {
                display: none; /* Âú®ÊâãÊú∫‰∏äÈöêËóèËØ¶ÁªÜ‰ø°ÊÅØ */
            }

            /* ‰∏ªÂõæË°®Âå∫Âüü */
            .main-chart-container {
                padding: 16px;
                margin: 8px 0;
            }

            .chart-header h3 {
                font-size: 16px;
            }

            .time-controls {
                gap: 8px;
            }

            .control-btn {
                padding: 6px 12px;
                font-size: 12px;
            }

            /* Ê∂àÊÅØÂíåÂëäË≠¶Âå∫Âüü */
            .message-alert-row {
                display: grid;
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .message-panel, .alert-panel {
                padding: 12px;
            }

            .panel-title {
                font-size: 14px;
            }

            .message-count, .alert-count {
                font-size: 12px;
                padding: 2px 6px;
            }

            .message-item, .alert-item {
                padding: 8px;
                margin-bottom: 6px;
            }

            .message-content, .alert-text {
                font-size: 12px;
            }

            .message-time, .alert-time {
                font-size: 10px;
            }

            /* Ê®°ÊÄÅÊ°Ü‰ºòÂåñ */
            .alert-modal-content {
                width: 95%;
                max-height: 90vh;
                margin: 0 10px;
            }

            .alert-modal-header {
                padding: 12px 16px;
            }

            .alert-modal-header h3 {
                font-size: 16px;
            }

            .alert-modal-body {
                padding: 12px 16px;
            }

            .alert-detail-item {
                padding: 12px;
            }

            .alert-actions {
                flex-direction: column;
            }

            .alert-action-btn {
                width: 100%;
                padding: 10px;
                font-size: 14px;
            }

            .modal-btn {
                padding: 12px 16px;
                font-size: 14px;
            }

            /* Toast ‰ºòÂåñ */
            .toast {
                right: 10px;
                left: 10px;
                top: 10px;
                right: 10px;
            }
        }

        /* Ë∂ÖÂ∞èÂ±èÂπï - 360px‰ª•‰∏ã */
        @media (max-width: 360px) {
            .main-grid {
                padding: 4px;
                gap: 4px;
            }

            .top-header {
                padding: 0 8px;
            }

            .header-title {
                font-size: 14px;
            }

            .header-subtitle {
                display: none; /* ÈöêËóèÂâØÊ†áÈ¢ò */
            }

            .health-metrics-row {
                grid-template-columns: 1fr; /* ÂçïÂàóÂ∏ÉÂ±Ä */
            }

            .health-card {
                padding: 8px;
            }

            .advanced-gauge {
                width: 50px;
                height: 50px;
            }

            .gauge-value {
                font-size: 12px;
            }

            .main-chart-container {
                padding: 8px;
            }

            .control-btn {
                padding: 4px 8px;
                font-size: 11px;
            }
        }

        /* Ëß¶Êë∏‰ºòÂåñ */
        @media (hover: none) and (pointer: coarse) {
            .health-card:hover {
                transform: none; /* ÁßªÈô§ÊÇ¨ÂÅúÂä®Áîª */
            }

            .control-btn {
                min-height: 44px; /* Â¢ûÂä†Ëß¶Êë∏ÁõÆÊ†áÂ§ßÂ∞è */
            }

            .alert-action-btn, .modal-btn {
                min-height: 44px;
            }

            .close-btn, .settings-btn {
                min-width: 44px;
                min-height: 44px;
            }
        }

        /* ============= Â∑¶‰æßÈù¢Êùø ============= */
        .left-panel {
            display: flex;
            flex-direction: column;
            gap: 8px;
            height: 100%;
            overflow: hidden;
            padding: 0;
        }

        /* ============= ÂÅ•Â∫∑ÊåáÊ†áÂç°Áâá ============= */
        /* ÂÅ•Â∫∑Âç°ÁâáÁÇπÂáªÊïàÊûúÂíåÊèêÁ§∫ */
        .health-card {
            background: linear-gradient(145deg, rgba(13, 20, 33, 0.95), rgba(6, 18, 25, 0.95));
            border: 1px solid rgba(0, 255, 157, 0.2);
            border-radius: 12px;
            padding: 12px;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            text-align: center; /* Ê∞¥Âπ≥Â±Ö‰∏≠ */
            filter: none; /* ÁßªÈô§ËìùËâ≤Êª§Èïú */
            cursor: pointer; /* Ê∑ªÂä†ÁÇπÂáªÊâãÂäø */
            flex: 1;
            min-height: 0;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }


        .health-card:hover {
            transform: translateY(-5px) scale(1.02);
            border-color: rgba(0, 255, 157, 0.5);
            box-shadow: 0 10px 30px rgba(0, 255, 157, 0.2);
        }

        .health-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, #00ff9d, transparent);
            animation: scan 4s infinite;
        }

        .health-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 255, 157, 0.2);
            border-color: rgba(0, 255, 157, 0.5);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .card-title {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #ffffff;
            font-size: 18px; /* Â¢ûÂ§ßÊ†áÈ¢òÂ≠ó‰Ωì */
            font-weight: 600;
            margin-bottom: 15px; /* Â¢ûÂä†Èó¥Ë∑ùÈÅøÂÖçÈáçÂè† */
            line-height: 1.5;
            word-spacing: 2px;
            justify-content: center; /* Â±Ö‰∏≠ÂØπÈΩê */
        }

        .card-icon {
            font-size: 20px;
        }

        .health-status {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #00ff9d;
            box-shadow: 0 0 8px rgba(0, 255, 157, 0.8);
        }

        .health-status.warning {
            background: #ffaa00;
            box-shadow: 0 0 8px rgba(255, 170, 0, 0.8);
        }

        .health-status.critical {
            background: #ff4757;
            box-shadow: 0 0 8px rgba(255, 71, 87, 0.8);
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        /* ============= È´òÁ∫ß‰ª™Ë°®ÁõòÊ†∑Âºè ============= */
        .advanced-gauge {
            position: relative;
            width: 80px;
            height: 80px;
            margin: 0 auto 8px;
        }

        .gauge-container {
            width: 100%;
            height: 100%;
            position: relative;
        }

        .gauge-value-display {
            position: absolute;
            top: 45%; /* Ë∞ÉÊï¥‰ΩçÁΩÆÈÅøÂÖçÈáçÂè† */
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 10; /* ÊèêÈ´òÂ±ÇÁ∫ß */
            width: 100%;
        }

        .gauge-value {
            font-family: "NumFont", monospace;
            font-size: 24px;
            font-weight: 900;
            color: #00ff9d;
            text-shadow: 0 0 15px rgba(0, 255, 157, 1);
            line-height: 1;
            text-align: center;
            letter-spacing: 1px;
        }

        .gauge-unit {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.9);
            margin-top: 4px;
            text-align: center;
            font-weight: 600;
            letter-spacing: 1px;
        }

        .health-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4px;
            font-size: 10px;
            text-align: center;
            justify-content: center;
            margin-top: 6px;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            padding: 3px 5px;
            background: rgba(0, 21, 41, 0.3);
            border-radius: 3px;
            border: 1px solid rgba(0, 255, 157, 0.1);
        }

        .detail-label {
            color: rgba(255, 255, 255, 0.7);
            font-size: 9px;
        }

        .detail-value {
            color: #00e4ff;
            font-weight: 700;
            font-size: 10px;
        }

        /* ============= ‰∏≠Â§ÆÂå∫Âüü ============= */
        .center-panel {
            display: grid;
            grid-template-rows: auto 300px 1fr 200px; /* ÂõõÂ±ÇÂ∏ÉÂ±Ä */
            gap: 20px;
        }

        /* ÂÅ•Â∫∑ÁªºÂêàËØÑÂàÜÂå∫Âüü */
        .health-score-section {
            background: linear-gradient(145deg, rgba(13, 20, 33, 0.95), rgba(6, 18, 25, 0.95));
            border: 1px solid rgba(0, 255, 157, 0.3);
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(10px);
            position: relative;
            display: grid;
            grid-template-columns: 1fr 280px 1fr;
            gap: 25px;
            align-items: center;
        }

        .score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: conic-gradient(from 0deg, var(--primary-color), var(--secondary-color), var(--accent-color), var(--primary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            position: relative;
            animation: rotate 20s linear infinite;
        }

        .score-circle::before {
            content: '';
            position: absolute;
            inset: 4px;
            background: var(--background-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .score-number {
            position: absolute;
            font-size: 36px;
            font-weight: 900;
            color: var(--primary-color);
            z-index: 2;
        }

        .health-score-center {
            text-align: center;
        }

        /* ============= ÂÅ•Â∫∑È¢ÑÊµãÊ®°Âùó ============= */
        .health-prediction {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .prediction-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .prediction-icon {
            width: 28px;
            height: 28px;
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            box-shadow: 0 0 12px rgba(255, 107, 107, 0.4);
        }

        .prediction-title {
            color: #ffffff;
            font-size: 16px;
            font-weight: 700;
            text-shadow: 0 0 8px rgba(255, 255, 255, 0.3);
        }

        .prediction-item {
            background: rgba(255, 107, 107, 0.08);
            border: 1px solid rgba(255, 107, 107, 0.25);
            border-radius: 6px;
            padding: 10px;
            position: relative;
            transition: all 0.3s ease;
        }

        .prediction-item:hover {
            border-color: rgba(255, 107, 107, 0.4);
            background: rgba(255, 107, 107, 0.12);
        }

        .prediction-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(to bottom, #ff6b6b, #ff4757);
            border-radius: 0 2px 2px 0;
        }

        .prediction-label {
            font-size: 11px;
            color: rgba(255, 107, 107, 0.9);
            font-weight: 600;
            margin-bottom: 3px;
        }

        .prediction-content {
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            line-height: 1.3;
        }

        .prediction-risk {
            display: inline-flex;
            align-items: center;
            gap: 3px;
            background: rgba(255, 107, 107, 0.2);
            padding: 1px 6px;
            border-radius: 8px;
            font-size: 9px;
            font-weight: 600;
            color: #ff6b6b;
            margin-left: 6px;
        }

        /* ============= ÂÅ•Â∫∑Âª∫ËÆÆÊ®°Âùó ============= */
        .health-recommendations {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .recommendations-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .recommendations-icon {
            width: 28px;
            height: 28px;
            background: linear-gradient(45deg, #00e4ff, #00b8d4);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            box-shadow: 0 0 12px rgba(0, 228, 255, 0.4);
        }

        .recommendations-title {
            color: #ffffff;
            font-size: 16px;
            font-weight: 700;
            text-shadow: 0 0 8px rgba(255, 255, 255, 0.3);
        }

        .recommendation-item {
            background: rgba(0, 228, 255, 0.08);
            border: 1px solid rgba(0, 228, 255, 0.25);
            border-radius: 6px;
            padding: 8px 10px;
            display: flex;
            align-items: flex-start;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .recommendation-item:hover {
            border-color: rgba(0, 228, 255, 0.4);
            background: rgba(0, 228, 255, 0.12);
            transform: translateX(2px);
        }

        .recommendation-icon {
            color: #00e4ff;
            font-size: 12px;
            margin-top: 1px;
            flex-shrink: 0;
        }

        .recommendation-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 11px;
            line-height: 1.3;
        }

        .recommendation-priority {
            display: inline-block;
            background: linear-gradient(45deg, #00e4ff, #00b8d4);
            color: #000;
            padding: 1px 5px;
            border-radius: 6px;
            font-size: 8px;
            font-weight: 700;
            margin-top: 3px;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* ÂìçÂ∫îÂºèËÆæËÆ° - ÂÅ•Â∫∑ËØÑÂàÜÂå∫Âüü */
        @media (max-width: 1200px) {
            .health-score-section {
                grid-template-columns: 1fr 240px 1fr;
                gap: 20px;
                padding: 15px;
            }
            
            .prediction-title,
            .recommendations-title {
                font-size: 14px;
            }
            
            .prediction-content,
            .recommendation-text {
                font-size: 11px;
            }
        }

        @media (max-width: 768px) {
            .health-score-section {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto;
                text-align: center;
                gap: 20px;
            }
            
            .health-prediction,
            .health-recommendations {
                max-width: 400px;
                margin: 0 auto;
            }
            
            .score-circle {
                width: 100px;
                height: 100px;
            }
            
            .score-number {
                font-size: 28px;
            }
        }

        @media (max-width: 599px) {
            .health-score-section {
                padding: 12px;
                gap: 15px;
            }
            
            .prediction-header,
            .recommendations-header {
                justify-content: center;
            }
            
            .prediction-item,
            .recommendation-item {
                padding: 8px;
            }
            
            .score-circle {
                width: 80px;
                height: 80px;
            }
            
            .score-number {
                font-size: 24px;
            }
        }

        /* ÂÆûÊó∂Ê≥¢ÂΩ¢ÂõæÂå∫Âüü */
        .vital-wave-section {
            background: linear-gradient(145deg, rgba(13, 20, 33, 0.95), rgba(6, 18, 25, 0.95));
            border: 1px solid rgba(255, 107, 107, 0.3);
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .wave-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .wave-controls {
            display: flex;
            gap: 8px;
        }

        .wave-btn {
            padding: 6px 12px;
            background: rgba(255, 107, 107, 0.1);
            border: 1px solid rgba(255, 107, 107, 0.3);
            border-radius: 6px;
            color: #ff6b6b;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
        }

        .wave-btn.active {
            background: rgba(255, 107, 107, 0.3);
            box-shadow: 0 0 10px rgba(255, 107, 107, 0.5);
        }

        /* ÂÅ•Â∫∑ÂØπÊØîË∂ãÂäøÂå∫Âüü */
        .trend-comparison {
            background: linear-gradient(145deg, rgba(13, 20, 33, 0.95), rgba(6, 18, 25, 0.95));
            border: 1px solid rgba(0, 228, 255, 0.3);
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(10px);
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .trend-item {
            text-align: center;
            padding: 15px;
            background: rgba(0, 21, 41, 0.3);
            border-radius: 8px;
            border: 1px solid rgba(0, 255, 157, 0.1);
        }

        .trend-label {
            display: block;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 8px;
        }

        .trend-value {
            font-size: 24px;
            font-weight: bold;
            display: block;
        }

        .trend-value.positive {
            color: #00ff3c;
        }

        .trend-value.negative {
            color: #ff4757;
        }

        .trend-value.neutral {
            color: #ffaa00;
        }

        .main-chart-container {
            flex: 1;
            background: linear-gradient(145deg, rgba(13, 20, 33, 0.95), rgba(6, 18, 25, 0.95));
            border: 1px solid rgba(0, 255, 157, 0.2);
            border-radius: 12px;
            padding: 30px;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .chart-title {
            color: #ffffff;
            font-size: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chart-controls {
            display: flex;
            gap: 10px;
        }

        .control-btn {
            padding: 8px 16px;
            background: rgba(0, 255, 157, 0.1);
            border: 1px solid rgba(0, 255, 157, 0.3);
            border-radius: 6px;
            color: #00ff9d;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
        }

        .control-btn:hover,
        .control-btn.active {
            background: rgba(0, 255, 157, 0.2);
            box-shadow: 0 0 10px rgba(0, 255, 157, 0.3);
        }

        .main-chart {
            height: 400px;
            width: 100%;
        }

        /* ============= Âè≥‰æßÈù¢Êùø ============= */
        .right-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* ============= Ê∂àÊÅØÈÄöÁü•Èù¢Êùø ============= */
        .message-panel {
            background: linear-gradient(145deg, rgba(13, 20, 33, 0.95), rgba(6, 18, 25, 0.95));
            border: 1px solid rgba(0, 228, 255, 0.2);
            border-radius: 12px;
            padding: 20px;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
            height: 300px;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(0, 228, 255, 0.2);
        }

        .panel-title {
            color: #ffffff;
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .message-count {
            background: linear-gradient(45deg, #ff6b6b, #ff4757);
            color: #ffffff;
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 12px;
            font-weight: 600;
            min-width: 20px;
            text-align: center;
        }

        .message-list {
            max-height: 240px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: rgba(0, 228, 255, 0.3) rgba(0, 21, 41, 0.2);
        }

        .message-list::-webkit-scrollbar {
            width: 4px;
        }

        .message-list::-webkit-scrollbar-track {
            background: rgba(0, 21, 41, 0.2);
            border-radius: 2px;
        }

        .message-list::-webkit-scrollbar-thumb {
            background: rgba(0, 228, 255, 0.3);
            border-radius: 2px;
        }

        .message-list::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 228, 255, 0.5);
        }

        /* ‰∏ì‰∏öÊ∂àÊÅØÈÄöÁü•Ê†∑Âºè */
        .message-item {
            background: linear-gradient(135deg, rgba(0, 21, 41, 0.8), rgba(0, 21, 41, 0.6));
            border: 1px solid rgba(0, 228, 255, 0.15);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .message-item:hover {
            background: linear-gradient(135deg, rgba(0, 21, 41, 0.9), rgba(0, 21, 41, 0.7));
            border-color: rgba(0, 228, 255, 0.4);
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(0, 228, 255, 0.1);
        }

        .message-item.unread {
            border-left: 4px solid #00e4ff;
            background: linear-gradient(135deg, rgba(0, 228, 255, 0.1), rgba(0, 21, 41, 0.8));
        }

        .message-item.unread::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, #00e4ff, #0099cc);
            animation: pulse-glow 2s ease-in-out infinite alternate;
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .message-type-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 16px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .msg-warning .message-type-badge {
            background: linear-gradient(135deg, #ff6b6b, #ff4757);
            color: white;
            box-shadow: 0 2px 8px rgba(255, 107, 107, 0.3);
        }

        .msg-system .message-type-badge {
            background: linear-gradient(135deg, #00e4ff, #0099cc);
            color: white;
            box-shadow: 0 2px 8px rgba(0, 228, 255, 0.3);
        }

        .msg-info .message-type-badge {
            background: linear-gradient(135deg, #2ed573, #1dd1a1);
            color: white;
            box-shadow: 0 2px 8px rgba(46, 213, 115, 0.3);
        }

        .message-status {
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .message-status.unread {
            background: #ff4757;
            color: white;
            animation: pulse-status 2s ease-in-out infinite;
        }

        .message-status.read {
            background: rgba(46, 213, 115, 0.2);
            color: #2ed573;
            border: 1px solid #2ed573;
        }

        .message-content {
            color: #ffffff;
            font-size: 13px;
            line-height: 1.5;
            margin: 10px 0;
            font-weight: 400;
        }

        .message-details {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 10px 0;
        }

        .message-details span {
            background: rgba(0, 228, 255, 0.1);
            color: #00e4ff;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            border: 1px solid rgba(0, 228, 255, 0.2);
        }

        .message-time {
            display: flex;
            align-items: center;
            gap: 4px;
            color: #8892b0;
            font-size: 11px;
            margin-top: 8px;
        }

        .message-content {
            color: #ffffff;
            font-size: 14px;
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .message-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .message-type {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .message-type.alert {
            background: rgba(255, 71, 87, 0.2);
            color: #ff4757;
        }

        .message-type.system {
            background: rgba(0, 228, 255, 0.2);
            color: #00e4ff;
        }

        .message-time {
            color: rgba(255, 255, 255, 0.5);
            font-size: 11px;
        }

        /* ============= ÂëäË≠¶Èù¢Êùø ============= */
        .alert-panel {
            background: linear-gradient(145deg, rgba(13, 20, 33, 0.95), rgba(6, 18, 25, 0.95));
            border: 1px solid rgba(255, 71, 87, 0.2);
            border-radius: 12px;
            padding: 20px;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .alert-panel:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 71, 87, 0.2);
            border-color: rgba(255, 71, 87, 0.4);
        }

        .alert-summary {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .alert-count {
            font-family: "NumFont", monospace;
            font-size: 32px;
            font-weight: bold;
            color: #ff4757;
            text-shadow: 0 0 10px rgba(255, 71, 87, 0.8);
        }

        .alert-trend {
            color: rgba(255, 255, 255, 0.7);
            font-size: 12px;
        }

        .alert-list {
            max-height: 240px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: rgba(255, 107, 107, 0.3) rgba(0, 21, 41, 0.2);
        }

        .alert-list::-webkit-scrollbar {
            width: 4px;
        }

        .alert-list::-webkit-scrollbar-track {
            background: rgba(0, 21, 41, 0.2);
            border-radius: 2px;
        }

        .alert-list::-webkit-scrollbar-thumb {
            background: rgba(255, 107, 107, 0.3);
            border-radius: 2px;
        }

        .alert-list::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 107, 107, 0.5);
        }

        /* ‰∏ì‰∏öÂÅ•Â∫∑ÂëäË≠¶Ê†∑Âºè */
        .alert-item {
            background: linear-gradient(135deg, rgba(0, 21, 41, 0.8), rgba(0, 21, 41, 0.6));
            border: 1px solid rgba(255, 107, 107, 0.15);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .alert-item:hover {
            background: linear-gradient(135deg, rgba(0, 21, 41, 0.9), rgba(0, 21, 41, 0.7));
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(255, 107, 107, 0.1);
        }

        .alert-item.status-pending {
            border-left: 4px solid #ff4757;
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.1), rgba(0, 21, 41, 0.8));
        }

        .alert-item.status-pending::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, #ff4757, #ff6b6b);
            animation: pulse-glow 2s ease-in-out infinite alternate;
        }

        .alert-item.status-resolved {
            border-left: 4px solid #2ed573;
            opacity: 0.8;
        }

        .alert-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .alert-level-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 16px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .alert-status {
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .alert-status.status-pending {
            background: rgba(255, 107, 107, 0.2);
            color: #ff6b6b;
            border: 1px solid #ff6b6b;
            animation: pulse-status 2s ease-in-out infinite;
        }

        .alert-status.status-resolved {
            background: rgba(46, 213, 115, 0.2);
            color: #2ed573;
            border: 1px solid #2ed573;
        }

        .alert-type {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 8px;
            color: #00e4ff;
            font-size: 12px;
            font-weight: 600;
        }

        .alert-description {
            color: #ffffff;
            font-size: 13px;
            line-height: 1.5;
            margin: 10px 0;
            font-weight: 400;
        }

        .alert-details {
            margin: 10px 0;
        }

        .detail-row {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 4px;
        }

        .alert-details span {
            background: rgba(0, 228, 255, 0.1);
            color: #00e4ff;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            border: 1px solid rgba(0, 228, 255, 0.2);
        }

        .alert-time {
            display: flex;
            align-items: center;
            gap: 4px;
            color: #8892b0;
            font-size: 11px;
            margin-top: 8px;
            flex-wrap: wrap;
        }

        .responded-time {
            background: rgba(46, 213, 115, 0.1);
            color: #2ed573;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 9px;
            margin-left: 8px;
        }

        /* ============= ÂìçÂ∫îÂºèËÆæËÆ° ============= */
        @media (max-width: 1440px) {
            .main-grid {
                grid-template-columns: 320px 1fr 320px;
                gap: 15px;
                padding: 15px;
            }
        }

        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto 1fr;
            }
            
            .left-panel,
            .right-panel {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 15px;
            }
        }

        /* ============= Âä†ËΩΩÂä®Áîª ============= */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(0, 255, 157, 0.2);
            border-top-color: #00ff9d;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* ============= Â∑•ÂÖ∑ÊèêÁ§∫ ============= */
        .tooltip {
            position: absolute;
            background: rgba(13, 20, 33, 0.95);
            border: 1px solid rgba(0, 255, 157, 0.3);
            border-radius: 6px;
            padding: 8px 12px;
            color: #ffffff;
            font-size: 12px;
            z-index: 1000;
            pointer-events: none;
            backdrop-filter: blur(10px);
        }

        /* ============= Ê®°ÊÄÅÊ°ÜÊ†∑Âºè ============= */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
        }

        .modal-content {
            background: linear-gradient(145deg, rgba(13, 20, 33, 0.95), rgba(6, 18, 25, 0.95));
            border: 1px solid rgba(0, 255, 157, 0.3);
            border-radius: 12px;
            padding: 30px;
            max-width: 80vw;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            color: #ffffff !important;
        }
        
        /* ÂÅ•Â∫∑Êï∞ÊçÆÂºπÂá∫Ê°ÜÊ†∑Âºè‰øÆÂ§ç */
        .modal-content, 
        .modal-content *,
        .health-popup,
        .health-popup *,
        .alert-popup,
        .alert-popup *,
        div[style*="background: white"],
        div[style*="background-color: white"],
        div[style*="background:#fff"],
        div[style*="background-color:#fff"] {
            color: #1a1a1a !important;
            background: rgba(255, 255, 255, 0.95) !important;
        }
        
        /* ÁâπÊÆä‰øÆÂ§çÔºöÈíàÂØπÁôΩËâ≤ËÉåÊôØÁöÑÂºπÂá∫Ê°ÜÁ°Æ‰øùÊñáÂ≠ó‰∏∫Ê∑±Ëâ≤ */
        div[style*="background: white"] *,
        div[style*="background-color: white"] *,
        div[style*="background:#fff"] *,
        div[style*="background-color:#fff"] *,
        .white-bg-popup,
        .white-bg-popup * {
            color: #1a1a1a !important;
        }
        
        /* ÂÅ•Â∫∑ÊåáÊ†áÂõæÊ†áÂíåÊï∞ÂÄºÁöÑÈ¢úËâ≤‰øÆÂ§ç */
        .health-indicator-icon {
            color: #ff6b6b !important;
        }
        
        .health-indicator-value {
            color: #1a1a1a !important;
            font-weight: bold !important;
        }
        
        .health-indicator-unit {
            color: #666666 !important;
        }
        
        /* ÈÄöÁî®ÂºπÂá∫Ê°ÜÁæéÂåñÊ†∑Âºè */
        .popup-container, 
        .info-popup,
        .health-data-popup {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(248, 249, 250, 0.98)) !important;
            border-radius: 16px !important;
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.15),
                0 0 20px rgba(0, 255, 157, 0.1) !important;
            backdrop-filter: blur(20px) !important;
            border: 1px solid rgba(0, 255, 157, 0.2) !important;
            padding: 20px !important;
            color: #1a1a1a !important;
        }
        
        /* ÂÅ•Â∫∑ÊåáÊ†áË°åÊ†∑Âºè‰ºòÂåñ */
        .health-metric-row {
            display: flex !important;
            align-items: center !important;
            justify-content: space-between !important;
            padding: 8px 0 !important;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1) !important;
            margin-bottom: 8px !important;
        }
        
        .health-metric-row:last-child {
            border-bottom: none !important;
            margin-bottom: 0 !important;
        }
        
        /* ÂÅ•Â∫∑ÊåáÊ†áÂõæÊ†áÁæéÂåñ */
        .health-metric-icon {
            font-size: 20px !important;
            margin-right: 12px !important;
            width: 24px !important;
            text-align: center !important;
        }
        
        /* ÂÅ•Â∫∑ÊåáÊ†áÊï∞ÂÄºÊ†∑Âºè */
        .health-metric-value {
            font-weight: 600 !important;
            font-size: 16px !important;
            color: #1a1a1a !important;
        }
        
        .health-metric-unit {
            color: #666666 !important;
            font-size: 14px !important;
            margin-left: 4px !important;
        }
        
        /* ‰ΩçÁΩÆ‰ø°ÊÅØÁâπÊÆäÊ†∑Âºè */
        .location-info {
            background: rgba(34, 139, 34, 0.1) !important;
            border-radius: 8px !important;
            padding: 10px !important;
            margin-top: 10px !important;
            border-left: 3px solid #228B22 !important;
        }
        
        .location-info .health-metric-value {
            color: #228B22 !important;
            font-family: monospace !important;
            font-size: 14px !important;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: #ff4757;
            font-size: 20px;
            cursor: pointer;
        }

        /* ============= 3DÂÅ•Â∫∑ÂõæË°®Âä®ÁîªÊïàÊûú ============= */
        @keyframes heartbeat-fast {
            0%, 100% {
                transform: scale(1);
                filter: drop-shadow(0 0 5px #ff6b6b);
            }
            25% {
                transform: scale(1.05);
                filter: drop-shadow(0 0 15px #ff4757);
            }
            50% {
                transform: scale(1.02);
                filter: drop-shadow(0 0 10px #ff6b6b);
            }
            75% {
                transform: scale(1.03);
                filter: drop-shadow(0 0 12px #ff4757);
            }
        }

        @keyframes heartbeat-slow {
            0%, 100% {
                transform: scale(1);
                filter: drop-shadow(0 0 5px #ff6b6b);
            }
            50% {
                transform: scale(1.02);
                filter: drop-shadow(0 0 8px #ff4757);
            }
        }

        @keyframes heartbeat-moderate {
            0%, 100% {
                transform: scale(1);
                filter: drop-shadow(0 0 5px #ffaa00);
            }
            33% {
                transform: scale(1.03);
                filter: drop-shadow(0 0 12px #ffaa00);
            }
            66% {
                transform: scale(1.01);
                filter: drop-shadow(0 0 8px #ffaa00);
            }
        }

        @keyframes fever-warning {
            0%, 100% {
                transform: scale(1);
                filter: drop-shadow(0 0 5px #ff4757) hue-rotate(0deg);
            }
            25% {
                transform: scale(1.02);
                filter: drop-shadow(0 0 15px #ff4757) hue-rotate(10deg);
            }
            50% {
                transform: scale(1.01);
                filter: drop-shadow(0 0 20px #ff6600) hue-rotate(20deg);
            }
            75% {
                transform: scale(1.015);
                filter: drop-shadow(0 0 12px #ff4757) hue-rotate(10deg);
            }
        }

        @keyframes blood-oxygen-critical {
            0%, 100% {
                transform: scale(1);
                filter: drop-shadow(0 0 8px #ff4757);
            }
            50% {
                transform: scale(1.03);
                filter: drop-shadow(0 0 20px #ff0000);
            }
        }

        /* Â¢ûÂº∫3D‰ª™Ë°®ÁõòÊïàÊûú - ‰ΩøÁî®ÁúüÂÆûÁ´ã‰ΩìÊ∏≤Êüì */
        .advanced-gauge {
            position: relative;
            perspective: 1000px;
            transform-style: preserve-3d;
        }

        /* ‰∏ªË¶Å3DÂ§ñÁéØÊïàÊûú */
        .advanced-gauge::before {
            content: '';
            position: absolute;
            top: -8px;
            left: -8px;
            right: -8px;
            bottom: -8px;
            background: 
                radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.3), transparent 50%),
                radial-gradient(circle at 70% 70%, rgba(0, 255, 157, 0.2), transparent 50%),
                conic-gradient(from 45deg, 
                    rgba(0, 255, 157, 0.4), 
                    rgba(0, 228, 255, 0.3), 
                    rgba(255, 107, 107, 0.2), 
                    rgba(255, 170, 0, 0.3),
                    rgba(0, 255, 157, 0.4));
            border-radius: 50%;
            z-index: -1;
            transform: translateZ(-20px);
            filter: blur(2px);
            animation: gauge-glow-3d 4s ease-in-out infinite;
        }

        /* ÂÜÖÈÉ®È´òÂÖâÊïàÊûú */
        .advanced-gauge::after {
            content: '';
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            bottom: 10px;
            background: 
                radial-gradient(circle at 25% 25%, rgba(255, 255, 255, 0.6), transparent 30%),
                radial-gradient(circle at center, transparent 40%, rgba(0, 255, 157, 0.1) 70%);
            border-radius: 50%;
            z-index: 1;
            pointer-events: none;
            transform: translateZ(10px);
            animation: inner-glow 3s ease-in-out infinite alternate;
        }

        /* 3DÁ´ã‰ΩìÂèëÂÖâÂä®Áîª */
        @keyframes gauge-glow-3d {
            0% {
                opacity: 0.4;
                transform: translateZ(-20px) rotateX(0deg) rotateY(0deg);
                filter: blur(2px) brightness(1);
            }
            25% {
                opacity: 0.7;
                transform: translateZ(-15px) rotateX(5deg) rotateY(5deg);
                filter: blur(1px) brightness(1.2);
            }
            50% {
                opacity: 0.8;
                transform: translateZ(-10px) rotateX(0deg) rotateY(10deg);
                filter: blur(3px) brightness(1.1);
            }
            75% {
                opacity: 0.6;
                transform: translateZ(-15px) rotateX(-5deg) rotateY(5deg);
                filter: blur(2px) brightness(1.3);
            }
            100% {
                opacity: 0.5;
                transform: translateZ(-20px) rotateX(0deg) rotateY(0deg);
                filter: blur(2px) brightness(1);
            }
        }

        /* ÂÜÖÈÉ®È´òÂÖâÂä®Áîª */
        @keyframes inner-glow {
            0% {
                opacity: 0.3;
                transform: translateZ(10px) scale(0.95);
            }
            100% {
                opacity: 0.8;
                transform: translateZ(15px) scale(1.02);
            }
        }

        /* ‰∏∫‰∏çÂêåÂÅ•Â∫∑ÊåáÊ†áÂÆöÂà∂ÁöÑ3DÁéØÂ¢ÉÂÖâ */
        #heartRateCard .advanced-gauge::before {
            background: 
                radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.3), transparent 50%),
                conic-gradient(from 45deg, 
                    rgba(255, 107, 107, 0.5), 
                    rgba(255, 71, 87, 0.4), 
                    rgba(255, 56, 56, 0.3), 
                    rgba(255, 107, 107, 0.5));
            box-shadow: 
                inset 0 0 30px rgba(255, 107, 107, 0.3),
                0 0 50px rgba(255, 107, 107, 0.2),
                0 0 100px rgba(255, 107, 107, 0.1);
        }

        #bloodOxygenCard .advanced-gauge::before {
            background: 
                radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.3), transparent 50%),
                conic-gradient(from 45deg, 
                    rgba(0, 228, 255, 0.5), 
                    rgba(0, 191, 204, 0.4), 
                    rgba(0, 153, 204, 0.3), 
                    rgba(0, 228, 255, 0.5));
            box-shadow: 
                inset 0 0 30px rgba(0, 228, 255, 0.3),
                0 0 50px rgba(0, 228, 255, 0.2),
                0 0 100px rgba(0, 228, 255, 0.1);
        }

        #temperatureCard .advanced-gauge::before {
            background: 
                radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.3), transparent 50%),
                conic-gradient(from 45deg, 
                    rgba(255, 170, 0, 0.5), 
                    rgba(255, 153, 0, 0.4), 
                    rgba(255, 136, 0, 0.3), 
                    rgba(255, 170, 0, 0.5));
            box-shadow: 
                inset 0 0 30px rgba(255, 170, 0, 0.3),
                0 0 50px rgba(255, 170, 0, 0.2),
                0 0 100px rgba(255, 170, 0, 0.1);
        }

        /* 3D‰ª™Ë°®ÁõòÂÆπÂô®Á´ã‰ΩìÊïàÊûú */
        .gauge-container {
            transform-style: preserve-3d;
            transform: translateZ(0);
            filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.3));
        }

        /* EChartsÂõæË°®ÂÆπÂô®3DÂ¢ûÂº∫ */
        .gauge-container > div {
            border-radius: 50%;
            background: 
                radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.1), transparent 70%),
                radial-gradient(circle at center, rgba(13, 20, 33, 0.9), rgba(6, 18, 25, 0.95));
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.2),
                inset 0 -1px 0 rgba(0, 0, 0, 0.2),
                0 5px 15px rgba(0, 0, 0, 0.3);
        }

        /* ‰∏ì‰∏öÂåªÁñóÁ∫ßÂÅ•Â∫∑Áä∂ÊÄÅÊåáÁ§∫Âô® */
        .health-status.normal {
            background: linear-gradient(135deg, #00ff3c, #00cc30);
            animation: status-pulse-normal 2s ease-in-out infinite;
        }

        .health-status.warning {
            background: linear-gradient(135deg, #ffaa00, #ff9900);
            animation: status-pulse-warning 1.5s ease-in-out infinite;
        }

        .health-status.critical {
            background: linear-gradient(135deg, #ff4757, #ff0000);
            animation: status-pulse-critical 1s ease-in-out infinite;
        }

        @keyframes status-pulse-normal {
            0%, 100% { box-shadow: 0 0 5px rgba(0, 255, 60, 0.5); }
            50% { box-shadow: 0 0 15px rgba(0, 255, 60, 0.8); }
        }

        @keyframes status-pulse-warning {
            0%, 100% { box-shadow: 0 0 8px rgba(255, 170, 0, 0.6); }
            50% { box-shadow: 0 0 20px rgba(255, 170, 0, 0.9); }
        }

        @keyframes status-pulse-critical {
            0%, 100% { box-shadow: 0 0 10px rgba(255, 71, 87, 0.7); }
            50% { box-shadow: 0 0 25px rgba(255, 71, 87, 1); }
        }

        /* ÂÅ•Â∫∑Êï∞ÊçÆÂç°ÁâáÂ¢ûÂº∫ - ‰ΩøÁî®ËÆæËÆ°Á¥†ÊùêËÉåÊôØ */
        .health-card {
            position: relative;
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .health-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                url('/static/health-assets/effects/glow-01.png') no-repeat center,
                radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.05), transparent 50%);
            background-size: contain, 100% 100%;
            opacity: 0.3;
            z-index: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .health-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 
                0 15px 40px rgba(0, 255, 157, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .health-card:hover::before {
            opacity: 0.6;
        }

        /* ‰∏∫‰∏çÂêåÂÅ•Â∫∑Âç°ÁâáËÆæÁΩÆ‰∏ìÁî®ËÉåÊôØÊïàÊûú */
        #heartRateCard::before {
            background: 
                url('/static/health-assets/effects/glow-01.png') no-repeat center,
                radial-gradient(circle at 30% 30%, rgba(255, 107, 107, 0.1), transparent 60%);
            background-size: 80% 80%, 100% 100%;
        }

        #bloodOxygenCard::before {
            background: 
                url('/static/health-assets/effects/glow-02.png') no-repeat center,
                radial-gradient(circle at 70% 30%, rgba(0, 228, 255, 0.1), transparent 60%);
            background-size: 80% 80%, 100% 100%;
        }

        #temperatureCard::before {
            background: 
                url('/static/health-assets/effects/glow-03.png') no-repeat center,
                radial-gradient(circle at 50% 70%, rgba(255, 170, 0, 0.1), transparent 60%);
            background-size: 80% 80%, 100% 100%;
        }

        /* Á°Æ‰øùÂç°ÁâáÂÜÖÂÆπÂ±ÇÁ∫ßÊ≠£Á°Æ */
        .health-card > * {
            position: relative;
            z-index: 1;
        }

        .health-card.alert-high {
            animation: card-alert-high 2s ease-in-out infinite;
        }

        .health-card.alert-critical {
            animation: card-alert-critical 1s ease-in-out infinite;
        }

        @keyframes card-alert-high {
            0%, 100% {
                border-color: rgba(255, 170, 0, 0.5);
                box-shadow: 0 8px 25px rgba(255, 170, 0, 0.2);
            }
            50% {
                border-color: rgba(255, 170, 0, 0.8);
                box-shadow: 0 12px 35px rgba(255, 170, 0, 0.4);
            }
        }

        @keyframes card-alert-critical {
            0%, 100% {
                border-color: rgba(255, 71, 87, 0.6);
                box-shadow: 0 10px 30px rgba(255, 71, 87, 0.3);
            }
            50% {
                border-color: rgba(255, 71, 87, 1);
                box-shadow: 0 15px 40px rgba(255, 71, 87, 0.6);
            }
        }

        /* ============= ÂÅ•Â∫∑Á¥†ÊùêÂ¢ûÂº∫Âä®ÁîªÊïàÊûú ============= */
        
        /* Â¢ûÂº∫Á≤íÂ≠êÂä®Áîª - ÈÄÇÈÖçÂÅ•Â∫∑Á¥†Êùê */
        @keyframes particles-enhanced {
            0% {
                transform: translate(0, 0) scale(1) rotate(0deg);
                opacity: 0.5;
            }
            25% {
                transform: translate(10px, -5px) scale(1.05) rotate(90deg);
                opacity: 0.7;
            }
            50% {
                transform: translate(20px, -10px) scale(1) rotate(180deg);
                opacity: 0.4;
            }
            75% {
                transform: translate(15px, -3px) scale(0.95) rotate(270deg);
                opacity: 0.6;
            }
            100% {
                transform: translate(0, 0) scale(1) rotate(360deg);
                opacity: 0.5;
            }
        }

        /* ÂèëÂÖâËàûÂä®ÊïàÊûú */
        @keyframes glow-dance {
            0% {
                transform: translate(0, 0) scale(1);
                opacity: 0.2;
            }
            33% {
                transform: translate(-10px, 5px) scale(1.1);
                opacity: 0.4;
            }
            66% {
                transform: translate(5px, -8px) scale(0.9);
                opacity: 0.3;
            }
            100% {
                transform: translate(0, 0) scale(1);
                opacity: 0.2;
            }
        }

        /* ÂÅ•Â∫∑Âç°ÁâáÂëºÂê∏ÊïàÊûú */
        @keyframes health-card-breathe {
            0%, 100% {
                transform: scale(1) translateZ(0);
                filter: brightness(1);
            }
            50% {
                transform: scale(1.02) translateZ(5px);
                filter: brightness(1.05);
            }
        }

        /* Ê∂àÊÅØÈÄöÁü•ÂíåÂëäË≠¶‰∏ìÁî®Âä®Áîª */
        @keyframes pulse-glow {
            0% { 
                opacity: 0.6;
                transform: scaleX(1);
            }
            100% { 
                opacity: 1;
                transform: scaleX(1.05);
            }
        }

        @keyframes pulse-status {
            0%, 100% { 
                opacity: 1;
                transform: scale(1);
            }
            50% { 
                opacity: 0.7;
                transform: scale(1.05);
            }
        }

        /* Â∫îÁî®ÂëºÂê∏ÊïàÊûúÂà∞ÂÅ•Â∫∑Âç°Áâá */
        .health-card {
            animation: health-card-breathe 4s ease-in-out infinite;
        }

        .health-card:hover {
            animation: none; /* ÊÇ¨ÂÅúÊó∂ÂÅúÊ≠¢ÂëºÂê∏Âä®Áîª */
        }
    </style>
</head>

<body>
    <div class="app-container">
        <div class="main-grid">
            <!-- È°∂ÈÉ®ÂØºËà™Ê†è -->
            <header class="top-header">
                <div class="header-left">
                    <div class="logo">L</div>
                    <div>
                        <div class="header-title">Êô∫ËÉΩÂÅ•Â∫∑ÁõëÊéß</div>
                        <div class="header-subtitle">‰∏™‰∫∫ÂÅ•Â∫∑Â§ßÂ±è v1.3.5</div>
                    </div>
                </div>
                
                <!-- Áî®Êà∑‰ø°ÊÅØÂå∫Âüü -->
                <div class="header-user-info">
                    <div class="user-avatar">
                        <img id="headerEmployeePhoto" src="/static/health-assets/default-avatar.png" alt="Áî®Êà∑Â§¥ÂÉè" onerror="this.src='/static/images/avatar.jpeg'">
                        <div class="user-status-dot"></div>
                    </div>
                    <div class="user-details">
                        <div class="user-name" id="headerEmployeeName">ÊùéÂª∫Âçé</div>
                        <div class="user-meta">
                            <span class="user-role" id="headerEmployeeRole">ÊôÆÈÄöÂëòÂ∑•</span>
                            <span class="user-separator">‚Ä¢</span>
                            <span class="user-device" id="headerEmployeeDevice">{{ device_sn or "" }}</span>
                        </div>
                    </div>
                    <div class="user-status">
                        <div class="status-badge online">Âú®Á∫ø</div>
                        <div class="device-info">
                            <span class="device-label">ËÆæÂ§áÔºö</span>
                            <span class="device-sn">{{ device_sn or "" }}</span>
                        </div>
                    </div>
                </div>
                
                <div class="header-right">
                    <!-- ‰∏™ÊÄßÂåñÊéßÂà∂Âå∫Âüü -->
                    <div class="personalization-controls">
                        <!-- ‰∏ªÈ¢òÂàáÊç¢Âô® -->
                        <div class="theme-selector">
                            <label class="control-label">üé®</label>
                            <select id="themeSelect" class="control-select" onchange="switchTheme(this.value)">
                                <option value="default">ÈªòËÆ§‰∏ªÈ¢ò</option>
                                <option value="deep-blue">Ê∑±Ëìù‰∏ªÈ¢ò</option>
                                <option value="purple">Á¥´ÁΩóÂÖ∞‰∏ªÈ¢ò</option>
                                <option value="eco-green">ÁîüÊÄÅÁªø</option>
                                <option value="warm-orange">ÊöñÈò≥Ê©ô</option>
                            </select>
                        </div>
                        
                        <!-- Â∏ÉÂ±ÄÈÄâÊã©Âô® -->
                        <div class="layout-selector">
                            <label class="control-label">üìä</label>
                            <select id="layoutSelect" class="control-select" onchange="switchLayout(this.value)">
                                <option value="standard">Ê†áÂáÜÂ∏ÉÂ±Ä</option>
                                <option value="compact">Á¥ßÂáëÂ∏ÉÂ±Ä</option>
                                <option value="expanded">Â±ïÂºÄÂ∏ÉÂ±Ä</option>
                            </select>
                        </div>

                        <!-- ËÆæÁΩÆÊåâÈíÆ -->
                        <button class="settings-btn" onclick="toggleSettings()" title="‰∏™ÊÄßÂåñËÆæÁΩÆ">‚öôÔ∏è</button>
                    </div>
                    
                    <div class="device-status" onclick="navigateToDeviceView()" style="cursor: pointer;" title="ÁÇπÂáªÊü•ÁúãËÆæÂ§áËØ¶ÊÉÖ">
                        <div class="status-indicator"></div>
                        <span id="deviceStatusText">ËÆæÂ§áÂú®Á∫ø</span>
                        <span style="margin-left: 8px; color: rgba(0,228,255,0.6); font-size: 10px;">‚ñ∂</span>
                    </div>
                    <button class="close-btn" onclick="window.close()">‚úï</button>
                </div>
            </header>

            <!-- Â∑¶‰æßÂÅ•Â∫∑ÊåáÊ†áÈù¢Êùø -->
            <aside class="left-panel">
                <!-- ÂøÉÁéáÂç°Áâá -->
                <div class="health-card" id="heartRateCard" onclick="showHealthDetails('heartRate')">
                    <div class="card-header">
                        <div class="card-title">
                            <span class="card-icon">üíì</span>
                            <span>ÂÆûÊó∂ÂøÉÁéá</span>
                        </div>
                        <div class="health-status" id="heartRateStatus"></div>
                    </div>
                    <div class="advanced-gauge">
                        <div class="gauge-container">
                            <div id="heartRateGauge" style="width: 100%; height: 100%;"></div>
                            <div class="gauge-value-display">
                                <div class="gauge-value" id="heartRateValue">--</div>
                                <div class="gauge-unit">BPM</div>
                            </div>
                        </div>
                    </div>
                    <div class="health-details">
                        <div class="detail-item">
                            <span class="detail-label">ÊúÄÈ´ò</span>
                            <span class="detail-value" id="heartRateMax">--</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">ÊúÄ‰Ωé</span>
                            <span class="detail-value" id="heartRateMin">--</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Âπ≥Âùá</span>
                            <span class="detail-value" id="heartRateAvg">--</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Áä∂ÊÄÅ</span>
                            <span class="detail-value" id="heartRateLevel">Ê≠£Â∏∏</span>
                        </div>
                    </div>
                </div>

                <!-- Ë°ÄÊ∞ßÂç°Áâá -->
                <div class="health-card" id="bloodOxygenCard" onclick="showHealthDetails('bloodOxygen')">
                    <div class="card-header">
                        <div class="card-title">
                            <span class="card-icon">ü©∏</span>
                            <span>Ë°ÄÊ∞ßÈ•±ÂíåÂ∫¶</span>
                        </div>
                        <div class="health-status" id="bloodOxygenStatus"></div>
                    </div>
                    <div class="advanced-gauge">
                        <div class="gauge-container">
                            <div id="bloodOxygenGauge" style="width: 100%; height: 100%;"></div>
                            <div class="gauge-value-display">
                                <div class="gauge-value" id="bloodOxygenValue">--</div>
                                <div class="gauge-unit">%</div>
                            </div>
                        </div>
                    </div>
                    <div class="health-details">
                        <div class="detail-item">
                            <span class="detail-label">ÊúÄÈ´ò</span>
                            <span class="detail-value" id="bloodOxygenMax">--</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">ÊúÄ‰Ωé</span>
                            <span class="detail-value" id="bloodOxygenMin">--</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Âπ≥Âùá</span>
                            <span class="detail-value" id="bloodOxygenAvg">--</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Áä∂ÊÄÅ</span>
                            <span class="detail-value" id="bloodOxygenLevel">Ê≠£Â∏∏</span>
                        </div>
                    </div>
                </div>

                <!-- ‰ΩìÊ∏©Âç°Áâá -->
                <div class="health-card" id="temperatureCard" onclick="showHealthDetails('temperature')">
                    <div class="card-header">
                        <div class="card-title">
                            <span class="card-icon">üå°Ô∏è</span>
                            <span>‰ΩìÊ∏©</span>
                        </div>
                        <div class="health-status" id="temperatureStatus"></div>
                    </div>
                    <div class="advanced-gauge">
                        <div class="gauge-container">
                            <div id="temperatureGauge" style="width: 100%; height: 100%;"></div>
                            <div class="gauge-value-display">
                                <div class="gauge-value" id="temperatureValue">--</div>
                                <div class="gauge-unit">¬∞C</div>
                            </div>
                        </div>
                    </div>
                    <div class="health-details">
                        <div class="detail-item">
                            <span class="detail-label">Êî∂Áº©Âéã</span>
                            <span class="detail-value" id="systolicValue">--</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">ËàíÂº†Âéã</span>
                            <span class="detail-value" id="diastolicValue">--</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Ê≠•Êï∞</span>
                            <span class="detail-value" id="stepCount">--</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Ê¥ªÂä®</span>
                            <span class="detail-value" id="activityLevel">ËΩªÂ∫¶</span>
                        </div>
                    </div>
                </div>
            </aside>
            <main class="center-panel">
                <!-- ÂÅ•Â∫∑ÁªºÂêàËØÑÂàÜ -->
                <div class="health-score-section">
                    <!-- ÂÅ•Â∫∑È¢ÑÊµã -->
                    <div class="health-prediction">
                        <div class="prediction-header">
                            <div class="prediction-icon">üîÆ</div>
                            <div class="prediction-title">ÂÅ•Â∫∑È¢ÑÊµã</div>
                        </div>
                        <div class="prediction-item">
                            <div class="prediction-label">Áñ≤Âä≥È£éÈô©</div>
                            <div class="prediction-content">
                                Âü∫‰∫éËøûÁª≠6Â∞èÊó∂‰Ωú‰∏öÁõëÊµãÔºåÂª∫ËÆÆÂú®1Â∞èÊó∂ÂÜÖÂÆâÊéí‰ºëÊÅØ
                                <span class="prediction-risk">‚ö†Ô∏è ËΩªÂ∫¶Áñ≤Âä≥</span>
                            </div>
                        </div>
                        <div class="prediction-item">
                            <div class="prediction-label">‰Ωú‰∏öÂÆâÂÖ®ÊåáÊï∞</div>
                            <div class="prediction-content">
                                ÂΩìÂâçÁîüÁêÜÊåáÊ†áÈÄÇÂÆúÁªßÁª≠Á≤æÂØÜÊìç‰Ωú‰ªªÂä°
                                <span class="prediction-risk">‚úÖ ‰ºòÁßÄ</span>
                            </div>
                        </div>
                        <div class="prediction-item">
                            <div class="prediction-label">ÁéØÂ¢ÉÈÄÇÂ∫îÊÄß</div>
                            <div class="prediction-content">
                                ËΩ¶Èó¥ÁéØÂ¢ÉÊ∏©Â∫¶ÈÄÇÂÆúÔºåÂª∫ËÆÆ‰øùÊåÅÂΩìÂâç‰Ωú‰∏öÂº∫Â∫¶
                                <span class="prediction-risk">üìà ÁêÜÊÉ≥</span>
                            </div>
                        </div>
                    </div>

                    <!-- ÂÅ•Â∫∑ÁªºÂêàËØÑÂàÜ‰∏≠ÂøÉ -->
                    <div class="health-score-center">
                        <div class="score-circle" id="healthScoreCircle">
                            <div class="score-number" id="healthScore">95</div>
                        </div>
                        <h3 style="color: #ffffff; margin: 0;">ÂÅ•Â∫∑ÁªºÂêàËØÑÂàÜ</h3>
                        <p style="color: rgba(255,255,255,0.7); font-size: 12px; margin: 5px 0 0 0;">Âü∫‰∫éÂÆûÊó∂‰ΩìÂæÅÊï∞ÊçÆÊô∫ËÉΩËØÑ‰º∞</p>
                    </div>

                    <!-- ÂÅ•Â∫∑Âª∫ËÆÆ -->
                    <div class="health-recommendations">
                        <div class="recommendations-header">
                            <div class="recommendations-icon">üí°</div>
                            <div class="recommendations-title">ÂÅ•Â∫∑Âª∫ËÆÆ</div>
                        </div>
                        <div class="recommendation-item">
                            <div class="recommendation-icon">üíß</div>
                            <div class="recommendation-text">
                                ÈÄÇÂΩìË°•ÂÖÖÊ∞¥ÂàÜÔºåÂª∫ËÆÆÊØèÂ∞èÊó∂È•ÆÊ∞¥200ml
                                <div class="recommendation-priority">È´ò‰ºòÂÖàÁ∫ß</div>
                            </div>
                        </div>
                        <div class="recommendation-item">
                            <div class="recommendation-icon">üèÉ</div>
                            <div class="recommendation-text">
                                ÂøÉÁéáËæÉ‰∏∫Âπ≥Á®≥ÔºåÂèØËøõË°å‰∏≠Á≠âÂº∫Â∫¶ËøêÂä®
                                <div class="recommendation-priority">Âª∫ËÆÆ</div>
                            </div>
                        </div>
                        <div class="recommendation-item">
                            <div class="recommendation-icon">üò¥</div>
                            <div class="recommendation-text">
                                ‰øùËØÅ7-8Â∞èÊó∂‰ºòË¥®Áù°Áú†Êó∂Èó¥
                                <div class="recommendation-priority">Êó•Â∏∏</div>
                            </div>
                        </div>
                        <div class="recommendation-item">
                            <div class="recommendation-icon">ü•ó</div>
                            <div class="recommendation-text">
                                Âª∫ËÆÆÊëÑÂÖ•ÂØåÂê´Áª¥ÁîüÁ¥†ÁöÑËî¨ÊûúÁ±ªÈ£üÁâ©
                                <div class="recommendation-priority">Ëê•ÂÖª</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ÂÆûÊó∂ÁîüÂëΩ‰ΩìÂæÅÊ≥¢ÂΩ¢ -->
                <div class="vital-wave-section">
                    <div class="wave-header">
                        <h4 style="color: #ffffff; margin: 0;">üìà ÂÆûÊó∂ÁîüÂëΩ‰ΩìÂæÅ</h4>
                        <div class="wave-controls">
                            <button class="wave-btn active" onclick="switchWaveType('heart')">ÂøÉÁéáÊ≥¢ÂΩ¢</button>
                            <button class="wave-btn" onclick="switchWaveType('oxygen')">Ë°ÄÊ∞ßÂèòÂåñ</button>
                            <button class="wave-btn" onclick="switchWaveType('temp')">‰ΩìÊ∏©Êõ≤Á∫ø</button>
                        </div>
                    </div>
                    <div id="vitalWaveChart" style="height: 200px; width: 100%;"></div>
                </div>

                <!-- ÂéüÊúâ‰∏ªË∂ãÂäøÂõæ -->
                <div class="main-chart-container">
                    <div class="chart-header">
                        <div class="chart-title">
                            <span>üìä</span>
                            <span>ÂÅ•Â∫∑Êï∞ÊçÆË∂ãÂäø</span>
                        </div>
                        <div class="chart-controls">
                            <button class="control-btn active" onclick="switchTimeRange('1h')">1Â∞èÊó∂</button>
                            <button class="control-btn" onclick="switchTimeRange('6h')">6Â∞èÊó∂</button>
                            <button class="control-btn" onclick="switchTimeRange('24h')">24Â∞èÊó∂</button>
                            <button class="control-btn" onclick="switchTimeRange('7d')">7Â§©</button>
                        </div>
                    </div>
                    <div id="mainChart" class="main-chart"></div>
                </div>

                <!-- ÂÅ•Â∫∑ÂØπÊØîË∂ãÂäø -->
                <div class="trend-comparison">
                    <div class="trend-item">
                        <span class="trend-label">ËæÉÊò®Êó•</span>
                        <span class="trend-value positive" id="yesterdayTrend">+2%</span>
                    </div>
                    <div class="trend-item">
                        <span class="trend-label">ËæÉÊú¨Âë®</span>
                        <span class="trend-value negative" id="weekTrend">-1%</span>
                    </div>
                    <div class="trend-item">
                        <span class="trend-label">ËæÉÊú¨Êúà</span>
                        <span class="trend-value neutral" id="monthTrend">+0%</span>
                    </div>
                </div>
            </main>

            <!-- Âè≥‰æßÊ∂àÊÅØÂíåÂëäË≠¶Èù¢Êùø -->
            <aside class="right-panel">

                <!-- Ê∂àÊÅØÈÄöÁü•Èù¢Êùø -->
                <div class="message-panel" onclick="navigateToMessageView()" style="cursor: pointer;">
                    <div class="panel-header">
                        <div class="panel-title">
                            <span>üí¨</span>
                            <span>Ê∂àÊÅØÈÄöÁü•</span>
                            <span style="float: right; color: rgba(0,228,255,0.6); font-size: 10px; margin-left: 10px;">ÁÇπÂáªÊü•Áúã ‚ñ∂</span>
                        </div>
                        <div class="message-count" id="messageCount">0</div>
                    </div>
                    <div class="message-list" id="messageList">
                        <!-- Ê∂àÊÅØÂÜÖÂÆπÂ∞ÜÈÄöËøáJavaScriptÂä®ÊÄÅÂä†ËΩΩ -->
                        <div class="message-item">
                            <div class="message-content">Á≥ªÁªüÊ≠£Âú®Âä†ËΩΩÊ∂àÊÅØ...</div>
                            <div class="message-meta">
                                <div class="message-type system">Á≥ªÁªü</div>
                                <div class="message-time">--:--</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ÂëäË≠¶Èù¢Êùø -->
                <div class="alert-panel" onclick="navigateToAlertView()" style="cursor: pointer;">
                    <div class="panel-header">
                        <div class="panel-title">
                            <span>üö®</span>
                            <span>ÂÅ•Â∫∑ÂëäË≠¶</span>
                        </div>
                        <div class="alert-trend">ÁÇπÂáªÊü•ÁúãËØ¶ÊÉÖ ‚ñ∂</div>
                    </div>
                    <div class="alert-summary">
                        <div class="alert-count" id="alertCount">0</div>
                        <div class="alert-trend" id="alertTrend">‰ªäÊó•Êñ∞Â¢û 0 Êù°</div>
                    </div>
                    <div class="alert-list" id="alertList">
                        <!-- ÂëäË≠¶ÂÜÖÂÆπÂ∞ÜÈÄöËøáJavaScriptÂä®ÊÄÅÂä†ËΩΩ -->
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <script>
        // ============= ÂÖ®Â±ÄÂèòÈáè =============
        let deviceSn = '';
        // WebSocket removed for performance optimization
        let currentTimeRange = '1h';
        let healthData = {};
        let chartInstances = {};
        let currentWaveType = 'heart';
        let employeeData = {
            name: 'ÊùéÂª∫Âçé',
            id: 'EMP20241108', 
            department: 'Êô∫ËÉΩÂà∂ÈÄ†ËΩ¶Èó¥',
            avatar: '/static/health-assets/default-avatar.png',
            confirmed: true
        };

        // ============= ÂàùÂßãÂåñÂáΩÊï∞ =============
        document.addEventListener('DOMContentLoaded', function() {
            // Á≠âÂæÖEChartsÂ∫ìÂä†ËΩΩÂÆåÊàê
            waitForECharts(() => {
                initializeApp();
            });
        });

        function waitForECharts(callback) {
            if (typeof echarts !== 'undefined') {
                callback();
            } else {
                console.log('‚è≥ Á≠âÂæÖEChartsÂ∫ìÂä†ËΩΩ...');
                setTimeout(() => waitForECharts(callback), 100);
            }
        }

        function initializeApp() {
            // ‰ªéURLËé∑ÂèñËÆæÂ§áÂ∫èÂàóÂè∑
            const urlParams = new URLSearchParams(window.location.search);
            deviceSn = urlParams.get('deviceSn') || '';
            
            console.log('üöÄ ÂàùÂßãÂåñ‰∏™‰∫∫ÂÅ•Â∫∑Â§ßÂ±è v1.3.5');
            console.log('üì± ËÆæÂ§áÂ∫èÂàóÂè∑:', deviceSn);
            
            // ÂàùÂßãÂåñËÆæÂ§áÁä∂ÊÄÅÊòæÁ§∫
            initializeDeviceStatusDisplay();
            
            // ÂàùÂßãÂåñÂõæË°®
            try {
                initializeCharts();
                console.log('‚úÖ EChartsÂõæË°®ÂàùÂßãÂåñÊàêÂäü');
            } catch (error) {
                console.error('‚ùå EChartsÂõæË°®ÂàùÂßãÂåñÂ§±Ë¥•:', error);
                // Êèê‰æõÈôçÁ∫ßÊñπÊ°à
                initializeFallbackCharts();
            }
            
            // ÂàùÂßãÂåñÂëòÂ∑•‰ø°ÊÅØ
            initializeEmployeeInfo();
            
            // Âä†ËΩΩ‰∏™ÊÄßÂåñËÆæÁΩÆ
            loadPersonalizationSettings();
            
            // Âä†ËΩΩÂÅ•Â∫∑Êï∞ÊçÆ
            loadHealthData();
            
            // Âä†ËΩΩÊ∂àÊÅØÂíåÂëäË≠¶
            loadMessages();
            loadAlerts();
            
            // Âä†ËΩΩËÆæÂ§áÁä∂ÊÄÅ
            loadDeviceStatus();
            
            // Âä†ËΩΩÂéÜÂè≤Ë∂ãÂäøÊï∞ÊçÆ
            loadHistoryChart();
            
            // WebSocket removed for performance optimization
            
            // ÂàùÂßãÂåñÂìçÂ∫îÂºèÂ∏ÉÂ±Ä
            initializeResponsive();
            
            // ÂàùÂßãÂåñÊ≥¢ÂΩ¢ÂõæË°®
            initializeWaveChart();
            
            // ËÆæÁΩÆÂÆöÊó∂Âà∑Êñ∞
            setInterval(loadHealthData, 10000);     // 10ÁßíÂà∑Êñ∞ÂÅ•Â∫∑Êï∞ÊçÆ
            setInterval(loadMessages, 30000);       // 30ÁßíÂà∑Êñ∞Ê∂àÊÅØ
            setInterval(loadAlerts, 30000);         // 30ÁßíÂà∑Êñ∞ÂëäË≠¶
            setInterval(loadDeviceStatus, 60000);   // 60ÁßíÂà∑Êñ∞ËÆæÂ§áÁä∂ÊÄÅ
            setInterval(loadHistoryChart, 300000);  // 5ÂàÜÈíüÂà∑Êñ∞ÂéÜÂè≤Êï∞ÊçÆ
        }

        // ============= ÂëòÂ∑•‰ø°ÊÅØÁÆ°ÁêÜ =============
        function initializeEmployeeInfo() {
            // Ê£ÄÊü•ÂëòÂ∑•‰ø°ÊÅØÂÖÉÁ¥†ÊòØÂê¶Â≠òÂú®ÔºàÂõ†‰∏∫ÂèØËÉΩÂ∑≤Ë¢´ÁßªÈô§Ôºâ
            const employeeNameEl = document.getElementById('employeeName');
            const employeeIdEl = document.getElementById('employeeId');
            const employeeDeptEl = document.getElementById('employeeDept');
            const photoElement = document.getElementById('employeePhoto');
            
            // Êõ¥Êñ∞Â§¥ÈÉ®Áî®Êà∑‰ø°ÊÅØ
            const headerEmployeeNameEl = document.getElementById('headerEmployeeName');
            const headerEmployeeIdEl = document.getElementById('headerEmployeeId');
            const headerEmployeeDeptEl = document.getElementById('headerEmployeeDept');
            const headerPhotoElement = document.getElementById('headerEmployeePhoto');
            
            if (employeeNameEl) employeeNameEl.textContent = employeeData.name;
            if (employeeIdEl) employeeIdEl.textContent = `Â∑•Âè∑: ${employeeData.id}`;
            if (employeeDeptEl) employeeDeptEl.textContent = `ÈÉ®Èó®: ${employeeData.department}`;
            if (photoElement) photoElement.src = employeeData.avatar;
            
            // Êõ¥Êñ∞Â§¥ÈÉ®ÊòæÁ§∫
            if (headerEmployeeNameEl) headerEmployeeNameEl.textContent = employeeData.name;
            // Note: These elements have been renamed to headerEmployeeRole and headerEmployeeDevice
            if (headerPhotoElement) headerPhotoElement.src = employeeData.avatar;
            
            console.log('üë§ ÂëòÂ∑•‰ø°ÊÅØÂàùÂßãÂåñÂÆåÊàê:', employeeData);
        }

        function confirmEmployee() {
            if (!employeeData.confirmed) {
                employeeData.confirmed = true;
                const confirmBtn = document.querySelector('.confirm-btn');
                confirmBtn.textContent = '‚úì Â∑≤Á°ÆËÆ§';
                confirmBtn.style.background = 'linear-gradient(45deg, #00ff3c, #00e635)';
                
                // Ê∑ªÂä†Á°ÆËÆ§Âä®Êïà
                confirmBtn.style.transform = 'scale(1.1)';
                setTimeout(() => {
                    confirmBtn.style.transform = 'scale(1)';
                }, 200);
                
                console.log('‚úÖ ÂëòÂ∑•Ë∫´‰ªΩÂ∑≤Á°ÆËÆ§:', employeeData.name);
                showToast(`ÂëòÂ∑• ${employeeData.name} Ë∫´‰ªΩÁ°ÆËÆ§ÊàêÂäü`, 'success');
            }
        }

        // ============= Ê≥¢ÂΩ¢ÂõæË°®ÂäüËÉΩ =============
        function initializeWaveChart() {
            if (typeof echarts === 'undefined') {
                console.warn('‚ö†Ô∏è EChartsÊú™Âä†ËΩΩÔºåË∑≥ËøáÊ≥¢ÂΩ¢ÂõæÂàùÂßãÂåñ');
                return;
            }
            
            const waveChartElement = document.getElementById('vitalWaveChart');
            if (!waveChartElement) {
                console.warn('‚ö†Ô∏è Ê≥¢ÂΩ¢ÂõæÂÆπÂô®‰∏çÂ≠òÂú®');
                return;
            }
            
            try {
                // ÂàùÂßãÂåñÂÆûÊó∂Ê≥¢ÂΩ¢Âõæ
                chartInstances.vitalWaveChart = echarts.init(waveChartElement);
                const option = {
                backgroundColor: 'transparent',
                grid: {
                    left: '5%', right: '5%', top: '10%', bottom: '15%'
                },
                xAxis: {
                    type: 'category',
                    data: [],
                    axisLine: { 
                        lineStyle: { color: 'rgba(255,107,107,0.4)' }
                    },
                    axisLabel: { 
                        color: 'rgba(255,255,255,0.8)',
                        fontSize: 10
                    }
                },
                yAxis: {
                    type: 'value',
                    axisLine: { 
                        lineStyle: { color: 'rgba(255,107,107,0.4)' }
                    },
                    axisLabel: { 
                        color: 'rgba(255,255,255,0.8)',
                        fontSize: 10
                    },
                    splitLine: {
                        lineStyle: { 
                            color: 'rgba(255,255,255,0.1)',
                            type: 'dashed'
                        }
                    }
                },
                series: [{
                    type: 'line',
                    data: [],
                    smooth: true,
                    lineStyle: {
                        color: '#ff6b6b',
                        width: 3,
                        shadowColor: '#ff6b6b',
                        shadowBlur: 10
                    },
                    itemStyle: {
                        color: '#ff6b6b'
                    },
                    areaStyle: {
                        color: {
                            type: 'linear',
                            x: 0, y: 0, x2: 0, y2: 1,
                            colorStops: [
                                { offset: 0, color: 'rgba(255,107,107,0.3)' },
                                { offset: 1, color: 'rgba(255,107,107,0.05)' }
                            ]
                        }
                    }
                }]
            };
            
            chartInstances.vitalWaveChart.setOption(option);
            
            // ÁîüÊàêÊ®°ÊãüÂÆûÊó∂Êï∞ÊçÆ
            generateWaveData('heart');
            
            } catch (error) {
                console.error('‚ùå Ê≥¢ÂΩ¢ÂõæÂàùÂßãÂåñÂ§±Ë¥•:', error);
                // ÊòæÁ§∫ÈîôËØØÊèêÁ§∫
                waveChartElement.innerHTML = `
                    <div style="
                        display: flex; 
                        align-items: center; 
                        justify-content: center; 
                        height: 200px; 
                        color: #ff6b6b; 
                        font-size: 14px;
                    ">
                        Ê≥¢ÂΩ¢ÂõæÊöÇÊó∂Êó†Ê≥ïÊòæÁ§∫
                    </div>
                `;
            }
        }

        function switchWaveType(waveType) {
            currentWaveType = waveType;
            
            // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
            document.querySelectorAll('.wave-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            generateWaveData(waveType);
            console.log('üìà ÂàáÊç¢Ê≥¢ÂΩ¢ÂõæÁ±ªÂûã:', waveType);
        }

        function generateWaveData(type) {
            const now = new Date();
            const data = [];
            const timeLabels = [];
            
            for (let i = 29; i >= 0; i--) {
                const time = new Date(now - i * 2000); // ÊØè2Áßí‰∏Ä‰∏™Êï∞ÊçÆÁÇπ
                timeLabels.push(time.toLocaleTimeString().slice(-8));
                
                let value;
                if (type === 'heart') {
                    // ÂøÉÁéáÊ≥¢ÂΩ¢ (60-100 BPM)
                    value = 75 + Math.sin(i * 0.3) * 15 + Math.random() * 10 - 5;
                } else if (type === 'oxygen') {
                    // Ë°ÄÊ∞ßÊ≥¢ÂΩ¢ (95-100%)
                    value = 97 + Math.sin(i * 0.2) * 2 + Math.random() * 2 - 1;
                } else if (type === 'temp') {
                    // ‰ΩìÊ∏©Ê≥¢ÂΩ¢ (36-38¬∞C)
                    value = 36.5 + Math.sin(i * 0.1) * 0.8 + Math.random() * 0.4 - 0.2;
                }
                data.push(Math.round(value * 100) / 100);
            }
            
            // Êõ¥Êñ∞ÂõæË°®È¢úËâ≤ÂíåÊ†áÈ¢ò
            let color, title;
            if (type === 'heart') {
                color = '#ff6b6b';
                title = 'ÂøÉÁéáÊ≥¢ÂΩ¢ (BPM)';
            } else if (type === 'oxygen') {
                color = '#00e4ff';
                title = 'Ë°ÄÊ∞ßÈ•±ÂíåÂ∫¶ (%)';
            } else if (type === 'temp') {
                color = '#ffaa00';
                title = '‰ΩìÊ∏©ÂèòÂåñ (¬∞C)';
            }
            
            chartInstances.vitalWaveChart.setOption({
                title: {
                    text: title,
                    textStyle: { 
                        color: color, 
                        fontSize: 14 
                    },
                    left: 'center'
                },
                xAxis: { data: timeLabels },
                series: [{
                    data: data,
                    lineStyle: { color: color, shadowColor: color },
                    itemStyle: { color: color },
                    areaStyle: {
                        color: {
                            type: 'linear',
                            x: 0, y: 0, x2: 0, y2: 1,
                            colorStops: [
                                { offset: 0, color: color + '40' },
                                { offset: 1, color: color + '08' }
                            ]
                        }
                    }
                }]
            });
        }

        // ============= ÂÅ•Â∫∑ËØ¶ÊÉÖ‰∫åÁ∫ßÁïåÈù¢ =============
        function showHealthDetails(cardType) {
            const titles = {
                heartRate: 'üíì ÂøÉÁéáËØ¶ÁªÜÂàÜÊûê',
                bloodOxygen: 'ü©∏ Ë°ÄÊ∞ßËØ¶ÁªÜÂàÜÊûê', 
                temperature: 'üå°Ô∏è ‰ΩìÊ∏©ËØ¶ÁªÜÂàÜÊûê'
            };
            
            const detailModal = `
                <div class="health-detail-modal" id="healthDetailModal" style="
                    position: fixed; top: 0; left: 0; right: 0; bottom: 0;
                    background: rgba(0,0,0,0.8); z-index: 10000;
                    display: flex; align-items: center; justify-content: center;
                    opacity: 0; transition: opacity 0.3s ease;
                ">
                    <div class="detail-content" style="
                        background: linear-gradient(145deg, rgba(13,20,33,0.95), rgba(6,18,25,0.95));
                        border: 1px solid rgba(0,255,157,0.3);
                        border-radius: 16px; width: 90%; max-width: 800px; 
                        max-height: 80vh; overflow-y: auto;
                        backdrop-filter: blur(20px);
                        transform: scale(0.9); transition: transform 0.3s ease;
                    ">
                        <div class="detail-header" style="
                            padding: 20px; border-bottom: 1px solid rgba(0,255,157,0.2);
                            display: flex; justify-content: space-between; align-items: center;
                        ">
                            <h2 style="color: #ffffff; margin: 0; font-size: 20px;">${titles[cardType]}</h2>
                            <button onclick="closeHealthDetail()" style="
                                background: transparent; border: 1px solid rgba(255,71,87,0.3);
                                color: #ff4757; width: 32px; height: 32px; border-radius: 6px;
                                cursor: pointer; font-size: 18px;
                            ">‚úï</button>
                        </div>
                        <div class="detail-tabs" style="
                            display: flex; background: rgba(0,21,41,0.3);
                            border-bottom: 1px solid rgba(0,255,157,0.2);
                        ">
                            <button class="detail-tab active" data-tab="realtime" onclick="switchDetailTab('realtime')" style="
                                flex: 1; padding: 15px; background: rgba(0,255,157,0.2);
                                border: none; color: #00ff9d; cursor: pointer;
                            ">ÂÆûÊó∂ÁõëÊµã</button>
                            <button class="detail-tab" data-tab="history" onclick="switchDetailTab('history')" style="
                                flex: 1; padding: 15px; background: transparent;
                                border: none; color: rgba(255,255,255,0.7); cursor: pointer;
                            ">ÂéÜÂè≤Ë∂ãÂäø</button>
                            <button class="detail-tab" data-tab="analysis" onclick="switchDetailTab('analysis')" style="
                                flex: 1; padding: 15px; background: transparent;
                                border: none; color: rgba(255,255,255,0.7); cursor: pointer;
                            ">AIÂàÜÊûê</button>
                        </div>
                        <div class="tab-content" id="detailTabContent" style="padding: 20px;">
                            ${generateDetailContent(cardType, 'realtime')}
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', detailModal);
            
            // ÊòæÁ§∫Âä®Áîª
            setTimeout(() => {
                const modal = document.getElementById('healthDetailModal');
                modal.style.opacity = '1';
                modal.querySelector('.detail-content').style.transform = 'scale(1)';
            }, 10);
            
            console.log('üîç ÊòæÁ§∫ÂÅ•Â∫∑ËØ¶ÊÉÖ:', cardType);
        }

        function closeHealthDetail() {
            const modal = document.getElementById('healthDetailModal');
            if (modal) {
                modal.style.opacity = '0';
                modal.querySelector('.detail-content').style.transform = 'scale(0.9)';
                setTimeout(() => modal.remove(), 300);
            }
        }

        function switchDetailTab(tabType) {
            // Êõ¥Êñ∞Ê†áÁ≠æÁä∂ÊÄÅ
            document.querySelectorAll('.detail-tab').forEach(tab => {
                tab.classList.remove('active');
                tab.style.background = 'transparent';
                tab.style.color = 'rgba(255,255,255,0.7)';
            });
            
            event.target.classList.add('active');
            event.target.style.background = 'rgba(0,255,157,0.2)';
            event.target.style.color = '#00ff9d';
            
            // Êõ¥Êñ∞ÂÜÖÂÆπ
            const contentArea = document.getElementById('detailTabContent');
            contentArea.innerHTML = generateDetailContent('heartRate', tabType); // Á§∫‰æãÁî®ÂøÉÁéá
        }

        function generateDetailContent(cardType, tabType) {
            if (tabType === 'realtime') {
                return `
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div style="text-align: center;">
                            <h4 style="color: #00ff9d; margin-bottom: 15px;">ÂΩìÂâçÊï∞ÂÄº</h4>
                            <div style="font-size: 48px; font-weight: bold; color: #ff6b6b; margin: 20px 0;">75</div>
                            <div style="color: rgba(255,255,255,0.8);">BPM</div>
                            <div style="margin-top: 15px; padding: 10px; background: rgba(0,255,60,0.1); border-radius: 8px; color: #00ff3c;">
                                ‚úì Ê≠£Â∏∏ËåÉÂõ¥
                            </div>
                        </div>
                        <div>
                            <h4 style="color: #00ff9d; margin-bottom: 15px;">‰ªäÊó•ÁªüËÆ°</h4>
                            <div style="display: flex; justify-content: space-between; margin: 10px 0; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.1);">
                                <span style="color: rgba(255,255,255,0.7);">ÊúÄÈ´ò:</span>
                                <span style="color: #ffffff; font-weight: bold;">89 BPM</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin: 10px 0; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.1);">
                                <span style="color: rgba(255,255,255,0.7);">ÊúÄ‰Ωé:</span>
                                <span style="color: #ffffff; font-weight: bold;">62 BPM</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin: 10px 0; padding: 8px 0;">
                                <span style="color: rgba(255,255,255,0.7);">Âπ≥Âùá:</span>
                                <span style="color: #ffffff; font-weight: bold;">75 BPM</span>
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: 20px;">
                        <h4 style="color: #00ff9d; margin-bottom: 10px;">ÂÅ•Â∫∑Âª∫ËÆÆ</h4>
                        <div style="background: rgba(0,228,255,0.1); padding: 15px; border-radius: 8px; border-left: 3px solid #00e4ff;">
                            <p style="color: #ffffff; margin: 0; line-height: 1.6;">
                                ÊÇ®ÁöÑÂøÉÁéáÂ§Ñ‰∫éÊ≠£Â∏∏ËåÉÂõ¥ÂÜÖÔºåÂª∫ËÆÆ‰øùÊåÅËßÑÂæãÁöÑ‰ΩúÊÅØÊó∂Èó¥ÔºåÈÄÇÈáèËøêÂä®ÔºåÈÅøÂÖçËøáÂ∫¶Âä≥Á¥Ø„ÄÇ
                            </p>
                        </div>
                    </div>
                `;
            } else if (tabType === 'history') {
                return `
                    <div style="text-align: center; color: rgba(255,255,255,0.8); padding: 40px;">
                        <div style="font-size: 48px; margin-bottom: 20px;">üìä</div>
                        <h3 style="color: #00ff9d;">ÂéÜÂè≤Ë∂ãÂäøÂàÜÊûê</h3>
                        <p>ÊòæÁ§∫ËøáÂéª7Â§©ÁöÑÂÅ•Â∫∑Êï∞ÊçÆÂèòÂåñË∂ãÂäø</p>
                        <div style="margin-top: 20px; padding: 15px; background: rgba(0,255,157,0.1); border-radius: 8px;">
                            ÂäüËÉΩÂºÄÂèë‰∏≠ÔºåÊï¨ËØ∑ÊúüÂæÖ...
                        </div>
                    </div>
                `;
            } else if (tabType === 'analysis') {
                return `
                    <div style="text-align: center; color: rgba(255,255,255,0.8); padding: 40px;">
                        <div style="font-size: 48px; margin-bottom: 20px;">ü§ñ</div>
                        <h3 style="color: #00ff9d;">AIÊô∫ËÉΩÂàÜÊûê</h3>
                        <p>Âü∫‰∫éÊú∫Âô®Â≠¶‰π†ÁÆóÊ≥ïÁöÑÂÅ•Â∫∑Áä∂ÊÄÅËØÑ‰º∞</p>
                        <div style="margin-top: 20px; padding: 15px; background: rgba(255,170,0,0.1); border-radius: 8px;">
                            AIÂàÜÊûêÂäüËÉΩÊ≠£Âú®ËÆ≠ÁªÉ‰∏≠...
                        </div>
                    </div>
                `;
            }
        }

        // ============= ËÆæÂ§áÁä∂ÊÄÅÁÆ°ÁêÜ =============
        function updateDeviceStatus() {
            const statusText = document.getElementById('deviceStatusText');
            const statusIndicator = document.querySelector('.status-indicator');
            
            // ËøôÈáåÂèØ‰ª•Ê†πÊçÆÂÆûÈôÖÊÉÖÂÜµÊõ¥Êñ∞ËÆæÂ§áÁä∂ÊÄÅ
            statusText.textContent = `ËÆæÂ§á ${deviceSn} Âú®Á∫ø`;
            statusIndicator.style.background = '#00ff9d';
        }

        // ============= ÂõæË°®ÂàùÂßãÂåñ =============
        function initializeCharts() {
            if (typeof echarts === 'undefined') {
                throw new Error('EChartsÂ∫ìÊú™Âä†ËΩΩ');
            }
            
            // ÂàùÂßãÂåñÂøÉÁéá‰ª™Ë°®Áõò
            const heartRateElement = document.getElementById('heartRateGauge');
            if (heartRateElement) {
                chartInstances.heartRateGauge = echarts.init(heartRateElement);
                chartInstances.heartRateGauge._chartName = 'ÂøÉÁéá'; // Ê†áËÆ∞ÂõæË°®Á±ªÂûã
                initGaugeChart(chartInstances.heartRateGauge, 'ÂøÉÁéá', 'BPM', 180, '#ff6b6b');
            }
            
            // ÂàùÂßãÂåñË°ÄÊ∞ß‰ª™Ë°®Áõò
            const bloodOxygenElement = document.getElementById('bloodOxygenGauge');
            if (bloodOxygenElement) {
                chartInstances.bloodOxygenGauge = echarts.init(bloodOxygenElement);
                chartInstances.bloodOxygenGauge._chartName = 'Ë°ÄÊ∞ß'; // Ê†áËÆ∞ÂõæË°®Á±ªÂûã
                initGaugeChart(chartInstances.bloodOxygenGauge, 'Ë°ÄÊ∞ß', '%', 100, '#00e4ff');
            }
            
            // ÂàùÂßãÂåñ‰ΩìÊ∏©‰ª™Ë°®Áõò
            const temperatureElement = document.getElementById('temperatureGauge');
            if (temperatureElement) {
                chartInstances.temperatureGauge = echarts.init(temperatureElement);
                chartInstances.temperatureGauge._chartName = '‰ΩìÊ∏©'; // Ê†áËÆ∞ÂõæË°®Á±ªÂûã
                initGaugeChart(chartInstances.temperatureGauge, '‰ΩìÊ∏©', '¬∞C', 50, '#ffaa00');
            }
            
            // ÂàùÂßãÂåñ‰∏ªË∂ãÂäøÂõæ
            const mainChartElement = document.getElementById('mainChart');
            if (mainChartElement) {
                chartInstances.mainChart = echarts.init(mainChartElement);
                initTrendChart(chartInstances.mainChart);
            }
        }

        function initializeFallbackCharts() {
            console.log('üîÑ ÂàùÂßãÂåñÈôçÁ∫ßÂõæË°®...');
            // ‰∏∫ÊØè‰∏™ÂõæË°®ÂÆπÂô®ÊòæÁ§∫ÈùôÊÄÅÂÜÖÂÆπ
            const fallbackElements = [
                { id: 'heartRateGauge', text: 'ÂøÉÁéáÂõæË°®Âä†ËΩΩ‰∏≠...', color: '#ff6b6b' },
                { id: 'bloodOxygenGauge', text: 'Ë°ÄÊ∞ßÂõæË°®Âä†ËΩΩ‰∏≠...', color: '#00e4ff' },
                { id: 'temperatureGauge', text: '‰ΩìÊ∏©ÂõæË°®Âä†ËΩΩ‰∏≠...', color: '#ffaa00' },
                { id: 'mainChart', text: '‰∏ªÂõæË°®Âä†ËΩΩ‰∏≠...', color: '#00ff9d' }
            ];
            
            fallbackElements.forEach(item => {
                const element = document.getElementById(item.id);
                if (element) {
                    element.innerHTML = `
                        <div style="
                            display: flex; 
                            align-items: center; 
                            justify-content: center; 
                            height: 100%; 
                            color: ${item.color}; 
                            font-size: 14px;
                            background: rgba(13, 20, 33, 0.9);
                            border-radius: 8px;
                        ">
                            ${item.text}
                        </div>
                    `;
                }
            });
        }

        function initGaugeChart(chartInstance, name, unit, max, color) {
            // Ê†πÊçÆ‰∏çÂêåÁöÑÂÅ•Â∫∑ÊåáÊ†áÂàõÂª∫‰∏ì‰∏öÁöÑ3DÂèØËßÜÂåñ
            if (name === 'ÂøÉÁéá') {
                init3DHeartRateChart(chartInstance, color);
            } else if (name === 'Ë°ÄÊ∞ß') {
                init3DBloodOxygenChart(chartInstance, color);
            } else if (name === '‰ΩìÊ∏©') {
                init3DTemperatureChart(chartInstance, color);
            } else {
                // ÈªòËÆ§Â¢ûÂº∫Âûã‰ª™Ë°®Áõò
                initEnhanced3DGauge(chartInstance, name, unit, max, color);
            }
        }

        function init3DHeartRateChart(chartInstance, color) {
            const option = {
                backgroundColor: 'transparent',
                graphic: [
                    // ËÉåÊôØÁ´ã‰ΩìÁéØ
                    {
                        type: 'group',
                        left: 'center',
                        top: 'middle',
                        children: [
                            {
                                type: 'ring',
                                shape: {
                                    cx: 0, cy: 0,
                                    r: 120, r0: 100
                                },
                                style: {
                                    fill: {
                                        type: 'linear',
                                        x: 0, y: 0, x2: 1, y2: 1,
                                        colorStops: [
                                            {offset: 0, color: 'rgba(255, 107, 107, 0.1)'},
                                            {offset: 0.5, color: 'rgba(255, 107, 107, 0.3)'},
                                            {offset: 1, color: 'rgba(255, 107, 107, 0.05)'}
                                        ]
                                    },
                                    shadowColor: 'rgba(255, 107, 107, 0.5)',
                                    shadowBlur: 25,
                                    shadowOffsetX: 0,
                                    shadowOffsetY: 5
                                }
                            },
                            // ÂÜÖÈÉ®ÂèëÂÖâÁéØ
                            {
                                type: 'ring',
                                shape: {
                                    cx: 0, cy: -2,
                                    r: 105, r0: 95
                                },
                                style: {
                                    fill: {
                                        type: 'radial',
                                        x: 0.3, y: 0.3, r: 0.8,
                                        colorStops: [
                                            {offset: 0, color: 'rgba(255, 255, 255, 0.8)'},
                                            {offset: 0.4, color: 'rgba(255, 107, 107, 0.6)'},
                                            {offset: 1, color: 'rgba(255, 107, 107, 0.1)'}
                                        ]
                                    },
                                    shadowColor: 'rgba(255, 255, 255, 0.8)',
                                    shadowBlur: 15
                                }
                            }
                        ]
                    }
                ],
                series: [{
                    name: 'ÂøÉÁéáÁõëÊµã',
                    type: 'gauge',
                    startAngle: 200,
                    endAngle: -40,
                    min: 40,
                    max: 180,
                    radius: '85%',
                    center: ['50%', '58%'],
                    splitNumber: 8,
                    
                    // Â¢ûÂº∫3DÂ§ñÂúàÊïàÊûú
                    axisLine: {
                        lineStyle: {
                            width: 20,
                            color: [
                                [0.3, {
                                    type: 'linear',
                                    x: 0, y: 0, x2: 1, y2: 0,
                                    colorStops: [
                                        {offset: 0, color: '#00ff3c'},
                                        {offset: 0.5, color: '#00e635'},
                                        {offset: 1, color: '#00cc30'}
                                    ]
                                }], // Ê≠£Â∏∏ÂøÉÁéáÂå∫Èó¥ - ÁªøËâ≤Ê∏êÂèò
                                [0.7, {
                                    type: 'linear',
                                    x: 0, y: 0, x2: 1, y2: 0,
                                    colorStops: [
                                        {offset: 0, color: '#ffaa00'},
                                        {offset: 0.5, color: '#ff9900'},
                                        {offset: 1, color: '#ff8800'}
                                    ]
                                }], // ËΩªÂ∫¶ÂºÇÂ∏∏ - Ê©ôËâ≤Ê∏êÂèò
                                [1, {
                                    type: 'linear',
                                    x: 0, y: 0, x2: 1, y2: 0,
                                    colorStops: [
                                        {offset: 0, color: '#ff4757'},
                                        {offset: 0.5, color: '#ff3838'},
                                        {offset: 1, color: '#ff2929'}
                                    ]
                                }]    // Âç±Èô©Âå∫Èó¥ - Á∫¢Ëâ≤Ê∏êÂèò
                            ],
                            shadowColor: `${color}99`,
                            shadowBlur: 30,
                            shadowOffsetX: 0,
                            shadowOffsetY: 8
                        }
                    },
                    
                    // 3DÂàªÂ∫¶Á∫ø
                    axisTick: {
                        show: true,
                        splitNumber: 4,
                        length: 8,
                        lineStyle: {
                            color: '#ffffff66',
                            width: 2,
                            shadowColor: '#ffffff',
                            shadowBlur: 5
                        }
                    },
                    
                    // 3DÂàÜÂâ≤Á∫ø
                    splitLine: {
                        show: true,
                        length: 15,
                        lineStyle: {
                            color: '#ffffff88',
                            width: 3,
                            shadowColor: '#ffffff',
                            shadowBlur: 8
                        }
                    },
                    
                    // ÂàªÂ∫¶Ê†áÁ≠æ
                    axisLabel: {
                        show: true,
                        distance: 25,
                        color: '#ffffff',
                        fontSize: 12,
                        fontWeight: 'bold',
                        formatter: function(value) {
                            if (value === 60) return 'Ê≠£Â∏∏';
                            if (value === 100) return 'ÂÅèÈ´ò';
                            if (value === 140) return 'Âç±Èô©';
                            return value;
                        }
                    },
                    
                    // 3DÊåáÈíà
                    pointer: {
                        show: true,
                        length: '75%',
                        width: 6,
                        itemStyle: {
                            color: {
                                type: 'linear',
                                x: 0, y: 0, x2: 0, y2: 1,
                                colorStops: [
                                    { offset: 0, color: '#ff6b6b' },
                                    { offset: 0.7, color: '#ff4757' },
                                    { offset: 1, color: '#2f1b14' }
                                ]
                            },
                            shadowColor: '#ff4757',
                            shadowBlur: 15,
                            shadowOffsetX: 0,
                            shadowOffsetY: 0
                        }
                    },
                    
                    // ÈîöÁÇπ
                    anchor: {
                        show: true,
                        showAbove: true,
                        size: 12,
                        itemStyle: {
                            color: '#ff4757',
                            shadowColor: '#ff4757',
                            shadowBlur: 10
                        }
                    },
                    
                    // Ê†áÈ¢ò
                    title: {
                        show: true,
                        offsetCenter: [0, '85%'],
                        fontSize: 14,
                        fontWeight: 'bold',
                        color: '#ffffff'
                    },
                    
                    // Êï∞ÂÄºÊòæÁ§∫ - Á¶ÅÁî®EChartsËá™Â∏¶ÁöÑÊòæÁ§∫Ôºå‰ΩøÁî®HTMLË¶ÜÁõñÂ±Ç
                    detail: {
                        show: false
                    },
                    
                    data: [{ 
                        value: 75,
                        name: 'üíì ÂÆûÊó∂ÂøÉÁéá'
                    }]
                }]
            };
            
            chartInstance.setOption(option);
        }

        function init3DBloodOxygenChart(chartInstance, color) {
            const option = {
                backgroundColor: 'transparent',
                series: [{
                    name: 'Ë°ÄÊ∞ßÈ•±ÂíåÂ∫¶',
                    type: 'gauge',
                    startAngle: 200,
                    endAngle: -40,
                    min: 88,
                    max: 100,
                    radius: '88%',
                    center: ['50%', '58%'],
                    splitNumber: 6,
                    
                    // Ë°ÄÊ∞ß‰∏ìÁî®È¢úËâ≤ÂàÜÂå∫
                    axisLine: {
                        lineStyle: {
                            width: 18,
                            color: [
                                [0.2, '#ff4757'], // Âç±Èô©Âå∫Âüü 88-90% - Á∫¢Ëâ≤
                                [0.5, '#ffaa00'], // Ë≠¶ÂëäÂå∫Âüü 90-95% - Ê©ôËâ≤  
                                [1, '#00e4ff']    // Ê≠£Â∏∏Âå∫Âüü 95-100% - ËìùËâ≤
                            ],
                            shadowColor: `${color}99`,
                            shadowBlur: 25,
                            shadowOffsetX: 0,
                            shadowOffsetY: 0
                        }
                    },
                    
                    // Ë°ÄÊ∞ßÁõëÊµã‰∏ìÁî®ÂàªÂ∫¶
                    axisTick: {
                        show: true,
                        splitNumber: 3,
                        length: 10,
                        lineStyle: {
                            color: '#00e4ff88',
                            width: 3,
                            shadowColor: '#00e4ff',
                            shadowBlur: 8
                        }
                    },
                    
                    splitLine: {
                        show: true,
                        length: 20,
                        lineStyle: {
                            color: '#ffffff99',
                            width: 4,
                            shadowColor: '#ffffff',
                            shadowBlur: 10
                        }
                    },
                    
                    axisLabel: {
                        show: true,
                        distance: 30,
                        color: '#ffffff',
                        fontSize: 12,
                        fontWeight: 'bold',
                        formatter: function(value) {
                            if (value === 90) return '‰ΩéÊ∞ß';
                            if (value === 95) return 'Ê≠£Â∏∏';
                            if (value === 100) return '‰ºòÁßÄ';
                            return value + '%';
                        }
                    },
                    
                    // Ë°ÄÊ∞ß‰∏ìÁî®ÊåáÈíà
                    pointer: {
                        show: true,
                        length: '80%',
                        width: 8,
                        itemStyle: {
                            color: {
                                type: 'radial',
                                x: 0.5, y: 0.5, r: 0.5,
                                colorStops: [
                                    { offset: 0, color: '#ffffff' },
                                    { offset: 0.7, color: '#00e4ff' },
                                    { offset: 1, color: '#0099cc' }
                                ]
                            },
                            shadowColor: '#00e4ff',
                            shadowBlur: 20
                        }
                    },
                    
                    anchor: {
                        show: true,
                        showAbove: true,
                        size: 15,
                        itemStyle: {
                            color: '#00e4ff',
                            shadowColor: '#00e4ff',
                            shadowBlur: 15
                        }
                    },
                    
                    title: {
                        show: true,
                        offsetCenter: [0, '85%'],
                        fontSize: 14,
                        fontWeight: 'bold',
                        color: '#ffffff'
                    },
                    
                    // Êï∞ÂÄºÊòæÁ§∫ - Á¶ÅÁî®EChartsËá™Â∏¶ÁöÑÊòæÁ§∫Ôºå‰ΩøÁî®HTMLË¶ÜÁõñÂ±Ç
                    detail: {
                        show: false
                    },
                    
                    data: [{ 
                        value: 98,
                        name: 'ü©∏ Ë°ÄÊ∞ßÈ•±ÂíåÂ∫¶'
                    }]
                }]
            };
            
            chartInstance.setOption(option);
        }

        function init3DTemperatureChart(chartInstance, color) {
            const option = {
                backgroundColor: 'transparent',
                series: [{
                    name: '‰ΩìÊ∏©ÁõëÊµã',
                    type: 'gauge',
                    startAngle: 200,
                    endAngle: -40,
                    min: 35.0,
                    max: 40.0,
                    radius: '88%',
                    center: ['50%', '58%'],
                    splitNumber: 10,
                    
                    // ‰ΩìÊ∏©‰∏ìÁî®È¢úËâ≤ÂàÜÂå∫
                    axisLine: {
                        lineStyle: {
                            width: 16,
                            color: [
                                [0.2, '#00d4ff'], // ‰ΩéÊ∏©Âå∫Âüü 35.0-36.1¬∞C - ËìùËâ≤
                                [0.6, '#00ff3c'], // Ê≠£Â∏∏Âå∫Âüü 36.1-37.3¬∞C - ÁªøËâ≤
                                [0.8, '#ffaa00'], // ÂæÆÁÉ≠Âå∫Âüü 37.3-38.0¬∞C - Ê©ôËâ≤
                                [1, '#ff4757']    // ÂèëÁÉ≠Âå∫Âüü 38.0-40.0¬∞C - Á∫¢Ëâ≤
                            ],
                            shadowColor: `${color}77`,
                            shadowBlur: 22,
                            shadowOffsetX: 0,
                            shadowOffsetY: 0
                        }
                    },
                    
                    axisTick: {
                        show: true,
                        splitNumber: 5,
                        length: 8,
                        lineStyle: {
                            color: '#ffaa0088',
                            width: 2,
                            shadowColor: '#ffaa00',
                            shadowBlur: 6
                        }
                    },
                    
                    splitLine: {
                        show: true,
                        length: 18,
                        lineStyle: {
                            color: '#ffffff77',
                            width: 3,
                            shadowColor: '#ffffff',
                            shadowBlur: 8
                        }
                    },
                    
                    axisLabel: {
                        show: true,
                        distance: 28,
                        color: '#ffffff',
                        fontSize: 11,
                        fontWeight: 'bold',
                        formatter: function(value) {
                            if (value === 36.1) return 'Ê≠£Â∏∏';
                            if (value === 37.3) return 'ÂÅèÈ´ò';
                            if (value === 38.0) return 'ÂèëÁÉ≠';
                            return value.toFixed(1) + '¬∞C';
                        }
                    },
                    
                    // Ê∏©Â∫¶ËÆ°Ê†∑ÂºèÊåáÈíà
                    pointer: {
                        show: true,
                        length: '78%',
                        width: 6,
                        itemStyle: {
                            color: {
                                type: 'linear',
                                x: 0, y: 0, x2: 0, y2: 1,
                                colorStops: [
                                    { offset: 0, color: '#ffffff' },
                                    { offset: 0.3, color: '#ffaa00' },
                                    { offset: 0.7, color: '#ff6600' },
                                    { offset: 1, color: '#cc0000' }
                                ]
                            },
                            shadowColor: '#ffaa00',
                            shadowBlur: 18
                        }
                    },
                    
                    anchor: {
                        show: true,
                        showAbove: true,
                        size: 14,
                        itemStyle: {
                            color: '#ffaa00',
                            shadowColor: '#ffaa00',
                            shadowBlur: 12
                        }
                    },
                    
                    title: {
                        show: true,
                        offsetCenter: [0, '85%'],
                        fontSize: 14,
                        fontWeight: 'bold',
                        color: '#ffffff'
                    },
                    
                    // Êï∞ÂÄºÊòæÁ§∫ - Á¶ÅÁî®EChartsËá™Â∏¶ÁöÑÊòæÁ§∫Ôºå‰ΩøÁî®HTMLË¶ÜÁõñÂ±Ç
                    detail: {
                        show: false
                    },
                    
                    data: [{ 
                        value: 36.5,
                        name: 'üå°Ô∏è ‰ΩìÊ∏©ÁõëÊµã'
                    }]
                }]
            };
            
            chartInstance.setOption(option);
        }

        function initEnhanced3DGauge(chartInstance, name, unit, max, color) {
            const option = {
                series: [{
                    name: name,
                    type: 'gauge',
                    startAngle: 200,
                    endAngle: -40,
                    min: 0,
                    max: max,
                    radius: '85%',
                    center: ['50%', '55%'],
                    splitNumber: 10,
                    itemStyle: {
                        color: color,
                        shadowColor: `${color}88`,
                        shadowBlur: 15
                    },
                    progress: {
                        show: true,
                        width: 12,
                        itemStyle: {
                            color: {
                                type: 'linear',
                                x: 0, y: 0, x2: 1, y2: 0,
                                colorStops: [
                                    { offset: 0, color: color + '33' },
                                    { offset: 0.5, color: color + '88' },
                                    { offset: 1, color: color }
                                ]
                            },
                            shadowColor: color,
                            shadowBlur: 20
                        }
                    },
                    pointer: {
                        show: true,
                        length: '75%',
                        width: 5,
                        itemStyle: {
                            color: color,
                            shadowColor: color,
                            shadowBlur: 10
                        }
                    },
                    axisLine: {
                        lineStyle: {
                            width: 12,
                            color: [[1, `${color}33`]],
                            shadowColor: `${color}66`,
                            shadowBlur: 15
                        }
                    },
                    axisTick: { 
                        show: true,
                        lineStyle: {
                            color: '#ffffff66',
                            shadowBlur: 5
                        }
                    },
                    splitLine: { 
                        show: true,
                        lineStyle: {
                            color: '#ffffff88',
                            shadowBlur: 8
                        }
                    },
                    axisLabel: { 
                        show: true,
                        color: '#ffffff',
                        fontSize: 11
                    },
                    title: { 
                        show: true,
                        color: '#ffffff',
                        fontSize: 14
                    },
                    detail: { 
                        show: true,
                        color: color,
                        fontSize: 18,
                        fontWeight: 'bold'
                    },
                    data: [{ value: 0 }]
                }]
            };
            
            chartInstance.setOption(option);
        }

        function initTrendChart(chartInstance) {
            const option = {
                backgroundColor: 'transparent',
                
                // ‰∏ì‰∏öÂåªÁñóÁ∫ßÂà´Â∑•ÂÖ∑ÊèêÁ§∫
                tooltip: {
                    trigger: 'axis',
                    backgroundColor: 'rgba(13, 20, 33, 0.95)',
                    borderColor: 'rgba(0, 255, 157, 0.5)',
                    borderWidth: 2,
                    textStyle: { 
                        color: '#ffffff', 
                        fontSize: 13,
                        fontWeight: 'bold'
                    },
                    shadowBlur: 20,
                    shadowColor: 'rgba(0, 255, 157, 0.3)',
                    formatter: function(params) {
                        let html = `<div style="padding: 10px;">`;
                        html += `<div style="color: #00ff9d; font-size: 14px; margin-bottom: 8px;">üìä ÂÅ•Â∫∑ÁõëÊµãÊï∞ÊçÆ</div>`;
                        html += `<div style="color: #ffffff88; font-size: 12px; margin-bottom: 10px;">${new Date(params[0].axisValue).toLocaleString()}</div>`;
                        
                        params.forEach(param => {
                            const color = param.color;
                            const name = param.seriesName;
                            const value = param.value[1];
                            let icon = '';
                            let status = '';
                            let unit = '';
                            
                            if (name === 'ÂøÉÁéá') {
                                icon = 'üíì';
                                unit = ' BPM';
                                if (value < 60) status = ' <span style="color: #ff4757;">ÂÅè‰Ωé</span>';
                                else if (value > 100) status = ' <span style="color: #ff4757;">ÂÅèÈ´ò</span>';
                                else status = ' <span style="color: #00ff3c;">Ê≠£Â∏∏</span>';
                            } else if (name === 'Ë°ÄÊ∞ß') {
                                icon = 'ü©∏';
                                unit = '%';
                                if (value < 95) status = ' <span style="color: #ff4757;">‰ΩéÊ∞ß</span>';
                                else status = ' <span style="color: #00ff3c;">Ê≠£Â∏∏</span>';
                            } else if (name === '‰ΩìÊ∏©') {
                                icon = 'üå°Ô∏è';
                                unit = '¬∞C';
                                if (value < 36.1) status = ' <span style="color: #00d4ff;">ÂÅè‰Ωé</span>';
                                else if (value > 37.3) status = ' <span style="color: #ff4757;">ÂÅèÈ´ò</span>';
                                else status = ' <span style="color: #00ff3c;">Ê≠£Â∏∏</span>';
                            }
                            
                            html += `<div style="margin: 5px 0; display: flex; align-items: center;">`;
                            html += `<span style="color: ${color}; font-size: 16px; margin-right: 8px;">${icon}</span>`;
                            html += `<span style="color: ${color}; font-weight: bold;">${name}: ${value}${unit}</span>`;
                            html += `<span style="margin-left: 10px;">${status}</span>`;
                            html += `</div>`;
                        });
                        
                        html += `</div>`;
                        return html;
                    }
                },
                
                // Âõæ‰æãÂ¢ûÂº∫
                legend: {
                    top: 15,
                    textStyle: { 
                        color: '#ffffff',
                        fontSize: 13,
                        fontWeight: 'bold'
                    },
                    itemWidth: 25,
                    itemHeight: 14,
                    itemGap: 30,
                    icon: 'roundRect',
                    selectedMode: 'multiple'
                },
                
                // ÁΩëÊ†ºÂ¢ûÂº∫
                grid: {
                    left: '8%',
                    right: '8%',
                    top: '18%',
                    bottom: '15%',
                    containLabel: true,
                    borderColor: 'rgba(255, 255, 255, 0.1)',
                    borderWidth: 1
                },
                
                // XËΩ¥Êó∂Èó¥ËΩ¥Â¢ûÂº∫
                xAxis: {
                    type: 'time',
                    axisLine: { 
                        lineStyle: { 
                            color: 'rgba(0, 255, 157, 0.4)',
                            width: 2
                        } 
                    },
                    axisLabel: { 
                        color: 'rgba(255, 255, 255, 0.8)',
                        fontSize: 11,
                        fontWeight: 'bold',
                        formatter: function(value) {
                            const date = new Date(value);
                            return `${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
                        }
                    },
                    axisTick: {
                        show: true,
                        lineStyle: {
                            color: 'rgba(255, 255, 255, 0.3)'
                        }
                    },
                    splitLine: {
                        show: true,
                        lineStyle: {
                            color: 'rgba(255, 255, 255, 0.1)',
                            type: 'dashed'
                        }
                    }
                },
                
                // ÂèåYËΩ¥Á≥ªÁªü
                yAxis: [
                    {
                        type: 'value',
                        name: 'ÂøÉÁéá (BPM) / Ë°ÄÊ∞ß (%)',
                        nameTextStyle: {
                            color: '#ff6b6b',
                            fontSize: 12,
                            fontWeight: 'bold'
                        },
                        position: 'left',
                        axisLine: { 
                            lineStyle: { 
                                color: 'rgba(255, 107, 107, 0.6)',
                                width: 2
                            } 
                        },
                        axisLabel: { 
                            color: 'rgba(255, 255, 255, 0.8)',
                            fontSize: 11,
                            fontWeight: 'bold'
                        },
                        splitLine: {
                            show: true,
                            lineStyle: {
                                color: 'rgba(255, 107, 107, 0.1)',
                                type: 'dashed'
                            }
                        }
                    },
                    {
                        type: 'value',
                        name: '‰ΩìÊ∏© (¬∞C)',
                        nameTextStyle: {
                            color: '#ffaa00',
                            fontSize: 12,
                            fontWeight: 'bold'
                        },
                        position: 'right',
                        min: 35.0,
                        max: 40.0,
                        axisLine: { 
                            lineStyle: { 
                                color: 'rgba(255, 170, 0, 0.6)',
                                width: 2
                            } 
                        },
                        axisLabel: { 
                            color: 'rgba(255, 255, 255, 0.8)',
                            fontSize: 11,
                            fontWeight: 'bold',
                            formatter: '{value}¬∞C'
                        },
                        splitLine: {
                            show: false
                        }
                    }
                ],
                
                // Â¢ûÂº∫Á≥ªÂàóÊï∞ÊçÆ
                series: [
                    {
                        name: 'ÂøÉÁéá',
                        type: 'line',
                        smooth: true,
                        symbol: 'circle',
                        symbolSize: 8,
                        
                        // 3DÁ∫øÊù°ÊïàÊûú
                        lineStyle: { 
                            color: {
                                type: 'linear',
                                x: 0, y: 0, x2: 1, y2: 0,
                                colorStops: [
                                    { offset: 0, color: '#ff6b6b' },
                                    { offset: 0.5, color: '#ff4757' },
                                    { offset: 1, color: '#ff3838' }
                                ]
                            },
                            width: 3,
                            shadowColor: '#ff6b6b',
                            shadowBlur: 15,
                            shadowOffsetY: 0
                        },
                        
                        // 3DÊï∞ÊçÆÁÇπ
                        itemStyle: { 
                            color: '#ff6b6b',
                            borderColor: '#ffffff',
                            borderWidth: 2,
                            shadowColor: '#ff6b6b',
                            shadowBlur: 10
                        },
                        
                        // Âå∫ÂüüÂ°´ÂÖÖ
                        areaStyle: {
                            color: {
                                type: 'linear',
                                x: 0, y: 0, x2: 0, y2: 1,
                                colorStops: [
                                    { offset: 0, color: 'rgba(255, 107, 107, 0.3)' },
                                    { offset: 1, color: 'rgba(255, 107, 107, 0.05)' }
                                ]
                            }
                        },
                        
                        emphasis: {
                            scale: 1.1,
                            itemStyle: {
                                shadowColor: '#ff6b6b',
                                shadowBlur: 20
                            }
                        },
                        
                        // Ê†áËÆ∞ÂÅ•Â∫∑Âå∫Èó¥
                        markLine: {
                            data: [
                                { yAxis: 60, name: 'Ê≠£Â∏∏‰∏ãÈôê', lineStyle: { color: '#00ff3c', type: 'dashed', opacity: 0.6 } },
                                { yAxis: 100, name: 'Ê≠£Â∏∏‰∏äÈôê', lineStyle: { color: '#00ff3c', type: 'dashed', opacity: 0.6 } }
                            ],
                            label: { show: false }
                        },
                        
                        data: []
                    },
                    
                    {
                        name: 'Ë°ÄÊ∞ß',
                        type: 'line',
                        smooth: true,
                        symbol: 'diamond',
                        symbolSize: 8,
                        
                        lineStyle: { 
                            color: {
                                type: 'linear',
                                x: 0, y: 0, x2: 1, y2: 0,
                                colorStops: [
                                    { offset: 0, color: '#00e4ff' },
                                    { offset: 0.5, color: '#00d2ee' },
                                    { offset: 1, color: '#00bfcc' }
                                ]
                            },
                            width: 3,
                            shadowColor: '#00e4ff',
                            shadowBlur: 15
                        },
                        
                        itemStyle: { 
                            color: '#00e4ff',
                            borderColor: '#ffffff',
                            borderWidth: 2,
                            shadowColor: '#00e4ff',
                            shadowBlur: 10
                        },
                        
                        areaStyle: {
                            color: {
                                type: 'linear',
                                x: 0, y: 0, x2: 0, y2: 1,
                                colorStops: [
                                    { offset: 0, color: 'rgba(0, 228, 255, 0.25)' },
                                    { offset: 1, color: 'rgba(0, 228, 255, 0.05)' }
                                ]
                            }
                        },
                        
                        emphasis: {
                            scale: 1.1,
                            itemStyle: {
                                shadowColor: '#00e4ff',
                                shadowBlur: 20
                            }
                        },
                        
                        markLine: {
                            data: [
                                { yAxis: 95, name: 'Ê≠£Â∏∏‰∏ãÈôê', lineStyle: { color: '#00ff3c', type: 'dashed', opacity: 0.6 } }
                            ],
                            label: { show: false }
                        },
                        
                        data: []
                    },
                    
                    {
                        name: '‰ΩìÊ∏©',
                        type: 'line',
                        smooth: true,
                        symbol: 'rect',
                        symbolSize: [10, 6],
                        yAxisIndex: 1,
                        
                        lineStyle: { 
                            color: {
                                type: 'linear',
                                x: 0, y: 0, x2: 1, y2: 0,
                                colorStops: [
                                    { offset: 0, color: '#ffaa00' },
                                    { offset: 0.5, color: '#ff9900' },
                                    { offset: 1, color: '#ff8800' }
                                ]
                            },
                            width: 3,
                            shadowColor: '#ffaa00',
                            shadowBlur: 15
                        },
                        
                        itemStyle: { 
                            color: '#ffaa00',
                            borderColor: '#ffffff',
                            borderWidth: 2,
                            shadowColor: '#ffaa00',
                            shadowBlur: 10
                        },
                        
                        areaStyle: {
                            color: {
                                type: 'linear',
                                x: 0, y: 0, x2: 0, y2: 1,
                                colorStops: [
                                    { offset: 0, color: 'rgba(255, 170, 0, 0.2)' },
                                    { offset: 1, color: 'rgba(255, 170, 0, 0.05)' }
                                ]
                            }
                        },
                        
                        emphasis: {
                            scale: 1.1,
                            itemStyle: {
                                shadowColor: '#ffaa00',
                                shadowBlur: 20
                            }
                        },
                        
                        markLine: {
                            data: [
                                { yAxis: 36.1, name: 'Ê≠£Â∏∏‰∏ãÈôê', lineStyle: { color: '#00ff3c', type: 'dashed', opacity: 0.6 } },
                                { yAxis: 37.3, name: 'Ê≠£Â∏∏‰∏äÈôê', lineStyle: { color: '#00ff3c', type: 'dashed', opacity: 0.6 } }
                            ],
                            label: { show: false }
                        },
                        
                        data: []
                    }
                ],
                
                // Êï∞ÊçÆÁº©ÊîæÊéßÂà∂
                dataZoom: [
                    {
                        type: 'inside',
                        start: 0,
                        end: 100,
                        filterMode: 'filter'
                    },
                    {
                        show: true,
                        type: 'slider',
                        bottom: '2%',
                        start: 0,
                        end: 100,
                        height: 20,
                        textStyle: {
                            color: '#ffffff'
                        },
                        borderColor: 'rgba(0, 255, 157, 0.3)',
                        fillerColor: 'rgba(0, 255, 157, 0.2)',
                        handleStyle: {
                            color: '#00ff9d'
                        }
                    }
                ],
                
                // Âä®ÁîªÈÖçÁΩÆ
                animation: true,
                animationDuration: 2000,
                animationEasing: 'cubicOut',
                animationDelay: function (idx) {
                    return idx * 200;
                }
            };
            
            chartInstance.setOption(option);
        }

        // ============= Êï∞ÊçÆÂä†ËΩΩÂáΩÊï∞ =============
        function loadHealthData() {
            console.log('üìä Âä†ËΩΩÂÆûÊó∂ÂÅ•Â∫∑Êï∞ÊçÆ...');
            
            fetch(`/get_personal_info?deviceSn=${deviceSn}`)
                .then(response => response.json())
                .then(result => {
                    if (result.success && result.data) {
                        console.log('‚úÖ ‰∏™‰∫∫‰ø°ÊÅØÂä†ËΩΩÊàêÂäü:', result.data);
                        
                        // Êõ¥Êñ∞ÂëòÂ∑•‰ø°ÊÅØ
                        if (result.data.user_info && result.data.user_info.data && result.data.user_info.data.users && result.data.user_info.data.users.length > 0) {
                            updateEmployeeInfo(result.data.user_info.data.users);
                        }
                        
                        // Êõ¥Êñ∞ÂÅ•Â∫∑Êï∞ÊçÆ
                        if (result.data.health_data && result.data.health_data.data && result.data.health_data.data.healthData) {
                            const healthData = extractLatestHealthData(result.data.health_data.data.healthData);
                            updateHealthDisplay(healthData);
                        }
                        
                        // Êõ¥Êñ∞Ê∂àÊÅØÊï∞ÊçÆ
                        if (result.data.message_info && result.data.message_info.data && result.data.message_info.data.messages) {
                            updateMessageDisplay(result.data.message_info.data.messages);
                        }
                        
                        // Êõ¥Êñ∞ÂëäË≠¶Êï∞ÊçÆ  
                        if (result.data.alert_info && result.data.alert_info.data && result.data.alert_info.data.alerts) {
                            updateAlertDisplay(result.data.alert_info.data.alerts);
                        }
                        
                        // Êõ¥Êñ∞ËÆæÂ§áÁä∂ÊÄÅ
                        if (result.data.device_info && result.data.device_info.data) {
                            updateDeviceStatusFromInfo(result.data.device_info.data);
                        }
                        
                    } else {
                        console.warn('‚ö†Ô∏è ‰∏™‰∫∫‰ø°ÊÅØÂä†ËΩΩÂ§±Ë¥•:', result.error);
                        // ‰ΩøÁî®Â§áÁî®Ê®°ÊãüÊï∞ÊçÆ
                        const mockData = generateMockHealthData();
                        updateHealthDisplay(mockData);
                    }
                })
                .catch(error => {
                    console.error('‚ùå ‰∏™‰∫∫‰ø°ÊÅØAPIËØ∑Ê±ÇÂ§±Ë¥•:', error);
                    // ‰ΩøÁî®Â§áÁî®Ê®°ÊãüÊï∞ÊçÆ
                    const mockData = generateMockHealthData();
                    updateHealthDisplay(mockData);
                });
        }

        function generateMockHealthData() {
            const now = Date.now();
            return {
                timestamp: now,
                heartRate: Math.floor(Math.random() * 40) + 60,
                bloodOxygen: Math.floor(Math.random() * 10) + 95,
                temperature: (Math.random() * 2 + 36).toFixed(1),
                systolic: Math.floor(Math.random() * 40) + 110,
                diastolic: Math.floor(Math.random() * 20) + 70,
                stepCount: Math.floor(Math.random() * 5000) + 2000
            };
        }

        // Êñ∞Â¢ûÔºöÂ§ÑÁêÜÁúüÂÆûAPIÊï∞ÊçÆÁöÑËæÖÂä©ÂáΩÊï∞
        function extractLatestHealthData(healthDataArray) {
            console.log('üîç ÂÅ•Â∫∑Êï∞ÊçÆËæìÂÖ•ÂèÇÊï∞:', healthDataArray);
            if (!healthDataArray || healthDataArray.length === 0) {
                console.log('‚ö†Ô∏è ÂÅ•Â∫∑Êï∞ÊçÆ‰∏∫Á©∫Ôºå‰ΩøÁî®Ê®°ÊãüÊï∞ÊçÆ');
                return generateMockHealthData();
            }
            
            // Ëé∑ÂèñÊúÄÊñ∞ÁöÑÂÅ•Â∫∑Êï∞ÊçÆËÆ∞ÂΩï
            const latestData = healthDataArray[0];
            console.log('üìä ÊúÄÊñ∞ÂÅ•Â∫∑Êï∞ÊçÆ:', latestData);
            
            return {
                timestamp: Date.now(),
                heartRate: parseInt(latestData.heart_rate) || Math.floor(Math.random() * 40) + 60,
                bloodOxygen: parseInt(latestData.blood_oxygen) || Math.floor(Math.random() * 10) + 95,
                temperature: parseFloat(latestData.temperature) || (Math.random() * 2 + 36).toFixed(1),
                systolic: parseInt(latestData.pressure_high) || Math.floor(Math.random() * 40) + 110,
                diastolic: parseInt(latestData.pressure_low) || Math.floor(Math.random() * 20) + 70,
                stepCount: parseInt(latestData.step) || Math.floor(Math.random() * 5000) + 2000,
                pressure: latestData.stress || '0',
                location: latestData.latitude && latestData.longitude ? `${latestData.latitude},${latestData.longitude}` : null
            };
        }

        function updateEmployeeInfo(userData) {
            if (!userData || userData.length === 0) return;
            
            const user = userData[0]; // Ëé∑ÂèñÁ¨¨‰∏Ä‰∏™Áî®Êà∑Êï∞ÊçÆ
            console.log('üë§ Êõ¥Êñ∞ÂëòÂ∑•‰ø°ÊÅØ:', user);
            
            // Êõ¥Êñ∞ÂëòÂ∑•Êï∞ÊçÆÂØπË±° - ‰øÆÊ≠£Â±ûÊÄßÂêçÂåπÈÖçAPIËøîÂõûÁªìÊûÑ
            employeeData.name = user.user_name || user.userName || user.name || employeeData.name;
            employeeData.role = user.position || 'ÊôÆÈÄöÂëòÂ∑•';
            employeeData.deviceSn = user.device_sn || employeeData.deviceSn;
            employeeData.department = user.department || user.dept_name || employeeData.department;
            employeeData.confirmed = true;
            
            // Êõ¥Êñ∞È°µÈù¢ÊòæÁ§∫
            const headerEmployeeNameEl = document.getElementById('headerEmployeeName');
            const headerEmployeeRoleEl = document.getElementById('headerEmployeeRole');
            const headerEmployeeDeviceEl = document.getElementById('headerEmployeeDevice');
            
            if (headerEmployeeNameEl) headerEmployeeNameEl.textContent = employeeData.name;
            if (headerEmployeeRoleEl) headerEmployeeRoleEl.textContent = employeeData.role;
            if (headerEmployeeDeviceEl) headerEmployeeDeviceEl.textContent = employeeData.deviceSn;
            
            console.log('‚úÖ ÂëòÂ∑•‰ø°ÊÅØÊõ¥Êñ∞ÂÆåÊàê:', employeeData);
        }

        function updateDeviceStatusFromInfo(deviceData) {
            if (!deviceData || deviceData.length === 0) return;
            
            const device = deviceData[0];
            console.log('üì± Êõ¥Êñ∞ËÆæÂ§áÁä∂ÊÄÅ:', device);
            
            const deviceStatus = {
                batteryLevel: device.batteryLevel || Math.floor(Math.random() * (100 - 20)) + 20,
                status: device.status || 'ACTIVE',
                lastUpdate: new Date(device.lastHeartbeat || Date.now())
            };
            
            updateDeviceStatus(deviceStatus);
        }

        function updateHealthDisplay(data) {
            healthData = data;
            
            console.log('üîÑ Êõ¥Êñ∞ÂÅ•Â∫∑Êï∞ÊçÆÊòæÁ§∫:', data);
            
            // Êõ¥Êñ∞ÂøÉÁéá - ‰ΩøÁî®Â¢ûÂº∫ÁöÑ3DÂõæË°®
            updateGaugeValue(chartInstances.heartRateGauge, data.heartRate, 180);
            document.getElementById('heartRateValue').textContent = data.heartRate;
            updateHealthStatus('heartRate', data.heartRate, 60, 100);
            updateHealthCardStatus('heartRateCard', data.heartRate, 60, 100, 120);
            
            // Êõ¥Êñ∞Ë°ÄÊ∞ß - ‰ΩøÁî®Â¢ûÂº∫ÁöÑ3DÂõæË°®
            updateGaugeValue(chartInstances.bloodOxygenGauge, data.bloodOxygen, 100);
            document.getElementById('bloodOxygenValue').textContent = data.bloodOxygen;
            updateHealthStatus('bloodOxygen', data.bloodOxygen, 95, 100);
            updateHealthCardStatus('bloodOxygenCard', data.bloodOxygen, 95, 100, 90);
            
            // Êõ¥Êñ∞‰ΩìÊ∏© - ‰ΩøÁî®Â¢ûÂº∫ÁöÑ3DÂõæË°®ÂíåÂåªÁñóÁ∫ßÊ∏©Â∫¶ËåÉÂõ¥
            const tempValue = parseFloat(data.temperature);
            updateGaugeValue(chartInstances.temperatureGauge, tempValue, 40);
            document.getElementById('temperatureValue').textContent = data.temperature;
            updateHealthStatus('temperature', tempValue, 36.1, 37.3);
            updateHealthCardStatus('temperatureCard', tempValue, 36.1, 37.3, 38.0);
            
            // Êõ¥Êñ∞ÂÖ∂‰ªñÁîüÂëΩ‰ΩìÂæÅÊåáÊ†á
            updateVitalSigns(data);
            
            // Êõ¥Êñ∞ÂÅ•Â∫∑ÁªüËÆ°ÂíåË∂ãÂäøÂàÜÊûê
            updateHealthStatistics(data);
            
            // Êõ¥Êñ∞ÂÅ•Â∫∑ÁªºÂêàËØÑÂàÜ
            updateHealthScore(data);
            
            // Êõ¥Êñ∞Ê≥¢ÂΩ¢ÂõæË°®Êï∞ÊçÆ
            updateWaveChart(data);
            
            console.log('‚úÖ ÂÅ•Â∫∑Êï∞ÊçÆÊòæÁ§∫Êõ¥Êñ∞ÂÆåÊàê');
        }

        function updateHealthScore(data) {
            // ËÆ°ÁÆóÁªºÂêàÂÅ•Â∫∑ËØÑÂàÜ
            let score = 100;
            
            // ÂøÉÁéáËØÑÂàÜ (30%)
            if (data.heartRate < 60 || data.heartRate > 100) {
                score -= 15;
            } else if (data.heartRate < 70 || data.heartRate > 90) {
                score -= 5;
            }
            
            // Ë°ÄÊ∞ßËØÑÂàÜ (30%) 
            if (data.bloodOxygen < 95) {
                score -= 20;
            } else if (data.bloodOxygen < 98) {
                score -= 5;
            }
            
            // ‰ΩìÊ∏©ËØÑÂàÜ (25%)
            const temp = parseFloat(data.temperature);
            if (temp < 36.1 || temp > 37.3) {
                score -= 15;
            } else if (temp < 36.5 || temp > 37.0) {
                score -= 3;
            }
            
            // Ë°ÄÂéãËØÑÂàÜ (15%)
            if (data.systolic > 140 || data.diastolic > 90) {
                score -= 10;
            } else if (data.systolic > 130 || data.diastolic > 85) {
                score -= 3;
            }
            
            score = Math.max(0, Math.min(100, Math.round(score)));
            
            const scoreElement = document.getElementById('healthScore');
            if (scoreElement) {
                scoreElement.textContent = score;
                
                // Ê†πÊçÆËØÑÂàÜÊõ¥Êñ∞È¢úËâ≤
                if (score >= 90) {
                    scoreElement.style.color = '#00ff3c';
                } else if (score >= 75) {
                    scoreElement.style.color = '#00ff9d';
                } else if (score >= 60) {
                    scoreElement.style.color = '#ffaa00';
                } else {
                    scoreElement.style.color = '#ff4757';
                }
            }
        }

        function updateWaveChart(data) {
            // ÂÆûÊó∂Êõ¥Êñ∞Ê≥¢ÂΩ¢ÂõæË°®Êï∞ÊçÆ
            if (chartInstances.vitalWaveChart) {
                generateWaveData(currentWaveType);
            }
        }

        function updateHealthCardStatus(cardId, value, minNormal, maxNormal, criticalThreshold) {
            const card = document.getElementById(cardId);
            if (!card) return;
            
            // Ê∏ÖÈô§‰πãÂâçÁöÑÁä∂ÊÄÅÁ±ª
            card.classList.remove('alert-high', 'alert-critical');
            
            // Ê†πÊçÆÂÅ•Â∫∑Êï∞ÂÄºÂ∫îÁî®Áõ∏Â∫îÁöÑËßÜËßâÊïàÊûú
            if (value < minNormal || value > maxNormal) {
                if ((cardId.includes('heartRate') && (value < 50 || value > criticalThreshold)) ||
                    (cardId.includes('bloodOxygen') && value < criticalThreshold) ||
                    (cardId.includes('temperature') && value > criticalThreshold)) {
                    card.classList.add('alert-critical');
                } else {
                    card.classList.add('alert-high');
                }
            }
        }

        function updateVitalSigns(data) {
            // Êõ¥Êñ∞Ë°ÄÂéãÊåáÊ†á
            const systolicElement = document.getElementById('systolicValue');
            const diastolicElement = document.getElementById('diastolicValue');
            
            if (systolicElement && data.systolic) {
                systolicElement.textContent = data.systolic + ' mmHg';
                // Ë°ÄÂéãÂàÜÁ∫ßÊòæÁ§∫
                if (data.systolic > 140 || data.diastolic > 90) {
                    systolicElement.style.color = '#ff4757';
                    systolicElement.style.fontWeight = 'bold';
                } else if (data.systolic > 130 || data.diastolic > 85) {
                    systolicElement.style.color = '#ffaa00';
                } else {
                    systolicElement.style.color = '#00ff3c';
                }
            }
            
            if (diastolicElement && data.diastolic) {
                diastolicElement.textContent = data.diastolic + ' mmHg';
                if (data.diastolic > 90) {
                    diastolicElement.style.color = '#ff4757';
                    diastolicElement.style.fontWeight = 'bold';
                } else if (data.diastolic > 85) {
                    diastolicElement.style.color = '#ffaa00';
                } else {
                    diastolicElement.style.color = '#00ff3c';
                }
            }
            
            // Êõ¥Êñ∞Ê≠•Êï∞ÂíåÊ¥ªÂä®Á≠âÁ∫ß
            const stepCountElement = document.getElementById('stepCount');
            const activityLevelElement = document.getElementById('activityLevel');
            
            if (stepCountElement && data.stepCount !== undefined) {
                stepCountElement.textContent = data.stepCount.toLocaleString();
                
                // Ê†πÊçÆÊ≠•Êï∞ÊòæÁ§∫Ê¥ªÂä®Á≠âÁ∫ß
                let activityLevel = 'ËΩªÂ∫¶';
                let activityColor = '#ffaa00';
                
                if (data.stepCount > 10000) {
                    activityLevel = 'ÈùûÂ∏∏Ê¥ªË∑É';
                    activityColor = '#00ff3c';
                } else if (data.stepCount > 7000) {
                    activityLevel = 'Ê¥ªË∑É';
                    activityColor = '#00e4ff';
                } else if (data.stepCount > 5000) {
                    activityLevel = '‰∏≠Á≠â';
                    activityColor = '#ffaa00';
                } else if (data.stepCount < 2000) {
                    activityLevel = '‰πÖÂùê';
                    activityColor = '#ff4757';
                }
                
                if (activityLevelElement) {
                    activityLevelElement.textContent = activityLevel;
                    activityLevelElement.style.color = activityColor;
                    activityLevelElement.style.fontWeight = 'bold';
                }
            }
        }

        function updateHealthStatistics(data) {
            // Êõ¥Êñ∞ÂÅ•Â∫∑ËØ¶ÊÉÖÁªüËÆ°
            try {
                // ÂøÉÁéáÁªüËÆ°
                if (data.heartRate) {
                    updateStatDetail('heartRateMax', Math.max(data.heartRate, getStoredMaxValue('heartRate', data.heartRate)));
                    updateStatDetail('heartRateMin', Math.min(data.heartRate, getStoredMinValue('heartRate', data.heartRate)));
                    updateStatDetail('heartRateAvg', calculateRunningAverage('heartRate', data.heartRate));
                }
                
                // Ë°ÄÊ∞ßÁªüËÆ°
                if (data.bloodOxygen) {
                    updateStatDetail('bloodOxygenMax', Math.max(data.bloodOxygen, getStoredMaxValue('bloodOxygen', data.bloodOxygen)));
                    updateStatDetail('bloodOxygenMin', Math.min(data.bloodOxygen, getStoredMinValue('bloodOxygen', data.bloodOxygen)));
                    updateStatDetail('bloodOxygenAvg', calculateRunningAverage('bloodOxygen', data.bloodOxygen));
                }
                
                // Â≠òÂÇ®ÂΩìÂâçÊï∞ÊçÆÁî®‰∫éÁªüËÆ°
                storeHealthDataForStats(data);
                
            } catch (error) {
                console.warn('‚ö†Ô∏è ÂÅ•Â∫∑ÁªüËÆ°Êõ¥Êñ∞Âá∫Èîô:', error);
            }
        }

        function updateStatDetail(elementId, value) {
            const element = document.getElementById(elementId);
            if (element && value !== undefined) {
                if (elementId.includes('heartRate')) {
                    element.textContent = Math.round(value) + ' BPM';
                } else if (elementId.includes('bloodOxygen')) {
                    element.textContent = Math.round(value) + '%';
                } else if (elementId.includes('temperature')) {
                    element.textContent = value.toFixed(1) + '¬∞C';
                }
            }
        }

        function getStoredMaxValue(type, currentValue) {
            const stored = localStorage.getItem(`health_max_${type}`);
            const maxVal = stored ? Math.max(parseFloat(stored), currentValue) : currentValue;
            localStorage.setItem(`health_max_${type}`, maxVal.toString());
            return maxVal;
        }

        function getStoredMinValue(type, currentValue) {
            const stored = localStorage.getItem(`health_min_${type}`);
            const minVal = stored ? Math.min(parseFloat(stored), currentValue) : currentValue;
            localStorage.setItem(`health_min_${type}`, minVal.toString());
            return minVal;
        }

        function calculateRunningAverage(type, currentValue) {
            const history = JSON.parse(localStorage.getItem(`health_history_${type}`) || '[]');
            history.push(currentValue);
            if (history.length > 100) history.shift(); // ‰øùÊåÅÊúÄËøë100‰∏™Êï∞ÊçÆÁÇπ
            
            localStorage.setItem(`health_history_${type}`, JSON.stringify(history));
            
            const avg = history.reduce((sum, val) => sum + val, 0) / history.length;
            return Math.round(avg * 10) / 10; // ‰øùÁïô‰∏Ä‰ΩçÂ∞èÊï∞
        }

        function storeHealthDataForStats(data) {
            const timestamp = Date.now();
            const statsEntry = {
                timestamp,
                heartRate: data.heartRate,
                bloodOxygen: data.bloodOxygen,
                temperature: parseFloat(data.temperature),
                systolic: data.systolic,
                diastolic: data.diastolic
            };
            
            const recentStats = JSON.parse(localStorage.getItem('recent_health_stats') || '[]');
            recentStats.push(statsEntry);
            
            // ‰øùÊåÅÊúÄËøë1000‰∏™Êï∞ÊçÆÁÇπ
            if (recentStats.length > 1000) recentStats.shift();
            
            localStorage.setItem('recent_health_stats', JSON.stringify(recentStats));
        }

        function updateGaugeValue(chartInstance, value, max) {
            // Êõ¥Êñ∞‰ª™Ë°®ÁõòÊï∞ÂÄºÂπ∂Ê∑ªÂä†Âä®ÊÄÅÈ¢úËâ≤ÂíåÂä®ÁîªÊïàÊûú
            const seriesConfig = {
                data: [{ value: Math.min(value, max) }]
            };
            
            // Ê†πÊçÆÊï∞ÂÄºÂä®ÊÄÅË∞ÉÊï¥È¢úËâ≤ÂíåÊïàÊûú
            if (chartInstance._chartName === 'ÂøÉÁéá') {
                updateHeartRateGauge(chartInstance, value);
            } else if (chartInstance._chartName === 'Ë°ÄÊ∞ß') {
                updateBloodOxygenGauge(chartInstance, value);
            } else if (chartInstance._chartName === '‰ΩìÊ∏©') {
                updateTemperatureGauge(chartInstance, value);
            } else {
                // ÈÄöÁî®‰ª™Ë°®ÁõòÊõ¥Êñ∞
                chartInstance.setOption(seriesConfig);
            }
        }

        function updateHeartRateGauge(chartInstance, heartRate) {
            // ÂøÉÁéá‰∏ìÁî®Êõ¥Êñ∞ÈÄªËæë
            let status = 'normal';
            let alertColor = '#00ff3c';
            let pulseEffect = '';
            
            if (heartRate < 50) {
                status = 'low';
                alertColor = '#ff4757';
                pulseEffect = 'slow';
            } else if (heartRate > 120) {
                status = 'high';
                alertColor = '#ff4757';
                pulseEffect = 'fast';
            } else if (heartRate > 100) {
                status = 'elevated';
                alertColor = '#ffaa00';
                pulseEffect = 'moderate';
            }
            
            const option = {
                series: [{
                    data: [{ 
                        value: heartRate,
                        name: ''
                    }],
                    // Á¶ÅÁî®detailÊòæÁ§∫Ôºå‰ΩøÁî®HTMLË¶ÜÁõñÂ±Ç
                    detail: {
                        show: false
                    },
                    pointer: {
                        itemStyle: {
                            shadowBlur: status === 'normal' ? 15 : 25,
                            shadowColor: alertColor
                        }
                    }
                }]
            };
            
            chartInstance.setOption(option);
            
            // Ê∑ªÂä†ÂøÉÁéáËøáÈ´ò/Ëøá‰ΩéÁöÑËßÜËßâË≠¶ÂëäÊïàÊûú
            if (status !== 'normal') {
                addHeartBeatAnimation(chartInstance, pulseEffect);
            }
        }

        function updateBloodOxygenGauge(chartInstance, spo2) {
            // Ë°ÄÊ∞ßÈ•±ÂíåÂ∫¶‰∏ìÁî®Êõ¥Êñ∞ÈÄªËæë
            let status = 'normal';
            let alertColor = '#00e4ff';
            
            if (spo2 < 90) {
                status = 'critical';
                alertColor = '#ff4757';
            } else if (spo2 < 95) {
                status = 'low';
                alertColor = '#ffaa00';
            } else if (spo2 >= 98) {
                status = 'excellent';
                alertColor = '#00ff3c';
            }
            
            const option = {
                series: [{
                    data: [{ 
                        value: spo2,
                        name: ''
                    }],
                    // Á¶ÅÁî®detailÊòæÁ§∫Ôºå‰ΩøÁî®HTMLË¶ÜÁõñÂ±Ç
                    detail: {
                        show: false
                    },
                    pointer: {
                        itemStyle: {
                            shadowBlur: status === 'critical' ? 30 : 20,
                            shadowColor: alertColor
                        }
                    }
                }]
            };
            
            chartInstance.setOption(option);
        }

        function updateTemperatureGauge(chartInstance, temperature) {
            // ‰ΩìÊ∏©‰∏ìÁî®Êõ¥Êñ∞ÈÄªËæë
            let status = 'normal';
            let alertColor = '#ffaa00';
            let tempLevel = '';
            
            if (temperature < 36.1) {
                status = 'hypothermia';
                alertColor = '#00d4ff';
                tempLevel = '‰ΩìÊ∏©ÂÅè‰Ωé';
            } else if (temperature > 38.0) {
                status = 'fever';
                alertColor = '#ff4757';
                tempLevel = 'ÂèëÁÉ≠';
            } else if (temperature > 37.3) {
                status = 'elevated';
                alertColor = '#ffaa00';
                tempLevel = 'ËΩªÂæÆÂÅèÈ´ò';
            } else {
                tempLevel = '‰ΩìÊ∏©Ê≠£Â∏∏';
                alertColor = '#00ff3c';
            }
            
            const option = {
                series: [{
                    data: [{ 
                        value: temperature,
                        name: ''
                    }],
                    // Á¶ÅÁî®detailÊòæÁ§∫Ôºå‰ΩøÁî®HTMLË¶ÜÁõñÂ±Ç  
                    detail: {
                        show: false
                    },
                    pointer: {
                        itemStyle: {
                            shadowBlur: status === 'fever' ? 30 : 18,
                            shadowColor: alertColor
                        }
                    }
                }]
            };
            
            chartInstance.setOption(option);
            
            // ÂèëÁÉ≠Êó∂Ê∑ªÂä†ÁâπÊÆäÊïàÊûú
            if (status === 'fever') {
                addFeverAnimation(chartInstance);
            }
        }

        function addHeartBeatAnimation(chartInstance, intensity) {
            // ÂøÉÁéáÂºÇÂ∏∏Êó∂ÁöÑÂä®ÁîªÊïàÊûú
            const animationDuration = intensity === 'fast' ? 800 : intensity === 'slow' ? 2000 : 1200;
            
            chartInstance.setOption({
                animation: true,
                animationDuration: animationDuration,
                animationEasing: 'elasticOut'
            });
            
            // Ê∑ªÂä†DOMÁ∫ßÂà´ÁöÑËÑâÂÜ≤ÊïàÊûú
            const chartDom = chartInstance.getDom();
            if (chartDom) {
                chartDom.style.animation = `heartbeat-${intensity} ${animationDuration}ms infinite`;
            }
        }

        function addFeverAnimation(chartInstance) {
            // ÂèëÁÉ≠Êó∂ÁöÑËßÜËßâË≠¶ÂëäÊïàÊûú
            const chartDom = chartInstance.getDom();
            if (chartDom) {
                chartDom.style.animation = 'fever-warning 1500ms infinite';
                chartDom.style.filter = 'drop-shadow(0 0 10px #ff4757)';
            }
        }

        function updateHealthStatus(type, value, minNormal, maxNormal) {
            const statusElement = document.getElementById(type + 'Status');
            const levelElement = document.getElementById(type + 'Level');
            
            let status = 'normal';
            let level = 'Ê≠£Â∏∏';
            
            if (value < minNormal || value > maxNormal) {
                status = 'warning';
                level = 'ÂºÇÂ∏∏';
                if (type === 'heartRate' && (value < 50 || value > 120)) {
                    status = 'critical';
                    level = 'Âç±Èô©';
                }
            }
            
            statusElement.className = 'health-status ' + status;
            if (levelElement) {
                levelElement.textContent = level;
            }
        }

        function updateTrendChart(historyData) {
            if (!historyData || !chartInstances.mainChart) {
                console.warn('‚ö†Ô∏è ÂõæË°®ÂÆû‰æãÊàñÂéÜÂè≤Êï∞ÊçÆ‰∏çÂèØÁî®');
                return;
            }
            
            const option = {
                series: [
                    {
                        data: historyData.heartRate || []
                    },
                    {
                        data: historyData.bloodOxygen || []
                    },
                    {
                        data: historyData.temperature || []
                    }
                ]
            };
            
            chartInstances.mainChart.setOption(option, true); // trueË°®Á§∫‰∏çÂêàÂπ∂ÔºåÂÆåÂÖ®ÊõøÊç¢Êï∞ÊçÆ
            console.log('üìä Ë∂ãÂäøÂõæË°®Â∑≤Êõ¥Êñ∞');
        }

        // ============= Ê∂àÊÅØÂíåÂëäË≠¶Âä†ËΩΩ =============
        function loadMessages() {
            // Ê∂àÊÅØÊï∞ÊçÆÁé∞Âú®ÈÄöËøá get_personal_info API Âä†ËΩΩÔºåÊó†ÈúÄÂçïÁã¨Ë∞ÉÁî®
            console.log('üí¨ Ê∂àÊÅØÊï∞ÊçÆÈÄöËøá‰∏ªAPIÂä†ËΩΩ');
        }
        
        function loadAlerts() {
            // ÂëäË≠¶Êï∞ÊçÆÁé∞Âú®ÈÄöËøá get_personal_info API Âä†ËΩΩÔºåÊó†ÈúÄÂçïÁã¨Ë∞ÉÁî®
            console.log('üö® ÂëäË≠¶Êï∞ÊçÆÈÄöËøá‰∏ªAPIÂä†ËΩΩ');
        }

        function loadDeviceStatus() {
            // ËÆæÂ§áÁä∂ÊÄÅÁé∞Âú®ÈÄöËøá get_personal_info API Âä†ËΩΩÔºåÊó†ÈúÄÂçïÁã¨Ë∞ÉÁî®
            console.log('üì± ËÆæÂ§áÁä∂ÊÄÅÈÄöËøá‰∏ªAPIÂä†ËΩΩ');
        }

        // ============= Êï∞ÊçÆÊòæÁ§∫Êõ¥Êñ∞ÂáΩÊï∞ =============
        function updateMessageDisplay(messages) {
            const messageList = document.getElementById('messageList');
            const messageCount = document.getElementById('messageCount');
            
            if (!messages || messages.length === 0) {
                if (messageCount) messageCount.textContent = '0';
                if (messageList) messageList.innerHTML = '<div class="message-item"><div class="message-content">ÊöÇÊó†Ê∂àÊÅØ</div></div>';
                return;
            }
            
            // Â§ÑÁêÜÁúüÂÆûAPIÊï∞ÊçÆÊ†ºÂºè - ‰øÆÊ≠£Â±ûÊÄßÂêçÂåπÈÖçAPIÁªìÊûÑ
            const processedMessages = messages.map(msg => ({
                type: msg.message_type || msg.type || 'warning',
                content: msg.message || msg.content || 'Á≥ªÁªüÊ∂àÊÅØ',
                time: msg.sent_time || new Date().toISOString(),
                status: msg.message_status == '1' ? 'unread' : 'read',
                deviceSn: msg.device_sn || '',
                userName: msg.user_name || '',
                department: msg.department_name || '',
                messageId: msg.message_id || ''
            }));
            
            // ÁªüËÆ°Êú™ËØªÊ∂àÊÅØÊï∞Èáè
            const unreadCount = processedMessages.filter(msg => msg.status === 'unread').length;
            if (messageCount) messageCount.textContent = unreadCount;
            
            if (messageList) {
                messageList.innerHTML = processedMessages.map(msg => {
                    const formattedTime = new Date(msg.time).toLocaleString('zh-CN', {
                        month: '2-digit',
                        day: '2-digit', 
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    
                    const typeInfo = {
                        'warning': { label: 'ÂëäË≠¶Ê∂àÊÅØ', icon: '‚ö†Ô∏è', class: 'msg-warning' },
                        'system': { label: 'Á≥ªÁªüÊ∂àÊÅØ', icon: 'üîî', class: 'msg-system' },
                        'info': { label: 'ÈÄöÁü•Ê∂àÊÅØ', icon: '‚ÑπÔ∏è', class: 'msg-info' }
                    };
                    
                    const msgType = typeInfo[msg.type] || typeInfo['system'];
                    
                    return `
                        <div class="message-item ${msg.status === 'unread' ? 'unread' : 'read'} ${msgType.class}">
                            <div class="message-header">
                                <div class="message-type-badge">
                                    <span class="type-icon">${msgType.icon}</span>
                                    <span class="type-label">${msgType.label}</span>
                                </div>
                                <div class="message-status ${msg.status}">
                                    ${msg.status === 'unread' ? 'Êú™ËØª' : 'Â∑≤ËØª'}
                                </div>
                            </div>
                            <div class="message-content">${msg.content}</div>
                            <div class="message-details">
                                ${msg.deviceSn ? `<span class="device-info">üì± ËÆæÂ§á: ${msg.deviceSn}</span>` : ''}
                                ${msg.userName ? `<span class="user-info">üë§ Áî®Êà∑: ${msg.userName}</span>` : ''}
                                ${msg.department ? `<span class="dept-info">üè¢ ÈÉ®Èó®: ${msg.department}</span>` : ''}
                            </div>
                            <div class="message-time">
                                <span class="time-icon">üïê</span>
                                <span class="time-text">${formattedTime}</span>
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            console.log('üí¨ Ê∂àÊÅØÊòæÁ§∫Â∑≤Êõ¥Êñ∞:', processedMessages.length, 'Êù°Ê∂àÊÅØ');
        }

        function updateAlertDisplay(alerts) {
            const alertList = document.getElementById('alertList');
            const alertCountEl = document.getElementById('alertCount');
            const alertTrendEl = document.getElementById('alertTrend');
            
            if (!alerts || alerts.length === 0) {
                if (alertList) alertList.innerHTML = '<div class="alert-item"><div class="alert-text">ÊöÇÊó†ÂëäË≠¶</div></div>';
                if (alertCountEl) alertCountEl.textContent = '0';
                if (alertTrendEl) alertTrendEl.textContent = '‰ªäÊó•Êó†Êñ∞Â¢ûÂëäË≠¶';
                return;
            }
            
            // Â§ÑÁêÜÁúüÂÆûAPIÊï∞ÊçÆÊ†ºÂºè - ‰øÆÊ≠£Â±ûÊÄßÂêçÂåπÈÖçAPIÁªìÊûÑ
            const processedAlerts = alerts.map(alert => ({
                level: alert.severity_level || alert.level || 'high',
                content: alert.alert_desc || alert.content || 'ÂÅ•Â∫∑ÂëäË≠¶',
                time: alert.alert_timestamp || new Date().toISOString(),
                status: alert.alert_status || 'pending',
                id: alert.alert_id,
                type: alert.alert_type || 'HEALTH_ALERT',
                deviceSn: alert.device_sn || '',
                userName: alert.user_name || '',
                orgName: alert.org_name || '',
                location: alert.latitude && alert.longitude ? `${alert.latitude},${alert.longitude}` : '',
                respondedTime: alert.responded_time
            }));
            
            // Êõ¥Êñ∞ÂëäË≠¶ÁªüËÆ°
            const pendingCount = processedAlerts.filter(alert => alert.status === 'pending').length;
            if (alertCountEl) alertCountEl.textContent = pendingCount;
            if (alertTrendEl) alertTrendEl.textContent = `‰ªäÊó•Êñ∞Â¢û ${alerts.length} Êù°`;
            
            if (alertList) {
                alertList.innerHTML = processedAlerts.slice(0, 10).map(alert => {
                    const formattedTime = new Date(alert.time).toLocaleString('zh-CN', {
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit', 
                        minute: '2-digit'
                    });
                    
                    const levelInfo = {
                        'critical': { label: '‰∏•Èáç', icon: 'üî•', class: 'alert-critical', color: '#ff4757' },
                        'high': { label: 'È´òÂç±', icon: 'üö®', class: 'alert-high', color: '#ff6b6b' },
                        'medium': { label: '‰∏≠Á≠â', icon: '‚ö†Ô∏è', class: 'alert-medium', color: '#ffa502' },
                        'low': { label: '‰ΩéÂç±', icon: '‚ÑπÔ∏è', class: 'alert-low', color: '#3742fa' },
                        'info': { label: '‰ø°ÊÅØ', icon: 'üí°', class: 'alert-info', color: '#2ed573' }
                    };
                    
                    const alertLevel = levelInfo[alert.level.toLowerCase()] || levelInfo['high'];
                    
                    const typeLabels = {
                        'WEAR_STATUS_CHANGED': '‰Ω©Êà¥Áä∂ÊÄÅÂèòÂåñ',
                        'HEART_RATE_ABNORMAL': 'ÂøÉÁéáÂºÇÂ∏∏',
                        'BLOOD_PRESSURE_HIGH': 'Ë°ÄÂéãÂÅèÈ´ò',
                        'BLOOD_OXYGEN_LOW': 'Ë°ÄÊ∞ßÂÅè‰Ωé',
                        'TEMPERATURE_ABNORMAL': '‰ΩìÊ∏©ÂºÇÂ∏∏',
                        'SOS_ALERT': 'SOSÂëäË≠¶',
                        'FALL_DETECTION': 'ÊëîÂÄíÊ£ÄÊµã'
                    };
                    
                    const typeLabel = typeLabels[alert.type] || alert.type;
                    const statusLabel = alert.status === 'pending' ? 'ÂæÖÂ§ÑÁêÜ' : alert.status === 'responded' ? 'Â∑≤Â§ÑÁêÜ' : 'Â∑≤Á°ÆËÆ§';
                    const statusClass = alert.status === 'pending' ? 'status-pending' : 'status-resolved';
                    
                    return `
                        <div class="alert-item ${alertLevel.class} ${statusClass}">
                            <div class="alert-header">
                                <div class="alert-level-badge" style="background-color: ${alertLevel.color}">
                                    <span class="level-icon">${alertLevel.icon}</span>
                                    <span class="level-text">${alertLevel.label}</span>
                                </div>
                                <div class="alert-status ${statusClass}">
                                    ${statusLabel}
                                </div>
                            </div>
                            <div class="alert-type">
                                <span class="type-icon">üìã</span>
                                <span class="type-text">${typeLabel}</span>
                            </div>
                            <div class="alert-description">${alert.content}</div>
                            <div class="alert-details">
                                <div class="detail-row">
                                    ${alert.deviceSn ? `<span class="device-info">üì± ${alert.deviceSn}</span>` : ''}
                                    ${alert.userName ? `<span class="user-info">üë§ ${alert.userName}</span>` : ''}
                                </div>
                                <div class="detail-row">
                                    ${alert.orgName ? `<span class="org-info">üè¢ ${alert.orgName}</span>` : ''}
                                    ${alert.location ? `<span class="location-info">üìç ‰ΩçÁΩÆ</span>` : ''}
                                </div>
                            </div>
                            <div class="alert-time">
                                <span class="time-icon">üïê</span>
                                <span class="time-text">${formattedTime}</span>
                                ${alert.respondedTime ? `<span class="responded-time">Â∑≤‰∫é${new Date(alert.respondedTime).toLocaleString('zh-CN')}Â§ÑÁêÜ</span>` : ''}
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            console.log('üö® ÂëäË≠¶ÊòæÁ§∫Â∑≤Êõ¥Êñ∞:', processedAlerts.length, 'Êù°ÂëäË≠¶');
        }

        function loadHistoryChart() {
            console.log('üìà Âä†ËΩΩÂéÜÂè≤Êï∞ÊçÆÂõæË°®...');
            
            fetch(`/api/personal/health_history?deviceSn=${deviceSn}&timeRange=${currentTimeRange}`)
                .then(response => response.json())
                .then(result => {
                    if (result.success) {
                        console.log('‚úÖ ÂéÜÂè≤Êï∞ÊçÆÂä†ËΩΩÊàêÂäü:', result.data.totalRecords, 'Êù°ËÆ∞ÂΩï');
                        updateTrendChart(result.data);
                    } else {
                        console.warn('‚ö†Ô∏è ÂéÜÂè≤Êï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•:', result.error);
                        // ‰ΩøÁî®Â§áÁî®Ê®°ÊãüÊï∞ÊçÆ
                        const now = new Date();
                        const historyData = [];
                        for (let i = 23; i >= 0; i--) {
                            const timestamp = new Date(now - i * 3600000);
                            historyData.push({
                                timestamp: timestamp,
                                heartRate: Math.floor(Math.random() * (90 - 60)) + 60,
                                bloodOxygen: Math.floor(Math.random() * (100 - 95)) + 95,
                                temperature: (Math.random() * (37.2 - 36.2) + 36.2).toFixed(1)
                            });
                        }
                        const formattedData = {
                            heartRate: historyData.map(d => [d.timestamp.toISOString(), d.heartRate]),
                            bloodOxygen: historyData.map(d => [d.timestamp.toISOString(), d.bloodOxygen]),
                            temperature: historyData.map(d => [d.timestamp.toISOString(), parseFloat(d.temperature)])
                        };
                        updateTrendChart(formattedData);
                    }
                })
                .catch(error => {
                    console.error('‚ùå ÂéÜÂè≤Êï∞ÊçÆAPIËØ∑Ê±ÇÂ§±Ë¥•:', error);
                    // ‰ΩøÁî®Â§áÁî®Ê®°ÊãüÊï∞ÊçÆ
                    const now = new Date();
                    const historyData = [];
                    for (let i = 23; i >= 0; i--) {
                        const timestamp = new Date(now - i * 3600000);
                        historyData.push({
                            timestamp: timestamp,
                            heartRate: Math.floor(Math.random() * (90 - 60)) + 60,
                            bloodOxygen: Math.floor(Math.random() * (100 - 95)) + 95,
                            temperature: (Math.random() * (37.2 - 36.2) + 36.2).toFixed(1)
                        });
                    }
                    const formattedData = {
                        heartRate: historyData.map(d => [d.timestamp.toISOString(), d.heartRate]),
                        bloodOxygen: historyData.map(d => [d.timestamp.toISOString(), d.bloodOxygen]),
                        temperature: historyData.map(d => [d.timestamp.toISOString(), parseFloat(d.temperature)])
                    };
                    updateTrendChart(formattedData);
                });
        }

        function initializeDeviceStatusDisplay() {
            // ÂàùÂßãÂåñËÆæÂ§áÁä∂ÊÄÅÊòæÁ§∫
            const statusText = document.getElementById('deviceStatusText');
            const statusIndicator = document.querySelector('.status-indicator');
            
            if (statusText) {
                statusText.textContent = deviceSn ? `ËÆæÂ§á ${deviceSn} ÂàùÂßãÂåñ‰∏≠...` : 'ËÆæÂ§áÂàùÂßãÂåñ‰∏≠...';
            }
            if (statusIndicator) {
                statusIndicator.style.background = '#ffaa00'; // ÂàùÂßãÂåñ‰∏∫ÈªÑËâ≤
            }
            
            console.log('üì± ËÆæÂ§áÁä∂ÊÄÅÊòæÁ§∫ÂàùÂßãÂåñÂÆåÊàê');
        }

        function updateDeviceStatus(deviceData) {
            if (!deviceData) {
                console.warn('‚ö†Ô∏è updateDeviceStatus: deviceData ÂèÇÊï∞‰∏∫Á©∫');
                return;
            }
            
            // Êõ¥Êñ∞ËÆæÂ§áÁä∂ÊÄÅÊòæÁ§∫
            const statusText = document.getElementById('deviceStatusText');
            const statusIndicator = document.querySelector('.status-indicator');
            
            if (statusText) {
                const statusDesc = deviceData.status === 'ACTIVE' ? 'Âú®Á∫ø' : 'Á¶ªÁ∫ø';
                statusText.textContent = deviceSn ? `ËÆæÂ§á ${deviceSn} ${statusDesc}` : `ËÆæÂ§á${statusDesc}`;
            }
            
            if (statusIndicator) {
                statusIndicator.style.background = deviceData.status === 'ACTIVE' ? '#00ff9d' : '#ff4757';
            }
            
            console.log('üì± ËÆæÂ§áÁä∂ÊÄÅÂ∑≤Êõ¥Êñ∞:', deviceData);
        }

        // WebSocket functionality removed for performance optimization

        // ============= Âç°ÁâáÂØºËà™ÂäüËÉΩ =============
        function createModalWindow(url, title, width, height) {
            const modalContainer = document.createElement('div');
            modalContainer.className = 'modal-container';
            modalContainer.innerHTML = `
                <div class="modal-content">
                    <button class="modal-close">‚úñ</button>
                    <iframe src="${url}" class="user-view-iframe"></iframe>
                </div>
            `;
            
            document.body.appendChild(modalContainer);
            
            // Ê∑ªÂä†Ê®°ÊÄÅÁ™óÂè£Ê†∑Âºè
            if (!document.getElementById('modalStyles')) {
                const style = document.createElement('style');
                style.id = 'modalStyles';
                style.textContent = `
                    .modal-container {
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        background: rgba(0, 0, 0, 0.8);
                        display: flex;
                        justify-content: center;
                        align-items: center;
                        z-index: 10000;
                    }
                    .modal-content {
                        width: ${width || '90%'};
                        height: ${height || '90%'};
                        background: #001529;
                        border-radius: 8px;
                        position: relative;
                        border: 1px solid #00e4ff;
                        box-shadow: 0 0 30px rgba(0, 228, 255, 0.3);
                    }
                    .modal-close {
                        position: absolute;
                        top: 10px;
                        right: 15px;
                        background: #ff4757;
                        color: white;
                        border: none;
                        border-radius: 4px;
                        padding: 5px 10px;
                        cursor: pointer;
                        z-index: 10001;
                        font-size: 14px;
                    }
                    .modal-close:hover {
                        background: #ff3742;
                    }
                    .user-view-iframe {
                        width: 100%;
                        height: 100%;
                        border: none;
                        border-radius: 8px;
                    }
                `;
                document.head.appendChild(style);
            }
            
            // ÂÖ≥Èó≠ÊåâÈíÆ‰∫ã‰ª∂
            modalContainer.querySelector('.modal-close').addEventListener('click', function() {
                document.body.removeChild(modalContainer);
            });
            
            // ÁÇπÂáªËÉåÊôØÂÖ≥Èó≠
            modalContainer.addEventListener('click', function(e) {
                if (e.target === modalContainer) {
                    document.body.removeChild(modalContainer);
                }
            });
        }

        // Ê∂àÊÅØÈÄöÁü•Èù¢ÊùøÁÇπÂáªË∑≥ËΩ¨ÂáΩÊï∞
        async function navigateToMessageView() {
            try {
                const deviceSn = "{{deviceSn}}"; // ‰ªéURLËé∑ÂèñdeviceSn
                if (!deviceSn) {
                    alert('Êó†Ê≥ïËé∑ÂèñËÆæÂ§á‰ø°ÊÅØ');
                    return;
                }
                
                // Ë∞ÉÁî®ÂêéÁ´ØAPIËé∑ÂèñorgIdÂíåuserId
                const response = await fetch(`/api/device/user_org?deviceSn=${deviceSn}`);
                const data = await response.json();
                
                if (data.success && data.orgId) {
                    createModalWindow(`/message_view.html?customerId=${data.orgId}&userId=${data.userId}`, 'Ê∂àÊÅØÁÆ°ÁêÜ', '90%', '90%');
                } else {
                    alert('Êó†Ê≥ïËé∑ÂèñÁî®Êà∑ÁªÑÁªá‰ø°ÊÅØ');
                }
            } catch (error) {
                console.error('Ë∑≥ËΩ¨Â§±Ë¥•:', error);
                alert('Ë∑≥ËΩ¨Â§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï');
            }
        }

        // ÂëäË≠¶Èù¢ÊùøÁÇπÂáªË∑≥ËΩ¨ÂáΩÊï∞
        async function navigateToAlertView() {
            try {
                const deviceSn = "{{deviceSn}}"; // ‰ªéURLËé∑ÂèñdeviceSn
                if (!deviceSn) {
                    alert('Êó†Ê≥ïËé∑ÂèñËÆæÂ§á‰ø°ÊÅØ');
                    return;
                }
                
                // Ë∞ÉÁî®ÂêéÁ´ØAPIËé∑ÂèñorgIdÂíåuserId
                const response = await fetch(`/api/device/user_org?deviceSn=${deviceSn}`);
                const data = await response.json();
                
                if (data.success && data.orgId) {
                    createModalWindow(`/alert_view.html?customerId=${data.orgId}&userId=${data.userId}`, 'ÂëäË≠¶ÁÆ°ÁêÜ', '90%', '90%');
                } else {
                    alert('Êó†Ê≥ïËé∑ÂèñÁªÑÁªá‰ø°ÊÅØ');
                }
            } catch (error) {
                console.error('Ë∑≥ËΩ¨Â§±Ë¥•:', error);
                alert('Ë∑≥ËΩ¨Â§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï');
            }
        }

        // ËÆæÂ§áÁä∂ÊÄÅÈù¢ÊùøÁÇπÂáªË∑≥ËΩ¨ÂáΩÊï∞
        async function navigateToDeviceView() {
            try {
                const deviceSn = "{{deviceSn}}"; // ‰ªéURLËé∑ÂèñdeviceSn
                if (!deviceSn) {
                    alert('Êó†Ê≥ïËé∑ÂèñËÆæÂ§á‰ø°ÊÅØ');
                    return;
                }
                
                // Ë∞ÉÁî®ÂêéÁ´ØAPIËé∑ÂèñorgIdÂíåuserId
                const response = await fetch(`/api/device/user_org?deviceSn=${deviceSn}`);
                const data = await response.json();
                
                if (data.success && data.orgId) {
                    createModalWindow(`/device_view.html?customerId=${data.orgId}&userId=${data.userId}`, 'ËÆæÂ§áÁÆ°ÁêÜ', '90%', '90%');
                } else {
                    alert('Êó†Ê≥ïËé∑ÂèñÁªÑÁªá‰ø°ÊÅØ');
                }
            } catch (error) {
                console.error('Ë∑≥ËΩ¨Â§±Ë¥•:', error);
                alert('Ë∑≥ËΩ¨Â§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï');
            }
        }

        // ============= ‰∏™ÊÄßÂåñÂäüËÉΩ ============= 
        function switchTheme(themeName) {
            console.log('üé® ÂàáÊç¢‰∏ªÈ¢ò:', themeName);
            
            // ÁßªÈô§ÊâÄÊúâ‰∏ªÈ¢òÁ±ª
            document.body.classList.remove('theme-deep-blue', 'theme-purple', 'theme-eco-green', 'theme-warm-orange');
            
            // Ê∑ªÂä†Êñ∞‰∏ªÈ¢òÁ±ª
            if (themeName !== 'default') {
                document.body.classList.add(`theme-${themeName}`);
            }
            
            // ‰øùÂ≠ò‰∏ªÈ¢òÂÅèÂ•ΩÂà∞localStorage
            localStorage.setItem('personalTheme', themeName);
            
            // ÈáçÊñ∞Âä†ËΩΩÂõæË°®‰ª•Êõ¥Êñ∞È¢úËâ≤
            updateChartsTheme();
        }

        function switchLayout(layoutType) {
            console.log('üìä ÂàáÊç¢Â∏ÉÂ±Ä:', layoutType);
            
            // ÁßªÈô§ÊâÄÊúâÂ∏ÉÂ±ÄÁ±ª
            document.body.classList.remove('layout-compact', 'layout-expanded');
            
            // Ê∑ªÂä†Êñ∞Â∏ÉÂ±ÄÁ±ª
            if (layoutType !== 'standard') {
                document.body.classList.add(`layout-${layoutType}`);
            }
            
            // ‰øùÂ≠òÂ∏ÉÂ±ÄÂÅèÂ•ΩÂà∞localStorage
            localStorage.setItem('personalLayout', layoutType);
            
            // ÈáçÊñ∞Ë∞ÉÊï¥ÂõæË°®Â∞∫ÂØ∏
            setTimeout(() => {
                Object.values(chartInstances).forEach(chart => {
                    if (chart && typeof chart.resize === 'function') {
                        chart.resize();
                    }
                });
            }, 300);
        }

        function toggleSettings() {
            console.log('‚öôÔ∏è ÂàáÊç¢ËÆæÁΩÆÈù¢Êùø');
            // ËøôÈáåÂèØ‰ª•Ê∑ªÂä†È´òÁ∫ßËÆæÁΩÆÈù¢ÊùøÁöÑÊòæÁ§∫/ÈöêËóèÂäüËÉΩ
            alert('È´òÁ∫ßËÆæÁΩÆÂäüËÉΩÂºÄÂèë‰∏≠...');
        }

        function updateChartsTheme() {
            // Ëé∑ÂèñÂΩìÂâç‰∏ªÈ¢òÈ¢úËâ≤
            const rootStyles = getComputedStyle(document.documentElement);
            const primaryColor = rootStyles.getPropertyValue('--primary-color').trim();
            const secondaryColor = rootStyles.getPropertyValue('--secondary-color').trim();
            const accentColor = rootStyles.getPropertyValue('--accent-color').trim();
            
            console.log('üìä Êõ¥Êñ∞ÂõæË°®‰∏ªÈ¢òÈ¢úËâ≤:', { primaryColor, secondaryColor, accentColor });
            
            // Êõ¥Êñ∞‰ª™Ë°®ÁõòÈ¢úËâ≤
            Object.entries(chartInstances).forEach(([key, chart]) => {
                if (chart && key.includes('Gauge')) {
                    let gaugeColor = primaryColor;
                    if (key === 'heartRateGauge') gaugeColor = accentColor;
                    else if (key === 'bloodOxygenGauge') gaugeColor = secondaryColor;
                    
                    chart.setOption({
                        series: [{
                            itemStyle: {
                                color: gaugeColor,
                                shadowColor: `${gaugeColor}66`,
                                shadowBlur: 10
                            },
                            progress: {
                                itemStyle: {
                                    color: {
                                        type: 'linear',
                                        x: 0, y: 0, x2: 1, y2: 0,
                                        colorStops: [
                                            { offset: 0, color: gaugeColor + '22' },
                                            { offset: 1, color: gaugeColor }
                                        ]
                                    }
                                }
                            },
                            axisLine: {
                                lineStyle: {
                                    color: [[1, `${gaugeColor}22`]]
                                }
                            }
                        }]
                    });
                }
            });
            
            // Êõ¥Êñ∞‰∏ªË∂ãÂäøÂõæÈ¢úËâ≤
            if (chartInstances.mainChart) {
                chartInstances.mainChart.setOption({
                    series: [
                        {
                            lineStyle: { color: accentColor },
                            itemStyle: { color: accentColor }
                        },
                        {
                            lineStyle: { color: secondaryColor },
                            itemStyle: { color: secondaryColor }
                        },
                        {
                            lineStyle: { color: primaryColor },
                            itemStyle: { color: primaryColor }
                        }
                    ]
                });
            }
        }

        function loadPersonalizationSettings() {
            // Âä†ËΩΩ‰øùÂ≠òÁöÑ‰∏ªÈ¢òËÆæÁΩÆ
            const savedTheme = localStorage.getItem('personalTheme') || 'default';
            const themeSelect = document.getElementById('themeSelect');
            if (themeSelect) {
                themeSelect.value = savedTheme;
                switchTheme(savedTheme);
            }
            
            // Âä†ËΩΩ‰øùÂ≠òÁöÑÂ∏ÉÂ±ÄËÆæÁΩÆ
            const savedLayout = localStorage.getItem('personalLayout') || 'standard';
            const layoutSelect = document.getElementById('layoutSelect');
            if (layoutSelect) {
                layoutSelect.value = savedLayout;
                switchLayout(savedLayout);
            }
            
            console.log('‚öôÔ∏è Âä†ËΩΩ‰∏™ÊÄßÂåñËÆæÁΩÆ:', { theme: savedTheme, layout: savedLayout });
        }

        // ============= ‰∫§‰∫íÂáΩÊï∞ =============
        function switchTimeRange(range) {
            currentTimeRange = range;
            
            // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
            document.querySelectorAll('.control-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            console.log('üìà ÂàáÊç¢Êó∂Èó¥ËåÉÂõ¥:', range);
            // ÈáçÊñ∞Âä†ËΩΩÂØπÂ∫îÊó∂Èó¥ËåÉÂõ¥ÁöÑÂéÜÂè≤Êï∞ÊçÆ
            loadHistoryChart();
        }

        function showAlertDetails() {
            console.log('üö® ÊòæÁ§∫ÂëäË≠¶ËØ¶ÊÉÖ');
            
            // Ëé∑ÂèñËØ¶ÁªÜÁöÑÂëäË≠¶‰ø°ÊÅØ
            fetch(`/api/personal/alerts?deviceSn=${deviceSn}`)
                .then(response => response.json())
                .then(result => {
                    if (result.success) {
                        showAlertModal(result.data.alerts);
                    } else {
                        console.error('Ëé∑ÂèñÂëäË≠¶ËØ¶ÊÉÖÂ§±Ë¥•:', result.error);
                        showAlertModal([]); // ÊòæÁ§∫Á©∫ÂëäË≠¶ÂàóË°®
                    }
                })
                .catch(error => {
                    console.error('ÂëäË≠¶ËØ¶ÊÉÖAPIËØ∑Ê±ÇÂ§±Ë¥•:', error);
                    showAlertModal([]); // ÊòæÁ§∫Á©∫ÂëäË≠¶ÂàóË°®
                });
        }

        function showAlertModal(alerts) {
            const modalHTML = `
                <div class="alert-modal" id="alertModal">
                    <div class="alert-modal-content">
                        <div class="alert-modal-header">
                            <h3>üö® ÂÅ•Â∫∑ÂëäË≠¶ËØ¶ÊÉÖ</h3>
                            <button class="modal-close-btn" onclick="closeAlertModal()">‚úï</button>
                        </div>
                        <div class="alert-modal-body">
                            ${alerts.length === 0 ? 
                                '<div class="no-alerts">üéâ Â§™Ê£í‰∫ÜÔºÅÁõÆÂâçÊ≤°Êúâ‰ªª‰ΩïÂëäË≠¶„ÄÇ</div>' : 
                                alerts.map(alert => `
                                    <div class="alert-detail-item alert-${alert.level}" data-alert-id="${alert.id}">
                                        <div class="alert-detail-header">
                                            <span class="alert-level-badge ${alert.level}">
                                                ${alert.level === 'critical' ? 'üî¥ ‰∏•Èáç' : 
                                                  alert.level === 'warning' ? '‚ö†Ô∏è Ë≠¶Âëä' : 
                                                  alert.level === 'info' ? '‚ÑπÔ∏è ‰ø°ÊÅØ' : 'üîµ ÈÄöÁü•'}
                                            </span>
                                            <span class="alert-time">${alert.time}</span>
                                        </div>
                                        <div class="alert-content">${alert.content}</div>
                                        <div class="alert-actions">
                                            <button class="alert-action-btn primary" onclick="handleAlert('${alert.id}', 'acknowledge')">
                                                ‚úì Á°ÆËÆ§
                                            </button>
                                            <button class="alert-action-btn secondary" onclick="handleAlert('${alert.id}', 'dismiss')">
                                                ‚úï ÂÖ≥Èó≠
                                            </button>
                                            ${alert.level === 'critical' ? 
                                                `<button class="alert-action-btn danger" onclick="handleAlert('${alert.id}', 'emergency')">
                                                    üÜò Á¥ßÊÄ•Â§ÑÁêÜ
                                                </button>` : ''}
                                        </div>
                                    </div>
                                `).join('')}
                        </div>
                        <div class="alert-modal-footer">
                            <button class="modal-btn secondary" onclick="closeAlertModal()">ÂÖ≥Èó≠</button>
                            <button class="modal-btn primary" onclick="markAllAlertsRead()">ÂÖ®ÈÉ®Ê†áËÆ∞‰∏∫Â∑≤ËØª</button>
                        </div>
                    </div>
                </div>
            `;
            
            // Ê∑ªÂä†Ê®°ÊÄÅÊ°ÜÂà∞È°µÈù¢
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            
            // ÊòæÁ§∫Âä®Áîª
            setTimeout(() => {
                document.getElementById('alertModal').classList.add('show');
            }, 10);
        }

        function closeAlertModal() {
            const modal = document.getElementById('alertModal');
            if (modal) {
                modal.classList.remove('show');
                setTimeout(() => {
                    modal.remove();
                }, 300);
            }
        }

        function handleAlert(alertId, action) {
            console.log(`üõ†Ô∏è Â§ÑÁêÜÂëäË≠¶ ${alertId}: ${action}`);
            
            // ËøôÈáåÂèØ‰ª•ÂèëÈÄÅAPIËØ∑Ê±ÇÊù•Â§ÑÁêÜÂëäË≠¶
            const actionMessages = {
                acknowledge: 'ÂëäË≠¶Â∑≤Á°ÆËÆ§',
                dismiss: 'ÂëäË≠¶Â∑≤ÂÖ≥Èó≠',
                emergency: 'Â∑≤ÂêØÂä®Á¥ßÊÄ•Â§ÑÁêÜÊµÅÁ®ã'
            };
            
            // Êõ¥Êñ∞UIÊòæÁ§∫
            const alertElement = document.querySelector(`[data-alert-id="${alertId}"]`);
            if (alertElement) {
                alertElement.style.opacity = '0.5';
                alertElement.querySelector('.alert-content').innerHTML += 
                    `<div class="alert-status">‚úì ${actionMessages[action]}</div>`;
            }
            
            // ÊòæÁ§∫ÊàêÂäüÊ∂àÊÅØ
            showToast(actionMessages[action], 'success');
            
            // Âú®ÁúüÂÆûÂÆûÁé∞‰∏≠ÔºåËøôÈáåÂ∫îËØ•ÂèëÈÄÅAPIËØ∑Ê±Ç
            // fetch(`/api/alerts/${alertId}/handle`, {
            //     method: 'POST',
            //     headers: { 'Content-Type': 'application/json' },
            //     body: JSON.stringify({ action: action })
            // });
        }

        function markAllAlertsRead() {
            console.log('üìù Ê†áËÆ∞ÊâÄÊúâÂëäË≠¶‰∏∫Â∑≤ËØª');
            
            // Êõ¥Êñ∞ÊâÄÊúâÂëäË≠¶È°πÁöÑÊòæÁ§∫Áä∂ÊÄÅ
            document.querySelectorAll('.alert-detail-item').forEach(item => {
                item.style.opacity = '0.5';
                const content = item.querySelector('.alert-content');
                if (!content.querySelector('.alert-status')) {
                    content.innerHTML += '<div class="alert-status">‚úì Â∑≤ËØª</div>';
                }
            });
            
            showToast('ÊâÄÊúâÂëäË≠¶Â∑≤Ê†áËÆ∞‰∏∫Â∑≤ËØª', 'success');
            
            // Âª∂ËøüÂÖ≥Èó≠Ê®°ÊÄÅÊ°Ü
            setTimeout(() => {
                closeAlertModal();
                // Âà∑Êñ∞ÂëäË≠¶ÂàóË°®
                loadAlerts();
            }, 1500);
        }

        function showToast(message, type = 'info') {
            const toastHTML = `
                <div class="toast toast-${type}" id="toast">
                    <div class="toast-content">
                        <span class="toast-icon">
                            ${type === 'success' ? '‚úì' : 
                              type === 'error' ? '‚úï' : 
                              type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è'}
                        </span>
                        <span class="toast-message">${message}</span>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', toastHTML);
            
            const toast = document.getElementById('toast');
            setTimeout(() => toast.classList.add('show'), 10);
            
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // ============= Â∑•ÂÖ∑ÂáΩÊï∞ =============
        function formatTime(timestamp) {
            return new Date(timestamp).toLocaleTimeString();
        }

        function formatNumber(num) {
            return num.toLocaleString();
        }

        // ============= ÂìçÂ∫îÂºèÂ§ÑÁêÜ =============
        let currentBreakpoint = 'desktop';
        
        function detectBreakpoint() {
            const width = window.innerWidth;
            let newBreakpoint;
            
            if (width <= 360) {
                newBreakpoint = 'xs';
            } else if (width <= 599) {
                newBreakpoint = 'mobile';
            } else if (width <= 767) {
                newBreakpoint = 'tablet';
            } else if (width <= 1199) {
                newBreakpoint = 'laptop';
            } else {
                newBreakpoint = 'desktop';
            }
            
            if (newBreakpoint !== currentBreakpoint) {
                console.log('üì± Â±èÂπïÂ∞∫ÂØ∏ÂèòÂåñ:', currentBreakpoint, '->', newBreakpoint);
                currentBreakpoint = newBreakpoint;
                handleBreakpointChange(newBreakpoint);
            }
        }
        
        function handleBreakpointChange(breakpoint) {
            const body = document.body;
            const mainContent = document.querySelector('.main-grid');
            
            // ÁßªÈô§ÊâÄÊúâÊñ≠ÁÇπÁõ∏ÂÖ≥ÁöÑÁ±ª
            body.classList.remove('breakpoint-xs', 'breakpoint-mobile', 'breakpoint-tablet', 'breakpoint-laptop', 'breakpoint-desktop');
            body.classList.add(`breakpoint-${breakpoint}`);
            
            // ÁßªÂä®Á´ØÁâπÊÆäÂ§ÑÁêÜ
            if (breakpoint === 'mobile' || breakpoint === 'xs') {
                reorganizeMobileLayout();
            } else {
                restoreDesktopLayout();
            }
            
            // Âª∂ËøüÈáçÊñ∞Ë∞ÉÊï¥ÂõæË°®Â∞∫ÂØ∏
            setTimeout(() => {
                Object.values(chartInstances).forEach(chart => {
                    if (chart && typeof chart.resize === 'function') {
                        chart.resize();
                    }
                });
            }, 100);
        }
        
        function reorganizeMobileLayout() {
            console.log('üì± ÈáçÁªÑÁßªÂä®Á´ØÂ∏ÉÂ±Ä');
            
            const leftPanel = document.querySelector('.left-panel');
            const centerPanel = document.querySelector('.center-panel');
            const rightPanel = document.querySelector('.right-panel');
            const mainGrid = document.querySelector('.main-grid');
            
            if (!leftPanel || !centerPanel || !rightPanel) return;
            
            // ÂàõÂª∫ÁßªÂä®ÁâàÂ∏ÉÂ±ÄÂÆπÂô®
            if (!document.querySelector('.mobile-layout')) {
                const mobileLayout = document.createElement('div');
                mobileLayout.className = 'mobile-layout';
                
                // ÂÅ•Â∫∑ÊåáÊ†áË°å
                const healthRow = document.createElement('div');
                healthRow.className = 'health-metrics-row';
                
                // ÁßªÂä®ÂÅ•Â∫∑Âç°ÁâáÂà∞Ê®™ÂêëÂ∏ÉÂ±Ä
                const healthCards = leftPanel.querySelectorAll('.health-card');
                healthCards.forEach(card => {
                    healthRow.appendChild(card.cloneNode(true));
                });
                
                // Ê∂àÊÅØÂëäË≠¶Ë°å
                const messageAlertRow = document.createElement('div');
                messageAlertRow.className = 'message-alert-row';
                
                const rightPanels = rightPanel.querySelectorAll('.message-panel, .alert-panel');
                rightPanels.forEach(panel => {
                    messageAlertRow.appendChild(panel.cloneNode(true));
                });
                
                // ÁªÑË£ÖÁßªÂä®ÁâàÂ∏ÉÂ±Ä
                mobileLayout.appendChild(healthRow);
                mobileLayout.appendChild(centerPanel.cloneNode(true));
                mobileLayout.appendChild(messageAlertRow);
                
                // ÊõøÊç¢ÂéüÊúâÂ∏ÉÂ±Ä
                leftPanel.style.display = 'none';
                centerPanel.style.display = 'none';
                rightPanel.style.display = 'none';
                
                mainGrid.appendChild(mobileLayout);
                
                // ÈáçÊñ∞ÁªëÂÆö‰∫ã‰ª∂ÁõëÂê¨Âô®
                bindMobileEventListeners();
            }
        }
        
        function restoreDesktopLayout() {
            console.log('üñ•Ô∏è ÊÅ¢Â§çÊ°åÈù¢Á´ØÂ∏ÉÂ±Ä');
            
            const mobileLayout = document.querySelector('.mobile-layout');
            if (mobileLayout) {
                mobileLayout.remove();
            }
            
            // ÊÅ¢Â§çÂéüÊúâÈù¢ÊùøÊòæÁ§∫
            const leftPanel = document.querySelector('.left-panel');
            const centerPanel = document.querySelector('.center-panel');
            const rightPanel = document.querySelector('.right-panel');
            
            if (leftPanel) leftPanel.style.display = 'flex';
            if (centerPanel) centerPanel.style.display = 'flex';
            if (rightPanel) rightPanel.style.display = 'flex';
        }
        
        function bindMobileEventListeners() {
            // ‰∏∫ÁßªÂä®ÁâàÂ∏ÉÂ±Ä‰∏≠ÁöÑÂÖÉÁ¥†ÈáçÊñ∞ÁªëÂÆö‰∫ã‰ª∂
            const mobileAlertPanel = document.querySelector('.mobile-layout .alert-panel');
            if (mobileAlertPanel) {
                mobileAlertPanel.addEventListener('click', showAlertDetails);
            }
        }
        
        // ÁõëÂê¨Á™óÂè£Â∞∫ÂØ∏ÂèòÂåñ
        window.addEventListener('resize', function() {
            detectBreakpoint();
        });
        
        // ÁõëÂê¨ËÆæÂ§áÊñπÂêëÂèòÂåñ
        window.addEventListener('orientationchange', function() {
            setTimeout(() => {
                detectBreakpoint();
            }, 100);
        });
        
        // ÂàùÂßãÂåñÊó∂Ê£ÄÊµãÊñ≠ÁÇπ
        function initializeResponsive() {
            detectBreakpoint();
        }

        // ============= ÈîôËØØÂ§ÑÁêÜ =============
        window.addEventListener('error', function(event) {
            console.error('‚ö†Ô∏è È°µÈù¢ÈîôËØØ:', event.error);
        });

    </script>

    <!-- Â§ñÈÉ®JSÊñá‰ª∂ÂºïÁî® -->
    <script src="/static/js/performance.js" defer></script>
    <script src="/static/js/personal.js" defer></script>
    
    <!-- È°µÈù¢ÂàùÂßãÂåñËÑöÊú¨ -->
    <script>
        // È°µÈù¢ÁâπÂÆöÈÖçÁΩÆ
        const PAGE_CONFIG = {
            deviceSn: '{{ device_sn or "" }}',
            orgId: '{{ org_id or "" }}', 
            userId: '{{ user_id or "" }}',
            apiEndpoint: '/api',
            socketNamespace: '/personal',
            // ÊÄßËÉΩÈÖçÁΩÆ
            updateInterval: 8000,
            chartUpdateInterval: 2000,
            cacheEnabled: true
        };
        
        console.log('üöÄ ‰∏™‰∫∫ÂÅ•Â∫∑Â§ßÂ±èÈ°µÈù¢Âä†ËΩΩÂÆåÊàê');
    </script>
</body>
</html>