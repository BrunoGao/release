<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>个人健康大屏</title>
<link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/element-ui/2.15.14/theme-chalk/index.min.css">
<script src="https://cdn.bootcdn.net/ajax/libs/vue/2.7.14/vue.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/element-ui/2.15.14/index.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/axios/1.6.8/axios.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/echarts/5.4.3/echarts.min.js"></script>
<style>
body{background:#181c24;color:#fff;font-family:PingFang SC,Arial,sans-serif;margin:0;}
#app{padding:24px;}
.flex{display:flex;gap:24px;}
.card{background:#232a36;border-radius:12px;padding:24px;margin-bottom:24px;box-shadow:0 2px 8px #0002;}
.big{font-size:2.2em;font-weight:700;}
.mid{font-size:1.2em;}
.stat{display:flex;gap:16px;align-items:center;}
.stat .num{font-size:2em;font-weight:700;}
.stat .desc{font-size:1em;opacity:.7;}
.echart{width:100%;height:320px;}
.table{width:100%;margin-top:12px;}
.tag{padding:2px 8px;border-radius:6px;font-size:.9em;}
.critical{background:#e74c3c;color:#fff;}.medium{background:#f39c12;color:#fff;}.normal{background:#27ae60;color:#fff;}
.loading{color:#aaa;text-align:center;padding:40px;}
.nodata{color:#888;text-align:center;padding:40px;}
.avatar{width:80px;height:80px;border-radius:50%;border:3px solid #fff;margin-right:24px;}
</style>
</head>
<body>
<div id="app">
  <div class="card flex" style="align-items:center;">
    <img :src="user.avatar" class="avatar" v-if="user.avatar">
    <div>
      <div class="big">{[[user.user_name||'-']]} <span class="mid">({[[user.dept_name||'-']]})</span></div>
      <div class="mid">手机号: {[[user.phone_number||'-']]}  设备号: {[[user.device_sn||'-']]} 佩戴: <span :class="user.wearable_status=='WORN'?'normal':'critical'">{[[user.wearable_status=='WORN'?'已佩戴':'未佩戴']]}</span> 状态: <span :class="user.device_status=='ACTIVE'?'normal':'critical'">{[[user.device_status=='ACTIVE'?'在线':'离线']]}</span></div>
    </div>
    <div style="flex:1"></div>
    <div class="stat">
      <div><div class="num">{[[device.battery_level||'-']]}%</div><div class="desc">电量</div></div>
      <div><div class="num">{[[device.system_software_version||'-']]}</div><div class="desc">系统版本</div></div>
      <div><div class="num">{[[device.charging_status=='NOT_CHARGING'?'未充电':'充电中']]}</div><div class="desc">充电状态</div></div>
    </div>
  </div>
  <div class="flex">
    <div style="flex:2">
      <div class="card">
        <div class="mid">实时健康数据</div>
        <div class="stat">
          <div v-for="(v,k) in health" :key="k" style="min-width:90px"><div class="num">{[[v]]}</div><div class="desc">{[[healthMap[k]||k]]}</div></div>
        </div>
      </div>
      <div class="card">
        <div class="mid">健康历史趋势 <el-button size="mini" @click="exportChart">导出</el-button> <el-button size="mini" @click="fullscreen">全屏</el-button></div>
        <div id="trend" class="echart"></div>
        <div v-if="loadingHealth" class="loading">加载中...</div>
        <div v-if="!loadingHealth&&!trendData.length" class="nodata">暂无数据</div>
      </div>
    </div>
    <div style="flex:1">
      <div class="card">
        <div class="mid">告警统计</div>
        <div class="stat">
          <div><div class="num critical">{[[alertStat.critical||0]]}</div><div class="desc">严重</div></div>
          <div><div class="num medium">{[[alertStat.medium||0]]}</div><div class="desc">中等</div></div>
        </div>
        <div class="mid">类型分布</div>
        <div class="stat" style="flex-wrap:wrap">
          <div v-for="(v,k) in alertType" :key="k" class="tag medium">{[[alertTypeMap[k]||k]]}:{[[v]]}</div>
        </div>
      </div>
      <div class="card">
        <div class="mid">告警列表</div>
        <el-table :data="alerts" class="table" size="mini" style="background:#232a36" :header-cell-style="{background:'#232a36',color:'#fff'}">
          <el-table-column prop="alert_timestamp" label="时间" width="120"></el-table-column>
          <el-table-column prop="alert_type" label="类型" width="80">
            <template slot-scope="s"><span class="tag" :class="s.row.severity_level">{[[alertTypeMap[s.row.alert_type]||s.row.alert_type]]}</span></template>
          </el-table-column>
          <el-table-column prop="alert_desc" label="描述"></el-table-column>
          <el-table-column prop="severity_level" label="级别" width="80">
            <template slot-scope="s"><span class="tag" :class="s.row.severity_level">{[[s.row.severity_level]]}</span></template>
          </el-table-column>
        </el-table>
        <div v-if="!alerts.length" class="nodata">暂无告警</div>
      </div>
    </div>
  </div>
  <div class="card">
    <div class="mid">消息列表</div>
    <el-table :data="messages" class="table" size="mini" style="background:#232a36" :header-cell-style="{background:'#232a36',color:'#fff'}">
      <el-table-column prop="sent_time" label="时间" width="120"></el-table-column>
      <el-table-column prop="message_type" label="类型" width="80"></el-table-column>
      <el-table-column prop="message" label="内容"></el-table-column>
      <el-table-column prop="user_name" label="发送人" width="100"></el-table-column>
    </el-table>
    <div v-if="!messages.length" class="nodata">暂无消息</div>
  </div>
</div>
<script>
const healthMap={heart_rate:'心率',blood_oxygen:'血氧',pressure_high:'高压',pressure_low:'低压',temperature:'体温',stress:'压力',step:'步数',distance:'距离',calorie:'卡路里'} // 体征映射#
const alertTypeMap={blood_oxygen:'血氧',blood_pressure:'血压',heart_rate:'心率',stress:'压力',temperature:'体温'} // 告警类型映射#
new Vue({el:'#app',delimiters:['{[[',']]}'],data:{user:{},device:{},health:{},trendData:[],loadingHealth:true,alerts:[],alertStat:{},alertType:{},messages:[]},mounted(){
  const sn=new URLSearchParams(location.search).get('deviceSn')
  axios.get(`/get_personal_info?deviceSn=${sn}`).then(r=>{const d=r.data.data||{};const u=(d.user_info?.data?.users||[])[0]||{};this.user=u;this.device=(d.device_info?.data?.devices||[])[0]||{};const h=d.health_data?.data||{};this.health={heart_rate:h.heartRate||'-',blood_oxygen:h.bloodOxygen||'-',pressure_high:h.pressureHigh||'-',pressure_low:h.pressureLow||'-',temperature:h.temperature||'-',stress:h.stress||'-',step:h.step||'-',distance:h.distance||'-',calorie:h.calorie||'-'};this.trendData=h.trend||[];this.loadingHealth=false;const a=d.alert_info?.data||{};this.alerts=a.alerts||[];this.alertStat=a.alertLevelCount||{};this.alertType=a.alertTypeCount||{};const m=d.message_info?.data||{};this.messages=m.messages||[];this.$nextTick(this.drawTrend)})
},methods:{drawTrend(){if(!this.trendData.length)return;const e=echarts.init(document.getElementById('trend'));e.setOption({tooltip:{},legend:{data:Object.keys(this.trendData[0]||{}).filter(k=>k!=='time')},xAxis:{type:'category',data:this.trendData.map(d=>d.time)},yAxis:{type:'value'},series:Object.keys(this.trendData[0]||{}).filter(k=>k!=='time').map(k=>({name:healthMap[k]||k,type:'line',data:this.trendData.map(d=>d[k])}))})},exportChart(){const e=echarts.getInstanceByDom(document.getElementById('trend'));e&&e.getDataURL&&window.open(e.getDataURL({type:'png'}))},fullscreen(){const el=document.getElementById('trend');if(el.requestFullscreen)el.requestFullscreen();else if(el.webkitRequestFullScreen)el.webkitRequestFullScreen();}}
})
</script>
</body>
</html> 