# LJWX æ•°æ®åº“å¤‡ä»½å’Œæ¢å¤å®Œæ•´æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

LJWXç³»ç»Ÿæä¾›äº†å®Œæ•´çš„MySQLæ•°æ®åº“å¤‡ä»½å’Œæ¢å¤è§£å†³æ–¹æ¡ˆï¼Œæ”¯æŒï¼š
- **SQLé€»è¾‘å¤‡ä»½**ï¼šç”¨äºæ•°æ®æ¢å¤å’Œè·¨å¹³å°è¿ç§»
- **æ•°æ®å·å¤‡ä»½**ï¼šç”¨äºå®Œæ•´çš„æ•°æ®åº“æ–‡ä»¶å¤‡ä»½
- **è‡ªåŠ¨åŒ–å¤‡ä»½**ï¼šæ”¯æŒå®šæ—¶ä»»åŠ¡å’Œç­–ç•¥ç®¡ç†
- **ä¸€é”®æ¢å¤**ï¼šç®€åŒ–çš„æ¢å¤æ“ä½œæµç¨‹

## ğŸ¯ å¤‡ä»½ç­–ç•¥

### 1. åŒé‡å¤‡ä»½ä¿æŠ¤
```
ğŸ“¦ SQLé€»è¾‘å¤‡ä»½ï¼ˆæ¨èï¼‰
â”œâ”€â”€ ä¼˜ç‚¹ï¼šè·¨å¹³å°å…¼å®¹ã€æ•°æ®å®Œæ•´æ€§é«˜ã€æ¢å¤çµæ´»
â”œâ”€â”€ ç¼ºç‚¹ï¼šå¤‡ä»½æ—¶é—´è¾ƒé•¿ã€éœ€è¦MySQLæœåŠ¡è¿è¡Œ
â””â”€â”€ é€‚ç”¨ï¼šæ—¥å¸¸å¤‡ä»½ã€æ•°æ®è¿ç§»ã€ç‰ˆæœ¬å‡çº§

ğŸ—ƒï¸ æ•°æ®å·å¤‡ä»½
â”œâ”€â”€ ä¼˜ç‚¹ï¼šå¤‡ä»½é€Ÿåº¦å¿«ã€å®Œæ•´æ€§å¥½ã€æ”¯æŒå†·å¤‡ä»½
â”œâ”€â”€ ç¼ºç‚¹ï¼šå¹³å°ç›¸å…³ã€æ¢å¤éœ€è¦åœæœº
â””â”€â”€ é€‚ç”¨ï¼šå®Œæ•´è¿ç§»ã€ç¾éš¾æ¢å¤ã€ç³»ç»Ÿé‡å»º
```

### 2. å¤‡ä»½é¢‘ç‡å»ºè®®
- **æ¯æ—¥SQLå¤‡ä»½**ï¼šä¿ç•™7å¤©ï¼Œç”¨äºæ—¥å¸¸æ•°æ®æ¢å¤
- **æ¯å‘¨å®Œæ•´å¤‡ä»½**ï¼šä¿ç•™30å¤©ï¼Œç”¨äºé•¿æœŸå­˜æ¡£
- **é‡è¦æ“ä½œå‰**ï¼šæ‰‹åŠ¨å¤‡ä»½ï¼Œç¡®ä¿æ•°æ®å®‰å…¨

## ğŸ› ï¸ å¤‡ä»½å·¥å…·

### 1. äº¤äº’å¼å¤‡ä»½å·¥å…·
```bash
# å¯åŠ¨äº¤äº’å¼å¤‡ä»½æ¢å¤å·¥å…·
./mysql-backup-restore.sh

# åŠŸèƒ½èœå•ï¼š
# 1. ğŸ“¦ åˆ›å»ºå®Œæ•´å¤‡ä»½ï¼ˆæ¨èï¼‰
# 2. ğŸ’¾ ä»…SQLé€»è¾‘å¤‡ä»½
# 3. ğŸ—ƒï¸ ä»…æ•°æ®å·å¤‡ä»½
# 4. ğŸ”„ æ¢å¤æ•°æ®åº“
# 5. ğŸ“Š æŸ¥çœ‹å¤‡ä»½åˆ—è¡¨
# 6. ğŸ” éªŒè¯å¤‡ä»½å®Œæ•´æ€§
# 7. ğŸ§¹ æ¸…ç†æ—§å¤‡ä»½
```

### 2. è‡ªåŠ¨åŒ–å¤‡ä»½è„šæœ¬
```bash
# æ¯æ—¥å¤‡ä»½ï¼ˆä»…SQLï¼‰
./auto-backup.sh daily

# æ¯å‘¨å¤‡ä»½ï¼ˆSQL + æ•°æ®å·ï¼‰
./auto-backup.sh weekly

# æ‰‹åŠ¨å®Œæ•´å¤‡ä»½
./auto-backup.sh manual

# æŸ¥çœ‹å¸®åŠ©
./auto-backup.sh --help
```

### 3. æ¼”ç¤ºè„šæœ¬
```bash
# è¿è¡Œå¤‡ä»½åŠŸèƒ½æ¼”ç¤º
./demo-backup.sh
```

## ğŸ“¦ å¤‡ä»½å®ç°åŸç†

### 1. SQLé€»è¾‘å¤‡ä»½
```bash
# å¤‡ä»½å‘½ä»¤
docker exec ljwx-mysql mysqldump \
    -u root -p123456 \
    --single-transaction \      # äº‹åŠ¡ä¸€è‡´æ€§
    --routines \               # å­˜å‚¨è¿‡ç¨‹
    --triggers \               # è§¦å‘å™¨
    --events \                 # äº‹ä»¶
    --hex-blob \               # äºŒè¿›åˆ¶æ•°æ®
    --add-drop-database \      # æ·»åŠ DROPè¯­å¥
    --databases lj-06 > backup.sql

# å‹ç¼©å¤‡ä»½
gzip backup.sql
```

### 2. æ•°æ®å·å¤‡ä»½
```bash
# ä½¿ç”¨ä¸´æ—¶å®¹å™¨å¤‡ä»½æ•°æ®å·
docker run --rm \
    -v client-deployment_mysql_data:/source:ro \
    -v $(pwd)/backups/volume:/backup \
    alpine:latest \
    tar -czf /backup/mysql_volume_$(date +%Y%m%d_%H%M%S).tar.gz -C /source .
```

## ğŸ”„ æ¢å¤æ“ä½œ

### 1. SQLå¤‡ä»½æ¢å¤
```bash
# è§£å‹å¹¶æ¢å¤
zcat backup.sql.gz | docker exec -i ljwx-mysql mysql -u root -p123456

# éªŒè¯æ¢å¤
docker exec ljwx-mysql mysql -u root -p123456 -e "SELECT COUNT(*) FROM information_schema.tables WHERE table_schema='lj-06';"
```

### 2. æ•°æ®å·æ¢å¤
```bash
# åœæ­¢MySQLå®¹å™¨
docker stop ljwx-mysql

# æ¸…ç©ºç°æœ‰æ•°æ®å·
docker run --rm -v client-deployment_mysql_data:/target alpine:latest rm -rf /target/*

# æ¢å¤æ•°æ®
docker run --rm \
    -v $(pwd)/backups/volume:/backup \
    -v client-deployment_mysql_data:/target \
    alpine:latest \
    tar -xzf /backup/backup_file.tar.gz -C /target

# é‡å¯MySQL
docker-compose up -d mysql
```

## ğŸ“ å¤‡ä»½ç›®å½•ç»“æ„

```
./backups/
â”œâ”€â”€ sql/                    # SQLé€»è¾‘å¤‡ä»½
â”‚   â”œâ”€â”€ ljwx_daily_20241220_020000.sql.gz
â”‚   â”œâ”€â”€ ljwx_weekly_20241220_030000.sql.gz
â”‚   â””â”€â”€ ljwx_manual_20241220_143000.sql.gz
â”œâ”€â”€ volume/                 # æ•°æ®å·å¤‡ä»½
â”‚   â”œâ”€â”€ mysql_weekly_20241220_030000.tar.gz
â”‚   â””â”€â”€ mysql_manual_20241220_143000.tar.gz
â”œâ”€â”€ config/                 # é…ç½®æ–‡ä»¶å¤‡ä»½
â”‚   â””â”€â”€ config_20241220_030000.tar.gz
â”œâ”€â”€ logs/                   # å¤‡ä»½æ—¥å¿—
â”œâ”€â”€ backup_log.csv          # å¤‡ä»½è®°å½•
â”œâ”€â”€ backup_history.csv      # å†å²è®°å½•
â””â”€â”€ auto_backup.log         # è‡ªåŠ¨å¤‡ä»½æ—¥å¿—
```

## â° å®šæ—¶ä»»åŠ¡è®¾ç½®

### 1. æ·»åŠ Crontabä»»åŠ¡
```bash
# ç¼–è¾‘å®šæ—¶ä»»åŠ¡
crontab -e

# æ·»åŠ ä»¥ä¸‹å†…å®¹
# æ¯æ—¥å‡Œæ™¨2ç‚¹æ‰§è¡ŒSQLå¤‡ä»½
0 2 * * * /path/to/client-deployment/auto-backup.sh daily

# æ¯å‘¨æ—¥å‡Œæ™¨3ç‚¹æ‰§è¡Œå®Œæ•´å¤‡ä»½
0 3 * * 0 /path/to/client-deployment/auto-backup.sh weekly
```

## ğŸ¯ å¿«é€Ÿå¼€å§‹

### 1. ç«‹å³åˆ›å»ºå¤‡ä»½
```bash
# å®Œæ•´å¤‡ä»½ï¼ˆæ¨èï¼‰
./auto-backup.sh manual

# ä»…SQLå¤‡ä»½
./auto-backup.sh daily
```

### 2. æŸ¥çœ‹å¤‡ä»½çŠ¶æ€
```bash
# æŸ¥çœ‹å¤‡ä»½æ–‡ä»¶
ls -la backups/

# æŸ¥çœ‹å¤‡ä»½æ—¥å¿—
tail backups/auto_backup.log
```

### 3. æ¢å¤æ•°æ®åº“
```bash
# å¯åŠ¨æ¢å¤å·¥å…·
./mysql-backup-restore.sh

# é€‰æ‹©èœå•é¡¹4è¿›è¡Œæ¢å¤
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜
```bash
# é—®é¢˜1: MySQLå®¹å™¨æœªè¿è¡Œ
docker ps | grep ljwx-mysql
docker-compose up -d mysql

# é—®é¢˜2: æƒé™é—®é¢˜
sudo chown -R $(whoami):$(whoami) backups/

# é—®é¢˜3: ç£ç›˜ç©ºé—´ä¸è¶³
df -h
du -sh backups/
```

## ğŸ“š æœ€ä½³å®è·µ

- âœ… å®šæœŸæµ‹è¯•æ¢å¤æµç¨‹
- âœ… ç›‘æ§å¤‡ä»½ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€
- âœ… å®šæœŸæ¸…ç†è¿‡æœŸå¤‡ä»½
- âœ… å¤‡ä»½å‰éªŒè¯æ•°æ®åº“çŠ¶æ€
- âœ… å¤šåœ°ç‚¹å­˜å‚¨é‡è¦å¤‡ä»½

## ğŸ¯ æ€»ç»“

LJWXæ•°æ®åº“å¤‡ä»½å’Œæ¢å¤ç³»ç»Ÿæä¾›äº†å®Œæ•´çš„æ•°æ®ä¿æŠ¤æ–¹æ¡ˆï¼š

1. **å¤šç§å¤‡ä»½æ–¹å¼**ï¼šSQLé€»è¾‘å¤‡ä»½ + æ•°æ®å·å¤‡ä»½
2. **è‡ªåŠ¨åŒ–ç®¡ç†**ï¼šå®šæ—¶ä»»åŠ¡ + ç­–ç•¥æ¸…ç†
3. **ç®€åŒ–æ“ä½œ**ï¼šäº¤äº’å¼å·¥å…· + ä¸€é”®æ¢å¤
4. **å®Œæ•´ç›‘æ§**ï¼šæ—¥å¿—è®°å½• + çŠ¶æ€æŠ¥å‘Š
5. **ç¾éš¾æ¢å¤**ï¼šå¿«é€Ÿæ¢å¤ + æ•°æ®éªŒè¯

é€šè¿‡åˆç†ä½¿ç”¨è¿™äº›å·¥å…·ï¼Œå¯ä»¥ç¡®ä¿LJWXç³»ç»Ÿæ•°æ®çš„å®‰å…¨æ€§å’Œå¯é æ€§ã€‚ 