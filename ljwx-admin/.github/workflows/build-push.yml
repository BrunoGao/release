name: Build and Push ljwx-admin Docker Image

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

env:
  REGISTRY: crpi-yilnm6upy4pmbp67.cn-shenzhen.personal.cr.aliyuncs.com/ljwx
  IMAGE_NAME: ljwx-admin
  VERSION: 1.1.2

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkoutä»£ç 
      uses: actions/checkout@v4

    - name: è®¾ç½®Docker Buildx
      uses: docker/setup-buildx-action@v3

    - name: ç™»å½•é˜¿é‡Œäº‘é•œåƒä»“åº“
      uses: docker/login-action@v3
      with:
        registry: ${{ env.REGISTRY }}
        username: ${{ secrets.ALIYUN_USERNAME }}
        password: ${{ secrets.ALIYUN_PASSWORD }}

    - name: æ„å»ºå¹¶æ¨é€Dockeré•œåƒ
      uses: docker/build-push-action@v5
      with:
        context: .
        file: Dockerfile.prod
        platforms: linux/amd64
        push: true
        tags: |
          ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:${{ env.VERSION }}
          ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:latest

    - name: éªŒè¯é•œåƒ
      run: |
        echo "âœ… ljwx-adminé•œåƒæ„å»ºå¹¶æ¨é€æˆåŠŸ!"
        echo "ğŸ³ é•œåƒåœ°å€: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:${{ env.VERSION }}"
        echo "ğŸ“¦ æ‹‰å–å‘½ä»¤: docker pull ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:${{ env.VERSION }}"