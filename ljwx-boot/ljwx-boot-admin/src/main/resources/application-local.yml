spring:
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://127.0.0.1:3306/${MYSQL_DATABASE:test}?useUnicode=true&characterEncoding=utf8&serverTimezone=Asia/Shanghai&useSSL=false&allowPublicKeyRetrieval=true&autoReconnect=true&failOverReadOnly=false&maxReconnects=3&initialTimeout=2&connectTimeout=60000&socketTimeout=60000
    username: ${MYSQL_USER:root}
    password: ${MYSQL_PASSWORD:123456}
    hikari: #本地开发连接池优化
      maximum-pool-size: 10 #本地环境降低连接数
      minimum-idle: 2 #最小空闲连接
      connection-timeout: 30000 #连接超时30秒
      idle-timeout: 600000 #空闲超时10分钟
      max-lifetime: 1800000 #连接最大生命周期30分钟
      leak-detection-threshold: 60000 #连接泄漏检测60秒
      validation-timeout: 5000 #连接验证超时5秒
      connection-test-query: SELECT 1 #连接测试查询
  data:
    redis:
      # 使用URL方式连接，解决Redis 8.x认证问题
      url: redis://default:${REDIS_PASSWORD:123456}@localhost:${REDIS_PORT:6379}/${REDIS_DB:1}
      connect-timeout: 10000ms
      timeout: 30000ms
      lettuce:
        pool:
          enabled: true
          max-active: 8 #本地环境降低连接数
          max-idle: 4
          min-idle: 1
          max-wait: 10000ms
        shutdown-timeout: 200ms
        # Redis 8.x版本兼容配置
        client-options:
          ping-before-activate-connection: false
          auto-reconnect: true
  jpa:
    show-sql: true #本地开发显示SQL
    hibernate:
      ddl-auto: validate
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MySQL8Dialect
        connection:
          provider_disables_autocommit: false
          handling_mode: DELAYED_ACQUISITION_AND_RELEASE_AFTER_TRANSACTION
        hbm2ddl:
          auto: validate
  jackson:
    serialization:
      ORDER_MAP_ENTRIES_BY_KEYS: false
  quartz:
    job-store-type: memory #本地开发使用内存存储
  aop:
    proxy-target-class: true  # 启用CGLIB代理
  ai:
    ollama:
      base-url: ${OLLAMA_BASE_URL:http://localhost:11434}
      chat:
        enabled: true
        model: ${OLLAMA_MODEL:qwen2.5:7b}
        options:
          temperature: 0.7
 
# 本地开发监控配置
management:
  server:
    port: 9999 #监控端口
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus,hikaricp #暴露关键端点
      base-path: /actuator
    enabled-by-default: true
  endpoint:
    health:
      show-details: always
    hikaricp:
      enabled: true
  metrics:
    export:
      prometheus:
        enabled: true
    hikaricp:
      enabled: true
  security:
    enabled: false #本地开发禁用安全认证

# 本地开发日志配置
logging:
  level:
    com.ljwx: debug #本地开发详细日志
    com.zaxxer.hikari: info #连接池日志
    org.springframework.jdbc: debug #JDBC调试日志
    org.springframework.web: debug #Web调试日志
    org.mybatis: debug #MyBatis调试日志
    root: info
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level [%X{traceId}] %logger{36} - %msg%n"
  file:
    name: logs/ljwx-boot-local.log #本地日志文件
    max-size: 50MB
    max-history: 7 #本地保留7天日志

# MyBatis-Plus本地配置
mybatis-plus:
  type-handlers-package: com.ljwx.modules.geofence.util
  configuration:
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl #本地开启SQL日志

# 本地开发OSS配置
oss:
  name: ${OSS_NAME:local}
  endpoint: ${OSS_ENDPOINT:http://localhost:9000}
  access-key: ${OSS_ACCESS_KEY:admin}
  secret-key: ${OSS_SECRET_KEY:admin123}
  bucket-name: ${OSS_BUCKET_NAME:ljwx-local}
  local-path: data/uploads #本地文件上传路径
  sync-delete: false #本地开发不删除文件
  expiry: 3600

# 本地开发AI配置
ollama:
  base-url: ${OLLAMA_BASE_URL:http://localhost:11434} #本地Ollama服务
  model: ${OLLAMA_MODEL:qwen2.5:7b} #使用较小模型进行本地开发
  max-tokens: 2048
  temperature: 0.7
  top-p: 1
  stream: false

# 本地开发向量数据库配置
vector-store:
  pgvector:
    url: jdbc:postgresql://localhost:5432/vector_db
    username: ${PGVECTOR_USER:postgres}
    password: ${PGVECTOR_PASSWORD:postgres}

# 本地开发环境标识
ljwx:
  env: local
  debug: true
  # Logo上传配置 - 本地开发环境
  logo:
    # 本地开发使用相对路径，从项目根目录开始
    upload-path: ljwx-boot/uploads
    default-logo: ljwx-boot/uploads/logos/defaults/default-logo.svg
  # 许可证配置 - 本地开发环境
  license:
    enabled: true
    file-path: ./license/ljwx.lic
    check-interval: 300  # 5分钟检查一次
    trial-mode: true     # 本地开发启用试用模式 
# 为DruidConfiguration兼容性添加标准Spring Boot数据源配置
spring:
  datasource:
    url: jdbc:mysql://127.0.0.1:3306/${MYSQL_DATABASE:test}?useUnicode=true&characterEncoding=utf8&serverTimezone=Asia/Shanghai&useSSL=false&allowPublicKeyRetrieval=true&autoReconnect=true&failOverReadOnly=false&maxReconnects=3&initialTimeout=2&connectTimeout=60000&socketTimeout=60000
    username: ${MYSQL_USER:root}
    password: ${MYSQL_PASSWORD:123456}
    driver-class-name: com.mysql.cj.jdbc.Driver
