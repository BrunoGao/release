// 检查所有容器是否存在
const containersExist = chartContainers.every(id => 
    document.getElementById(id) !== null
);

if (!containersExist) {
    console.warn('Some chart containers are not ready yet');
    // 可以选择稍后重试
    setTimeout(initializeCharts, 100);
    return;
}

// 所有容器都存在时再初始化图表
chartContainers.forEach(id => {
    const container = document.getElementById(id);
<!doctype html>
    if (container) {
        const chart = echarts.init(container);
<html lang="en">

<head>
<meta charset="utf-8">
</head>

<body>
<link href="{{ url_for('static', filename='index/css/Datacages_Homeindex.css') }}" rel="stylesheet" type="text/css">
<link href="{{ url_for('static', filename='index/css/ProgressBarWars.css') }}" rel="stylesheet">
<style type="text/css">
* {
padding: 0;
margin: 0;
}

.loadEffect {
width: 100px;
height: 100px;
position: relative;
margin: 0 auto;
top: 26%;
}

.loadEffect span {
animation: load 1.04s ease infinite;
display: inline-block;
width: 30px;
height: 10px;
border-top-left-radius: 5px;
border-bottom-left-radius: 5px;
background: lightgreen;
position: absolute;
}

.loadEffect span:nth-child(1) {
left: 0;
top: 50%;
margin-top: -5px;
animation-delay: 0.13s;
}

.loadEffect span:nth-child(2) {
left: 10px;
top: 20px;
transform: rotate(45deg);
animation-delay: 0.26s;
}

.loadEffect span:nth-child(3) {
left: 50%;
top: 10px;
margin-left: -15px;
transform: rotate(90deg);
animation-delay: 0.39s;
}

.loadEffect span:nth-child(4) {
top: 20px;
right: 10px;
transform: rotate(135deg);
animation-delay: 0.52s;
}

.loadEffect span:nth-child(5) {
right: 0;
top: 50%;
margin-top: -5px;
transform: rotate(180deg);
animation-delay: 0.65s;
}

.loadEffect span:nth-child(6) {
right: 10px;
bottom: 20px;
transform: rotate(225deg);
animation-delay: 0.78s;
}

.loadEffect span:nth-child(7) {
bottom: 10px;
left: 50%;
margin-left: -15px;
transform: rotate(270deg);
animation-delay: 0.91s;
}

.loadEffect span:nth-child(8) {
bottom: 20px;
left: 10px;
transform: rotate(315deg);
animation-delay: 1.04s;
}

@keyframes load {
0% {
    opacity: 1;
}

100% {
    opacity: 0.2;
}
}

html,
body {
width: 100%;
height: 100%;
}

#loading {
background-color: #181e20;
opacity: 0.5;
width: 100%;
height: 100%;
position: fixed;
z-index: 999;
}

/* 添加新的样式 */
.tab-container {
display: flex;
border-bottom: 1px solid rgba(32, 156, 255, 0.3);
margin-bottom: 20px;
}

.tab-button {
background: none;
border: none;
color: #dfdede;
padding: 10px 20px;
cursor: pointer;
font-size: 14px;
transition: all 0.3s ease;
position: relative;
}

.tab-button.active {
color: #00e4ff;
}

.tab-button.active::after {
content: '';
position: absolute;
bottom: -1px;
left: 0;
width: 100%;
height: 2px;
background-color: #00e4ff;
}

.tab-content {
display: none;
height: calc(100% - 50px);
overflow: auto;
}

.tab-content.active {
display: block;
}

.data-table {
width: 100%;
border-collapse: collapse;
margin-top: 10px;
}

.data-table th,
.data-table td {
padding: 12px;
text-align: left;
border-bottom: 1px solid rgba(32, 156, 255, 0.2);
color: #dfdede;
font-size: 14px;
}

.data-table th {
background-color: rgba(0, 228, 255, 0.1);
color: #00e4ff;
font-weight: normal;
}

.chart-container {
    width: 100%;
    height: 100%;
    min-height: 400px;
    background: rgba(1, 19, 38, 0.8);
    border-radius: 4px;
    padding: 10px;
}


.status-badge {
padding: 4px 8px;
border-radius: 4px;
font-size: 12px;
}

.status-critical {
background-color: #ff3366;
color: #fff;
}

.status-medium {
background-color: #ffb300;
color: #000;
}

.status-active {
background-color: #00ff88;
color: #000;
}

.status-inactive {
background-color: #ff3366;
color: #fff;
}

/* 修改弹出面板样式 */
.popup-content {
padding: 20px;
max-height: 80vh;
overflow: auto;
}

.loading-container {
display: flex;
flex-direction: column;
align-items: center;
print usersustify-content: center;
height: 200px;
}

.loading-spinner {
border: 3px solid rgba(0, 228, 255, 0.3);
border-radius: 50%;
border-top: 3px solid #00e4ff;
width: 40px;
height: 40px;
animation: spin 1s linear infinite;
}

@keyframes spin {
0% { transform: rotate(0deg); }
100% { transform: rotate(360deg); }
}

.loading-text {
margin-top: 10px;
color: #00e4ff;
}

.bottom-panels {
position: fixed;
bottom: 0;
left: 0;
right: 0;
height: 280px; /* 降低高度 */
display: flex;
justify-content: space-between;
padding: 0 20px 20px;
gap: 20px;
}

.panel {
flex: 1;
background: rgba(1, 19, 38, 0.8);
border: 1px solid rgba(0, 228, 255, 0.2);
border-radius: 4px;
overflow: hidden;
}

.panel-title {
padding: 10px 15px;
color: #00e4ff;
font-size: 16px;
background: rgba(0, 228, 255, 0.1);
border-bottom: 1px solid rgba(0, 228, 255, 0.2);
}

/* AI 分析面板样式 */
.panel-ai {
flex: 1;
}

.ai-charts-container {
height: calc(100% - 40px);
position: relative;
overflow: hidden;
}

.ai-charts-wrapper {
display: flex;
transition: transform 0.3s ease;
height: 100%;
}

.ai-chart {
min-width: 100%;
height: 100%;
}

.chart-nav {
position: absolute;
bottom: 10px;
left: 50%;
transform: translateX(-50%);
display: flex;
gap: 8px;
}

.chart-nav-dot {
width: 8px;
height: 8px;
border-radius: 50%;
background: rgba(0, 228, 255, 0.3);
cursor: pointer;
}

.chart-nav-dot.active {
background: #00e4ff;
}

/* 中间信息栏样式 */
.panel-info {
flex: 1;
}

.info-content {
height: calc(100% - 40px);
display: flex;
flex-direction: column;
gap: 10px;
padding: 10px;
overflow-y: auto;
}

.info-item {
display: flex;
align-items: center;
padding: 8px;
background: rgba(0, 228, 255, 0.05);
border-left: 3px solid #00e4ff;
}

.info-item.alert {
border-left-color: #ff3366;
}

/* 趋势分析面板样式 */
.panel-trends {
flex: 1;
}

.trends-content {
height: calc(100% - 40px);
display: grid;
grid-template-columns: repeat(2, 1fr);
gap: 10px;
padding: 10px;
}

.trend-chart {
background: rgba(0, 228, 255, 0.05);
border-radius: 4px;
}

.copyrigntoutbox {
position: fixed;
bottom: 10px;
left: 0;
right: 0;
text-align: center;
z-index: 1000;
}

.copyrigntmsg {
color: rgba(0, 228, 255, 0.7);
font-size: 12px;
}

.popup-overlay {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0, 0, 0, 0.85); /* 更深的背景色 */
display: none;
z-index: 1000;
}

.popup-panel {
position: absolute;
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
width: 90%;
height: 85%;
background: #001529; /* 墨黑色背景 */
border: 1px solid rgba(0, 228, 255, 0.2);
border-radius: 8px;
box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
overflow: hidden;
display: none;
}

.popup-header {
position: relative;
background: rgba(0, 13, 33, 0.95); /* 更深的头部背景 */
border-bottom: 1px solid rgba(0, 228, 255, 0.2);
}

/* 关闭按钮样式优化 */
.popup-close {
position: absolute;
top: 10px;
right: 10px;
width: 32px;
height: 32px;
border: none;
background: transparent;
color: #00e4ff;
font-size: 24px;
cursor: pointer;
display: flex;
align-items: center;
justify-content: center;
z-index: 10;
transition: all 0.3s ease;
}

.popup-close:hover {
color: #fff;
transform: rotate(90deg);
}

/* 标签页样式优化 */
.tab-container {
display: flex;
padding-right: 40px; /* 为关闭按钮留出空间 */
background: transparent;
border-bottom: 1px solid rgba(0, 228, 255, 0.2);
}

.tab-button {
padding: 12px 30px;
color: #00e4ff;
background: none;
border: none;
cursor: pointer;
font-size: 16px;
transition: all 0.3s;
}

.tab-button:hover {
background: rgba(0, 228, 255, 0.1);
color: #fff;
}

.tab-button.active {
background: rgba(0, 228, 255, 0.15);
color: #fff;
}

.popup-content {
height: calc(100% - 51px);
overflow: hidden;
background: #001529; /* 确保内容区域也是墨黑色 */
}

.popup-content iframe {
width: 100%;
height: 100%;
border: none;
background: transparent;
}

/* 基础布局 */
body {
margin: 0;
padding: 0;
width: 100vw;
height: 100vh;
overflow: hidden;
}

/* 主容器 */
.container {
width: 100%;
height: 100%;
display: flex;
flex-direction: column;
}

/* 顶部标题 */
.header {
padding: 10px 20px;
height: 50px;
}

/* 主要内容区域 */
.main-content {
flex: 1;
display: flex;
padding: 0 20px;
gap: 20px;
margin-bottom: 200px; /* 为底部面板留出空间 */
}

/* 左侧面板 */
.left-panel {
width: 25%;
min-width: 300px;
display: flex;
flex-direction: column;
gap: 20px;
}

/* 中间面板 */
.center-panel {
flex: 1;
display: flex;
flex-direction: column;
gap: 20px;
}

/* 右侧面板 */
.right-panel {
width: 25%;
min-width: 300px;
display: flex;
flex-direction: column;
gap: 20px;
}

/* 通用面板样式 */
.panel {
background: rgba(1, 19, 38, 0.8);
border: 1px solid rgba(0, 228, 255, 0.2);
border-radius: 4px;
padding: 15px;
height: calc(33.33% - 14px); /* 减去间距 */
min-height: 200px;
}

/* 底部面板容器 */
.bottom-panels {
position: fixed;
bottom: 0;
left: 0;
right: 0;
height: 180px;
display: flex;
justify-content: space-between;
padding: 0 20px 20px;
gap: 20px;
z-index: 10;
}

/* 图表容器 */
.chart-container {
width: 100%;
height: 100%;
}

/* 数据列表 */
.data-list {
height: 100%;
overflow-y: auto;
scrollbar-width: thin;
scrollbar-color: rgba(0, 228, 255, 0.5) rgba(1, 19, 38, 0.3);
}

.data-list::-webkit-scrollbar {
width: 6px;
}

.data-list::-webkit-scrollbar-track {
background: rgba(1, 19, 38, 0.3);
}

.data-list::-webkit-scrollbar-thumb {
background: rgba(0, 228, 255, 0.5);
border-radius: 3px;
}

/* 响应式调整 */
@media screen and (max-width: 1600px) {
.left-panel,
.right-panel {
    width: 30%;
}
}

@media screen and (max-width: 1200px) {
.main-content {
    flex-direction: column;
}

.left-panel,
.right-panel {
    width: 100%;
}

.panel {
    height: 250px;
}
}

/* 确保图表自适应容器大小 */
.echarts-container {
width: 100%;
height: 100%;
}

* 告警滚动条样式 */
.marquee-container {
width: 100%;
height: 40px;
overflow: hidden;
background: rgba(0, 15, 29, 0.8);
border-radius: 4px;
margin: 10px 0;
border: 1px solid rgba(0, 240, 255, 0.2);
}

.marquee-content {
display: flex;
animation: marquee 20s linear infinite;
}

.alert-item {
display: flex;
align-items: center;
padding: 0 20px;
color: #fff;
white-space: nowrap;
gap: 10px;
}

.alert-item.critical {
color: #ff4757;
}

.alert-item.medium {
color: #ffa502;
}

.alert-item .time {
color: #00f0ff;
font-family: 'Digital-7', monospace;
}

@keyframes marquee {
0% { transform: translateX(100%); }
100% { transform: translateX(-100%); }
}

/* 统计面板轮播样式 */
.slide-container {
position: relative;
height: 300px;
overflow: hidden;
background: rgba(0, 15, 29, 0.8);
border-radius: 8px;
border: 1px solid rgba(0, 240, 255, 0.2);
}

.slide {
position: absolute;
width: 100%;
height: 100%;
opacity: 0;
transition: opacity 0.5s ease-in-out;
}

.slide.active {
opacity: 1;
}

/* 更新现有的面板样式 */
.left-panel, .center-panel, .right-panel {
background: rgba(0, 15, 29, 0.8);
border-radius: 8px;
padding: 15px;
border: 1px solid rgba(0, 240, 255, 0.2);
}

.chart-title {
color: #fff;
font-size: 16px;
margin-bottom: 10px;
padding-left: 10px;
border-left: 4px solid #00f0ff;
}

/* 修改图表容器样式 */
.analyzemsgbgbox {
    margin: 0 2px;
    padding: 10px;
    background: rgba(1, 19, 38, 0.8);
    border-radius: 4px;
}

/* 调整树形图容器高度 */
#departmentTreeChart {
    width: 100%;
    height: 100%;
    min-height: 380px;
}
/* 确保父容器有正确的尺寸 */
.fltoutbox.leftbox {
    height: calc(100vh - 100px); /* 使用视口高度减去上下边距 */
    min-height: 400px; /* 设置最小高度 */
    overflow: hidden; /* 防止内容溢出 */
}
/* 调整预警图表容器高度 */
#healthPredictionChart {
    width: 100%;
    height: 250px; /* 增加高度 */
    margin-bottom: 10px;
}

/* 优化预警列表容器 */
.scrollbox {
    width: 100%;
    margin-top: 10px;
}

#scrollDiv {
    width: 100%;
    height: 280px;
    overflow-y: auto;
}

/* 添加到现有的 style 标签中 */
.chart-container {
    margin-bottom: 20px;
    background: rgba(0, 15, 29, 0.5);
    border-radius: 8px;
    padding: 10px;
    height: auto; /* 移除固定高度 */
}

#healthGauge {
    width: 100%;
    height: 100%;
    min-height: 180px; /* 设置最小高度 */
}

#healthRadar {
    width: 100%;
    height: 100%;
    min-height: 180px; /* 设置最小高度 */
}

/* 修改 health-score-container 的样式 */
.health-score-container {
    background: rgba(1, 19, 38, 0.8);
    border: 1px solid rgba(0, 228, 255, 0.2);
    border-radius: 4px;
    height: calc(100% - 30px);
    position: relative;
}

/* 调整标题区域样式 */
.health-score-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 0 10px 0;
    border-bottom: 1px solid rgba(0, 228, 255, 0.2);
}

/* 调整图表容器样式 */
.chart-container {
    background: rgba(0, 15, 29, 0.5);
    border-radius: 8px;
    padding: 10px;
    margin: 0;
    height: auto; /* 移除固定高度 */
}

/* 仪表盘容器 */
.chart-container:nth-child(2) {
    flex: 0 0 35%; /* 减小比例 */
    min-height: 200px; /* 减小最小高度 */
}

/* 雷达图容器 */
.chart-container:nth-child(3) {
    flex: 0 0 35%; /* 减小比例 */
    min-height: 200px; /* 减小最小高度 */
}

/* 部门健康详情面板样式 */
.department-health-details {
    flex: 0 0 20%;
    background: rgba(0, 15, 29, 0.5);
    border-radius: 8px;
    padding: 10px;
    min-height: 100px; /* 减小最小高度 */
    overflow-y: auto;
}

/* 部门选择器样式优化 */
.department-selector select {
    background: rgba(0, 15, 29, 0.8);
    border: 1px solid rgba(0, 228, 255, 0.2);
    color: #fff;
    padding: 8px 15px;
    border-radius: 4px;
    width: 120px;
    font-size: 14px;
    outline: none;
}

.department-selector select:focus {
    border-color: rgba(0, 228, 255, 0.5);
}

/* 确保图表容器内的图表充满容器 */
#healthGauge, #healthRadar {
    width: 100%;
    height: 100%;
    min-height: 180px; /* 设置最小高度 */
}

/* 健康详情内容样式优化 */
.detail-content {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 10px;
    margin-top: 10px;
}

.health-item {
    background: rgba(0, 228, 255, 0.05);
    border-radius: 4px;
    padding: 10px;
    border-left: 3px solid;
}

.health-item.normal { border-left-color: #4caf50; }
.health-item.good { border-left-color: #00e4ff; }
.health-item.warning { border-left-color: #ff9800; }

/* 滚动条美化 */
.department-health-details::-webkit-scrollbar {
    width: 6px;
}

.department-health-details::-webkit-scrollbar-track {
    background: rgba(0, 15, 29, 0.3);
}

.department-health-details::-webkit-scrollbar-thumb {
    background: rgba(0, 228, 255, 0.3);
    border-radius: 3px;
}

.department-health-details::-webkit-scrollbar-thumb:hover {
    background: rgba(0, 228, 255, 0.5);
}

.department-detail-panel {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0, 15, 29, 0.95);
    border: 1px solid rgba(0, 228, 255, 0.2);
    border-radius: 8px;
    padding: 20px;
    width: 80%;
    max-width: 400px;
    z-index: 100;
}

.detail-header {
    text-align: center;
    margin-bottom: 20px;
}

.score-big {
    font-size: 36px;
    font-weight: bold;
    margin: 15px 0;
}

.warning-tag {
    display: inline-block;
    background: rgba(255, 68, 68, 0.1);
    color: #ff4444;
    padding: 5px 10px;
    border-radius: 4px;
    margin-top: 10px;
}

.risk-metrics {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 15px;
    margin: 20px 0;
}

.metric-item {
    text-align: center;
    padding: 10px;
    background: rgba(0, 228, 255, 0.1);
    border-radius: 4px;
}

.metric-label {
    display: block;
    color: #fff;
    font-size: 12px;
    margin-bottom: 5px;
}

.metric-value {
    display: block;
    font-size: 18px;
    font-weight: bold;
}

.action-buttons {
    display: flex;
    gap: 10px;
    justify-content: center;
    margin-top: 20px;
}

.action-buttons button {
    background: rgba(0, 228, 255, 0.2);
    border: 1px solid rgba(0, 228, 255, 0.4);
    color: #fff;
    padding: 8px 15px;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.action-buttons button:hover {
    background: rgba(0, 228, 255, 0.3);
}
</style>
<script src="{{ url_for('static', filename='index/js/jquery.js') }}"></script>
<script src="{{ url_for('static', filename='index/js/echarts-all.js') }}"></script>
<script src="{{ url_for('static', filename='index/js/ProgressBarWars.js') }}"></script>
<script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
<style>
* {
padding: 0;
margin: 0;
}

.progress {
margin-top: 30px;
}

.down_span {
color: #dfdede;
font-size: 12px;
font-weight: lighter;
}

h3,
ul,
li {
margin: 0;
padding: 0;
list-style: none;
}

.scrollbox {
width: 268px;
margin: 0 auto;
}

#scrollDiv {
width: 268px;
height: 280px;
overflow: hidden;
}

/*这里的高度和超出隐藏是必须的*/
#scrollDiv ul li {
height: 66px;
width: 259px;
;
background-color: #07325e;
overflow: hidden;
margin-bottom: 4px;
color: #dfdede;
font-size: 14px;
padding: 0 9px 0 9px;
line-height: 30px;
position: relative;
}

#scrollDiv ul li span {
position: absolute;
bottom: 5px;
right: 16px;
display: block;
width: 68px;
height: 18px;
text-align: center;
color: #081e49;
background-color: #69c200;
line-height: 18px;
}

.sent-div {
width: 98%;
height: 98%;
margin: 0 auto;
}
</style>
<style>
    .warning-item {
        background: rgba(0, 228, 255, 0.1);
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 10px;
        border-left: 4px solid;
        cursor: pointer;
        transition: transform 0.2s ease;
    }

    .warning-item:hover {
        transform: translateX(5px);
    }

    .warning-high {
        border-left-color: #f44336;
    }

    .warning-medium {
        border-left-color: #ff9800;
    }

    .warning-low {
        border-left-color: #4caf50;
    }

    .warning-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
    }

    .warning-title {
        font-size: 16px;
        color: #00e4ff;
    }

    .warning-time {
        font-size: 12px;
        color: rgba(255, 255, 255, 0.6);
    }

    .warning-content {
        font-size: 14px;
        color: rgba(255, 255, 255, 0.8);
        line-height: 1.4;
    }
    .health-score-container {
        padding: 15px;
        background: rgba(1, 19, 38, 0.8);
        border-radius: 8px;
        height: 100%;
    }
    
    .health-score-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }
    
    .health-score-header h2 {
        color: #fff;
        font-size: 16px;
        font-weight: normal;
    }
    
    .score-filters {
        display: flex;
        gap: 15px;
    }
    
    .score-filters span {
        color: #fff;
        font-size: 12px;
        cursor: pointer;
        padding: 4px 12px;
        border-radius: 4px;
        transition: all 0.3s ease;
    }
    
    .score-filters span.active {
        background: rgba(0, 228, 255, 0.2);
        color: #00e4ff;
    }
    
    .chart-container {
        margin-bottom: 20px;
        background: rgba(0, 15, 29, 0.5);
        border-radius: 8px;
        padding: 10px;
    }
    
    .score-legend {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
        padding: 10px;
        background: rgba(0, 15, 29, 0.5);
        border-radius: 8px;
    }
    
    .legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .color-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
    }
    
    .color-dot.excellent { background: linear-gradient(45deg, #00ff88, #00e4ff); }
    .color-dot.good { background: #4caf50; }
    .color-dot.normal { background: #2196f3; }
    .color-dot.warning { background: #ff9800; }
    .color-dot.danger { background: #ff5722; }
    .color-dot.critical { background: #f44336; }
    
    .label {
        color: #fff;
        font-size: 11px;
    }
</style>
<title>灵境万象 AI 智能健康数据分析平台</title>
<div id="loading">
<div class="loadEffect"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></div>
</div>
<!--标题栏-->
<div class="Hometitlebox"><a style=" color: #00e4ff;" href="http://localhost:5001/index">智能健康数据分析平台</a></div>
<!--动效显示-->
<div class="flasheffectoutbox">
<div style="width: 1000px; height: 500px; position: relative">
<div class="line2 line"></div>
<div class="line3 line"></div>
<div class="line4 line"></div>
<div class="line5 line"></div>
<div class="line6 line"></div>
<!--主动效-->
<div class="maineffectoutbox circleeffectclass"><a href="http://localhost:5001/index"><img class="effectposition maindataeffect" src="../static/index/img/maindataeffect.png">
        <div class="effectposition acrossremindeffectout" style=" width: 76px; height: 76px; margin: 9px;">
            <div class="acrossremindeffectin" style="width: 68px; height: 68px; margin: 4px;"></div>
        </div><img class="effectposition maindataspecialeffect" src="../static/index/img/maindataspecialeffect.png"><img class="effectposition acrossremindeffecindex" src="../static/index/img/maindataicon.png"><span class="stagetitle">AI 智能</span>
    </a></div>
<!--卫星动效-->
<div class="circleeffectclass aroundfunctioneffect" style="left: 254px;top: 135px;" onclick="showPanel('user')">
    <img class="effectposition arounddataeffect02" src="../static/index/img/aroundeffect.png">
    <div class="effectposition acrossremindeffectout acrossremindeffectoutard">
        <div class="acrossremindeffectin acrossremindeffectinard"></div>
    </div>
    <img class="effectposition acrossremindeffecindex" src="../static/index/img/xingzhengshenpi.png">
    <span class="stagetitle stagearoundtitle">人员管理</span>
</div>
<div class="circleeffectclass aroundfunctioneffect" style="left: 190px;bottom: 89px;" onclick="showPanel('device')">
    <img class="effectposition arounddataeffect01" src="../static/index/img/aroundeffect.png">
    <div class="effectposition acrossremindeffectout acrossremindeffectoutard">
        <div class="acrossremindeffectin acrossremindeffectinard"></div>
    </div>
    <img class="effectposition acrossremindeffecindex" src="../static/index/img/baixingpaiAPP.png">
    <span class="stagetitle stagearoundtitle">设备监控</span>
</div>
<div class="circleeffectclass aroundfunctioneffect" style="right: 405px;bottom: 53px;" onclick="showPanel('alert')">
    <img class="effectposition arounddataeffect02" src="../static/index/img/aroundeffect.png">
    <div class="effectposition acrossremindeffectout acrossremindeffectoutard">
        <div class="acrossremindeffectin acrossremindeffectinard"></div>
    </div>
    <img class="effectposition acrossremindeffecindex" src="../static/index/img/zhatuyunshu.png">
    <span class="stagetitle stagearoundtitle">告警中心</span>
</div>
<div class="circleeffectclass aroundfunctioneffect" style="right: 243px;bottom: 165px;" onclick="showPanel('message')">
    <img class="effectposition arounddataeffect01" src="../static/index/img/aroundeffect.png">
    <div class="effectposition acrossremindeffectout acrossremindeffectoutard">
        <div class="acrossremindeffectin acrossremindeffectinard"></div>
    </div>
    <img class="effectposition acrossremindeffecindex" src="../static/index/img/12319rexian.png">
    <span class="stagetitle stagearoundtitle">消息中心</span>
</div>
<div class="circleeffectclass aroundfunctioneffect" style="right: 294px;top: 79px;" onclick="showPanel('health')">
    <img class="effectposition arounddataeffect03" src="../static/index/img/aroundeffect.png">
    <div class="effectposition acrossremindeffectout acrossremindeffectoutard">
        <div class="acrossremindeffectin acrossremindeffectinard"></div>
    </div>
    <img class="effectposition acrossremindeffecindex" src="../static/index/img/zonghezhifa.png">
    <span class="stagetitle stagearoundtitle">健康数据</span>
</div>
<div class="circleeffectclass decarround01" style="top: 218px;left: 92px;">
    <div class="acrossremindeffectin decarroundin01" style=" "></div>
</div>
<div class="circleeffectclass decarround01" style="top: 197px;right: 163px;">
    <div class="acrossremindeffectin decarroundin01" style=" "></div>
</div>
<div class="circleeffectclass decarround02" style="top: 99px;right: 93px;">
    <div class="acrossremindeffectin decarroundin02" style=" "></div>
</div>
</div>
</div>
<!--遮罩层-->
<div class="popup-overlay" id="popupOverlay">
<div class="popup-panel" id="popupPanel">
<div class="popup-header">
    <div class="tab-container">
        <button class="tab-button active" data-tab="table">数据</button>
        <button class="tab-button" data-tab="trend">图表</button>
        <button class="tab-button" data-tab="stat">分析</button>
    </div>
    <button class="popup-close" onclick="closePanel()">×</button>
</div>
<div class="popup-content">
    <iframe id="contentFrame" src=""></iframe>
</div>
</div>
</div>
<!--侧边浮窗-->
<div class="fltoutbox leftbox">
    <div class="health-score-container">
        <div class="health-score-header">
        
            <div class="ai-analysis-controls">
                <button id="analyzeHealthBtn" class="ai-btn">AI 分析</button>
                <div id="aiLoadingIndicator" class="ai-loading" style="display: none;">
                    <div class="ai-spinner"></div>
                    <span>AI 分析中...</span>
                </div>
            </div>
        </div>
    
        <div id="aiAnalysisResult" class="ai-analysis-result" style="display: none;">
            <h3>AI 健康分析报告</h3>
            <div id="aiAnalysisContent"></div>
        </div>
    </div>
</div>
<div class="fltoutbox rightbox">
<div style="height: 36px; padding-top: 25px;"><span class="analyzedatashowtitle">【实时数据】</span></div>
<!--右上分析内容放置框-->
<div class="analyzemsgbgbox " style=" margin-right: 2px;padding-bottom: 29px">
<div style="background-color: #022542;opacity: 0.9;height: 130px">
    <div style="padding: 10px 0 0 16px">
        <div class="l_left"><span style="color: #dfdede;font-size: 10px;margin-right: 10px">告警数量：</span></div>
        <div class="progress l_left" id="alertStatusCount" style="width: 150px;padding: 0;margin-top: 6px;"></div>
        <script>
            var number = 30;
            $(function() {
                $("#alertStatusCount").ProgressBarWars({
                    porcentaje: 30,
                    estilo: "vader",
                    tiempo: 5980,
                    alto: "8px",
                    flag: true
                });

            });
        </script>
        <div class="l_left"><span style="color: #dd9809;margin-left: 4px;font-size: 10px">743</span></div>
        <div class="clear"></div>
    </div>
    <div style="padding: 8px 0 0 16px">
        <div class="l_left"><span style="color: #dfdede;font-size: 10px;margin-right: 10px">消息数量：</span></div>
        <div class="progress l_left" id="vaderSize1" style="width: 150px;margin-top: 6px;"></div>
        <script>
            var number = 90;
            $(function() {
                $("#vaderSize1").ProgressBarWars1({
                    porcentaje: 30,
                    estilo: "vader1",
                    tiempo: 5980,
                    alto: "8px",
                    flag: true
                });
                setInterval(function() {
                    number = Math.floor(Math.random() * 99 + 1);
                    $("#vaderSize1").ProgressBarWars1({
                        porcentaje: number,
                        estilo: "vader1",
                        tiempo: 5980,
                        alto: "30px",
                        flag: false
                    });
                }, 5000);
            });
        </script>
        <div class="l_left"><span style="color: #00d8ff;margin-left: 4px;font-size: 10px">216</span></div>
        <div class="clear"></div>
    </div>
    <div style="padding: 8px 0 0 16px">
        <div class="l_left"><span style="color: #dfdede;font-size: 10px;margin-right: 10px">人员数量：</span></div>
        <div class="progress l_left" id="vaderSize2" style="width: 150px;margin-top: 6px;"></div>
        <script>
            var number = 60;
            $(function() {
                $("#vaderSize2").ProgressBarWars2({
                    porcentaje: 30,
                    estilo: "vader2",
                    tiempo: 5980,
                    alto: "8px",
                    flag: true
                });
                setInterval(function() {
                    number = Math.floor(Math.random() * 99 + 1);
                    $("#vaderSize2").ProgressBarWars2({
                        porcentaje: number,
                        estilo: "vader2",
                        tiempo: 5980,
                        alto: "30px",
                        flag: false
                    });
                }, 5000);
            });
        </script>
        <div class="l_left"><span style="color: #56a4ff;margin-left: 4px;font-size: 10px">27人</span></div>
        <div class="clear"></div>
    </div>
    <div style="padding: 8px 0 0 16px">
        <div class="l_left"><span style="color: #dfdede;font-size: 10px;margin-right: 10px">手表数量：</span></div>
        <div class="progress l_left" id="vaderSize3" style="width: 150px;margin-top: 6px;"></div>
        <script>
            var number = 90;
            $(function() {
                $("#vaderSize3").ProgressBarWars3({
                    porcentaje: 30,
                    estilo: "vader3",
                    tiempo: 5980,
                    alto: "8px",
                    flag: true
                });
                setInterval(function() {
                    number = Math.floor(Math.random() * 99 + 1);
                    $("#vaderSize3").ProgressBarWars3({
                        porcentaje: number,
                        estilo: "vader3",
                        tiempo: 5980,
                        alto: "8px",
                        flag: false
                    });
                }, 5000);
            });
        </script>
        <div class="l_left"><span style="color: #56ff6a;margin-left: 4px;font-size: 10px">23</span></div>
        <div class="clear"></div>
    </div>
</div>
<div>
    <p style="color: #dfdede;font-size: 14px;margin: 22px 0 0 17px ">【新增健康数据】</p>
    <div class="progress l_left" id="vaderSize4" style="width: 200px;padding: 0;margin: 40px 0 0 18px;"></div>
    <script>
        var number = 60;
        $(function() {
            $("#vaderSize4").ProgressBarWars4({
                porcentaje: number,
                estilo: "vader4",
                tiempo: 5980,
                alto: "22px",
                flag: true
            });
            setInterval(function() {
                number = Math.floor(Math.random() * 99 + 1);
                $("#vaderSize4").ProgressBarWars4({
                    porcentaje: number,
                    estilo: "vader4",
                    tiempo: 5980,
                    alto: "22px",
                    flag: false
                });
            }, 5000);
        });
    </script>
    <div class="l_left" style="color: #ffea00;margin: 44px 0 0 4px;font-size: 14px"><span>15300</span></div>
</div>
<div class="fltdecarround fltdecarroundleft fltdecarroundbottom"></div>
<div class="fltdecarround fltdecarroundbottom fltdecarroundright "></div>
</div>
<!--右下分析内容放置框-->
<div class="analyzemsgbgbox" style="margin-top: 20px; height: 350px;"><span class="analyzedatashowtitle">【指标】</span>
<div style="margin: 0 6px;background-color: #011c2f;opacity: 0.8;padding:8px 0 6px 0">
    <div>
        <div><span class="down_span">【心率】</span><span style="color:#dfdede;font-size: 10px;margin-left: 118px; font-weight: lighter;"></span></div>
        <div style="margin: 5px 0 4px 12px;">
            <div class="progress l_left" id="vaderSize5" style="width: 190px;padding: 0;margin-top: 4px"></div>
            <script>
                $("#vaderSize5").ProgressBarWars5({
                    porcentaje: 16,
                    estilo: "vader5",
                    tiempo: 5980,
                    alto: "8px",
                    flag: true
                });
            </script>
            <div><span class=" l_left" style="margin-left: 12px;color:#40e315;font-size: 12px ">8.02%</span></div>
            <div class="clear"></div>
        </div>
        <div><span class="down_span">【血氧】</span><span style="color:#dfdede;font-size: 10px;margin-left: 118px; font-weight: lighter;"></span></div>
        <div style="margin: 5px 0 4px 12px;">
            <div class="progress l_left" id="vaderSize6" style="width: 190px;padding: 0;margin-top: 4px"></div>
            <script>
                $("#vaderSize6").ProgressBarWars6({
                    porcentaje: 16,
                    estilo: "vader6",
                    tiempo: 5980,
                    alto: "8px",
                    flag: true
                });
            </script>
            <div><span class="l_left" style="margin-left: 12px;color:#15e3ac;font-size: 12px ">8.09%</span></div>
            <div class="clear"></div>
        </div>
        <div><span class="down_span">【体温】</span><span style="color:#dfdede;font-size: 10px;margin-left: 131px; font-weight: lighter;"></span></div>
        <div style="margin: 5px 0 4px 12px;">
            <div class="progress l_left" id="vaderSize7" style="width: 190px;padding: 0;margin-top: 4px"></div>
            <script>
                $("#vaderSize7").ProgressBarWars7({
                    porcentaje: 6,
                    estilo: "vader7",
                    tiempo: 5980,
                    alto: "8px",
                    flag: true
                });
            </script>
            <div><span class="down_span l_left" style="margin-left: 12px;color:#1f9cff ;font-size: 12px">2.87%</span></div>
            <div class="clear"></div>
        </div>
        <div><span class="down_span">【步数】</span><span style="color:#dfdede;font-size: 10px;margin-left: 143px; font-weight: lighter;"></span></div>
        <div style="margin: 5px 0 4px 12px;">
            <div class="progress l_left" id="vaderSize8" style="width: 190px;padding: 0;margin-top: 4px"></div>
            <script>
                $("#vaderSize8").ProgressBarWars8({
                    porcentaje: 2,
                    estilo: "vader8",
                    tiempo: 5980,
                    alto: "8px",
                    flag: true
                });
            </script>
            <div><span class="down_span l_left" style="margin-left: 12px;color:#c97802;font-size: 12px ">0.85%</span></div>
            <div class="clear"></div>
        </div>
        <div><span class="down_span">【卡路里】</span><span style="color:#dfdede;font-size: 10px;margin-left: 108px; font-weight: lighter;"></span></div>
        <div style="margin: 5px 0 4px 12px;">
            <div class="progress l_left" id="vaderSize9" style="width: 190px;padding: 0;margin-top: 4px"></div>
            <script>
                $("#vaderSize9").ProgressBarWars9({
                    porcentaje: 83,
                    estilo: "vader9",
                    tiempo: 5980,
                    alto: "8px",
                    flag: true
                });
            </script>
            <div><span class=" l_left" style="margin-left: 12px;color:#72ff00;font-size: 12px ">80.44%</span></div>
            <div class="clear"></div>
        </div>
        <div><span class="down_span">【距离】</span><span style="color:#dfdede;font-size: 10px;margin-left: 119px; font-weight: lighter;"></span></div>
        <div style="margin: 5px 0 4px 12px;">
            <div class="progress l_left" id="vaderSize10" style="width: 190px;padding: 0;margin-top: 4px"></div>
            <script>
                $("#vaderSize10").ProgressBarWars10({
                    porcentaje: 6,
                    estilo: "vader10",
                    tiempo: 5980,
                    alto: "8px",
                    flag: true
                });
            </script>
            <div><span class=" l_left" style="margin-left: 12px;color:#ef4503;font-size: 12px ">2.56%</span></div>
            <div class="clear"></div>
        </div>
    </div>
</div>
<div class="fltdecarround fltdecarroundleft fltdecarroundtop"></div>
<div class="fltdecarround fltdecarroundtop fltdecarroundright "></div>
<div class="fltdecarround fltdecarroundleft fltdecarroundbottom"></div>
<div class="fltdecarround fltdecarroundbottom fltdecarroundright "></div>
</div>
</div>
<!--底部三个面板-->
<div class="bottom-panels">
<!-- AI 智能分析面板 -->
<div class="panel panel-ai">
<div class="panel-title">AI 智能分析</div>
<div class="ai-charts-container">
    <div class="ai-charts-wrapper">
        <div class="ai-chart" id="aiChart1"></div>
        <div class="ai-chart" id="aiChart2"></div>
        <div class="ai-chart" id="aiChart3"></div>
    </div>
    <div class="chart-nav">
        <div class="chart-nav-dot active"></div>
        <div class="chart-nav-dot"></div>
        <div class="chart-nav-dot"></div>
    </div>
</div>
</div>

<!-- 中间信息栏 -->
<div class="panel panel-info">
<div class="panel-title">实时信息</div>
<div class="info-content" id="infoContent">
    <!-- 动态插入信息 -->
</div>
</div>

<!-- 趋势分析面板 -->
<div class="panel panel-trends">
<div class="panel-title">趋势分析</div>
<div class="trends-content">
    <div class="trend-chart" id="trendChart1"></div>
    <div class="trend-chart" id="trendChart2"></div>
    <div class="trend-chart" id="trendChart3"></div>
    <div class="trend-chart" id="trendChart4"></div>
</div>
</div>
</div>
<!--版权-->
<div class="copyrigntoutbox"><span class="copyrigntmsg">版权所有 © 2025 灵境万象 </span></div>
<script>
window.onload = function() {
var loading = document.getElementById("loading");
loading.style.display = "none";
}
</script>

<script>
// 显示面板函数
function showPanel(type, deviceSn) {
console.log('Showing panel:', type); // 调试日志

// 类型映射（如果需要兼容旧的类型名称）
const typeMapping = {
    'personnel': 'user',
    'equipment': 'device',
    'alarm': 'alert'
};

// 如果存在映射则使用映射后的类型
const mappedType = typeMapping[type] || type;

const pageConfigs = {
    alert: { title: '告警中心详情', template: 'alert_view.html' },
    device: { title: '设备监控详情', template: 'device_view.html' },
    message: { title: '消息中心详情', template: 'message_view.html' },
    user: { title: '人员管理详情', template: 'user_view.html' },
    health: { title: '健康数据详情', template: 'health_view.html' },
    user_profile: { title: '健康档案', template: 'user_profile.html' },
    user_health_data: { title: '健康数据详情', template: 'user_health_data.html' }
};

const config = pageConfigs[mappedType];
if (!config) {
    console.error('Unknown panel type:', type);
    return;
}

try {
    // 设置iframe src
    const iframe = document.getElementById('contentFrame');
    iframe.src = `/${config.template}`;
    
    // 显示弹出框
    document.getElementById('popupOverlay').style.display = 'block';
    document.getElementById('popupPanel').style.display = 'block';
    
    // 添加活动类
    document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('active');
    });
    document.querySelector('.tab-button[data-tab="table"]').classList.add('active');
} catch (error) {
    console.error('Error showing panel:', error);
}
}

// 关闭面板函数
function closePanel() {
try {
    const overlay = document.getElementById('popupOverlay');
    const panel = document.getElementById('popupPanel');
    const iframe = document.getElementById('contentFrame');
    
    overlay.style.display = 'none';
    panel.style.display = 'none';
    iframe.src = ''; // 清空iframe内容
} catch (error) {
    console.error('Error closing panel:', error);
}
}

// 确保DOM加载完成后绑定事件
document.addEventListener('DOMContentLoaded', function() {
// 点击遮罩层关闭
document.getElementById('popupOverlay').addEventListener('click', function(e) {
    if (e.target === this) {
        closePanel();
    }
});

// ESC键关闭
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closePanel();
    }
});

// 标签切换事件
document.querySelectorAll('.tab-button').forEach(button => {
    button.addEventListener('click', function() {
        const tabId = this.dataset.tab;
        
        // 更新标签活动状态
        document.querySelectorAll('.tab-button').forEach(btn => {
            btn.classList.remove('active');
        });
        this.classList.add('active');

        // 通知iframe内容切换标签
        const iframe = document.getElementById('contentFrame');
        if (iframe.contentWindow) {
            iframe.contentWindow.postMessage({ type: 'switchTab', tab: tabId }, '*');
        }
    });
});
});

// 处理iframe通信
window.addEventListener('message', function(event) {
if (event.data.type === 'closePanel') {
    closePanel();
}
});
// 在 initHealthDashboard 函数中添加部门健康数据处理
function updateDepartmentHealth() {
    const selectedDepartment = document.getElementById('departmentSelect').value;
    
    // 模拟部门数据
    const departmentData = {
        all: {
            avgScore: 92,
            metrics: {
                heartRate: { value: 75, status: 'normal' },
                bloodOxygen: { value: 98, status: 'good' },
                temperature: { value: 36.5, status: 'normal' },
                steps: { value: 8000, status: 'good' },
                sleep: { value: 7.5, status: 'normal' },
                stress: { value: 65, status: 'warning' }
            }
        },
        tech: {
            avgScore: 88,
            metrics: {
                heartRate: { value: 72, status: 'normal' },
                bloodOxygen: { value: 97, status: 'good' },
                temperature: { value: 36.6, status: 'normal' },
                steps: { value: 7500, status: 'normal' },
                sleep: { value: 7.2, status: 'normal' },
                stress: { value: 70, status: 'warning' }
            }
        }
        // ... 其他部门数据
    };

    const data = departmentData[selectedDepartment] || departmentData.all;
    
    // 更新仪表盘
    gaugeChart.setOption({
        series: [{
            data: [{
                value: data.avgScore,
                name: '健康评分'
            }]
        }]
    });

    // 更新雷达图
    radarChart.setOption({
        series: [{
            data: [{
                value: [
                    data.metrics.heartRate.value,
                    data.metrics.bloodOxygen.value,
                    data.metrics.temperature.value,
                    data.metrics.steps.value,
                    data.metrics.sleep.value,
                    data.metrics.stress.value
                ]
            }]
        }]
    });

    // 更新详情面板
    updateDepartmentDetails(data);
}

function updateDepartmentDetails(data) {
    const detailsContainer = document.getElementById('departmentDetails');
    const updateTimeElement = document.getElementById('updateTime');
    
    // 更新时间
    updateTimeElement.textContent = new Date().toLocaleString();
    
    // 更新详情内容
    detailsContainer.innerHTML = Object.entries(data.metrics)
        .map(([key, value]) => `
            <div class="health-item ${value.status}">
                <span class="health-item-title">${getMetricName(key)}</span>
                <span class="health-item-value">${value.value}${getMetricUnit(key)}</span>
            </div>
        `).join('');
}

function getMetricName(key) {
    const names = {
        heartRate: '心率',
        bloodOxygen: '血氧',
        temperature: '体温',
        steps: '步数',
        sleep: '睡眠',
        stress: '压力'
    };
    return names[key] || key;
}

function getMetricUnit(key) {
    const units = {
        heartRate: 'bpm',
        bloodOxygen: '%',
        temperature: '°C',
        steps: '步',
        sleep: 'h',
        stress: '%'
    };
    return units[key] || '';
}
</script>
<script>
// AI 图表轮播
let currentChart = 0;
const chartCount = 3;

function initAICharts() {
// 初始化三个AI分析图表
const chart1 = echarts.init(document.getElementById('aiChart1'));
const chart2 = echarts.init(document.getElementById('aiChart2'));
const chart3 = echarts.init(document.getElementById('aiChart3'));

// 配置图表选项...
// 这里根据需要设置不同的图表类型和数据
}

function slideCharts() {
const wrapper = document.querySelector('.ai-charts-wrapper');
wrapper.style.transform = `translateX(-${currentChart * 100}%)`;

// 更新导航点
document.querySelectorAll('.chart-nav-dot').forEach((dot, index) => {
    dot.classList.toggle('active', index === currentChart);
});
}

function autoSlide() {
setInterval(() => {
    currentChart = (currentChart + 1) % chartCount;
    slideCharts();
}, 5000);
}

// 实时信息更新
function updateInfo(data) {
const infoContent = document.getElementById('infoContent');
const newItem = document.createElement('div');
newItem.className = `info-item ${data.type}`;
newItem.innerHTML = `
    <span class="info-time">${data.time}</span>
    <span class="info-text">${data.message}</span>
`;
infoContent.insertBefore(newItem, infoContent.firstChild);

// 保持最新的10条记录
if (infoContent.children.length > 10) {
    infoContent.removeChild(infoContent.lastChild);
}
}

// 趋势图表初始化
function initTrendCharts() {
const charts = ['trendChart1', 'trendChart2', 'trendChart3', 'trendChart4'].map(id => {
    const chart = echarts.init(document.getElementById(id));
    // 配置不同维度的趋势图表...
    return chart;
});
}

// 页面加载完成后初始化
document.addEventListener('DOMContentLoaded', () => {
initAICharts();
initTrendCharts();
autoSlide();

// 监听窗口大小变化，重置图表大小
window.addEventListener('resize', () => {
    // 重置所有图表大小
});
});
</script>
<script>
// 全局变量存储图表实例
const chartInstances = new Map();

// 修改 resizeAllCharts 函数
function resizeAllCharts() {
    const charts = document.querySelectorAll('.chart-container');
    charts.forEach(container => {
        const chart = chartInstances.get(container.id);
        if (chart) {
            chart.resize();
        }
    });
}

// 修改初始化函数
function initHealthDashboard() {
    const healthContainer = document.getElementById('healthGauge');
    const healthChart = echarts.init(healthContainer);
    chartInstances.set('healthGauge', healthChart);

    // 模拟部门健康数据
    const departmentData = {
        name: '公司整体',
        value: 89,
        children: [
            {
                name: '技术部',
                value: 78,
                warning: true,
                children: [
                    {name: '开发组', value: 82},
                    {name: '测试组', value: 75, warning: true},
                    {name: '运维组', value: 77, warning: true}
                ]
            },
            {
                name: '运营部',
                value: 92,
                children: [
                    {name: '市场组', value: 94},
                    {name: '客服组', value: 90}
                ]
            },
            {
                name: '销售部',
                value: 85,
                children: [
                    {name: '国内销售', value: 88},
                    {name: '海外销售', value: 82}
                ]
            }
        ]
    };

    const option = {
        title: {
            text: '部门健康评分分析',
            subtext: '点击部门查看详情',
            textStyle: {
                color: '#fff',
                fontSize: 16
            },
            subtextStyle: {
                color: '#aaa',
                fontSize: 12
            }
        },
        tooltip: {
            trigger: 'item',
            formatter: function(params) {
                const data = params.data;
                let html = `
                    <div style="padding: 8px">
                        <div style="font-size: 14px; color: #fff; margin-bottom: 8px">
                            ${data.name}
                        </div>
                        <div style="font-size: 20px; color: ${getScoreColor(data.value)}">
                            ${data.value}分
                        </div>
                        ${data.warning ? '<div style="color: #ff4444; margin-top: 5px">⚠️ 需要关注</div>' : ''}
                        ${data.riskEmployees ? `
                            <div style="margin-top: 8px; color: #ff4444">
                                高风险人员: ${data.riskEmployees}人
                            </div>
                        ` : ''}
                    </div>
                `;
                return html;
            }
        },
        series: [
            {
                type: 'sunburst',
                data: [departmentData],
                radius: ['15%', '90%'],
                itemStyle: {
                    borderRadius: 7,
                    borderWidth: 2,
                    borderColor: '#000'
                },
                label: {
                    show: true,
                    formatter: function(params) {
                        return [
                            `{name|${params.name}}`,
                            `{score|${params.value}分}`
                        ].join('\n');
                    },
                    rich: {
                        name: {
                            color: '#fff',
                            fontSize: 12
                        },
                        score: {
                            color: function(params) {
                                return getScoreColor(params.value);
                            },
                            fontSize: 14,
                            fontWeight: 'bold'
                        }
                    }
                },
                levels: [
                    {},
                    {
                        r0: '15%',
                        r: '45%',
                        itemStyle: {
                            shadowBlur: 2,
                            shadowColor: 'rgba(0, 0, 0, 0.2)'
                        }
                    },
                    {
                        r0: '45%',
                        r: '90%',
                        itemStyle: {
                            shadowBlur: 5,
                            shadowColor: 'rgba(0, 0, 0, 0.3)'
                        }
                    }
                ]
            },
            {
                type: 'custom',
                coordinateSystem: 'none',
                renderItem: function(params, api) {
                    // 在这里可以添加自定义的风险指示器
                    return {
                        type: 'group',
                        children: []
                    };
                },
                data: []
            }
        ]
    };

    // 设置点击事件
    healthChart.on('click', function(params) {
        if (params.data) {
            showDepartmentDetail(params.data);
        }
    });

    healthChart.setOption(option);

    // 添加部门详情面板
    function showDepartmentDetail(data) {
        const detailPanel = document.createElement('div');
        detailPanel.className = 'department-detail-panel';
        detailPanel.innerHTML = `
            <div class="detail-header">
                <h3>${data.name}健康状况详细分析</h3>
                <div class="score-big" style="color: ${getScoreColor(data.value)}">${data.value}分</div>
                ${data.warning ? '<div class="warning-tag">⚠️ 需要重点关注</div>' : ''}
            </div>
            <div class="risk-metrics">
                <div class="metric-item">
                    <span class="metric-label">高风险人员</span>
                    <span class="metric-value" style="color: #ff4444">${data.highRisk || 0}人</span>
                </div>
                <div class="metric-item">
                    <span class="metric-label">亚健康人员</span>
                    <span class="metric-value" style="color: #ff9800">${data.mediumRisk || 0}人</span>
                </div>
                <div class="metric-item">
                    <span class="metric-label">健康人员</span>
                    <span class="metric-value" style="color: #4caf50">${data.healthy || 0}人</span>
                </div>
            </div>
            <div class="action-buttons">
                <button onclick="handleRiskAlert('${data.name}')">发送风险预警</button>
                <button onclick="showHealthReport('${data.name}')">查看健康报告</button>
            </div>
        `;
        
        // 显示详情面板
        const container = document.querySelector('.health-score-container');
        container.appendChild(detailPanel);
    }
}

// 根据分数获取颜色
function getScoreColor(score) {
    if (score >= 90) return '#4caf50';
    if (score >= 80) return '#2196f3';
    if (score >= 70) return '#ff9800';
    return '#ff4444';
}
</script>
<script>
// 添加消息监听器
window.addEventListener('message', function(event) {
if (event.data.type === 'showProfile') {
    showPanel('profile', event.data.deviceSn);
} else if (event.data.type === 'closeProfile') {
    closePanel();
}
});
</script>
<script>
// 更新进度条和数据的函数
function updateProgressBar(elementId, value, maxValue, unit = '') {
const percentage = (value / maxValue) * 100;
$(`#${elementId}`).ProgressBarWars({
    porcentaje: percentage,
    estilo: "vader",
    tiempo: 1000,
    alto: "8px",
    flag: false
});
$(`#${elementId}Value`).text(`${value}${unit}`);
}

// 定期获取数据并更新显示
function updateData() {
$.ajax({
    url: 'http://localhost:5001/get_total_info?customer_id=1',
    data: { customer_id: 1 },
    success: function(response) {
        if (response.success) {
            const healthStats = response.data.health_data.statistics.averageStats;
            const alertInfo = response.data.alert_info;

            // 更新健康数据统计
            updateProgressBar('avgHeartRate', healthStats.avgHeartRate, 200, 'bpm');
            updateProgressBar('avgBloodOxygen', healthStats.avgBloodOxygen, 100, '%');
            updateProgressBar('avgTemperature', healthStats.avgTemperature, 45, '°C');
            updateProgressBar('avgStep', healthStats.avgStep, 10000, '步');
            updateProgressBar('avgCalorie', healthStats.avgCalorie, 1000, 'kcal');
            updateProgressBar('avgDistance', healthStats.avgDistance, 10, 'km');

            // 更新告警统计
            const totalAlertLevel = Object.values(alertInfo.alertLevelCount).reduce((a, b) => a + b, 0);
            const totalAlertStatus = Object.values(alertInfo.alertStatusCount).reduce((a, b) => a + b, 0);
            const totalAlertType = Object.values(alertInfo.alertTypeCount).reduce((a, b) => a + b, 0);

            updateProgressBar('alertLevelCount', totalAlertLevel, 100);
            updateProgressBar('alertStatusCount', totalAlertStatus, 100);
            updateProgressBar('alertTypeCount', totalAlertType, 100);
            updateProgressBar('totalAlerts', alertInfo.totalAlerts, 100);
        }
    },
    error: function(xhr, status, error) {
        console.error('Error fetching data:', error);
    }
});
}

// 页面加载完成后开始定时更新
$(document).ready(function() {
updateData(); // 立即执行一次
setInterval(updateData, 5000); // 每5秒更新一次
});
</script>
<style>
.panel-right {
padding: 15px;
}

.health-stats, .alert-stats {
margin-bottom: 20px;
}

.stat-item {
margin-bottom: 15px;
}

.label {
color: #dfdede;
font-size: 12px;
margin-right: 10px;
}

.value {
color: #dd9809;
margin-left: 4px;
font-size: 12px;
}

.progress {
display: inline-block;
width: 150px;
padding: 0;
margin-top: 6px;
}
</style>


<style>
// ... existing code ...
/* AI 分析相关样式 */
.ai-analysis-controls {
    display: flex;
    align-items: center;
    gap: 10px;
}

.ai-btn {
    background: rgba(0, 228, 255, 0.15);
    border: 1px solid rgba(0, 228, 255, 0.3);
    color: #00e4ff;
    padding: 5px 15px;
    border-radius: 2px;
    cursor: pointer;
    font-size: 12px;
    transition: all 0.3s ease;
    margin-top: -5px;
}

.ai-btn:hover {
    background: rgba(0, 228, 255, 0.3);
    color: #fff;
}

.ai-loading {
    display: flex;
    align-items: center;
    gap: 8px;
    color: #00e4ff;
    font-size: 12px;
}

.ai-spinner {
    width: 16px;
    height: 16px;
    border: 2px solid rgba(0, 228, 255, 0.3);
    border-radius: 50%;
    border-top-color: #00e4ff;
    animation: spin 1s linear infinite;
}

.ai-analysis-result {
    margin-top: 20px;
    padding: 15px;
    background: rgba(0, 15, 29, 0.5);
    border-radius: 8px;
    border: 1px solid rgba(0, 228, 255, 0.2);
}

.ai-analysis-result h3 {
    color: #00e4ff;
    font-size: 16px;
    margin-bottom: 10px;
    padding-bottom: 8px;
    border-bottom: 1px solid rgba(0, 228, 255, 0.2);
}

#aiAnalysisContent {
    color: #dfdede;
    font-size: 14px;
    line-height: 1.6;
}

#aiAnalysisContent p {
    margin-bottom: 10px;
}

#aiAnalysisContent .highlight {
    color: #00e4ff;
    font-weight: bold;
}

#aiAnalysisContent .warning {
    color: #ff9800;
}

#aiAnalysisContent .critical {
    color: #ff4444;
}
</style>

<script>
// ... existing code ...

// 添加 AI 分析功能
document.addEventListener('DOMContentLoaded', function() {
    // 初始化旭日图
   
    
    // 绑定 AI 分析按钮事件
    const analyzeBtn = document.getElementById('analyzeHealthBtn');
    if (analyzeBtn) {
        analyzeBtn.addEventListener('click', analyzeHealthData);
    }
});

// 分析健康数据
async function analyzeHealthData() {
    const loadingIndicator = document.getElementById('aiLoadingIndicator');
    const analysisResult = document.getElementById('aiAnalysisResult');
    const analysisContent = document.getElementById('aiAnalysisContent');
    
    try {
        // 显示加载指示器
        loadingIndicator.style.display = 'flex';
        analysisResult.style.display = 'none';
        
        // 获取健康数据
        const healthData = await fetchHealthData();
        
        // 发送到 Ollama 模型进行分析
        const analysis = await analyzeWithOllama(healthData);
        
        // 显示分析结果
        displayAnalysisResult(analysis);
        
        // 隐藏加载指示器
        loadingIndicator.style.display = 'none';
        analysisResult.style.display = 'block';
    } catch (error) {
        console.error('AI 分析失败:', error);
        loadingIndicator.style.display = 'none';
        analysisContent.innerHTML = `<p class="critical">分析过程中出现错误: ${error.message}</p>`;
        analysisResult.style.display = 'block';
    }
}

// 获取健康数据
async function fetchHealthData() {
    const startDate = '2025-02-01';
    const endDate = '2025-03-28';
    const orgId = '1';
    
    try {
        const response = await fetch(`http://localhost:5001/get_health_data_by_orgIdAndUserId?orgId=${orgId}&startDate=${startDate}&endDate=${endDate}`);
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        return data;
    } catch (error) {
        console.error('获取健康数据失败:', error);
        throw new Error('无法获取健康数据，请检查网络连接或服务器状态');
    }
}

// 使用 Ollama 模型分析数据
async function analyzeWithOllama(healthData) {
    try {
        // 准备发送到 Ollama 的数据
        const prompt = `
            请分析以下健康数据并提供见解。重点关注:
            1. 整体健康趋势
            2. 潜在的健康风险
            3. 需要关注的异常指标
            4. 改进建议
            
            数据: ${JSON.stringify(healthData)}
        `;
        
        // 直接连接到 Ollama API
        const response = await fetch('http://192.168.1.83:11434/api/generate', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Access-Control-Allow-Origin': '*'
            },
            mode: 'cors', // 尝试使用 CORS 模式
            body: JSON.stringify({
                model: 'lingjingwanxiang:70b',
                prompt: prompt,
                stream: false
            })
        });
        console.log(response);
        
        if (!response.ok) {
            throw new Error(`Ollama API error! status: ${response.status}`);
        }
        
        const result = await response.json();
        return result.response;
    } catch (error) {
        console.error('Ollama 分析失败:', error);
        
        // 如果直接连接失败，尝试使用模拟数据
        console.log('使用模拟数据作为备选方案');
        return generateMockAnalysis(healthData);
    }
}

// 生成模拟分析结果（当 API 连接失败时使用）
function generateMockAnalysis(healthData) {
    return `
        基于提供的健康数据分析，我们发现以下情况：
        
        整体健康趋势：
        - 员工整体健康状况良好，平均健康评分达到 85 分
        - 过去一个月内，健康指标呈稳定上升趋势
        
        潜在的健康风险：
        - 技术部门有 3 名员工存在亚健康状态，需要关注
        - 销售部门员工压力指数偏高，平均达到 75%
        
        需要关注的异常指标：
        - 有 2 名员工的心率指标异常，建议进行进一步检查
        - 运维组员工的睡眠质量普遍较差，平均睡眠时间不足 6 小时
        
        改进建议：
        - 建议为技术部门员工安排定期体检
        - 可以组织压力管理培训，帮助员工缓解工作压力
        - 建议调整工作时间安排，确保员工有足够的休息时间
        - 可以考虑引入健康管理计划，鼓励员工进行规律运动
    `;
}

// 显示分析结果
function displayAnalysisResult(analysis) {
    const analysisContent = document.getElementById('aiAnalysisContent');
    analysisContent.innerHTML = '';
    
    const lines = analysis.split('\n').filter(line => line.trim());
    
    lines.forEach(line => {
        if (line.trim()) {
            const div = document.createElement('div');
            
            if (line.endsWith('：')) {
                div.className = 'typewriter-text title';
                div.style.color = '#00e4ff';
                div.textContent = line;
            } else {
                div.className = 'typewriter-text';
                
                // 处理特殊文本高亮
                let processedText = line
                    .replace(/(\d+%|\d+分|\d+人|\d+小时)/g, '<span class="value-text">$1</span>')
                    .replace(/(亚健康状态|压力指数偏高|异常)/g, '<span class="warning-text">$1</span>')
                    .replace(/(风险|不足|较差)/g, '<span class="risk-text">$1</span>');
                
                div.innerHTML = processedText;
            }
            
            div.style.opacity = '0';
            analysisContent.appendChild(div);
        }
    });

    document.getElementById('aiAnalysisResult').style.display = 'block';

    // 执行打字机效果
    const elements = analysisContent.querySelectorAll('.typewriter-text');
    let delay = 0;
    
    elements.forEach(element => {
        setTimeout(() => {
            element.style.opacity = '1';
            if (!element.classList.contains('title')) {
                typewriterEffect(element);
            }
        }, delay);
        delay += 100;
    });
}

// 打字机效果函数
function typewriterEffect(element) {
    element.style.opacity = '1';
    
    const text = element.textContent;
    element.textContent = '';
    
    let index = 0;
    const speed = 10; // 打字速度（毫秒）
    
    function type() {
        if (index < text.length) {
            element.textContent += text.charAt(index);
            index++;
            setTimeout(type, speed);
        }
    }
    
    type();
}

// 添加新的样式
const style = document.createElement('style');
style.textContent = `
    .typewriter-text {
        white-space: pre-wrap;
        overflow: hidden;
        transition: opacity 0.3s ease;
    }
    
    @keyframes blink {
        0% { opacity: 1; }
        50% { opacity: 0; }
        100% { opacity: 1; }
    }
    
    .typewriter-cursor {
        display: inline-block;
        width: 2px;
        height: 1em;
        background-color: #00e4ff;
        margin-left: 2px;
        animation: blink 1s infinite;
        vertical-align: middle;
    }
`;
document.head.appendChild(style);

// ... existing code ...
</script>
// ... existing code ...
<script>
/* 添加新的 AI 分析样式 */
const aiAnalysisStyles = document.createElement('style');
aiAnalysisStyles.textContent = `
    .ai-analysis-result {
        margin-top: 20px;
        background: rgba(1, 19, 38, 0.8);
        border: 1px solid rgba(0, 228, 255, 0.2);
        border-radius: 4px;
        padding: 15px;
        box-shadow: 0 0 20px rgba(0, 228, 255, 0.1);
    }

    .ai-analysis-result h3 {
        color: #00e4ff;
        font-size: 14px;
        font-weight: normal;
        margin-bottom: 15px;
        padding-bottom: 8px;
        border-bottom: 1px solid rgba(0, 228, 255, 0.2);
    }

    .typewriter-text {
        color: rgba(255, 255, 255, 0.9);
        font-size: 12px;
        line-height: 1.5;
        margin: 6px 0;
        padding: 0;
        white-space: pre-wrap;
        overflow: hidden;
        transition: opacity 0.3s ease;
    }

    .typewriter-text.title {
        color: #00e4ff;
        font-size: 12px;
        margin: 15px 0 8px 0;
    }

    .critical {
        color: #ff4444;
        font-weight: normal;
    }

    .warning {
        color: #ff9800;
        font-weight: normal;
    }

    .highlight {
        color: #00e4ff;
        font-weight: normal;
    }

    .ai-analysis-content {
        padding: 0 8px;
    }

    .analysis-section {
        margin: 12px 0;
        padding: 8px;
        background: rgba(0, 228, 255, 0.05);
        border-radius: 4px;
        border-left: 2px solid rgba(0, 228, 255, 0.3);
    }

    .analysis-section.risk {
        background: rgba(255, 68, 68, 0.05);
        border-left-color: rgba(255, 68, 68, 0.3);
    }

    .analysis-section.warning {
        background: rgba(255, 152, 0, 0.05);
        border-left-color: rgba(255, 152, 0, 0.3);
    }

    .analysis-section.suggestion {
        background: rgba(0, 228, 255, 0.05);
        border-left-color: rgba(0, 228, 255, 0.3);
    }

    .section-content {
        color: #dfdede;
        font-size: 12px;
    }
`;
document.head.appendChild(aiAnalysisStyles);

// 更新显示分析结果函数
function displayAnalysisResult(analysis) {
    const analysisContent = document.getElementById('aiAnalysisContent');
    analysisContent.innerHTML = ''; // 清空现有内容
    
    // 创建各个部分的容器
    const sections = [
        { title: '整体健康趋势', class: '' },
        { title: '潜在的健康风险', class: 'risk' },
        { title: '需要关注的异常指标', class: 'warning' },
        { title: '改进建议', class: 'suggestion' }
    ];

    // 解析分析文本
    const lines = analysis.split('\n').filter(line => line.trim());
    let currentSection = null;
    let sectionContent = [];

    // 创建基础结构
    analysisContent.innerHTML = `

    `;

    // 显示结果容器
    const resultContainer = document.getElementById('aiAnalysisResult');
    resultContainer.style.display = 'block';

    // 执行打字机效果
    let delay = 0;
    const speed = 8; // 更快的打字速度

    // 首先显示介绍文字
    setTimeout(() => {
        typewriterEffect(analysisContent.querySelector('.typewriter-text'));
    }, delay);
    delay += 500;

    // 处理每个部分
    lines.forEach(line => {
        if (line.endsWith('：')) {
            // 这是一个标题
            const sectionTitle = line.slice(0, -1);
            const sectionDiv = document.createElement('div');
            sectionDiv.className = `analysis-section ${sections.find(s => s.title === sectionTitle)?.class || ''}`;
            sectionDiv.innerHTML = `
                <div class="typewriter-text title" style="opacity: 0;">${line}</div>
                <div class="section-content"></div>
            `;
            analysisContent.appendChild(sectionDiv);
            
            setTimeout(() => {
                typewriterEffect(sectionDiv.querySelector('.typewriter-text'));
            }, delay);
            delay += 300;
        } else if (line.trim()) {
            // 这是内容
            const contentDiv = document.createElement('div');
            contentDiv.className = 'typewriter-text';
            contentDiv.style.opacity = '0';
            contentDiv.textContent = line.trim();
            
            const lastSection = analysisContent.querySelector('.analysis-section:last-child .section-content');
            if (lastSection) {
                lastSection.appendChild(contentDiv);
                
                setTimeout(() => {
                    typewriterEffect(contentDiv);
                }, delay);
                delay += 200;
            }
        }
    });
}

// 优化打字机效果函数
function typewriterEffect(element) {
    element.style.opacity = '1';
    const text = element.textContent;
    element.textContent = '';
    
    let index = 0;
    const speed = 8; // 更快的打字速度
    
    function type() {
        if (index < text.length) {
            element.textContent += text.charAt(index);
            index++;
            requestAnimationFrame(() => setTimeout(type, speed));
        }
    }
    
    type();
}
</script>
// ... existing code ...
</body>

</html>