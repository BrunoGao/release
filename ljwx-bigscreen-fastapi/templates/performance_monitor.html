<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤§å±æ€§èƒ½ç›‘æ§</title>
    <style>
        body { font-family: monospace; background: #001529; color: #00e4ff; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .metric { background: rgba(0,21,41,0.8); padding: 15px; margin: 10px 0; border-radius: 5px; }
        .good { border-left: 5px solid #52c41a; }
        .warning { border-left: 5px solid #faad14; }
        .bad { border-left: 5px solid #ff4d4f; }
        .test-btn { background: #1890ff; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        #results { white-space: pre-wrap; background: #000; padding: 15px; border-radius: 5px; max-height: 400px; overflow-y: scroll; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ å¤§å±æ€§èƒ½ç›‘æ§ä»ªè¡¨æ¿</h1>
        
        <div class="metric good">
            <h3>âœ… å·²å®Œæˆä¼˜åŒ–</h3>
            <ul>
                <li>åˆ é™¤æ— æ³•è®¿é—®çš„192.168.1.83èµ„æº</li>
                <li>æœ¬åœ°åŒ–ECharts (1MB) å’Œ jQuery (87KB)</li>
                <li>ä¿®å¤404é”™è¯¯çš„JSæ–‡ä»¶å¼•ç”¨</li>
                <li>éƒ¨ç½²ç»ˆææ€§èƒ½ä¼˜åŒ–å™¨</li>
            </ul>
        </div>

        <div class="metric warning">
            <h3>âš ï¸ ä»éœ€ä¼˜åŒ–</h3>
            <ul>
                <li>ç»Ÿè®¡APIå“åº”æ—¶é—´: 2.9ç§’</li>
                <li>åç«¯å¹¶å‘æŸ¥è¯¢æ€§èƒ½</li>
                <li>ç¼“å­˜ç­–ç•¥TTLè¿‡çŸ­(5ç§’)</li>
            </ul>
        </div>

        <h3>ğŸ§ª æ€§èƒ½æµ‹è¯•å·¥å…·</h3>
        <button class="test-btn" onclick="testPageLoad()">æµ‹è¯•é¡µé¢åŠ è½½æ—¶é—´</button>
        <button class="test-btn" onclick="testAPIResponse()">æµ‹è¯•APIå“åº”æ—¶é—´</button>
        <button class="test-btn" onclick="testResourceSize()">æ£€æŸ¥èµ„æºå¤§å°</button>
        <button class="test-btn" onclick="runFullDiagnosis()">å®Œæ•´æ€§èƒ½è¯Šæ–­</button>

        <h3>ğŸ“Š æµ‹è¯•ç»“æœ</h3>
        <div id="results">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•...</div>
    </div>

    <script>
        const resultsDiv = document.getElementById('results');
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            resultsDiv.textContent += `[${timestamp}] ${message}\n`;
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }

        async function testPageLoad() {
            log('ğŸš€ å¼€å§‹é¡µé¢åŠ è½½æµ‹è¯•...');
            const startTime = performance.now();
            
            try {
                const response = await fetch('/main?customerId=1');
                const endTime = performance.now();
                const loadTime = endTime - startTime;
                
                log(`ğŸ“„ HTMLåŠ è½½æ—¶é—´: ${loadTime.toFixed(0)}ms`);
                
                if (loadTime < 100) log('âœ… HTMLåŠ è½½: ä¼˜ç§€');
                else if (loadTime < 500) log('âš ï¸ HTMLåŠ è½½: è‰¯å¥½');
                else log('âŒ HTMLåŠ è½½: éœ€è¦ä¼˜åŒ–');
                
            } catch (error) {
                log(`âŒ é¡µé¢åŠ è½½å¤±è´¥: ${error.message}`);
            }
        }

        async function testAPIResponse() {
            log('ğŸ”— å¼€å§‹APIå“åº”æµ‹è¯•...');
            const startTime = performance.now();
            
            try {
                const today = new Date().toISOString().slice(0, 10);
                const response = await fetch(`/api/statistics/overview?orgId=1&date=${today}`);
                const endTime = performance.now();
                const apiTime = endTime - startTime;
                
                log(`ğŸ“Š APIå“åº”æ—¶é—´: ${apiTime.toFixed(0)}ms`);
                
                if (apiTime < 1000) log('âœ… APIå“åº”: ä¼˜ç§€');
                else if (apiTime < 3000) log('âš ï¸ APIå“åº”: å¯æ¥å—');
                else log('âŒ APIå“åº”: éœ€è¦ä¼˜åŒ–');
                
                const data = await response.json();
                log(`ğŸ“‹ æ•°æ®å¤§å°: ${JSON.stringify(data).length} å­—ç¬¦`);
                
            } catch (error) {
                log(`âŒ APIæµ‹è¯•å¤±è´¥: ${error.message}`);
            }
        }

        async function testResourceSize() {
            log('ğŸ“¦ æ£€æŸ¥èµ„æºå¤§å°...');
            
            const resources = [
                '/static/libs/echarts.min.js',
                '/static/libs/jquery.min.js', 
                '/static/js/map_enhancement_patch.js',
                '/static/js/map-optimizer.js'
            ];
            
            for (const url of resources) {
                try {
                    const response = await fetch(url, {method: 'HEAD'});
                    const size = response.headers.get('content-length');
                    if (size) {
                        const sizeKB = Math.round(size / 1024);
                        log(`ğŸ“„ ${url}: ${sizeKB}KB`);
                    } else {
                        log(`ğŸ“„ ${url}: å¤§å°æœªçŸ¥`);
                    }
                } catch (error) {
                    log(`âŒ ${url}: æ— æ³•è®¿é—®`);
                }
            }
        }

        async function runFullDiagnosis() {
            log('ğŸ” å¼€å§‹å®Œæ•´æ€§èƒ½è¯Šæ–­...');
            log('='.repeat(50));
            
            await testPageLoad();
            log('');
            await testAPIResponse();
            log('');
            await testResourceSize();
            log('');
            
            log('ğŸ“ˆ è¯Šæ–­å®Œæˆ - ä¼˜åŒ–å»ºè®®:');
            log('1. ç»§ç»­ç›‘æ§APIå“åº”æ—¶é—´');
            log('2. è€ƒè™‘å¢åŠ CDNåŠ é€Ÿ');
            log('3. å¯ç”¨gzipå‹ç¼©');
            log('4. ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢');
            log('='.repeat(50));
        }
    </script>
</body>
</html>