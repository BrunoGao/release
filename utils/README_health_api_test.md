# ljwx-boot å¥åº·ç³»ç»ŸAPIè‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·

## æ¦‚è¿°

è¿™æ˜¯ä¸€å¥—å®Œæ•´çš„ljwx-bootå¥åº·ç³»ç»ŸAPIè‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·ï¼Œç”¨äºéªŒè¯ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š

- âœ… **ç»Ÿä¸€å¥åº·æ•°æ®æŸ¥è¯¢** - åˆ†è¡¨æŸ¥è¯¢ã€å¿«æ…¢è¡¨æŸ¥è¯¢ã€æŒ‡æ ‡é…ç½®éªŒè¯
- âœ… **å¥åº·åŸºçº¿ç”Ÿæˆ** - ä¸ªäººåŸºçº¿ã€ç¾¤ä½“åŸºçº¿ã€èŒä½é£é™©åŸºçº¿
- âœ… **å¥åº·è¯„åˆ†è®¡ç®—** - å¤šç»´åº¦å¥åº·è¯„åˆ†ç®—æ³•
- âœ… **å¥åº·ç”»åƒç”Ÿæˆ** - æ™ºèƒ½å¥åº·ç”»åƒç³»ç»Ÿ
- âœ… **å¥åº·å»ºè®®ç”Ÿæˆ** - ä¸ªæ€§åŒ–å¥åº·å»ºè®®
- âœ… **å¥åº·é¢„æµ‹åŠŸèƒ½** - å¥åº·è¶‹åŠ¿é¢„æµ‹
- âœ… **ä»»åŠ¡ç®¡ç†ç›‘æ§** - å®šæ—¶ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€ç›‘æ§

## æµ‹è¯•è¦†ç›–çš„APIæ¥å£

### 1. ç»Ÿä¸€å¥åº·æ•°æ®æŸ¥è¯¢ (`/health/unified`)

| æ¥å£ | æ–¹æ³• | åŠŸèƒ½ |
|------|------|------|
| `/query` | POST | ç»Ÿä¸€å¥åº·æ•°æ®æŸ¥è¯¢ |
| `/query/simple` | GET | ç®€åŒ–å¥åº·æ•°æ®æŸ¥è¯¢ |
| `/metrics/supported` | GET | è·å–æ”¯æŒçš„å¥åº·æŒ‡æ ‡ |
| `/metrics/config` | GET | è·å–å¥åº·æŒ‡æ ‡é…ç½® |
| `/metrics/filter` | GET | è¿‡æ»¤æ”¯æŒçš„å¥åº·æŒ‡æ ‡ |
| `/cache/clear` | POST | æ¸…é™¤é…ç½®ç¼“å­˜ |
| `/table/info` | GET | è·å–åˆ†è¡¨ä¿¡æ¯ |

### 2. å¥åº·ä»»åŠ¡ç®¡ç† (`/api/health/task`)

| æ¥å£ | æ–¹æ³• | åŠŸèƒ½ |
|------|------|------|
| `/status` | GET | æŸ¥è¯¢ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€ |
| `/statistics` | GET | æŸ¥è¯¢å¥åº·æ•°æ®ç»Ÿè®¡ |
| `/tables` | GET | æŸ¥è¯¢åˆ†è¡¨ä¿¡æ¯ |
| `/department/{id}/overview` | GET | è·å–éƒ¨é—¨å¥åº·æ¦‚è§ˆ |
| `/department/ranking` | GET | è·å–éƒ¨é—¨å¥åº·æ’å |
| `/cache/statistics` | GET | è·å–ç¼“å­˜ç»Ÿè®¡ |
| `/cache/clear/{userId}` | POST | æ¸…ç†ç”¨æˆ·ç¼“å­˜ |
| `/cache/warmup` | POST | ç¼“å­˜é¢„çƒ­ |

### 3. å¥åº·ç”»åƒ (`/health/profile`)

| æ¥å£ | æ–¹æ³• | åŠŸèƒ½ |
|------|------|------|
| `/test` | GET | æµ‹è¯•æ¥å£ |
| `/baseline/generate` | POST | ç”Ÿæˆå¥åº·åŸºçº¿ |

## å¿«é€Ÿå¼€å§‹

### é¢„å¤‡æ­¥éª¤

1. **é…ç½®æ•°æ®åº“è¿æ¥**
```bash
# ç¡®ä¿ db_config.json é…ç½®æ­£ç¡®
{
  "host": "127.0.0.1",
  "port": 3306,
  "database": "test", 
  "user": "root",
  "password": "123456"
}
```

2. **æµ‹è¯•è®¤è¯æ¥å£**
```bash
# å…ˆæµ‹è¯•è®¤è¯æ˜¯å¦æ­£å¸¸
python3 test_auth.py
```

### æ–¹å¼1: ä½¿ç”¨Shellè„šæœ¬ (æ¨è)

```bash
# åŸºæœ¬æµ‹è¯• (ä½¿ç”¨é»˜è®¤è®¤è¯URL)
./health_api_test.sh --base-url http://localhost:8080

# æŒ‡å®šè®¤è¯æœåŠ¡åœ°å€
./health_api_test.sh \
  --base-url http://192.168.1.83:8080 \
  --auth-url http://192.168.1.83:3333/proxy-default/auth/user_name
```

### æ–¹å¼2: ç›´æ¥ä½¿ç”¨Pythonè„šæœ¬

```bash
# å®‰è£…ä¾èµ–
pip3 install requests mysql-connector-python

# æ‰§è¡Œæµ‹è¯•
python3 health_api_test.py \
  --base-url http://localhost:8080 \
  --auth-url http://192.168.1.83:3333/proxy-default/auth/user_name
```

## å‚æ•°è¯´æ˜

| å‚æ•° | å¿…éœ€ | é»˜è®¤å€¼ | æè¿° |
|------|------|--------|------|
| `--base-url` | âœ… | - | APIæœåŠ¡åŸºç¡€URL |
| `--auth-url` | âŒ | http://192.168.1.83:3333/proxy-default/auth/user_name | è®¤è¯æœåŠ¡URL |

## è®¤è¯é…ç½®

æµ‹è¯•å·¥å…·ä¼šè‡ªåŠ¨è¿›è¡Œèº«ä»½è®¤è¯ï¼š
- **ç”¨æˆ·å**: admin
- **å¯†ç **: 80a3d119ee1501354755dfc3c4638d74c67c801689efbed4f25f06cb4b1cd776
- **è®¤è¯æˆåŠŸå**è‡ªåŠ¨åœ¨æ‰€æœ‰è¯·æ±‚ä¸­æºå¸¦Bearer Token

**æ³¨æ„**: æµ‹è¯•å·¥å…·ä¼šè‡ªåŠ¨ä»æ•°æ®åº“åŠ è½½çœŸå®çš„å®¢æˆ·ã€ç”¨æˆ·ã€è®¾å¤‡æ•°æ®ã€‚

## æµ‹è¯•ç¯å¢ƒé…ç½®

æµ‹è¯•å·¥å…·æ”¯æŒå¤šç¯å¢ƒé…ç½®ï¼Œè¯¦è§ `health_api_test_config.json`ï¼š

```json
{
  "test_environments": {
    "local": {
      "base_url": "http://localhost:8080",
      "customer_id": 1,
      "user_id": 1001
    },
    "staging": {
      "base_url": "http://staging.ljwx.com:8080", 
      "customer_id": 2,
      "user_id": 2001
    }
  }
}
```

## æµ‹è¯•æŠ¥å‘Š

æµ‹è¯•å®Œæˆåä¼šç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š

- ğŸ“„ `health_api_test.log` - è¯¦ç»†æµ‹è¯•æ—¥å¿—
- ğŸ“Š `health_api_test_report_YYYYMMDD_HHMMSS.json` - JSONæ ¼å¼æµ‹è¯•æŠ¥å‘Š

### æŠ¥å‘Šç¤ºä¾‹

```json
{
  "summary": {
    "base_url": "http://localhost:8080",
    "total_tests": 15,
    "passed_tests": 13,
    "failed_tests": 2,
    "pass_rate": 86.7,
    "total_time": 45.32,
    "avg_response_time": 234.5
  },
  "test_results": [...]
}
```

## å®‰å…¨ç‰¹æ€§

ğŸ”’ **å®‰å…¨ä¿æŠ¤æœºåˆ¶**ï¼š
- âœ… è‡ªåŠ¨è·³è¿‡å¯èƒ½å½±å“æ•°æ®çš„ç ´åæ€§æ“ä½œ
- âœ… æ€§èƒ½æµ‹è¯•éœ€è¦ç”¨æˆ·ç¡®è®¤
- âœ… ä»…æ‰§è¡Œè¯»å–å’ŒæŸ¥è¯¢æ“ä½œ
- âœ… ä¿æŠ¤ç”Ÿäº§ç¯å¢ƒæ•°æ®

## æ€§èƒ½åŸºå‡†

| æŒ‡æ ‡ | ä¼˜ç§€ | è‰¯å¥½ | å¯æ¥å— | éœ€ä¼˜åŒ– |
|------|------|------|--------|--------|
| å“åº”æ—¶é—´ | <200ms | <500ms | <1000ms | >2000ms |
| æˆåŠŸç‡ | >99% | >95% | >90% | <80% |

## æµ‹è¯•åœºæ™¯

### 1. åŸºç¡€å¥åº·æ•°æ®æŸ¥è¯¢
- ç»Ÿä¸€æŸ¥è¯¢æ¥å£
- ç®€åŒ–æŸ¥è¯¢æ¥å£  
- å¥åº·æŒ‡æ ‡é…ç½®
- åˆ†è¡¨ä¿¡æ¯æŸ¥è¯¢

### 2. ä»»åŠ¡ç®¡ç†åŠŸèƒ½
- ä»»åŠ¡çŠ¶æ€ç›‘æ§
- æ•°æ®ç»Ÿè®¡æŸ¥è¯¢
- ç¼“å­˜ç®¡ç†æ“ä½œ

### 3. éƒ¨é—¨å¥åº·åˆ†æ
- éƒ¨é—¨å¥åº·æ¦‚è§ˆ
- éƒ¨é—¨å¥åº·æ’å
- ç»„ç»‡æ•°æ®èšåˆ

### 4. ç¼“å­˜æ€§èƒ½
- ç¼“å­˜ç»Ÿè®¡æŸ¥è¯¢
- ç¼“å­˜æ¸…ç†æ“ä½œ  
- ç¼“å­˜é¢„çƒ­æµ‹è¯•

## æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

1. **è¿æ¥å¤±è´¥**
   ```
   âŒ é”™è¯¯: æ— æ³•è¿æ¥åˆ°æœåŠ¡
   ```
   - æ£€æŸ¥æœåŠ¡åœ°å€æ˜¯å¦æ­£ç¡®
   - ç¡®è®¤æœåŠ¡æ˜¯å¦æ­£åœ¨è¿è¡Œ
   - æ£€æŸ¥ç½‘ç»œè¿æ¥

2. **è®¤è¯å¤±è´¥**
   ```
   âŒ 401 Unauthorized
   ```
   - æ£€æŸ¥å®¢æˆ·IDå’Œç”¨æˆ·IDæ˜¯å¦æœ‰æ•ˆ
   - ç¡®è®¤APIæ¥å£æƒé™é…ç½®

3. **æ•°æ®æŸ¥è¯¢ä¸ºç©º**
   ```
   âš ï¸ æŸ¥è¯¢ç»“æœä¸ºç©º
   ```
   - æ£€æŸ¥æ—¶é—´èŒƒå›´æ˜¯å¦åˆç†
   - ç¡®è®¤ç”¨æˆ·æ˜¯å¦æœ‰å¥åº·æ•°æ®
   - éªŒè¯åˆ†è¡¨é…ç½®

### è°ƒè¯•æ¨¡å¼

å¯ç”¨è¯¦ç»†æ—¥å¿—ï¼š

```bash
export PYTHONPATH=.
python3 -u health_api_test.py --base-url http://localhost:8080 --customer-id 1 --user-id 1001
```

## æ‰©å±•å¼€å‘

### æ·»åŠ æ–°æµ‹è¯•

1. åœ¨ `HealthAPITester` ç±»ä¸­æ·»åŠ æ–°çš„æµ‹è¯•æ–¹æ³•ï¼š

```python
def test_new_feature(self):
    \"\"\"æµ‹è¯•æ–°åŠŸèƒ½\"\"\"
    result = self.make_request('GET', f"{self.base_url}/new/api")
    self.log_test_result("æ–°åŠŸèƒ½æµ‹è¯•", result['success'], ...)
```

2. åœ¨ `run_all_tests()` æ–¹æ³•ä¸­è°ƒç”¨ï¼š

```python
def run_all_tests(self):
    # å…¶ä»–æµ‹è¯•...
    self.test_new_feature()
```

### è‡ªå®šä¹‰é…ç½®

ä¿®æ”¹ `health_api_test_config.json` æ·»åŠ æ–°çš„æµ‹è¯•ç¯å¢ƒæˆ–æµ‹è¯•åœºæ™¯ã€‚

## æœ€ä½³å®è·µ

1. **æµ‹è¯•å‰å‡†å¤‡**
   - ç¡®ä¿æµ‹è¯•ç¯å¢ƒæ•°æ®å®Œæ•´æ€§
   - ç¡®è®¤æµ‹è¯•ç”¨æˆ·å’Œå®¢æˆ·IDæœ‰æ•ˆ
   - æ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€

2. **æµ‹è¯•æ‰§è¡Œ**
   - å…ˆåœ¨å¼€å‘ç¯å¢ƒæµ‹è¯•
   - è°¨æ…åœ¨ç”Ÿäº§ç¯å¢ƒæ‰§è¡Œ
   - å…³æ³¨æµ‹è¯•æŠ¥å‘Šå’Œæ—¥å¿—

3. **ç»“æœåˆ†æ**
   - é‡ç‚¹å…³æ³¨å¤±è´¥æµ‹è¯•çš„åŸå› 
   - ç›‘æ§å“åº”æ—¶é—´è¶‹åŠ¿
   - éªŒè¯æ•°æ®å®Œæ•´æ€§

## æ”¯æŒ

å¦‚é‡é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
- æµ‹è¯•æ—¥å¿—æ–‡ä»¶
- ç³»ç»ŸæœåŠ¡çŠ¶æ€  
- ç½‘ç»œè¿æ¥æƒ…å†µ
- APIæ¥å£æ–‡æ¡£

---

**æ³¨æ„**: æœ¬å·¥å…·è®¾è®¡ä¸ºå®‰å…¨çš„åªè¯»æµ‹è¯•ï¼Œä¸ä¼šä¿®æ”¹ç”Ÿäº§æ•°æ®ã€‚å¦‚éœ€æ‰§è¡Œæ•°æ®ä¿®æ”¹æ“ä½œï¼Œè¯·åœ¨ç¡®è®¤å®‰å…¨çš„æƒ…å†µä¸‹æ‰‹åŠ¨æ‰§è¡Œã€‚