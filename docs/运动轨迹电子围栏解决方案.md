# è¿åŠ¨è½¨è¿¹ & ç”µå­å›´æ åŠŸèƒ½æ¨¡å—æ•´ä½“è§£å†³æ–¹æ¡ˆ

## 1. äº§å“æ–¹æ¡ˆ PRD

### 1.1 åœºæ™¯ä¸ç”¨æˆ·ç”»åƒ

**æ ¸å¿ƒåº”ç”¨åœºæ™¯ï¼š**
- **è°ƒåº¦ç›‘æ§**ï¼šç‰©æµé…é€ã€å¤–å‹¤å·¡æ£€äººå‘˜å®æ—¶ä½ç½®è·Ÿè¸ª
- **å®‰é˜²å·¡æ£€**ï¼šä¿å®‰å·¡é€»è·¯çº¿åˆè§„ã€å…³é”®åŒºåŸŸè¿›å‡ºç›‘ç®¡
- **åœ¨å²—è€ƒå‹¤**ï¼šå¤–å‹¤äººå‘˜åˆ°å²—éªŒè¯ã€å·¥ä½œæ—¶é•¿ç»Ÿè®¡
- **è¶Šç•Œå‘Šè­¦**ï¼šå±é™©åŒºåŸŸé˜²æŠ¤ã€æœªæˆæƒåŒºåŸŸå…¥ä¾µæ£€æµ‹
- **åº”æ€¥å“åº”**ï¼šçªå‘äº‹ä»¶äººå‘˜å®šä½ã€æœ€è¿‘æ•‘æ´åŠ›é‡è°ƒåº¦

**ç”¨æˆ·ç”»åƒï¼š**
- **ä¼ä¸šç®¡ç†å‘˜**ï¼šé…ç½®å›´æ ã€æƒé™åˆ†é…ã€å‘Šè­¦ç­–ç•¥åˆ¶å®š
- **éƒ¨é—¨è°ƒåº¦å‘˜**ï¼šå®æ—¶ç›‘æ§ã€å†å²æŸ¥è¯¢ã€å¼‚å¸¸å¤„ç½®
- **ä¸€çº¿å‘˜å·¥**ï¼šè¢«åŠ¨ä½ç½®ä¸ŠæŠ¥ã€å‘Šè­¦æ¥æ”¶
- **å®‰å…¨ç®¡ç†å‘˜**ï¼šåˆè§„å®¡è®¡ã€é£é™©åŒºåŸŸç®¡ç†

### 1.2 å…³é”®ç”¨ä¾‹

#### æ ¸å¿ƒåŠŸèƒ½ç”¨ä¾‹
1. **å®æ—¶è½¨è¿¹ç›‘æ§**
   - åœ°å›¾å±•ç¤ºæ‰€æœ‰åœ¨çº¿äººå‘˜ä½ç½®
   - å®æ—¶çŠ¶æ€ï¼šåœ¨çº¿/ç¦»çº¿/å‘Šè­¦/æ­£å¸¸
   - æ”¯æŒäººå‘˜åˆ†ç»„ã€æ‰¹é‡ç­›é€‰

2. **å†å²è½¨è¿¹å›æ”¾**
   - æ—¶é—´æ®µè½¨è¿¹æŸ¥è¯¢ä¸å›æ”¾
   - åœç•™ç‚¹è¯†åˆ«ä¸æ—¶é•¿ç»Ÿè®¡
   - è½¨è¿¹å¼‚å¸¸æ£€æµ‹ï¼ˆåç¦»è·¯çº¿ã€é•¿æ—¶é—´åœç•™ï¼‰

3. **ç”µå­å›´æ ç®¡ç†**
   - å›´æ åˆ›å»ºï¼ˆåœ†å½¢/çŸ©å½¢/å¤šè¾¹å½¢ï¼‰
   - å›´æ æ‰¹é‡å¯¼å…¥ï¼ˆExcel/CSV/GeoJSONï¼‰
   - å›´æ ç»‘å®šå¯¹è±¡ï¼ˆäººå‘˜/è®¾å¤‡/è½¦è¾†ï¼‰

4. **æ™ºèƒ½å‘Šè­¦ç³»ç»Ÿ**
   - è¿›å…¥/ç¦»å¼€/åœç•™æ—¶é•¿å‘Šè­¦
   - å¤šæ¸ é“é€šçŸ¥ï¼ˆå¾®ä¿¡/çŸ­ä¿¡/é‚®ä»¶ï¼‰
   - å‘Šè­¦å‡çº§ä¸å¤„ç½®æµç¨‹

### 1.3 ä¿¡æ¯æ¶æ„ & é¡µé¢æµç¨‹

```
ä¸»å¯¼èˆªæ¶æ„ï¼š
â”œâ”€â”€ å®æ—¶ç›‘æ§              # ä¸»è¦å·¥ä½œå°
â”‚   â”œâ”€â”€ å®æ—¶åœ°å›¾è§†å›¾       # åœ°å›¾ + äººå‘˜åˆ—è¡¨
â”‚   â”œâ”€â”€ å‘Šè­¦ä¸­å¿ƒ          # å®æ—¶å‘Šè­¦å¤„ç†
â”‚   â””â”€â”€ åœ¨çº¿çŠ¶æ€ç»Ÿè®¡       # Dashboard
â”œâ”€â”€ å†å²åˆ†æ
â”‚   â”œâ”€â”€ è½¨è¿¹å›æ”¾          # å†å²è½¨è¿¹æŸ¥è¯¢å›æ”¾
â”‚   â”œâ”€â”€ åœç•™åˆ†æ          # åœç•™çƒ­ç‚¹åˆ†æ
â”‚   â””â”€â”€ è¡Œä¸ºåˆ†æ          # è¡Œä¸ºæ¨¡å¼åˆ†æ
â”œâ”€â”€ å›´æ ç®¡ç†
â”‚   â”œâ”€â”€ å›´æ åˆ—è¡¨          # CRUDæ“ä½œ
â”‚   â”œâ”€â”€ æ‰¹é‡å¯¼å…¥          # Excel/GeoJSONå¯¼å…¥
â”‚   â””â”€â”€ ç»‘å®šç®¡ç†          # äººå‘˜å›´æ ç»‘å®š
â””â”€â”€ ç³»ç»Ÿé…ç½®
    â”œâ”€â”€ å‘Šè­¦é…ç½®          # å‘Šè­¦è§„åˆ™ä¸é€šé“
    â”œâ”€â”€ æƒé™ç®¡ç†          # éƒ¨é—¨æƒé™åˆ†é…
    â””â”€â”€ å‚æ•°é…ç½®          # é‡‡æ ·ç‡ã€æŠ½ç¨€å‚æ•°ç­‰
```

**æ ¸å¿ƒé¡µé¢æµç¨‹ï¼š**
```
å®æ—¶ç›‘æ§é¡µé¢æµç¨‹ï¼š
[åœ°å›¾è§†å›¾] â†â†’ [äººå‘˜åˆ—è¡¨] â†â†’ [è¯¦æƒ…é¢æ¿]
     â†“           â†“           â†“
[å‘Šè­¦å¼¹çª—] â†’ [å¤„ç½®æ“ä½œ] â†’ [æµè½¬è®°å½•]
```

### 1.4 å…³é”®æ“ä½œæµ

#### å›´æ åˆ›å»ºæµç¨‹
```
1. é€‰æ‹©å›´æ ç±»å‹ â†’ 2. åœ°å›¾ç»˜åˆ¶ â†’ 3. å‚æ•°è®¾ç½® â†’ 4. ä¿å­˜éªŒè¯
   (åœ†/çŸ©å½¢/å¤šè¾¹å½¢)  (å¯è§†åŒ–ç»˜åˆ¶)  (åç§°ã€å‘Šè­¦ç­–ç•¥) (ç©ºé—´æœ‰æ•ˆæ€§æ£€æŸ¥)
```

#### å‘Šè­¦å¤„ç½®æµç¨‹
```
1. å‘Šè­¦è§¦å‘ â†’ 2. å¤šæ¸ é“é€šçŸ¥ â†’ 3. äººå·¥ç¡®è®¤ â†’ 4. å¤„ç½®æ“ä½œ â†’ 5. ç»“æœè®°å½•
   (è‡ªåŠ¨æ£€æµ‹)   (å¾®ä¿¡/çŸ­ä¿¡/é‚®ä»¶)  (å‘Šè­¦ç¡®è®¤)   (å¤„ç½®æªæ–½)   (å®¡è®¡æ—¥å¿—)
```

## 2. UI/UE è§„èŒƒä¸è®¾è®¡è¯´æ˜

### 2.1 è®¾è®¡è¯­è¨€è§„èŒƒ

#### ä¸»é¢˜ç³»ç»Ÿ
- **æ·±è‰²ä¸»é¢˜**ï¼šä¸»è‰² #1f2937ï¼Œè¾…è‰² #374151ï¼Œå¼ºè°ƒè‰² #3b82f6
- **äº®è‰²ä¸»é¢˜**ï¼šä¸»è‰² #ffffffï¼Œè¾…è‰² #f9fafbï¼Œå¼ºè°ƒè‰² #2563eb
- **çŠ¶æ€è‰²å½©**ï¼š
  - æ­£å¸¸ï¼š#10b981 (ç»¿è‰²)
  - å‘Šè­¦ï¼š#f59e0b (æ©™è‰²)
  - å±é™©ï¼š#ef4444 (çº¢è‰²)
  - ç¦»çº¿ï¼š#6b7280 (ç°è‰²)

#### å¸ƒå±€æ …æ ¼ç³»ç»Ÿ
- **å®¹å™¨å®½åº¦**ï¼š1200px ä¸»å®¹å™¨ï¼Œå“åº”å¼æ–­ç‚¹
- **é—´è·ä½“ç³»**ï¼š4px åŸºç¡€å•ä½ (4, 8, 12, 16, 24, 32, 48)
- **åœ†è§’è§„èŒƒ**ï¼šæŒ‰é’® 4pxï¼Œå¡ç‰‡ 8pxï¼Œå¼¹çª— 12px
- **é˜´å½±å±‚çº§**ï¼š4çº§é˜´å½±æ·±åº¦ï¼Œå¯¹åº”ä¸åŒ z-index

### 2.2 å…³é”®é¡µé¢è®¾è®¡

#### å®æ—¶ç›‘æ§å¤§å±å¸ƒå±€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Header: Logo | å¯¼èˆª | ç”¨æˆ·ä¿¡æ¯ | å‘Šè­¦è®¡æ•°(çº¢ç‚¹)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚                                 â”‚ â”‚ åœ¨çº¿äººå‘˜åˆ—è¡¨         â”‚  â”‚
â”‚ â”‚           åœ°å›¾åŒºåŸŸ               â”‚ â”‚ â”œâ”€ ç”¨æˆ·A [åœ¨çº¿]     â”‚  â”‚
â”‚ â”‚      (å å±å¹• 70% å®½åº¦)           â”‚ â”‚ â”œâ”€ ç”¨æˆ·B [å‘Šè­¦]     â”‚  â”‚
â”‚ â”‚                                 â”‚ â”‚ â”œâ”€ ç”¨æˆ·C [ç¦»çº¿]     â”‚  â”‚
â”‚ â”‚ åœ°å›¾æ§ä»¶:                        â”‚ â”‚ â””â”€ ...             â”‚  â”‚
â”‚ â”‚ â”Œâ”€â” ç¼©æ”¾ â”Œâ”€â” æµ‹è·                â”‚ â”‚                    â”‚  â”‚
â”‚ â”‚ â””â”€â”˜      â””â”€â”˜                    â”‚ â”‚ ç­›é€‰å™¨:             â”‚  â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” å›¾å±‚æ§åˆ¶             â”‚ â”‚ [éƒ¨é—¨] [çŠ¶æ€] [æœç´¢] â”‚  â”‚
â”‚ â”‚ â”‚çƒ­åŠ› èšåˆ â”‚                     â”‚ â”‚                    â”‚  â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚ â”‚ å¿«æ·æ“ä½œ:           â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ [å®šä½] [è¯¦æƒ…] [å‘Šè­¦] â”‚  â”‚
â”‚                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚ åº•éƒ¨çŠ¶æ€æ : å½“å‰åœ¨çº¿Xäºº | ä»Šæ—¥å‘Šè­¦Xæ¬¡ | æ•°æ®æ›´æ–°æ—¶é—´          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å‘Šè­¦æµ®çª— (å³ä¸‹è§’)ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”” å®æ—¶å‘Šè­¦              â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ ç”¨æˆ·A ç¦»å¼€å®‰å…¨åŒºåŸŸ       â”‚
â”‚ æ—¶é—´: 14:23:15          â”‚
â”‚ [æŸ¥çœ‹è¯¦æƒ…] [æ ‡è®°å¤„ç†]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å†å²å›æ”¾ç•Œé¢è®¾è®¡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è½¨è¿¹å›æ”¾æ§åˆ¶å°                                               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ç”¨æˆ·é€‰æ‹©      â”‚ â”‚æ—¶é—´èŒƒå›´â”‚ â”‚æ’­æ”¾æ§åˆ¶                      â”‚  â”‚
â”‚ â”‚[ç”¨æˆ·A â–¼]    â”‚ â”‚[æ—¥æœŸ]  â”‚ â”‚ â® â¯ â­  å€é€Ÿ:[2xâ–¼]         â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚        è½¨è¿¹åœ°å›¾æ˜¾ç¤º              â”‚ â”‚ è½¨è¿¹ä¿¡æ¯é¢æ¿         â”‚  â”‚
â”‚ â”‚                                 â”‚ â”‚                    â”‚  â”‚
â”‚ â”‚ è½¨è¿¹çº¿: â”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â”€        â”‚ â”‚ å½“å‰æ—¶é—´: 09:23:15  â”‚  â”‚
â”‚ â”‚         (è“è‰²è½¨è¿¹çº¿)             â”‚ â”‚ å½“å‰ä½ç½®: XXè·¯XXå·   â”‚  â”‚
â”‚ â”‚                                 â”‚ â”‚ å½“å‰é€Ÿåº¦: 5.2km/h   â”‚  â”‚
â”‚ â”‚ åœç•™ç‚¹: â— (çº¢è‰²åœ†ç‚¹)             â”‚ â”‚ ç´¯è®¡è·ç¦»: 2.3km     â”‚  â”‚
â”‚ â”‚ å›´æ : â–¢ (è™šçº¿æ¡†)                â”‚ â”‚ åœç•™æ¬¡æ•°: 3æ¬¡       â”‚  â”‚
â”‚ â”‚                                 â”‚ â”‚                    â”‚  â”‚
â”‚ â”‚                                 â”‚ â”‚ å¼‚å¸¸äº‹ä»¶:           â”‚  â”‚
â”‚ â”‚                                 â”‚ â”‚ 09:15 ç¦»å¼€å®‰å…¨åŒºåŸŸ   â”‚  â”‚
â”‚ â”‚                                 â”‚ â”‚ 09:42 é•¿æ—¶é—´åœç•™     â”‚  â”‚
â”‚ â”‚                                 â”‚ â”‚ [å¯¼å‡ºè½¨è¿¹]          â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â”‚ æ—¶é—´è½´æ§åˆ¶å™¨:                                                â”‚
â”‚ 09:00 â”œâ”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ 18:00                      â”‚
â”‚       (æ‹–æ‹½æ»‘å—æ§åˆ¶æ’­æ”¾æ—¶é—´)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å›´æ ç®¡ç†ç•Œé¢
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å›´æ ç®¡ç† [+æ–°å»ºå›´æ ] [æ‰¹é‡å¯¼å…¥] [æ‰¹é‡åˆ é™¤]                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç­›é€‰: [ç±»å‹â–¼] [çŠ¶æ€â–¼] [éƒ¨é—¨â–¼] [æœç´¢æ¡†...]                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€ å›´æ åˆ—è¡¨ (å·¦ä¾§30%) â”€â”€â”€â”€â”€â” â”Œâ”€ åœ°å›¾é¢„è§ˆ (å³ä¾§70%) â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ â–¡ å®‰å…¨åŒºåŸŸA [åœ†å½¢]       â”‚ â”‚                           â”‚ â”‚
â”‚ â”‚   â”œ ç»‘å®šç”¨æˆ·: 15äºº       â”‚ â”‚     é€‰ä¸­å›´æ åœ°å›¾æ˜¾ç¤º        â”‚ â”‚
â”‚ â”‚   â”œ çŠ¶æ€: å¯ç”¨           â”‚ â”‚                           â”‚ â”‚
â”‚ â”‚   â”” [ç¼–è¾‘] [åˆ é™¤]        â”‚ â”‚                           â”‚ â”‚
â”‚ â”‚                         â”‚ â”‚                           â”‚ â”‚
â”‚ â”‚ â–¡ å±é™©åŒºåŸŸB [å¤šè¾¹å½¢]     â”‚ â”‚                           â”‚ â”‚
â”‚ â”‚   â”œ ç»‘å®šç”¨æˆ·: 8äºº        â”‚ â”‚                           â”‚ â”‚
â”‚ â”‚   â”œ çŠ¶æ€: å¯ç”¨           â”‚ â”‚                           â”‚ â”‚
â”‚ â”‚   â”” [ç¼–è¾‘] [åˆ é™¤]        â”‚ â”‚                           â”‚ â”‚
â”‚ â”‚                         â”‚ â”‚                           â”‚ â”‚
â”‚ â”‚ [åˆ†é¡µæ§åˆ¶: 1 2 3 ... 10] â”‚ â”‚                           â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å›´æ åˆ›å»ºå¼¹çª—:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ–°å»ºå›´æ                              â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ å›´æ åç§°: [è¾“å…¥æ¡†]                   â”‚
â”‚ å›´æ ç±»å‹: â—‹åœ†å½¢ â—‹çŸ©å½¢ â—å¤šè¾¹å½¢        â”‚
â”‚ å‘Šè­¦ç­–ç•¥: â˜‘è¿›å…¥å‘Šè­¦ â˜‘ç¦»å¼€å‘Šè­¦        â”‚
â”‚ åœç•™æ—¶é•¿: [___]åˆ†é’Ÿåå‘Šè­¦            â”‚
â”‚ å‘Šè­¦çº§åˆ«: â—‹ä½ â—ä¸­ â—‹é«˜               â”‚
â”‚ é€šçŸ¥æ–¹å¼: â˜‘å¾®ä¿¡ â˜‘çŸ­ä¿¡ â˜é‚®ä»¶          â”‚
â”‚                                     â”‚
â”‚ åœ¨åœ°å›¾ä¸Šç»˜åˆ¶å›´æ åŒºåŸŸ...               â”‚
â”‚                                     â”‚
â”‚        [å–æ¶ˆ]    [ä¿å­˜]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å‘Šè­¦ä¸­å¿ƒç•Œé¢
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‘Šè­¦ä¸­å¿ƒ ğŸ“Šä»Šæ—¥å‘Šè­¦: 23æ¡ ğŸ“ˆå‘Šè­¦è¶‹åŠ¿                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç­›é€‰: [ä»Šå¤©â–¼] [å…¨éƒ¨çº§åˆ«â–¼] [å…¨éƒ¨ç±»å‹â–¼] [å¤„ç†çŠ¶æ€â–¼] [æœç´¢...]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å‘Šè­¦åˆ—è¡¨:                                                   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ğŸ”´é«˜ å¼ ä¸‰ ç¦»å¼€å®‰å…¨åŒºåŸŸA    14:23:15  [æœªå¤„ç†] [æŸ¥çœ‹][å¤„ç†]â”‚ â”‚
â”‚ â”‚ğŸŸ¡ä¸­ æå›› é•¿æ—¶é—´åœç•™      13:45:32  [å·²å¤„ç†] [æŸ¥çœ‹]      â”‚ â”‚  
â”‚ â”‚ğŸŸ¡ä¸­ ç‹äº” è¿›å…¥å±é™©åŒºåŸŸB    13:22:18  [å¤„ç†ä¸­] [æŸ¥çœ‹][è·Ÿè¿›]â”‚ â”‚
â”‚ â”‚ğŸŸ¢ä½ èµµå…­ è®¾å¤‡ç¦»çº¿        12:58:43  [å·²å¿½ç•¥] [æŸ¥çœ‹]      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â”‚ å‘Šè­¦å¤„ç†å¼¹çª—:                                                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚ â”‚ å‘Šè­¦å¤„ç†                             â”‚                     â”‚
â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚                     â”‚
â”‚ â”‚ å‘Šè­¦ç±»å‹: ç¦»å¼€å®‰å…¨åŒºåŸŸ               â”‚                     â”‚
â”‚ â”‚ å‘Šè­¦æ—¶é—´: 2024-01-15 14:23:15       â”‚                     â”‚
â”‚ â”‚ æ¶‰åŠäººå‘˜: å¼ ä¸‰                       â”‚                     â”‚
â”‚ â”‚ å›´æ åç§°: å®‰å…¨åŒºåŸŸA                  â”‚                     â”‚
â”‚ â”‚                                     â”‚                     â”‚
â”‚ â”‚ å¤„ç†æ–¹å¼:                            â”‚                     â”‚
â”‚ â”‚ â—‹å·²ç¡®è®¤å®‰å…¨ â—‹è”ç³»å½“äº‹äºº              â”‚                     â”‚
â”‚ â”‚ â—‹æ´¾é£äººå‘˜ â—‹å‡çº§å¤„ç†                  â”‚                     â”‚
â”‚ â”‚                                     â”‚                     â”‚
â”‚ â”‚ å¤‡æ³¨: [æ–‡æœ¬æ¡†]                       â”‚                     â”‚
â”‚ â”‚                                     â”‚                     â”‚
â”‚ â”‚        [å–æ¶ˆ]    [æäº¤å¤„ç†]         â”‚                     â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 äº¤äº’ç»†èŠ‚è§„èŒƒ

#### åœ°å›¾äº¤äº’
- **ç¼©æ”¾æ§åˆ¶**ï¼šé¼ æ ‡æ»šè½® + åŒå‡»æ”¾å¤§ + æ‰‹åŠ¿æ”¯æŒ
- **æ¡†é€‰åŠŸèƒ½**ï¼šæŒ‰ä½Shift+æ‹–æ‹½è¿›è¡ŒåŒºåŸŸé€‰æ‹©
- **æµ‹è·å·¥å…·**ï¼šç‚¹å‡»æ¿€æ´»ï¼Œè¿ç»­ç‚¹å‡»æµ‹é‡ï¼ŒåŒå‡»ç»“æŸ
- **å›¾å±‚åˆ‡æ¢**ï¼šè½¨è¿¹çº¿/çƒ­åŠ›å›¾/èšåˆç‚¹çš„å¼€å…³æ§åˆ¶

#### ç‚¹èšåˆç­–ç•¥
- **èšåˆé˜ˆå€¼**ï¼šâ‰¥200ä¸ªç‚¹æ—¶å¯ç”¨èšåˆæ˜¾ç¤º
- **çƒ­åŠ›å›¾åˆ‡æ¢**ï¼šâ‰¥1000ä¸ªç‚¹æ—¶è‡ªåŠ¨åˆ‡æ¢ä¸ºçƒ­åŠ›å›¾
- **ç‚¹å‡»å±•å¼€**ï¼šç‚¹å‡»èšåˆåœ†åœˆå±•å¼€æ˜¾ç¤ºå…·ä½“ä½ç½®ç‚¹

#### å›æ”¾æ§åˆ¶
- **æ’­æ”¾å€é€Ÿ**ï¼š0.5x / 1x / 2x / 4x / 8x äº”æ¡£è°ƒèŠ‚
- **è¿›åº¦æ§åˆ¶**ï¼šæ—¶é—´è½´æ‹–æ‹½å®šä½ + æ’­æ”¾/æš‚åœ
- **å…³é”®å¸§å®šä½**ï¼šä¸€é”®è·³è½¬åˆ°å‘Šè­¦æ—¶é—´ç‚¹ã€åœç•™å¼€å§‹ç‚¹

## 3. æŠ€æœ¯æ–¹æ¡ˆ

### 3.1 æŠ€æœ¯æ ˆé€‰å‹

#### å‰ç«¯æŠ€æœ¯æ ˆ
```
æ ¸å¿ƒæ¡†æ¶: Vue 3.4+ + TypeScript 5.0+
æ„å»ºå·¥å…·: Vite 5.0+ (ESM, å¿«é€ŸHMR)
åœ°å›¾å¼•æ“: MapBox GL JS 3.0+ (å¤‡é€‰: é«˜å¾·JS SDK 2.0)
å¯è§†åŒ–: ECharts 5.4+ (è½¨è¿¹å›¾è¡¨ã€ç»Ÿè®¡å›¾è¡¨)
UIç»„ä»¶: Element Plus 2.4+ (ä¼ä¸šçº§ç»„ä»¶åº“)
çŠ¶æ€ç®¡ç†: Pinia 2.1+ (Vue 3åŸç”ŸçŠ¶æ€ç®¡ç†)
HTTPå®¢æˆ·ç«¯: Axios 1.6+ (è¯·æ±‚æ‹¦æˆªã€é”™è¯¯å¤„ç†)
å®æ—¶é€šä¿¡: Socket.IO Client 4.7+ (WebSocketé€šä¿¡)
```

#### åç«¯æŠ€æœ¯æ ˆ
```
åº”ç”¨æ¡†æ¶: Spring Boot 3.2+ (Java 17+)
Webå®¹å™¨: Undertow (é«˜æ€§èƒ½NIO)
æ•°æ®è®¿é—®: MyBatis Plus 3.5+ + HikariCP
å®æ—¶é€šä¿¡: WebSocket + Spring Session
æ¶ˆæ¯é˜Ÿåˆ—: Redis Streams (è½»é‡çº§MQ)
ç¼“å­˜ç­–ç•¥: Redis 7.0+ (é›†ç¾¤æ¨¡å¼)
ç©ºé—´è®¡ç®—: PostGIS æ‰©å±• (å¤‡é€‰: JTS)
ä»»åŠ¡è°ƒåº¦: Spring Task + Redisåˆ†å¸ƒå¼é”
```

#### æ•°æ®å­˜å‚¨
```
ä¸»æ•°æ®åº“: MySQL 8.0+ (InnoDB + ç©ºé—´ç´¢å¼•)
ç¼“å­˜å±‚: Redis 7.0+ (String + Hash + Stream)
æ—¶åºæ•°æ®: è€ƒè™‘ InfluxDB (é«˜é¢‘è½¨è¿¹æ•°æ®)
æ–‡ä»¶å­˜å‚¨: MinIO/é˜¿é‡Œäº‘OSS (å›´æ æ–‡ä»¶ã€å¯¼å‡ºæ–‡ä»¶)
```

### 3.2 ç³»ç»Ÿæ¶æ„å›¾

```
è®¾å¤‡ç«¯æ•°æ®æµ:
[ç§»åŠ¨è®¾å¤‡] â†’ [æ•°æ®ç½‘å…³] â†’ [æ¶ˆæ¯é˜Ÿåˆ—] â†’ [è½¨è¿¹æœåŠ¡] â†’ [å­˜å‚¨å±‚]
     â†“           â†“           â†“           â†“           â†“
[GPSåæ ‡]   [æ•°æ®æ ¡éªŒ]   [å¼‚æ­¥å¤„ç†]   [å›´æ è®¡ç®—]   [MySQL/Redis]

å®æ—¶æ¨é€é“¾è·¯:
[è½¨è¿¹æœåŠ¡] â†’ [WebSocketç½‘å…³] â†’ [å‰ç«¯å®¢æˆ·ç«¯]
     â†“              â†“              â†“
[çŠ¶æ€å˜æ›´]      [æ¶ˆæ¯åˆ†å‘]      [UIæ›´æ–°]

æŸ¥è¯¢è®¿é—®é“¾è·¯:
[å‰ç«¯å®¢æˆ·ç«¯] â†’ [APIç½‘å…³] â†’ [ä¸šåŠ¡æœåŠ¡] â†’ [ç¼“å­˜å±‚] â†’ [æ•°æ®åº“]
     â†“           â†“          â†“          â†“          â†“
[ç”¨æˆ·è¯·æ±‚]   [è®¤è¯é‰´æƒ]   [ä¸šåŠ¡é€»è¾‘]   [Redis]    [MySQL]
```

### 3.3 æ•°æ®æ¨¡å‹è®¾è®¡

#### è½¨è¿¹æ•°æ®è¡¨ï¼ˆæŒ‰æœˆåˆ†è¡¨ï¼‰
```sql
-- è½¨è¿¹ä¸»è¡¨æ¨¡æ¿
CREATE TABLE t_location_track_202401 (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id VARCHAR(32) NOT NULL COMMENT 'ç”¨æˆ·ID',
    device_id VARCHAR(64) COMMENT 'è®¾å¤‡ID',
    track_time TIMESTAMP(3) NOT NULL COMMENT 'å®šä½æ—¶é—´(æ¯«ç§’ç²¾åº¦)',
    longitude DECIMAL(10,7) NOT NULL COMMENT 'ç»åº¦',
    latitude DECIMAL(10,7) NOT NULL COMMENT 'çº¬åº¦',
    altitude FLOAT COMMENT 'æµ·æ‹”é«˜åº¦(ç±³)',
    speed FLOAT COMMENT 'é€Ÿåº¦(km/h)',
    bearing FLOAT COMMENT 'æ–¹å‘è§’(åº¦)',
    accuracy FLOAT COMMENT 'å®šä½ç²¾åº¦(ç±³)',
    location_type TINYINT DEFAULT 1 COMMENT 'å®šä½ç±»å‹:1-GPS,2-WiFi,3-åŸºç«™',
    geom POINT SRID 4326 COMMENT 'ç©ºé—´å‡ ä½•å¯¹è±¡',
    raw_data JSON COMMENT 'åŸå§‹å®šä½æ•°æ®',
    created_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_user_time (user_id, track_time),
    INDEX idx_time (track_time),
    SPATIAL INDEX idx_geom (geom)
) COMMENT='ä½ç½®è½¨è¿¹è®°å½•è¡¨(æŒ‰æœˆåˆ†è¡¨)';
```

#### å›´æ é…ç½®è¡¨
```sql
CREATE TABLE t_geofence (
    fence_id VARCHAR(32) PRIMARY KEY COMMENT 'å›´æ ID',
    org_id VARCHAR(32) NOT NULL COMMENT 'ç»„ç»‡ID',
    fence_name VARCHAR(100) NOT NULL COMMENT 'å›´æ åç§°',
    fence_type ENUM('CIRCLE','RECTANGLE','POLYGON') NOT NULL COMMENT 'å›´æ ç±»å‹',
    geometry_data JSON NOT NULL COMMENT 'å‡ ä½•æ•°æ®',
    center_lng DECIMAL(10,7) COMMENT 'ä¸­å¿ƒç‚¹ç»åº¦',
    center_lat DECIMAL(10,7) COMMENT 'ä¸­å¿ƒç‚¹çº¬åº¦',
    radius FLOAT COMMENT 'åŠå¾„(ç±³,åœ†å½¢å›´æ ç”¨)',
    geom GEOMETRY SRID 4326 COMMENT 'ç©ºé—´å‡ ä½•å¯¹è±¡',
    
    -- å‘Šè­¦é…ç½®
    alert_on_enter BOOLEAN DEFAULT TRUE COMMENT 'è¿›å…¥å‘Šè­¦',
    alert_on_exit BOOLEAN DEFAULT TRUE COMMENT 'ç¦»å¼€å‘Šè­¦',
    alert_on_stay BOOLEAN DEFAULT FALSE COMMENT 'åœç•™å‘Šè­¦',
    stay_duration_minutes INT DEFAULT 30 COMMENT 'åœç•™æ—¶é•¿é˜ˆå€¼(åˆ†é’Ÿ)',
    alert_level ENUM('LOW','MEDIUM','HIGH') DEFAULT 'MEDIUM' COMMENT 'å‘Šè­¦çº§åˆ«',
    
    -- é€šçŸ¥é…ç½®
    notify_channels JSON COMMENT 'é€šçŸ¥æ¸ é“é…ç½®',
    notify_template_id VARCHAR(32) COMMENT 'é€šçŸ¥æ¨¡æ¿ID',
    
    -- çŠ¶æ€æ§åˆ¶
    is_active BOOLEAN DEFAULT TRUE COMMENT 'æ˜¯å¦å¯ç”¨',
    created_by VARCHAR(32) COMMENT 'åˆ›å»ºäºº',
    created_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_org (org_id),
    SPATIAL INDEX idx_geom (geom)
) COMMENT='ç”µå­å›´æ é…ç½®è¡¨';
```

#### å›´æ ç»‘å®šå…³ç³»è¡¨
```sql
CREATE TABLE t_fence_bind (
    bind_id VARCHAR(32) PRIMARY KEY,
    fence_id VARCHAR(32) NOT NULL COMMENT 'å›´æ ID',
    target_type ENUM('USER','DEVICE','VEHICLE') NOT NULL COMMENT 'ç»‘å®šç›®æ ‡ç±»å‹',
    target_id VARCHAR(32) NOT NULL COMMENT 'ç›®æ ‡ID',
    bind_rule JSON COMMENT 'ç»‘å®šè§„åˆ™',
    is_active BOOLEAN DEFAULT TRUE COMMENT 'æ˜¯å¦å¯ç”¨',
    created_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    UNIQUE KEY uk_fence_target (fence_id, target_type, target_id),
    INDEX idx_target (target_type, target_id)
) COMMENT='å›´æ ç»‘å®šå…³ç³»è¡¨';
```

#### å‘Šè­¦è®°å½•è¡¨
```sql
CREATE TABLE t_geofence_alert (
    alert_id VARCHAR(32) PRIMARY KEY,
    fence_id VARCHAR(32) NOT NULL COMMENT 'å›´æ ID',
    user_id VARCHAR(32) NOT NULL COMMENT 'ç”¨æˆ·ID',
    alert_type ENUM('ENTER','EXIT','STAY_TIMEOUT') NOT NULL COMMENT 'å‘Šè­¦ç±»å‹',
    alert_level ENUM('LOW','MEDIUM','HIGH') NOT NULL COMMENT 'å‘Šè­¦çº§åˆ«',
    
    -- æ—¶é—´ä¿¡æ¯
    start_time TIMESTAMP NOT NULL COMMENT 'å‘Šè­¦å¼€å§‹æ—¶é—´',
    end_time TIMESTAMP COMMENT 'å‘Šè­¦ç»“æŸæ—¶é—´',
    duration_minutes INT COMMENT 'æŒç»­æ—¶é•¿(åˆ†é’Ÿ)',
    
    -- ä½ç½®ä¿¡æ¯
    location_lng DECIMAL(10,7) COMMENT 'å‘Šè­¦ä½ç½®ç»åº¦',
    location_lat DECIMAL(10,7) COMMENT 'å‘Šè­¦ä½ç½®çº¬åº¦',
    location_desc VARCHAR(200) COMMENT 'ä½ç½®æè¿°',
    
    -- å¤„ç†ä¿¡æ¯
    alert_status ENUM('PENDING','PROCESSING','RESOLVED','IGNORED') DEFAULT 'PENDING',
    handler_id VARCHAR(32) COMMENT 'å¤„ç†äººID',
    handle_time TIMESTAMP COMMENT 'å¤„ç†æ—¶é—´',
    handle_note TEXT COMMENT 'å¤„ç†å¤‡æ³¨',
    
    -- é€šçŸ¥ä¿¡æ¯
    notify_status JSON COMMENT 'é€šçŸ¥çŠ¶æ€',
    notify_retry_count INT DEFAULT 0 COMMENT 'é€šçŸ¥é‡è¯•æ¬¡æ•°',
    
    created_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_fence_time (fence_id, start_time),
    INDEX idx_user_time (user_id, start_time),
    INDEX idx_status_time (alert_status, start_time)
) COMMENT='å›´æ å‘Šè­¦è®°å½•è¡¨';
```

#### ç”¨æˆ·åœ¨çº¿çŠ¶æ€è¡¨
```sql
CREATE TABLE t_user_online_status (
    user_id VARCHAR(32) PRIMARY KEY,
    device_id VARCHAR(64) COMMENT 'è®¾å¤‡ID',
    online_status ENUM('ONLINE','OFFLINE','ABNORMAL') NOT NULL COMMENT 'åœ¨çº¿çŠ¶æ€',
    last_location_time TIMESTAMP COMMENT 'æœ€åå®šä½æ—¶é—´',
    last_lng DECIMAL(10,7) COMMENT 'æœ€åç»åº¦',
    last_lat DECIMAL(10,7) COMMENT 'æœ€åçº¬åº¦',
    last_location_desc VARCHAR(200) COMMENT 'æœ€åä½ç½®æè¿°',
    heartbeat_interval INT DEFAULT 30 COMMENT 'å¿ƒè·³é—´éš”(ç§’)',
    updated_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_status (online_status),
    INDEX idx_update_time (updated_time)
) COMMENT='ç”¨æˆ·åœ¨çº¿çŠ¶æ€è¡¨';
```

### 3.4 API æ¥å£è®¾è®¡

#### è½¨è¿¹æ•°æ®æ¥å£
```java
// è½¨è¿¹ä¸Šä¼ æ¥å£
POST /api/v1/track/batch
Content-Type: application/json
{
    "deviceId": "device_001",
    "tracks": [
        {
            "userId": "user_001",
            "timestamp": 1642492800000,
            "longitude": 116.397428,
            "latitude": 39.90923,
            "altitude": 50.2,
            "speed": 12.5,
            "bearing": 45.0,
            "accuracy": 5.0,
            "locationType": 1
        }
    ]
}

// å®æ—¶è½¨è¿¹æŸ¥è¯¢
GET /api/v1/track/realtime?userIds=user_001,user_002&latest=true

// å†å²è½¨è¿¹æŸ¥è¯¢
GET /api/v1/track/history?userId=user_001&startTime=1642406400000&endTime=1642492800000&simplify=true&maxPoints=1000

// è½¨è¿¹ç»Ÿè®¡åˆ†æ
GET /api/v1/track/analytics?userId=user_001&date=2024-01-15
Response: {
    "totalDistance": 15.2,
    "totalDuration": 480,
    "averageSpeed": 8.5,
    "stayPoints": [
        {
            "longitude": 116.397428,
            "latitude": 39.90923,
            "stayDuration": 120,
            "locationDesc": "XXå…¬å¸"
        }
    ]
}
```

#### å›´æ ç®¡ç†æ¥å£
```java
// å›´æ CRUD
POST /api/v1/geofence
PUT /api/v1/geofence/{fenceId}
GET /api/v1/geofence/{fenceId}
DELETE /api/v1/geofence/{fenceId}
GET /api/v1/geofence/list?orgId=org_001&page=1&size=20

// å›´æ ç»‘å®šç®¡ç†
POST /api/v1/geofence/{fenceId}/bind
{
    "targetType": "USER",
    "targetIds": ["user_001", "user_002"],
    "bindRule": {
        "workTimeOnly": true,
        "weekdays": [1,2,3,4,5]
    }
}

// å›´æ éªŒè¯
POST /api/v1/geofence/validate
{
    "fenceType": "POLYGON",
    "geometryData": [[116.1, 39.1], [116.2, 39.1], ...]
}

// æ‰¹é‡å¯¼å…¥
POST /api/v1/geofence/import
Content-Type: multipart/form-data
file: geofence.xlsx
```

#### å‘Šè­¦ç®¡ç†æ¥å£
```java
// å‘Šè­¦åˆ—è¡¨æŸ¥è¯¢
GET /api/v1/alert/list?status=PENDING&level=HIGH&startTime=xxx&endTime=xxx&page=1&size=20

// å‘Šè­¦å¤„ç†
POST /api/v1/alert/{alertId}/handle
{
    "handlerAction": "RESOLVED",
    "handleNote": "å·²è”ç³»å½“äº‹äººç¡®è®¤å®‰å…¨"
}

// å‘Šè­¦ç»Ÿè®¡
GET /api/v1/alert/statistics?period=TODAY
Response: {
    "totalCount": 23,
    "levelStats": {"HIGH": 3, "MEDIUM": 12, "LOW": 8},
    "typeStats": {"ENTER": 10, "EXIT": 8, "STAY_TIMEOUT": 5},
    "trend": [{"hour": 9, "count": 2}, {"hour": 10, "count": 5}]
}
```

#### WebSocket å®æ—¶é€šä¿¡
```javascript
// WebSocketè¿æ¥
ws://localhost:8080/ws/track/{token}

// æ¶ˆæ¯æ ¼å¼
{
    "type": "LOCATION_UPDATE",
    "data": {
        "userId": "user_001",
        "timestamp": 1642492800000,
        "longitude": 116.397428,
        "latitude": 39.90923,
        "status": "ONLINE"
    }
}

{
    "type": "ALERT",
    "data": {
        "alertId": "alert_001",
        "fenceId": "fence_001",
        "userId": "user_001",
        "alertType": "EXIT",
        "alertLevel": "HIGH",
        "location": {
            "longitude": 116.397428,
            "latitude": 39.90923
        },
        "timestamp": 1642492800000
    }
}
```

### 3.5 å›´æ ç®—æ³•ä¸ç©ºé—´æ£€ç´¢

#### å›´æ åˆ¤å®šç®—æ³•
```java
public class GeofenceCalculator {
    
    // åœ†å½¢å›´æ åˆ¤å®š
    public boolean isInsideCircle(Point point, Circle circle) {
        double distance = calculateDistance(point, circle.getCenter());
        return distance <= circle.getRadius();
    }
    
    // çŸ©å½¢å›´æ åˆ¤å®š
    public boolean isInsideRectangle(Point point, Rectangle rect) {
        return point.getLng() >= rect.getMinLng() 
            && point.getLng() <= rect.getMaxLng()
            && point.getLat() >= rect.getMinLat() 
            && point.getLat() <= rect.getMaxLat();
    }
    
    // å¤šè¾¹å½¢å›´æ åˆ¤å®šï¼ˆå°„çº¿æ³•ï¼‰
    public boolean isInsidePolygon(Point point, List<Point> polygon) {
        int intersections = 0;
        for (int i = 0; i < polygon.size(); i++) {
            Point p1 = polygon.get(i);
            Point p2 = polygon.get((i + 1) % polygon.size());
            
            if (rayIntersectsSegment(point, p1, p2)) {
                intersections++;
            }
        }
        return intersections % 2 == 1;
    }
}
```

#### ç©ºé—´ç´¢å¼•ä¼˜åŒ–
```java
// MySQLç©ºé—´ç´¢å¼•æŸ¥è¯¢
@Query("""
    SELECT f.fence_id, f.fence_name, f.fence_type
    FROM t_geofence f 
    WHERE f.is_active = true 
    AND ST_Contains(f.geom, ST_GeomFromText('POINT(?1 ?2)', 4326))
""")
List<Geofence> findContainingFences(double longitude, double latitude);

// Redisåœ°ç†ç©ºé—´ç´¢å¼•ï¼ˆç”¨äºå¿«é€Ÿé¢„ç­›é€‰ï¼‰
public List<String> getNearbyFences(double lng, double lat, double radius) {
    return redisTemplate.opsForGeo()
        .radius("geofence_centers", lng, lat, radius, RedisGeoCommands.DistanceUnit.METERS)
        .getContent()
        .stream()
        .map(result -> result.getContent().getName())
        .collect(Collectors.toList());
}
```

#### è½¨è¿¹å¤„ç†ç®—æ³•
```java
// è½¨è¿¹çº åï¼ˆå¡å°”æ›¼æ»¤æ³¢ï¼‰
public class TrackFilter {
    private KalmanFilter kalmanFilter;
    
    public Point filterPoint(Point rawPoint, Point previousPoint) {
        if (previousPoint == null) {
            kalmanFilter.init(rawPoint);
            return rawPoint;
        }
        
        // é€Ÿåº¦å¼‚å¸¸æ£€æµ‹
        double speed = calculateSpeed(previousPoint, rawPoint);
        if (speed > MAX_REASONABLE_SPEED) {
            return kalmanFilter.predict(); // è¿”å›é¢„æµ‹ä½ç½®
        }
        
        return kalmanFilter.update(rawPoint);
    }
}

// Douglas-Peuckerè½¨è¿¹æŠ½ç¨€ç®—æ³•
public List<Point> simplifyTrack(List<Point> track, double tolerance) {
    if (track.size() <= 2) return track;
    
    // æ‰¾åˆ°è·ç¦»é¦–å°¾è¿çº¿æœ€è¿œçš„ç‚¹
    double maxDistance = 0;
    int maxIndex = 0;
    
    for (int i = 1; i < track.size() - 1; i++) {
        double distance = pointToLineDistance(track.get(i), 
                                             track.get(0), 
                                             track.get(track.size() - 1));
        if (distance > maxDistance) {
            maxDistance = distance;
            maxIndex = i;
        }
    }
    
    // é€’å½’å¤„ç†
    if (maxDistance > tolerance) {
        List<Point> left = simplifyTrack(track.subList(0, maxIndex + 1), tolerance);
        List<Point> right = simplifyTrack(track.subList(maxIndex, track.size()), tolerance);
        
        left.addAll(right.subList(1, right.size()));
        return left;
    } else {
        return Arrays.asList(track.get(0), track.get(track.size() - 1));
    }
}

// åœç•™ç‚¹è¯†åˆ«
public List<StayPoint> detectStayPoints(List<TrackPoint> track) {
    List<StayPoint> stayPoints = new ArrayList<>();
    int i = 0;
    
    while (i < track.size()) {
        int j = i + 1;
        
        // æŸ¥æ‰¾è¿ç»­çš„ä½é€Ÿç‚¹
        while (j < track.size()) {
            double distance = calculateDistance(track.get(i).getLocation(), 
                                              track.get(j).getLocation());
            long timeDiff = track.get(j).getTimestamp() - track.get(i).getTimestamp();
            
            if (distance > STAY_DISTANCE_THRESHOLD || 
                timeDiff > MAX_STAY_TIME_GAP) {
                break;
            }
            j++;
        }
        
        // å¦‚æœåœç•™æ—¶é—´è¶…è¿‡é˜ˆå€¼ï¼Œè®°å½•ä¸ºåœç•™ç‚¹
        long stayDuration = track.get(j-1).getTimestamp() - track.get(i).getTimestamp();
        if (stayDuration >= MIN_STAY_DURATION) {
            Point centerPoint = calculateCenterPoint(track.subList(i, j));
            stayPoints.add(new StayPoint(centerPoint, 
                                       track.get(i).getTimestamp(),
                                       track.get(j-1).getTimestamp(),
                                       stayDuration));
        }
        
        i = j;
    }
    
    return stayPoints;
}
```

## 4. æ€§èƒ½ä¸å®¹é‡è§„åˆ’

### 4.1 å¹¶å‘ä¸ååé‡è®¾è®¡

#### ç”¨æˆ·è§„æ¨¡ä¸è´Ÿè½½åˆ†æ
```
ç”¨æˆ·è§„æ¨¡: 1000äºº
å®æ—¶åœ¨çº¿å³°å€¼: 300äºº (å·¥ä½œæ—¶é—´)
ä½ç½®ä¸ŠæŠ¥é¢‘ç‡: 10ç§’/æ¬¡ (å¯é…5-60ç§’)
æ—¥è½¨è¿¹æ•°æ®é‡: 300ç”¨æˆ· Ã— 8å°æ—¶ Ã— 360æ¬¡ = 864,000æ¡/å¤©
æœˆåº¦æ•°æ®é‡: 864K Ã— 30 = 25,920,000æ¡/æœˆ (çº¦2600ä¸‡æ¡)

å­˜å‚¨å®¹é‡é¢„ä¼°:
- å•æ¡è½¨è¿¹è®°å½•: ~200å­—èŠ‚ (å«ç©ºé—´ç´¢å¼•)
- æœˆåº¦å­˜å‚¨: 26M Ã— 200B â‰ˆ 5.2GB/æœˆ
- å¹´åº¦å­˜å‚¨: 5.2GB Ã— 12 â‰ˆ 62.4GB/å¹´
```

#### å¹¶å‘å¤„ç†èƒ½åŠ›
```java
// è½¨è¿¹ä¸Šä¼ æ‰¹å¤„ç†é…ç½®
@ConfigurationProperties(prefix = "track.upload")
public class TrackUploadConfig {
    private int batchSize = 500;              // å•æ¬¡æ‰¹é‡ä¸Šä¼ æœ€å¤§æ¡æ•°
    private int maxConcurrency = 50;          // æœ€å¤§å¹¶å‘å¤„ç†æ•°
    private int queueCapacity = 10000;        // é˜Ÿåˆ—å®¹é‡
    private Duration timeout = Duration.ofSeconds(30);
}

// çº¿ç¨‹æ± é…ç½®
@Configuration
public class AsyncConfig {
    @Bean("trackProcessExecutor")
    public Executor trackProcessExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
        executor.setCorePoolSize(20);
        executor.setMaxPoolSize(50);
        executor.setQueueCapacity(1000);
        executor.setThreadNamePrefix("track-process-");
        executor.setRejectedExecutionHandler(new ThreadPoolExecutor.CallerRunsPolicy());
        return executor;
    }
}
```

### 4.2 å‰ç«¯æ€§èƒ½é¢„ç®—

#### é¡µé¢åŠ è½½æ€§èƒ½ç›®æ ‡
```
é¦–å±åŠ è½½æŒ‡æ ‡:
- FCP (First Contentful Paint): < 1.2s
- LCP (Largest Contentful Paint): < 2.5s  
- FID (First Input Delay): < 100ms
- CLS (Cumulative Layout Shift): < 0.1

åœ°å›¾æ¸²æŸ“æ€§èƒ½:
- åœ°å›¾åˆå§‹åŒ–: < 800ms
- åˆ‡ç‰‡åŠ è½½: < 300ms/åˆ‡ç‰‡
- ç‚¹ä½æ¸²æŸ“: 1000ä¸ªç‚¹ä½ < 100ms
- è½¨è¿¹ç»˜åˆ¶: 10000ä¸ªç‚¹ < 500ms
```

#### å‰ç«¯ä¼˜åŒ–ç­–ç•¥
```typescript
// ä»£ç åˆ†å‰²ä¸æ‡’åŠ è½½
const router = createRouter({
  routes: [
    {
      path: '/realtime',
      component: () => import('@/views/RealTimeMonitor.vue'),
      meta: { preload: true }
    },
    {
      path: '/history',
      component: () => import('@/views/HistoryPlayback.vue'),
      meta: { lazy: true }
    },
    {
      path: '/geofence',
      component: () => import('@/views/GeofenceManagement.vue')
    }
  ]
});

// è½¨è¿¹æ•°æ®åˆ†é¡µåŠ è½½
class TrackDataManager {
  private pageSize = 1000;
  private maxCachePoints = 5000;
  
  async loadTrackData(params: TrackQueryParams): Promise<TrackPoint[]> {
    // è¶…è¿‡1ä¸‡ç‚¹è‡ªåŠ¨åˆ†é¡µ
    if (params.totalPoints > 10000) {
      return this.loadTrackDataPaginated(params);
    }
    
    // å¯ç”¨æŠ½ç¨€ç®—æ³•
    if (params.simplify) {
      params.tolerance = this.calculateOptimalTolerance(params.totalPoints);
    }
    
    return this.loadTrackDataDirect(params);
  }
  
  // ç‚¹èšåˆç­–ç•¥
  shouldEnableCluster(pointCount: number): boolean {
    return pointCount >= 200;
  }
  
  shouldEnableHeatmap(pointCount: number): boolean {
    return pointCount >= 1000;
  }
}
```

#### åœ°å›¾æ€§èƒ½ä¼˜åŒ–
```typescript
// MapBoxé…ç½®ä¼˜åŒ–
const mapConfig = {
  // åŸºç¡€æ€§èƒ½é…ç½®
  maxZoom: 18,
  minZoom: 3,
  renderWorldCopies: false,
  
  // ä½ç«¯è®¾å¤‡ä¼˜åŒ–
  fadeDuration: window.devicePixelRatio > 1 ? 300 : 0,
  crossSourceCollisions: false,
  
  // æ•°æ®æºä¼˜åŒ–
  clusterMaxZoom: 14,
  clusterRadius: 50,
  clusterMinPoints: 2
};

// è½¨è¿¹æ¸²æŸ“ä¼˜åŒ–
class TrackRenderer {
  private renderQueue: TrackPoint[][] = [];
  private renderBatchSize = 100;
  
  // åˆ†æ‰¹æ¸²æŸ“å¤§é‡è½¨è¿¹ç‚¹
  async renderTrackBatched(points: TrackPoint[]) {
    const batches = this.splitIntoBatches(points, this.renderBatchSize);
    
    for (const batch of batches) {
      await this.renderBatch(batch);
      await this.nextFrame(); // é¿å…é˜»å¡ä¸»çº¿ç¨‹
    }
  }
  
  private nextFrame(): Promise<void> {
    return new Promise(resolve => requestAnimationFrame(() => resolve()));
  }
}
```

### 4.3 åç«¯æ€§èƒ½é¢„ç®—ä¸ä¼˜åŒ–

#### æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–
```sql
-- åˆ†è¡¨ç­–ç•¥ç¤ºä¾‹
CREATE TABLE t_location_track_202401 LIKE t_location_track_template;
CREATE TABLE t_location_track_202402 LIKE t_location_track_template;

-- ç´¢å¼•ä¼˜åŒ–ç­–ç•¥
ALTER TABLE t_location_track_202401 
ADD INDEX idx_user_time_covering (user_id, track_time, longitude, latitude, speed);

-- ç©ºé—´ç´¢å¼•ä¼˜åŒ–
ALTER TABLE t_geofence 
ADD SPATIAL INDEX idx_geom_optimized (geom) USING RTREE;

-- æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–
-- ä½¿ç”¨è¦†ç›–ç´¢å¼•é¿å…å›è¡¨
SELECT user_id, track_time, longitude, latitude, speed 
FROM t_location_track_202401 
WHERE user_id = ? AND track_time BETWEEN ? AND ?
ORDER BY track_time;
```

#### ç¼“å­˜ç­–ç•¥è®¾è®¡
```java
@Configuration
@EnableCaching
public class CacheConfig {
    
    // Redisç¼“å­˜é…ç½®
    @Bean
    public CacheManager cacheManager() {
        RedisCacheManager.Builder builder = RedisCacheManager
            .RedisCacheManagerBuilder
            .fromConnectionFactory(redisConnectionFactory())
            .cacheDefaults(cacheConfiguration());
        return builder.build();
    }
    
    private RedisCacheConfiguration cacheConfiguration() {
        return RedisCacheConfiguration.defaultCacheConfig()
            .entryTtl(Duration.ofMinutes(10))  // é»˜è®¤10åˆ†é’Ÿè¿‡æœŸ
            .serializeKeysWith(RedisSerializationContext.SerializationPair
                .fromSerializer(new StringRedisSerializer()))
            .serializeValuesWith(RedisSerializationContext.SerializationPair
                .fromSerializer(new GenericJackson2JsonRedisSerializer()))
            .disableCachingNullValues();
    }
}

@Service
public class TrackCacheService {
    
    // æœ€è¿‘è½¨è¿¹ç¼“å­˜(30åˆ†é’Ÿ)
    @Cacheable(value = "track:recent", key = "#userId", unless = "#result.isEmpty()")
    public List<TrackPoint> getRecentTrack(String userId) {
        return trackService.getTrackInRecentMinutes(userId, 30);
    }
    
    // åœ¨çº¿çŠ¶æ€ç¼“å­˜
    @Cacheable(value = "user:online", key = "#userId")
    public UserOnlineStatus getUserOnlineStatus(String userId) {
        return userService.getOnlineStatus(userId);
    }
    
    // å›´æ ç¼“å­˜(1å°æ—¶)
    @Cacheable(value = "geofence:active", unless = "#result.isEmpty()")
    public List<Geofence> getActiveGeofences() {
        return geofenceService.getActiveGeofences();
    }
}
```

#### å®æ—¶è®¡ç®—ä¼˜åŒ–
```java
@Component
public class RealTimeTrackProcessor {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    @Autowired
    private GeofenceCalculator geofenceCalculator;
    
    // å®æ—¶è½¨è¿¹å¤„ç†
    @EventListener
    @Async("trackProcessExecutor")
    public void processTrackPoint(TrackPointEvent event) {
        TrackPoint point = event.getTrackPoint();
        
        // 1. æ›´æ–°åœ¨çº¿çŠ¶æ€
        updateOnlineStatus(point);
        
        // 2. å›´æ åˆ¤å®š(å†…å­˜è®¡ç®—)
        List<Geofence> nearbyFences = getNearbyFences(point);
        for (Geofence fence : nearbyFences) {
            processGeofenceEvent(point, fence);
        }
        
        // 3. å®æ—¶æ¨é€
        publishTrackUpdate(point);
    }
    
    // è·å–é™„è¿‘å›´æ (ä½¿ç”¨Redisåœ°ç†ç´¢å¼•é¢„ç­›é€‰)
    private List<Geofence> getNearbyFences(TrackPoint point) {
        // å…ˆä»Redisåœ°ç†ç´¢å¼•è·å–å€™é€‰å›´æ 
        Set<String> nearbyFenceIds = redisTemplate.opsForGeo()
            .radius("geofence_centers", 
                   point.getLongitude(), 
                   point.getLatitude(), 
                   1000, // 1å…¬é‡ŒèŒƒå›´é¢„ç­›é€‰
                   RedisGeoCommands.DistanceUnit.METERS)
            .getContent()
            .stream()
            .map(result -> result.getContent().getName())
            .collect(Collectors.toSet());
        
        // ä»ç¼“å­˜è·å–å›´æ è¯¦æƒ…
        return nearbyFenceIds.stream()
            .map(this::getGeofenceFromCache)
            .filter(Objects::nonNull)
            .collect(Collectors.toList());
    }
}
```

### 4.4 ç³»ç»Ÿç›‘æ§ä¸å‘Šè­¦

#### å…³é”®æ€§èƒ½æŒ‡æ ‡
```java
@Component
public class PerformanceMetrics {
    
    private final MeterRegistry meterRegistry;
    private final Counter trackUploadCounter;
    private final Timer trackProcessTimer;
    private final Gauge onlineUserGauge;
    
    public PerformanceMetrics(MeterRegistry meterRegistry) {
        this.meterRegistry = meterRegistry;
        this.trackUploadCounter = Counter.builder("track.upload.total")
            .description("Total track uploads")
            .register(meterRegistry);
        this.trackProcessTimer = Timer.builder("track.process.duration")
            .description("Track processing duration")
            .register(meterRegistry);
        this.onlineUserGauge = Gauge.builder("user.online.count")
            .description("Current online user count")
            .register(meterRegistry, this, PerformanceMetrics::getOnlineUserCount);
    }
    
    // æ ¸å¿ƒæ€§èƒ½æŒ‡æ ‡
    @Scheduled(fixedRate = 30000) // æ¯30ç§’æ›´æ–°
    public void updateMetrics() {
        // WebSocketè¿æ¥æ•°
        meterRegistry.gauge("websocket.connections", getWebSocketConnections());
        
        // æ•°æ®åº“è¿æ¥æ± çŠ¶æ€
        meterRegistry.gauge("database.connections.active", getActiveDbConnections());
        meterRegistry.gauge("database.connections.idle", getIdleDbConnections());
        
        // Redisè¿æ¥çŠ¶æ€
        meterRegistry.gauge("redis.connections", getRedisConnections());
        
        // JVMå†…å­˜ä½¿ç”¨
        meterRegistry.gauge("jvm.memory.used", getUsedMemory());
    }
}
```

#### å‘Šè­¦é˜ˆå€¼é…ç½®
```yaml
# application-prod.yml
management:
  metrics:
    export:
      prometheus:
        enabled: true
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus

# å‘Šè­¦è§„åˆ™é…ç½®
alerts:
  performance:
    # APIå“åº”æ—¶é—´å‘Šè­¦
    api_response_time:
      threshold: 1000ms  # P95è¶…è¿‡1ç§’å‘Šè­¦
      window: 5m
    
    # æ•°æ®åº“è¿æ¥æ± å‘Šè­¦
    db_pool_usage:
      threshold: 80%     # ä½¿ç”¨ç‡è¶…è¿‡80%å‘Šè­¦
      window: 2m
    
    # å†…å­˜ä½¿ç”¨å‘Šè­¦
    memory_usage:
      threshold: 85%     # å†…å­˜ä½¿ç”¨è¶…è¿‡85%å‘Šè­¦
      window: 5m
    
    # WebSocketè¿æ¥å‘Šè­¦
    websocket_connections:
      threshold: 500     # è¿æ¥æ•°è¶…è¿‡500å‘Šè­¦
      window: 1m
      
    # è½¨è¿¹ä¸Šä¼ å¤±è´¥ç‡å‘Šè­¦
    track_upload_failure_rate:
      threshold: 5%      # å¤±è´¥ç‡è¶…è¿‡5%å‘Šè­¦
      window: 10m
```

## 5. å®‰å…¨ä¸å¤šç§Ÿæˆ·è®¾è®¡

### 5.1 è®¤è¯ä¸æˆæƒä½“ç³»

#### JWTè®¤è¯æœºåˆ¶
```java
@Configuration
@EnableWebSecurity
public class SecurityConfig {
    
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http
            .sessionManagement(session -> 
                session.sessionCreationPolicy(SessionCreationPolicy.STATELESS))
            .authorizeHttpRequests(authz -> authz
                .requestMatchers("/api/v1/auth/**").permitAll()
                .requestMatchers("/api/v1/track/upload").hasRole("DEVICE")
                .requestMatchers(HttpMethod.GET, "/api/v1/track/**").hasRole("VIEWER")
                .requestMatchers("/api/v1/geofence/**").hasRole("ADMIN")
                .requestMatchers("/api/v1/alert/**").hasRole("OPERATOR")
                .anyRequest().authenticated())
            .oauth2ResourceServer(oauth2 -> 
                oauth2.jwt(jwt -> jwt.jwtDecoder(jwtDecoder())));
        
        return http.build();
    }
}

@Component
public class JwtTokenProvider {
    
    public String createToken(UserAuthentication auth) {
        Instant now = Instant.now();
        
        return Jwt.withTokenValue(UUID.randomUUID().toString())
            .header("alg", "RS256")
            .header("typ", "JWT")
            .issuer("ljwx-system")
            .subject(auth.getUserId())
            .audience("ljwx-client")
            .issuedAt(now)
            .expiresAt(now.plus(Duration.ofHours(8))) // 8å°æ—¶æœ‰æ•ˆæœŸ
            .claim("orgId", auth.getOrgId())
            .claim("roles", auth.getRoles())
            .claim("permissions", auth.getPermissions())
            .claim("tenantId", auth.getTenantId())
            .build()
            .getTokenValue();
    }
}
```

#### RBACæƒé™æ¨¡å‹
```java
// æƒé™æšä¸¾å®šä¹‰
public enum TrackPermission {
    // è½¨è¿¹ç›¸å…³æƒé™
    TRACK_VIEW("track:view", "æŸ¥çœ‹è½¨è¿¹"),
    TRACK_VIEW_ALL("track:view:all", "æŸ¥çœ‹æ‰€æœ‰äººè½¨è¿¹"),
    TRACK_HISTORY("track:history", "æŸ¥çœ‹å†å²è½¨è¿¹"),
    TRACK_EXPORT("track:export", "å¯¼å‡ºè½¨è¿¹"),
    
    // å›´æ ç›¸å…³æƒé™
    GEOFENCE_VIEW("geofence:view", "æŸ¥çœ‹å›´æ "),
    GEOFENCE_CREATE("geofence:create", "åˆ›å»ºå›´æ "),
    GEOFENCE_EDIT("geofence:edit", "ç¼–è¾‘å›´æ "),
    GEOFENCE_DELETE("geofence:delete", "åˆ é™¤å›´æ "),
    GEOFENCE_BIND("geofence:bind", "ç»‘å®šå›´æ "),
    
    // å‘Šè­¦ç›¸å…³æƒé™
    ALERT_VIEW("alert:view", "æŸ¥çœ‹å‘Šè­¦"),
    ALERT_HANDLE("alert:handle", "å¤„ç†å‘Šè­¦"),
    ALERT_CONFIG("alert:config", "é…ç½®å‘Šè­¦è§„åˆ™"),
    
    // ç³»ç»Ÿæƒé™
    SYSTEM_ADMIN("system:admin", "ç³»ç»Ÿç®¡ç†");
}

// é¢„å®šä¹‰è§’è‰²
@Component
public class RoleDefinitions {
    public static final Role VIEWER = Role.builder()
        .name("æŸ¥çœ‹å‘˜")
        .permissions(Set.of(
            TrackPermission.TRACK_VIEW,
            TrackPermission.GEOFENCE_VIEW,
            TrackPermission.ALERT_VIEW
        ))
        .build();
    
    public static final Role OPERATOR = Role.builder()
        .name("æ“ä½œå‘˜")
        .permissions(Set.of(
            TrackPermission.TRACK_VIEW,
            TrackPermission.TRACK_HISTORY,
            TrackPermission.GEOFENCE_VIEW,
            TrackPermission.ALERT_VIEW,
            TrackPermission.ALERT_HANDLE
        ))
        .build();
        
    public static final Role ADMIN = Role.builder()
        .name("ç®¡ç†å‘˜")
        .permissions(Set.of(TrackPermission.values())) // å…¨æƒé™
        .build();
}
```

### 5.2 æ•°æ®éš”ç¦»ä¸ç§Ÿæˆ·ç®¡ç†

#### å¤šç§Ÿæˆ·æ•°æ®éš”ç¦»
```java
// ç§Ÿæˆ·ä¸Šä¸‹æ–‡ç®¡ç†
@Component
public class TenantContext {
    private static final ThreadLocal<String> TENANT_ID = new ThreadLocal<>();
    
    public static void setTenantId(String tenantId) {
        TENANT_ID.set(tenantId);
    }
    
    public static String getTenantId() {
        return TENANT_ID.get();
    }
    
    public static void clear() {
        TENANT_ID.remove();
    }
}

// ç§Ÿæˆ·æ‹¦æˆªå™¨
@Component
public class TenantInterceptor implements HandlerInterceptor {
    
    @Override
    public boolean preHandle(HttpServletRequest request, 
                           HttpServletResponse response, 
                           Object handler) {
        String tenantId = extractTenantId(request);
        if (tenantId != null) {
            TenantContext.setTenantId(tenantId);
        }
        return true;
    }
    
    @Override
    public void afterCompletion(HttpServletRequest request, 
                              HttpServletResponse response, 
                              Object handler, Exception ex) {
        TenantContext.clear();
    }
}

// MyBatisæ‹¦æˆªå™¨å®ç°è‡ªåŠ¨ç§Ÿæˆ·è¿‡æ»¤
@Intercepts({@Signature(type = Executor.class, method = "query")})
public class TenantSqlInterceptor implements Interceptor {
    
    @Override
    public Object intercept(Invocation invocation) throws Throwable {
        String tenantId = TenantContext.getTenantId();
        if (tenantId != null) {
            // è‡ªåŠ¨åœ¨SQLä¸­æ·»åŠ ç§Ÿæˆ·æ¡ä»¶
            modifySqlWithTenantFilter(invocation, tenantId);
        }
        return invocation.proceed();
    }
}
```

#### æ•°æ®åˆ†è¡¨ç­–ç•¥
```sql
-- æŒ‰ç§Ÿæˆ·åˆ†è¡¨çš„è½¨è¿¹æ•°æ®
CREATE TABLE t_location_track_tenant1_202401 (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id VARCHAR(32) NOT NULL,
    tenant_id VARCHAR(32) NOT NULL DEFAULT 'tenant1',
    track_time TIMESTAMP(3) NOT NULL,
    longitude DECIMAL(10,7) NOT NULL,
    latitude DECIMAL(10,7) NOT NULL,
    -- å…¶ä»–å­—æ®µ...
    
    INDEX idx_tenant_user_time (tenant_id, user_id, track_time)
) COMMENT='ç§Ÿæˆ·1è½¨è¿¹æ•°æ®è¡¨';

-- å›´æ è¡¨ç§Ÿæˆ·éš”ç¦»
ALTER TABLE t_geofence 
ADD COLUMN tenant_id VARCHAR(32) NOT NULL DEFAULT '',
ADD INDEX idx_tenant_org (tenant_id, org_id);
```

### 5.3 æ•°æ®å®‰å…¨ä¸å®¡è®¡

#### æ•æ„Ÿæ•°æ®ä¿æŠ¤
```java
@Component
public class DataEncryption {
    
    private final AESUtil aesUtil;
    
    // ä½ç½®æ•°æ®åŠ å¯†å­˜å‚¨
    public String encryptLocation(double longitude, double latitude) {
        String locationStr = longitude + "," + latitude;
        return aesUtil.encrypt(locationStr);
    }
    
    public Point decryptLocation(String encryptedLocation) {
        String locationStr = aesUtil.decrypt(encryptedLocation);
        String[] coords = locationStr.split(",");
        return new Point(Double.parseDouble(coords[0]), 
                        Double.parseDouble(coords[1]));
    }
}

// æ•°æ®è„±æ•é…ç½®
@JsonSerialize(using = LocationDesensitizer.class)
public class TrackPointDto {
    private String userId;
    private Long timestamp;
    private Double longitude; // è„±æ•å¤„ç†
    private Double latitude;  // è„±æ•å¤„ç†
}

public class LocationDesensitizer extends JsonSerializer<Double> {
    @Override
    public void serialize(Double value, JsonGenerator gen, 
                         SerializerProvider serializers) throws IOException {
        // æ ¹æ®ç”¨æˆ·æƒé™å†³å®šç²¾åº¦
        if (hasHighPrecisionPermission()) {
            gen.writeNumber(value);
        } else {
            // é™ä½ç²¾åº¦åˆ°100ç±³çº§åˆ«
            gen.writeNumber(Math.round(value * 1000.0) / 1000.0);
        }
    }
}
```

#### æ“ä½œå®¡è®¡æ—¥å¿—
```java
@Entity
@Table(name = "t_audit_log")
public class AuditLog {
    @Id
    private String id;
    
    @Column(name = "tenant_id")
    private String tenantId;
    
    @Column(name = "user_id")
    private String userId;
    
    @Column(name = "operation_type")
    @Enumerated(EnumType.STRING)
    private OperationType operationType;
    
    @Column(name = "resource_type")
    private String resourceType;
    
    @Column(name = "resource_id")
    private String resourceId;
    
    @Column(name = "operation_details", columnDefinition = "JSON")
    private String operationDetails;
    
    @Column(name = "client_ip")
    private String clientIp;
    
    @Column(name = "user_agent")
    private String userAgent;
    
    @Column(name = "operation_time")
    private LocalDateTime operationTime;
    
    @Column(name = "operation_result")
    @Enumerated(EnumType.STRING)
    private OperationResult operationResult;
}

// å®¡è®¡åˆ‡é¢
@Aspect
@Component
public class AuditAspect {
    
    @Around("@annotation(Auditable)")
    public Object auditOperation(ProceedingJoinPoint joinPoint) throws Throwable {
        long startTime = System.currentTimeMillis();
        String operationId = UUID.randomUUID().toString();
        
        try {
            // è®°å½•æ“ä½œå¼€å§‹
            auditLogService.logOperationStart(operationId, joinPoint);
            
            Object result = joinPoint.proceed();
            
            // è®°å½•æ“ä½œæˆåŠŸ
            auditLogService.logOperationSuccess(operationId, result, 
                                               System.currentTimeMillis() - startTime);
            
            return result;
        } catch (Exception e) {
            // è®°å½•æ“ä½œå¤±è´¥
            auditLogService.logOperationFailure(operationId, e,
                                               System.currentTimeMillis() - startTime);
            throw e;
        }
    }
}
```

## 6. å¯è¿ç»´æ€§ä¸ç›‘æ§

### 6.1 é…ç½®ä¸­å¿ƒç®¡ç†
```yaml
# è½¨è¿¹é…ç½®
track:
  upload:
    batch-size: 500                    # æ‰¹é‡ä¸Šä¼ å¤§å°
    max-retry: 3                       # æœ€å¤§é‡è¯•æ¬¡æ•°
    timeout: 30s                       # è¶…æ—¶æ—¶é—´
  sampling:
    default-interval: 10s              # é»˜è®¤é‡‡æ ·é—´éš”
    high-precision-interval: 5s        # é«˜ç²¾åº¦é‡‡æ ·é—´éš”
    power-saving-interval: 60s         # çœç”µæ¨¡å¼é‡‡æ ·é—´éš”
  simplification:
    enable: true                       # å¯ç”¨è½¨è¿¹æŠ½ç¨€
    tolerance: 10.0                    # æŠ½ç¨€å®¹å·®(ç±³)
    max-points: 1000                   # å•æ¬¡æŸ¥è¯¢æœ€å¤§ç‚¹æ•°

# å›´æ é…ç½®  
geofence:
  calculation:
    enable-spatial-index: true         # å¯ç”¨ç©ºé—´ç´¢å¼•
    batch-process-size: 100            # æ‰¹å¤„ç†å¤§å°
    cache-nearby-fences: true          # ç¼“å­˜é™„è¿‘å›´æ 
  alert:
    max-alerts-per-minute: 10          # æ¯åˆ†é’Ÿæœ€å¤§å‘Šè­¦æ•°
    duplicate-alert-interval: 5m       # é‡å¤å‘Šè­¦é—´éš”
    alert-queue-size: 1000             # å‘Šè­¦é˜Ÿåˆ—å¤§å°

# é€šçŸ¥é…ç½®
notification:
  channels:
    wechat:
      enabled: true
      app-id: ${WECHAT_APP_ID}
      app-secret: ${WECHAT_APP_SECRET}
      template-id: ${WECHAT_TEMPLATE_ID}
    sms:
      enabled: true
      provider: aliyun
      access-key: ${SMS_ACCESS_KEY}
      access-secret: ${SMS_ACCESS_SECRET}
    email:
      enabled: false
      smtp-host: smtp.company.com
      smtp-port: 587

# æ€§èƒ½é…ç½®
performance:
  database:
    max-connections: 100               # æœ€å¤§æ•°æ®åº“è¿æ¥æ•°
    query-timeout: 30s                 # æŸ¥è¯¢è¶…æ—¶
  redis:
    max-connections: 50                # æœ€å¤§Redisè¿æ¥æ•°
    command-timeout: 5s                # å‘½ä»¤è¶…æ—¶
  websocket:
    max-connections: 500               # æœ€å¤§WebSocketè¿æ¥æ•°
    heartbeat-interval: 30s            # å¿ƒè·³é—´éš”
```

### 6.2 ç›‘æ§æŒ‡æ ‡ä½“ç³»
```java
@Component
public class TrackingMetrics {
    
    // ä¸šåŠ¡æŒ‡æ ‡
    @EventListener
    public void onTrackUpload(TrackUploadEvent event) {
        // è½¨è¿¹ä¸Šä¼ é‡ç»Ÿè®¡
        Metrics.counter("track.upload.count",
            "tenant", event.getTenantId(),
            "user", event.getUserId()).increment();
            
        // è½¨è¿¹ä¸Šä¼ å­—èŠ‚æ•°
        Metrics.counter("track.upload.bytes",
            "tenant", event.getTenantId()).increment(event.getDataSize());
    }
    
    @EventListener
    public void onGeofenceAlert(GeofenceAlertEvent event) {
        // å‘Šè­¦æ•°é‡ç»Ÿè®¡
        Metrics.counter("geofence.alert.count",
            "type", event.getAlertType().name(),
            "level", event.getAlertLevel().name(),
            "fence", event.getFenceId()).increment();
    }
    
    // ç³»ç»ŸæŒ‡æ ‡
    @Scheduled(fixedRate = 30000)
    public void recordSystemMetrics() {
        // WebSocketè¿æ¥æ•°
        Metrics.gauge("websocket.connections.active", 
                     webSocketService.getActiveConnections());
        
        // åœ¨çº¿ç”¨æˆ·æ•°
        Metrics.gauge("user.online.count",
                     userService.getOnlineUserCount());
        
        // æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½
        recordDatabaseMetrics();
        
        // Redisæ€§èƒ½æŒ‡æ ‡
        recordRedisMetrics();
    }
}
```

### 6.3 æ—¥å¿—ç®¡ç†ä¸è¿½è¸ª
```java
// ç»“æ„åŒ–æ—¥å¿—é…ç½®
@Configuration
public class LoggingConfig {
    
    @Bean
    public Logger structuredLogger() {
        return LoggerFactory.getLogger("STRUCTURED");
    }
}

// ä¸šåŠ¡æ—¥å¿—è®°å½•
@Component
public class TrackingLogger {
    
    private final Logger structuredLogger;
    
    public void logTrackUpload(String userId, int count, long processingTime) {
        MDC.put("traceId", TraceContext.getTraceId());
        MDC.put("userId", userId);
        MDC.put("operation", "track_upload");
        
        structuredLogger.info("Track upload completed: count={}, processingTime={}ms", 
                             count, processingTime);
        
        MDC.clear();
    }
    
    public void logGeofenceAlert(GeofenceAlertEvent event) {
        MDC.put("traceId", TraceContext.getTraceId());
        MDC.put("alertId", event.getAlertId());
        MDC.put("userId", event.getUserId());
        MDC.put("fenceId", event.getFenceId());
        MDC.put("operation", "geofence_alert");
        
        structuredLogger.warn("Geofence alert triggered: type={}, level={}", 
                             event.getAlertType(), event.getAlertLevel());
        
        MDC.clear();
    }
}

// é“¾è·¯è¿½è¸ªé›†æˆ
@Component
public class TraceIdGenerator {
    
    @EventListener
    public void onRequestStart(RequestStartEvent event) {
        String traceId = generateTraceId();
        TraceContext.setTraceId(traceId);
        
        // ä¼ æ’­åˆ°WebSocket
        if (event.isWebSocketRequest()) {
            webSocketService.setTraceId(event.getSessionId(), traceId);
        }
    }
    
    private String generateTraceId() {
        return System.currentTimeMillis() + "-" + 
               ThreadLocalRandom.current().nextInt(10000, 99999);
    }
}
```

### 6.4 æ•°æ®å¯¼å‡ºä¸å·¥å•ç³»ç»Ÿ
```java
@RestController
@RequestMapping("/api/v1/export")
public class DataExportController {
    
    // è½¨è¿¹æ•°æ®å¯¼å‡º
    @PostMapping("/track")
    @PreAuthorize("hasPermission('TRACK_EXPORT')")
    public ResponseEntity<ExportTask> exportTrackData(@RequestBody TrackExportRequest request) {
        // åˆ›å»ºå¯¼å‡ºä»»åŠ¡
        ExportTask task = exportService.createTrackExportTask(request);
        return ResponseEntity.ok(task);
    }
    
    // å‘Šè­¦æ•°æ®å¯¼å‡º
    @PostMapping("/alert")
    @PreAuthorize("hasPermission('ALERT_VIEW')")
    public ResponseEntity<ExportTask> exportAlertData(@RequestBody AlertExportRequest request) {
        ExportTask task = exportService.createAlertExportTask(request);
        return ResponseEntity.ok(task);
    }
    
    // å¯¼å‡ºä»»åŠ¡çŠ¶æ€æŸ¥è¯¢
    @GetMapping("/task/{taskId}")
    public ResponseEntity<ExportTask> getExportTask(@PathVariable String taskId) {
        ExportTask task = exportService.getExportTask(taskId);
        return ResponseEntity.ok(task);
    }
}

@Service
public class ExportService {
    
    @Async("exportExecutor")
    public ExportTask createTrackExportTask(TrackExportRequest request) {
        ExportTask task = new ExportTask();
        task.setTaskId(UUID.randomUUID().toString());
        task.setTaskType(ExportType.TRACK);
        task.setStatus(ExportStatus.PROCESSING);
        task.setCreatedTime(LocalDateTime.now());
        
        try {
            // æŸ¥è¯¢æ•°æ®
            List<TrackPoint> tracks = trackService.queryTracks(request);
            
            // æ ¹æ®æ ¼å¼å¯¼å‡º
            String filePath = switch (request.getFormat()) {
                case CSV -> exportToCsv(tracks, task.getTaskId());
                case EXCEL -> exportToExcel(tracks, task.getTaskId());
                case GPX -> exportToGpx(tracks, task.getTaskId());
                case KML -> exportToKml(tracks, task.getTaskId());
                default -> throw new UnsupportedOperationException();
            };
            
            task.setFilePath(filePath);
            task.setStatus(ExportStatus.COMPLETED);
            
        } catch (Exception e) {
            task.setStatus(ExportStatus.FAILED);
            task.setErrorMessage(e.getMessage());
        }
        
        // æ›´æ–°ä»»åŠ¡çŠ¶æ€
        exportTaskRepository.save(task);
        return task;
    }
    
    private String exportToExcel(List<TrackPoint> tracks, String taskId) {
        String fileName = "track_export_" + taskId + ".xlsx";
        String filePath = "/exports/" + fileName;
        
        try (Workbook workbook = new XSSFWorkbook()) {
            Sheet sheet = workbook.createSheet("è½¨è¿¹æ•°æ®");
            
            // åˆ›å»ºè¡¨å¤´
            Row headerRow = sheet.createRow(0);
            headerRow.createCell(0).setCellValue("ç”¨æˆ·ID");
            headerRow.createCell(1).setCellValue("æ—¶é—´");
            headerRow.createCell(2).setCellValue("ç»åº¦");
            headerRow.createCell(3).setCellValue("çº¬åº¦");
            headerRow.createCell(4).setCellValue("é€Ÿåº¦");
            headerRow.createCell(5).setCellValue("æµ·æ‹”");
            headerRow.createCell(6).setCellValue("ç²¾åº¦");
            
            // å¡«å……æ•°æ®
            int rowNum = 1;
            for (TrackPoint track : tracks) {
                Row row = sheet.createRow(rowNum++);
                row.createCell(0).setCellValue(track.getUserId());
                row.createCell(1).setCellValue(track.getTimestamp().toString());
                row.createCell(2).setCellValue(track.getLongitude());
                row.createCell(3).setCellValue(track.getLatitude());
                row.createCell(4).setCellValue(track.getSpeed());
                row.createCell(5).setCellValue(track.getAltitude());
                row.createCell(6).setCellValue(track.getAccuracy());
            }
            
            // å†™å…¥æ–‡ä»¶
            try (FileOutputStream fos = new FileOutputStream(filePath)) {
                workbook.write(fos);
            }
            
        } catch (IOException e) {
            throw new RuntimeException("Excelå¯¼å‡ºå¤±è´¥", e);
        }
        
        return filePath;
    }
}
```

## 7. å¯ç”¨æ€§ä¸æ˜“ç”¨æ€§è®¾è®¡

### 7.1 é«˜å¯ç”¨æ¶æ„è®¾è®¡
```yaml
# æœåŠ¡éƒ¨ç½²é…ç½®
services:
  track-service:
    replicas: 3                        # 3ä¸ªå®ä¾‹
    resources:
      requests:
        memory: "512Mi"
        cpu: "500m"
      limits:
        memory: "1Gi" 
        cpu: "1000m"
    health-check:
      path: /actuator/health
      initial-delay: 30s
      period: 10s
      
  websocket-gateway:
    replicas: 2                        # 2ä¸ªWebSocketç½‘å…³
    sticky-session: true               # å¯ç”¨ä¼šè¯ä¿æŒ
    
  redis-cluster:
    nodes: 3                           # Redisé›†ç¾¤3èŠ‚ç‚¹
    replicas: 1                        # æ¯ä¸ªèŠ‚ç‚¹1ä¸ªå‰¯æœ¬
    
  mysql-master-slave:
    master: 1                          # 1ä¸ªä¸»åº“
    slave: 2                           # 2ä¸ªä»åº“
    sync-mode: async                   # å¼‚æ­¥åŒæ­¥
```

### 7.2 å®¹ç¾ä¸å¤‡ä»½ç­–ç•¥
```java
// æ•°æ®åº“æ•…éšœè½¬ç§»
@Configuration
public class DatabaseFailoverConfig {
    
    @Bean
    @Primary
    public DataSource primaryDataSource() {
        HikariDataSource dataSource = new HikariDataSource();
        dataSource.setJdbcUrl("jdbc:mysql://mysql-master:3306/track_db");
        dataSource.setConnectionTimeout(5000);
        dataSource.setValidationTimeout(3000);
        return dataSource;
    }
    
    @Bean
    public DataSource readOnlyDataSource() {
        HikariDataSource dataSource = new HikariDataSource();
        dataSource.setJdbcUrl("jdbc:mysql://mysql-slave:3306/track_db");
        dataSource.setReadOnly(true);
        return dataSource;
    }
}

// Redisæ•…éšœåˆ‡æ¢
@Configuration
public class RedisFailoverConfig {
    
    @Bean
    public LettuceConnectionFactory redisConnectionFactory() {
        RedisSentinelConfiguration sentinelConfig = 
            new RedisSentinelConfiguration()
                .master("track-redis-master")
                .sentinel("redis-sentinel-1", 26379)
                .sentinel("redis-sentinel-2", 26379)
                .sentinel("redis-sentinel-3", 26379);
                
        return new LettuceConnectionFactory(sentinelConfig);
    }
}
```

### 7.3 ç”¨æˆ·ä½“éªŒä¼˜åŒ–

#### æ™ºèƒ½æç¤ºä¸å¼•å¯¼
```typescript
// æ“ä½œå¼•å¯¼ç³»ç»Ÿ
export class UserGuideService {
  private guide: Driver;
  
  constructor() {
    this.guide = new Driver({
      showProgress: true,
      doneBtnText: 'å®Œæˆ',
      closeBtnText: 'å…³é—­',
      nextBtnText: 'ä¸‹ä¸€æ­¥',
      prevBtnText: 'ä¸Šä¸€æ­¥'
    });
  }
  
  // é¦–æ¬¡ä½¿ç”¨å¼•å¯¼
  startFirstTimeGuide() {
    const steps = [
      {
        element: '#map-container',
        popover: {
          title: 'å®æ—¶åœ°å›¾',
          description: 'è¿™é‡Œæ˜¾ç¤ºæ‰€æœ‰äººå‘˜çš„å®æ—¶ä½ç½®ï¼Œç‚¹å‡»äººå‘˜å¯æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯'
        }
      },
      {
        element: '#user-list',
        popover: {
          title: 'äººå‘˜åˆ—è¡¨', 
          description: 'å·¦ä¾§æ˜¾ç¤ºæ‰€æœ‰äººå‘˜çš„åœ¨çº¿çŠ¶æ€ï¼Œæ”¯æŒç­›é€‰å’Œæœç´¢'
        }
      },
      {
        element: '#alert-panel',
        popover: {
          title: 'å‘Šè­¦é¢æ¿',
          description: 'å³ä¸‹è§’æ˜¾ç¤ºå®æ—¶å‘Šè­¦ä¿¡æ¯ï¼Œç‚¹å‡»å¯æŸ¥çœ‹è¯¦æƒ…å’Œå¤„ç†'
        }
      }
    ];
    
    this.guide.defineSteps(steps);
    this.guide.start();
  }
  
  // åŠŸèƒ½æ“ä½œæç¤º
  showFeatureTip(feature: string) {
    const tips = {
      'create-geofence': 'åœ¨åœ°å›¾ä¸Šç‚¹å‡»å¹¶æ‹–æ‹½åˆ›å»ºå›´æ åŒºåŸŸ',
      'track-playback': 'æ‹–æ‹½æ—¶é—´è½´æ§åˆ¶æ’­æ”¾è¿›åº¦ï¼Œç‚¹å‡»å€é€ŸæŒ‰é’®è°ƒæ•´æ’­æ”¾é€Ÿåº¦',
      'alert-handle': 'é€‰æ‹©å¤„ç†æ–¹å¼å¹¶å¡«å†™å¤‡æ³¨ï¼Œç³»ç»Ÿä¼šè®°å½•å¤„ç†å†å²'
    };
    
    this.showToast(tips[feature], 'info');
  }
}
```

#### å¿«æ·æ“ä½œè®¾è®¡
```typescript
// é”®ç›˜å¿«æ·é”®
export class KeyboardShortcuts {
  constructor() {
    this.registerGlobalShortcuts();
  }
  
  private registerGlobalShortcuts() {
    // å…¨å±€å¿«æ·é”®
    hotkeys('ctrl+f', () => this.focusSearch());
    hotkeys('ctrl+n', () => this.createNewFence());
    hotkeys('esc', () => this.closeModals());
    hotkeys('f5', () => this.refreshData());
    
    // åœ°å›¾æ“ä½œå¿«æ·é”®
    hotkeys('ctrl+z', () => this.mapUndo());
    hotkeys('ctrl+y', () => this.mapRedo());
    hotkeys('del', () => this.deleteSelected());
    
    // å›æ”¾æ§åˆ¶å¿«æ·é”®
    hotkeys('space', () => this.togglePlayback());
    hotkeys('left', () => this.previousFrame());
    hotkeys('right', () => this.nextFrame());
  }
}

// å³é”®èœå•
export class ContextMenuService {
  showMapContextMenu(position: {x: number, y: number}, data: any) {
    const menuItems = [
      {
        label: 'åˆ›å»ºå›´æ ',
        icon: 'create-fence',
        action: () => this.createFenceAtPosition(data.latlng)
      },
      {
        label: 'æŸ¥çœ‹æ­¤å¤„äººå‘˜',
        icon: 'view-users', 
        action: () => this.showUsersAtLocation(data.latlng)
      },
      {
        label: 'æµ‹é‡è·ç¦»',
        icon: 'measure',
        action: () => this.startMeasuring(data.latlng)
      },
      { type: 'separator' },
      {
        label: 'å®šä½åˆ°æ­¤å¤„',
        icon: 'location',
        action: () => this.centerMapAt(data.latlng)
      }
    ];
    
    this.showContextMenu(position, menuItems);
  }
}
```

#### å“åº”å¼è®¾è®¡
```scss
// å“åº”å¼å¸ƒå±€
.track-monitoring-layout {
  display: grid;
  grid-template-areas: 
    "header header header"
    "sidebar map-area alert-panel"
    "footer footer footer";
  grid-template-columns: 300px 1fr 320px;
  grid-template-rows: 60px 1fr 40px;
  
  @media (max-width: 1200px) {
    grid-template-areas:
      "header header"
      "map-area map-area" 
      "sidebar alert-panel"
      "footer footer";
    grid-template-columns: 1fr 1fr;
    grid-template-rows: 60px 1fr 300px 40px;
  }
  
  @media (max-width: 768px) {
    grid-template-areas:
      "header"
      "map-area"
      "sidebar"
      "alert-panel" 
      "footer";
    grid-template-columns: 1fr;
    grid-template-rows: 60px 400px 200px 200px 40px;
  }
}

// ç§»åŠ¨ç«¯ä¼˜åŒ–
.mobile-optimized {
  .map-container {
    touch-action: pan-x pan-y zoom;
    
    .map-controls {
      position: fixed;
      bottom: 80px;
      right: 16px;
      z-index: 1000;
      
      .control-button {
        width: 48px;
        height: 48px;
        margin-bottom: 8px;
        font-size: 18px;
      }
    }
  }
  
  .user-list {
    max-height: 200px;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }
}
```

### 7.4 é”™è¯¯å¤„ç†ä¸ç”¨æˆ·åé¦ˆ
```typescript
// å…¨å±€é”™è¯¯å¤„ç†
export class ErrorHandler {
  private notificationService: NotificationService;
  
  handleApiError(error: AxiosError) {
    const { status, data } = error.response || {};
    
    switch (status) {
      case 400:
        this.showUserError(data.message || 'è¯·æ±‚å‚æ•°æœ‰è¯¯');
        break;
      case 401:
        this.handleAuthError();
        break;
      case 403:
        this.showUserError('æ‚¨æ²¡æœ‰æƒé™æ‰§è¡Œæ­¤æ“ä½œ');
        break;
      case 500:
        this.showSystemError('ç³»ç»Ÿæš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•');
        this.reportError(error);
        break;
      default:
        this.showSystemError('ç½‘ç»œè¿æ¥å¼‚å¸¸ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè®¾ç½®');
    }
  }
  
  private showUserError(message: string) {
    this.notificationService.warning(message, {
      duration: 5000,
      showClose: true
    });
  }
  
  private showSystemError(message: string) {
    this.notificationService.error(message, {
      duration: 0, // ä¸è‡ªåŠ¨å…³é—­
      showClose: true,
      showRetry: true,
      onRetry: () => location.reload()
    });
  }
}

// ç¦»çº¿çŠ¶æ€å¤„ç†
export class OfflineHandler {
  private isOnline = navigator.onLine;
  private pendingRequests: PendingRequest[] = [];
  
  constructor() {
    window.addEventListener('online', () => this.handleOnline());
    window.addEventListener('offline', () => this.handleOffline());
  }
  
  private handleOffline() {
    this.isOnline = false;
    this.showOfflineNotification();
    this.enableOfflineMode();
  }
  
  private handleOnline() {
    this.isOnline = true;
    this.hideOfflineNotification();
    this.syncPendingRequests();
    this.disableOfflineMode();
  }
  
  private enableOfflineMode() {
    // å¯ç”¨æœ¬åœ°æ•°æ®ç¼“å­˜
    localStorage.setItem('offline_mode', 'true');
    
    // æ˜¾ç¤ºç¦»çº¿æç¤º
    document.body.classList.add('offline-mode');
  }
}
```

---

## æ€»ç»“

æœ¬è§£å†³æ–¹æ¡ˆæä¾›äº†ä¸€ä¸ªå®Œæ•´çš„ä¼ä¸šçº§è¿åŠ¨è½¨è¿¹ä¸ç”µå­å›´æ ç³»ç»Ÿï¼Œå…·å¤‡ä»¥ä¸‹ç‰¹ç‚¹ï¼š

### æ ¸å¿ƒèƒ½åŠ›
- **å®æ—¶ç›‘æ§**ï¼š300ç”¨æˆ·å¹¶å‘ï¼Œ10ç§’çº§ä½ç½®æ›´æ–°
- **å†å²åˆ†æ**ï¼šè½¨è¿¹å›æ”¾ã€åœç•™åˆ†æã€è¡Œä¸ºæ¨¡å¼è¯†åˆ«  
- **æ™ºèƒ½å›´æ **ï¼šåœ†å½¢/çŸ©å½¢/å¤šè¾¹å½¢å›´æ ï¼Œè¿›å…¥/ç¦»å¼€/åœç•™å‘Šè­¦
- **å¤šæ¸ é“å‘Šè­¦**ï¼šå¾®ä¿¡/çŸ­ä¿¡/é‚®ä»¶é€šçŸ¥ï¼Œå‘Šè­¦å‡çº§å¤„ç†

### æŠ€æœ¯äº®ç‚¹
- **é«˜æ€§èƒ½**ï¼šåˆ†è¡¨å­˜å‚¨ã€ç©ºé—´ç´¢å¼•ã€Redisç¼“å­˜ã€å¼‚æ­¥å¤„ç†
- **é«˜å¯ç”¨**ï¼šä¸»ä»åˆ†ç¦»ã€é›†ç¾¤éƒ¨ç½²ã€æ•…éšœåˆ‡æ¢
- **é«˜å®‰å…¨**ï¼šå¤šç§Ÿæˆ·éš”ç¦»ã€RBACæƒé™ã€æ•°æ®åŠ å¯†ã€æ“ä½œå®¡è®¡
- **æ˜“æ‰©å±•**ï¼šå¾®æœåŠ¡æ¶æ„ã€é…ç½®ä¸­å¿ƒã€æ’ä»¶åŒ–è®¾è®¡

### ç”¨æˆ·ä½“éªŒ
- **ä¸“ä¸šUI**ï¼šæ·±æµ…ä¸»é¢˜ã€å“åº”å¼å¸ƒå±€ã€ç›´è§‚äº¤äº’
- **ä¾¿æ·æ“ä½œ**ï¼šå¿«æ·é”®æ”¯æŒã€å³é”®èœå•ã€æ‰¹é‡å¤„ç†
- **æ™ºèƒ½æç¤º**ï¼šæ“ä½œå¼•å¯¼ã€é”™è¯¯å¤„ç†ã€ç¦»çº¿æ”¯æŒ

è¯¥æ–¹æ¡ˆå¯ç›´æ¥ç”¨äºç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ï¼Œé¢„æœŸæ”¯æŒ1000ç”¨æˆ·è§„æ¨¡ï¼Œå…·å¤‡è‰¯å¥½çš„æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚