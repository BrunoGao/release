# å‘Šè­¦è§„åˆ™ç³»ç»Ÿå…¨æµç¨‹å¯è½åœ°å®æ–½æ–¹æ¡ˆ

## ğŸ“‹ æ–¹æ¡ˆæ¦‚è¿°

åŸºäºç°æœ‰ç³»ç»Ÿæ¶æ„å’Œä¼˜åŒ–æ–‡æ¡£ï¼Œæ•´åˆå‘Šè­¦è§„åˆ™ã€ç¼“å­˜åŒæ­¥ã€æ¶ˆæ¯å‘å¸ƒç­‰æ‰€æœ‰ä¼˜åŒ–ç­–ç•¥ï¼Œæä¾›ä¸€ä¸ªå®Œæ•´çš„ã€å¯ç›´æ¥è½åœ°çš„å®æ–½æ–¹æ¡ˆã€‚

### ğŸ¯ æ ¸å¿ƒç›®æ ‡
- **ç»Ÿä¸€è§„åˆ™ç®¡ç†**: æ”¯æŒå•ä½“å¾ã€å¤åˆã€å¤æ‚ä¸‰ç±»å‘Šè­¦è§„åˆ™
- **é«˜æ•ˆç¼“å­˜åŒæ­¥**: Redisä¸‰å±‚ç¼“å­˜æ¶æ„ï¼ŒTTLå»¶é•¿è‡³24å°æ—¶
- **æ¶ˆæ¯å‘å¸ƒä¼˜åŒ–**: ç»Ÿä¸€æ¶ˆæ¯æ¨¡å‹ï¼Œæ”¯æŒå¤šæ¸ é“åˆ†å‘
- **é«˜å¹¶å‘å¤„ç†**: å¼‚æ­¥é˜Ÿåˆ—+æ‰¹é‡å¤„ç†ï¼Œæ€§èƒ½æå‡80%ä»¥ä¸Š
- **ç®¡ç†ç•Œé¢å‹å¥½**: å¯è§†åŒ–è§„åˆ™é…ç½®å‘å¯¼

## ğŸ—ï¸ æ•´ä½“æ¶æ„è®¾è®¡

### ç³»ç»Ÿæ¶æ„å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ljwx-admin    â”‚    â”‚   ljwx-boot     â”‚    â”‚ ljwx-bigscreen  â”‚
â”‚ è§„åˆ™ç®¡ç†ç•Œé¢    â”‚ â†â†’ â”‚ è§„åˆ™å¼•æ“+ç¼“å­˜   â”‚ â†â†’ â”‚ å‘Šè­¦ç”Ÿæˆ+å¤„ç†   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â”‚                       â”‚                       â”‚
         â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Vue3é…ç½®ç•Œé¢    â”‚    â”‚ Redisç¼“å­˜åŒæ­¥   â”‚    â”‚ å¼‚æ­¥é˜Ÿåˆ—å¤„ç†    â”‚
â”‚ å¯è§†åŒ–è§„åˆ™å‘å¯¼  â”‚    â”‚ DB=1 â†pub/subâ†’ â”‚    â”‚ ä¸‰å±‚ç¼“å­˜ä¼˜åŒ–    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµå‘
```
å‘Šè­¦è§„åˆ™é…ç½® â†’ ljwx-admin â†’ ljwx-boot API â†’ MySQLæ•°æ®åº“
                                    â†“
                            Rediså‘å¸ƒè®¢é˜…é€šçŸ¥
                                    â†“
                    ljwx-bigscreenè®¢é˜…æ›´æ–° â†’ æœ¬åœ°ç¼“å­˜åˆ·æ–°
                                    â†“
                        å¥åº·æ•°æ®ä¸Šä¼  â†’ è§„åˆ™è¯„ä¼°å¼•æ“
                                    â†“
                        å¤åˆæ¡ä»¶è¯„ä¼° â†’ å‘Šè­¦ç”Ÿæˆ
                                    â†“
                        æ¶ˆæ¯åˆ†å‘ â†’ å¾®ä¿¡/çŸ­ä¿¡/å¤§å±æ¨é€
```

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### 1. å‘Šè­¦è§„åˆ™è¡¨ä¼˜åŒ– (t_alert_rules)

#### 1.1 å‘ä¸‹å…¼å®¹çš„è¡¨ç»“æ„å¢å¼º
```sql
-- ä¿æŒç°æœ‰å­—æ®µï¼Œæ–°å¢æ‰©å±•å­—æ®µ
ALTER TABLE `t_alert_rules` 
ADD COLUMN `rule_category` ENUM('SINGLE', 'COMPOSITE', 'COMPLEX') DEFAULT 'SINGLE' COMMENT 'è§„åˆ™ç±»å‹ï¼šå•ä½“å¾/å¤åˆ/å¤æ‚',
ADD COLUMN `condition_expression` JSON COMMENT 'å¤åˆæ¡ä»¶è¡¨è¾¾å¼',
ADD COLUMN `time_window_seconds` INT DEFAULT 300 COMMENT 'æ—¶é—´çª—å£(ç§’)',
ADD COLUMN `cooldown_seconds` INT DEFAULT 600 COMMENT 'å‘Šè­¦å†·å´æœŸ(ç§’)',
ADD COLUMN `priority_level` INT DEFAULT 3 COMMENT 'ä¼˜å…ˆçº§(1-5ï¼Œæ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜)',
ADD COLUMN `rule_tags` JSON COMMENT 'è§„åˆ™æ ‡ç­¾ï¼Œä¾¿äºåˆ†ç±»ç®¡ç†',
ADD COLUMN `effective_time_start` TIME COMMENT 'ç”Ÿæ•ˆå¼€å§‹æ—¶é—´',
ADD COLUMN `effective_time_end` TIME COMMENT 'ç”Ÿæ•ˆç»“æŸæ—¶é—´',
ADD COLUMN `effective_days` VARCHAR(20) DEFAULT '1,2,3,4,5,6,7' COMMENT 'ç”Ÿæ•ˆæ˜ŸæœŸ(1-7)',
ADD COLUMN `version` BIGINT DEFAULT 1 COMMENT 'è§„åˆ™ç‰ˆæœ¬å·',
ADD COLUMN `enabled_channels` JSON COMMENT 'å¯ç”¨çš„é€šçŸ¥æ¸ é“',
ADD INDEX idx_customer_category (`customer_id`, `rule_category`),
ADD INDEX idx_priority (`priority_level`),
ADD INDEX idx_physical_sign_active (`physical_sign`, `is_active`);
```

#### 1.2 è§„åˆ™æ¡ä»¶è¡¨è¾¾å¼è®¾è®¡
```json
-- å•ä½“å¾è§„åˆ™ (ç°æœ‰å…¼å®¹)
{
  "rule_type": "single",
  "physical_sign": "heart_rate",
  "threshold_min": 60,
  "threshold_max": 120,
  "trend_duration": 3
}

-- å¤åˆè§„åˆ™ (æ–°å¢)
{
  "rule_type": "composite",
  "conditions": [
    {
      "physical_sign": "heart_rate",
      "operator": ">",
      "threshold": 120,
      "duration_seconds": 180
    },
    {
      "physical_sign": "blood_oxygen", 
      "operator": "<",
      "threshold": 90,
      "duration_seconds": 60
    }
  ],
  "logical_operator": "AND",
  "evaluation_window": 300
}

-- å¤æ‚è§„åˆ™ (é«˜çº§)
{
  "rule_type": "complex",
  "expression": "((heart_rate > 120 AND blood_oxygen < 90) OR (temperature > 38.5)) AND time_of_day BETWEEN '09:00' AND '17:00'",
  "variables": {
    "heart_rate": "health_data.heart_rate",
    "blood_oxygen": "health_data.blood_oxygen",
    "temperature": "health_data.temperature",
    "time_of_day": "CURRENT_TIME"
  }
}
```

### 2. å‘Šè­¦è®°å½•è¡¨å¢å¼º (t_alert_info)
```sql
ALTER TABLE `t_alert_info`
ADD COLUMN `rule_version` BIGINT COMMENT 'è§„åˆ™ç‰ˆæœ¬',
ADD COLUMN `trigger_conditions` JSON COMMENT 'è§¦å‘æ¡ä»¶è¯¦æƒ…',
ADD COLUMN `evaluation_context` JSON COMMENT 'è¯„ä¼°ä¸Šä¸‹æ–‡',
ADD COLUMN `suppression_key` VARCHAR(128) COMMENT 'æŠ‘åˆ¶é”®',
ADD COLUMN `escalation_level` INT DEFAULT 0 COMMENT 'å‡çº§çº§åˆ«',
ADD COLUMN `ack_required` BOOLEAN DEFAULT FALSE COMMENT 'æ˜¯å¦éœ€è¦ç¡®è®¤',
ADD COLUMN `auto_resolve` BOOLEAN DEFAULT FALSE COMMENT 'æ˜¯å¦è‡ªåŠ¨æ¢å¤',
ADD INDEX idx_suppression (`suppression_key`),
ADD INDEX idx_escalation (`escalation_level`),
ADD INDEX idx_rule_version (`rule_id`, `rule_version`);
```

### 3. ç¼“å­˜åŒæ­¥è¡¨ (æ–°å¢)
```sql
CREATE TABLE `t_alert_cache_sync` (
  `id` BIGINT PRIMARY KEY AUTO_INCREMENT,
  `customer_id` BIGINT NOT NULL,
  `cache_key` VARCHAR(255) NOT NULL,
  `version` BIGINT NOT NULL DEFAULT 1,
  `last_sync_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
  `sync_status` ENUM('pending', 'synced', 'failed') DEFAULT 'pending',
  `error_message` TEXT,
  UNIQUE KEY uk_customer_cache (`customer_id`, `cache_key`),
  INDEX idx_sync_status (`sync_status`),
  INDEX idx_last_sync (`last_sync_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='å‘Šè­¦è§„åˆ™ç¼“å­˜åŒæ­¥çŠ¶æ€è¡¨';
```

## ğŸš€ åç«¯å®ç° (ljwx-boot)

### 1. è§„åˆ™å¼•æ“æ ¸å¿ƒç±»
```java
@Service
@Slf4j
public class AlertRuleEngineService {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    @Autowired
    private TAlertRulesMapper alertRulesMapper;
    
    /**
     * è§„åˆ™è¯„ä¼°ä¸»å…¥å£
     */
    public List<AlertResult> evaluateRules(HealthDataEvent healthData) {
        String customerId = healthData.getCustomerId();
        
        // 1. è·å–ç¼“å­˜çš„è§„åˆ™
        List<TAlertRules> rules = getCachedRules(customerId);
        
        // 2. è§„åˆ™é¢„ç¼–è¯‘å’Œåˆ†ç»„
        CompiledRuleSet compiledRules = compileRules(rules);
        
        // 3. å¹¶è¡Œè¯„ä¼°
        return evaluateRulesParallel(healthData, compiledRules);
    }
    
    /**
     * ä¸‰å±‚ç¼“å­˜è·å–è§„åˆ™
     */
    private List<TAlertRules> getCachedRules(String customerId) {
        String cacheKey = "alert_rules:" + customerId;
        
        // L1: JVMç¼“å­˜ (5åˆ†é’Ÿ)
        List<TAlertRules> rules = localCache.get(cacheKey);
        if (rules != null) {
            return rules;
        }
        
        // L2: Redisç¼“å­˜ (24å°æ—¶)
        rules = (List<TAlertRules>) redisTemplate.opsForValue().get(cacheKey);
        if (rules != null) {
            localCache.put(cacheKey, rules);
            return rules;
        }
        
        // L3: æ•°æ®åº“
        rules = alertRulesMapper.selectByCustomerId(Long.valueOf(customerId));
        
        // å›å¡«ç¼“å­˜
        redisTemplate.opsForValue().set(cacheKey, rules, Duration.ofHours(24));
        localCache.put(cacheKey, rules);
        
        return rules;
    }
    
    /**
     * è§„åˆ™é¢„ç¼–è¯‘
     */
    private CompiledRuleSet compileRules(List<TAlertRules> rules) {
        CompiledRuleSet compiledRules = new CompiledRuleSet();
        
        for (TAlertRules rule : rules) {
            if (!rule.getIsActive()) continue;
            
            switch (rule.getRuleCategory()) {
                case SINGLE:
                    compiledRules.addSingleRule(compileSingleRule(rule));
                    break;
                case COMPOSITE:
                    compiledRules.addCompositeRule(compileCompositeRule(rule));
                    break;
                case COMPLEX:
                    compiledRules.addComplexRule(compileComplexRule(rule));
                    break;
            }
        }
        
        return compiledRules;
    }
    
    /**
     * å¹¶è¡Œè§„åˆ™è¯„ä¼°
     */
    private List<AlertResult> evaluateRulesParallel(HealthDataEvent healthData, CompiledRuleSet compiledRules) {
        List<CompletableFuture<List<AlertResult>>> futures = new ArrayList<>();
        
        // å•ä½“å¾è§„åˆ™å¹¶è¡Œè¯„ä¼°
        futures.add(CompletableFuture.supplyAsync(() -> 
            evaluateSingleRules(healthData, compiledRules.getSingleRules())));
        
        // å¤åˆè§„åˆ™å¹¶è¡Œè¯„ä¼°
        futures.add(CompletableFuture.supplyAsync(() -> 
            evaluateCompositeRules(healthData, compiledRules.getCompositeRules())));
        
        // å¤æ‚è§„åˆ™å¹¶è¡Œè¯„ä¼°
        futures.add(CompletableFuture.supplyAsync(() -> 
            evaluateComplexRules(healthData, compiledRules.getComplexRules())));
        
        // åˆå¹¶ç»“æœ
        return futures.stream()
            .map(CompletableFuture::join)
            .flatMap(List::stream)
            .collect(Collectors.toList());
    }
}
```

### 2. ç¼“å­˜åŒæ­¥å¢å¼ºç‰ˆ
```java
@Component
@Slf4j
public class AlertRulesCacheManager {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    @Autowired
    private TAlertCacheSyncMapper cacheSyncMapper;
    
    /**
     * æ›´æ–°å‘Šè­¦è§„åˆ™ç¼“å­˜ - å¢å¼ºç‰ˆæœ¬
     */
    @Transactional
    public void updateAlertRulesCache(Long customerId) {
        String lockKey = "alert_rules_lock_" + customerId;
        
        // åˆ†å¸ƒå¼é”
        Boolean lockAcquired = redisTemplate.opsForValue()
            .setIfAbsent(lockKey, "locked", Duration.ofMinutes(5));
        
        if (!lockAcquired) {
            log.warn("è·å–åˆ†å¸ƒå¼é”å¤±è´¥: {}", lockKey);
            return;
        }
        
        try {
            // 1. æŸ¥è¯¢æœ€æ–°è§„åˆ™
            List<TAlertRules> rules = alertRulesMapper.selectByCustomerId(customerId);
            
            // 2. å¢åŠ ç‰ˆæœ¬å·
            Long version = redisTemplate.opsForValue().increment("alert_rules_version_" + customerId);
            
            // 3. æ„å»ºç¼“å­˜æ•°æ®
            CacheData cacheData = CacheData.builder()
                .version(version)
                .rules(rules)
                .updateTime(System.currentTimeMillis())
                .customerId(customerId)
                .build();
            
            // 4. æ›´æ–°Redisç¼“å­˜
            String cacheKey = "alert_rules_" + customerId;
            redisTemplate.opsForValue().set(cacheKey, cacheData, Duration.ofHours(24));
            
            // 5. å‘å¸ƒæ›´æ–°é€šçŸ¥
            String message = String.format("update:%s:%s", customerId, version);
            redisTemplate.convertAndSend("alert_rules_channel", message);
            
            // 6. è®°å½•åŒæ­¥çŠ¶æ€
            updateSyncStatus(customerId, cacheKey, version, "synced", null);
            
            log.info("å‘Šè­¦è§„åˆ™ç¼“å­˜æ›´æ–°æˆåŠŸ: customerId={}, version={}", customerId, version);
            
        } catch (Exception e) {
            log.error("å‘Šè­¦è§„åˆ™ç¼“å­˜æ›´æ–°å¤±è´¥: customerId={}", customerId, e);
            updateSyncStatus(customerId, "alert_rules_" + customerId, 0L, "failed", e.getMessage());
            throw e;
        } finally {
            redisTemplate.delete(lockKey);
        }
    }
    
    /**
     * æ‰¹é‡æ›´æ–°ç¼“å­˜ - æ€§èƒ½ä¼˜åŒ–
     */
    public void batchUpdateCache(List<Long> customerIds) {
        // åˆ†æ‰¹å¤„ç†ï¼Œé¿å…é˜»å¡
        int batchSize = 10;
        for (int i = 0; i < customerIds.size(); i += batchSize) {
            List<Long> batch = customerIds.subList(i, Math.min(i + batchSize, customerIds.size()));
            
            CompletableFuture.runAsync(() -> {
                batch.parallelStream().forEach(this::updateAlertRulesCache);
            });
        }
    }
    
    private void updateSyncStatus(Long customerId, String cacheKey, Long version, String status, String errorMessage) {
        TAlertCacheSync syncRecord = TAlertCacheSync.builder()
            .customerId(customerId)
            .cacheKey(cacheKey)
            .version(version)
            .lastSyncTime(LocalDateTime.now())
            .syncStatus(status)
            .errorMessage(errorMessage)
            .build();
        
        cacheSyncMapper.insertOrUpdate(syncRecord);
    }
}
```

### 3. ç»Ÿä¸€æ¶ˆæ¯å‘å¸ƒå™¨
```java
@Service
@Slf4j
public class UnifiedMessagePublisher {
    
    @Autowired
    private WeChatNotifier weChatNotifier;
    
    @Autowired
    private SmsNotifier smsNotifier;
    
    @Autowired
    private WebSocketNotifier webSocketNotifier;
    
    @Autowired
    private MessageQueueProducer messageProducer;
    
    /**
     * ç»Ÿä¸€æ¶ˆæ¯å‘å¸ƒå…¥å£
     */
    public void publishAlert(AlertMessage alertMessage) {
        // 1. æ¶ˆæ¯é¢„å¤„ç†
        UnifiedMessage unifiedMessage = buildUnifiedMessage(alertMessage);
        
        // 2. æ¸ é“è·¯ç”±
        List<NotificationChannel> channels = routeChannels(alertMessage);
        
        // 3. å¹¶è¡Œå‘é€
        List<CompletableFuture<NotificationResult>> futures = channels.stream()
            .map(channel -> CompletableFuture.supplyAsync(() -> 
                sendToChannel(unifiedMessage, channel)))
            .collect(Collectors.toList());
        
        // 4. ç»“æœæ±‡æ€»
        CompletableFuture.allOf(futures.toArray(new CompletableFuture[0]))
            .thenRun(() -> {
                List<NotificationResult> results = futures.stream()
                    .map(CompletableFuture::join)
                    .collect(Collectors.toList());
                
                logResults(alertMessage, results);
            });
    }
    
    /**
     * æ„å»ºç»Ÿä¸€æ¶ˆæ¯æ¨¡å‹
     */
    private UnifiedMessage buildUnifiedMessage(AlertMessage alertMessage) {
        return UnifiedMessage.builder()
            .messageId(generateMessageId())
            .messageType("alert")
            .subType(alertMessage.getAlertType())
            .title(buildTitle(alertMessage))
            .content(buildContent(alertMessage))
            .priority(mapPriority(alertMessage.getSeverityLevel()))
            .urgency(mapUrgency(alertMessage.getSeverityLevel()))
            .sender(buildSender())
            .target(buildTarget(alertMessage))
            .delivery(buildDelivery(alertMessage))
            .metadata(buildMetadata(alertMessage))
            .build();
    }
    
    /**
     * æ¸ é“æ™ºèƒ½è·¯ç”±
     */
    private List<NotificationChannel> routeChannels(AlertMessage alertMessage) {
        List<NotificationChannel> channels = new ArrayList<>();
        
        // åŸºäºä¸¥é‡ç¨‹åº¦å†³å®šæ¸ é“
        String severity = alertMessage.getSeverityLevel();
        List<String> enabledChannels = alertMessage.getEnabledChannels();
        
        if (enabledChannels.contains("wechat")) {
            channels.add(NotificationChannel.WECHAT);
        }
        
        if (enabledChannels.contains("message")) {
            channels.add(NotificationChannel.INTERNAL_MESSAGE);
        }
        
        // Criticalçº§åˆ«å¼ºåˆ¶WebSocketæ¨é€
        if ("critical".equals(severity)) {
            channels.add(NotificationChannel.WEBSOCKET);
        }
        
        // é«˜ä¼˜å…ˆçº§æ·»åŠ çŸ­ä¿¡é€šé“
        if (Arrays.asList("critical", "high").contains(severity) && 
            enabledChannels.contains("sms")) {
            channels.add(NotificationChannel.SMS);
        }
        
        return channels;
    }
    
    /**
     * å‘é€åˆ°æŒ‡å®šæ¸ é“
     */
    private NotificationResult sendToChannel(UnifiedMessage message, NotificationChannel channel) {
        try {
            switch (channel) {
                case WECHAT:
                    return weChatNotifier.send(message);
                case SMS:
                    return smsNotifier.send(message);
                case WEBSOCKET:
                    return webSocketNotifier.send(message);
                case INTERNAL_MESSAGE:
                    return insertInternalMessage(message);
                default:
                    return NotificationResult.failed("æœªçŸ¥æ¸ é“");
            }
        } catch (Exception e) {
            log.error("å‘é€æ¶ˆæ¯å¤±è´¥: channel={}, messageId={}", channel, message.getMessageId(), e);
            return NotificationResult.failed(e.getMessage());
        }
    }
}
```

## ğŸ”§ å‰ç«¯å®ç° (ljwx-bigscreenä¼˜åŒ–)

### 1. ç¼“å­˜è®¢é˜…ç®¡ç†å™¨å¢å¼º
```python
class AlertRulesCacheSubscriber:
    """å¢å¼ºç‰ˆRedisç¼“å­˜è®¢é˜…ç®¡ç†å™¨"""
    
    def __init__(self):
        self.redis_bigscreen = RedisHelper()  # DB=0
        self.redis_boot = redis.Redis(host='127.0.0.1', port=6379, password='123456', db=1)  # DB=1
        self.local_cache = {}
        self.cache_stats = {
            'hits': 0,
            'misses': 0,
            'updates': 0,
            'errors': 0
        }
        self.running = True
        
    def start_subscriber(self):
        """å¯åŠ¨ç¼“å­˜è®¢é˜…å™¨"""
        def subscriber_thread():
            pubsub = self.redis_bigscreen.pubsub()
            pubsub.subscribe('alert_rules_channel')
            
            logger.info("å‘Šè­¦è§„åˆ™ç¼“å­˜è®¢é˜…å™¨å·²å¯åŠ¨")
            
            for message in pubsub.listen():
                if not self.running:
                    break
                    
                if message['type'] == 'message':
                    self.handle_cache_update(message['data'])
                    
        Thread(target=subscriber_thread, daemon=True).start()
    
    def handle_cache_update(self, message):
        """å¤„ç†ç¼“å­˜æ›´æ–°æ¶ˆæ¯ - å¢å¼ºç‰ˆæœ¬"""
        try:
            # è§£ææ¶ˆæ¯: "update:customer_id:version"
            parts = message.decode('utf-8').split(':')
            if len(parts) >= 2 and parts[0] == 'update':
                customer_id = parts[1]
                version = int(parts[2]) if len(parts) > 2 else 0
                
                # æ£€æŸ¥æ˜¯å¦éœ€è¦æ›´æ–°
                if self.should_update_cache(customer_id, version):
                    success = self.refresh_local_cache(customer_id)
                    if success:
                        self.cache_stats['updates'] += 1
                        logger.info(f"ç¼“å­˜æ›´æ–°æˆåŠŸ: customer_id={customer_id}, version={version}")
                    else:
                        self.cache_stats['errors'] += 1
                        
        except Exception as e:
            self.cache_stats['errors'] += 1
            logger.error(f"å¤„ç†ç¼“å­˜æ›´æ–°å¤±è´¥: {e}")
    
    def get_alert_rules(self, customer_id):
        """ä¸‰å±‚ç¼“å­˜è·å–å‘Šè­¦è§„åˆ™ - æ€§èƒ½ä¼˜åŒ–"""
        cache_key = f"rules:{customer_id}"
        
        # L1: å†…å­˜ç¼“å­˜
        if cache_key in self.local_cache:
            cached_data = self.local_cache[cache_key]
            if time.time() - cached_data['timestamp'] < 300:  # 5åˆ†é’Ÿæœ‰æ•ˆ
                self.cache_stats['hits'] += 1
                return cached_data['rules']
        
        self.cache_stats['misses'] += 1
        
        # L2: ljwx-boot Redisç¼“å­˜
        try:
            boot_cache_key = f"alert_rules_{customer_id}"
            cached_data = self.redis_boot.get(boot_cache_key)
            
            if cached_data:
                data = json.loads(cached_data)
                rules = data.get('rules', [])
                
                # æ›´æ–°L1ç¼“å­˜
                self.local_cache[cache_key] = {
                    'rules': rules,
                    'timestamp': time.time(),
                    'version': data.get('version', 0)
                }
                
                return rules
                
        except Exception as e:
            logger.error(f"ä»ljwx-boot Redisè·å–è§„åˆ™å¤±è´¥: {e}")
        
        # L3: æ•°æ®åº“å…œåº•
        try:
            return self.get_rules_from_database(customer_id)
        except Exception as e:
            logger.error(f"æ•°æ®åº“å…œåº•æŸ¥è¯¢å¤±è´¥: {e}")
            return []
    
    def get_cache_stats(self):
        """è·å–ç¼“å­˜ç»Ÿè®¡ä¿¡æ¯"""
        total_requests = self.cache_stats['hits'] + self.cache_stats['misses']
        hit_rate = (self.cache_stats['hits'] / total_requests * 100) if total_requests > 0 else 0
        
        return {
            'hit_rate': round(hit_rate, 2),
            'total_hits': self.cache_stats['hits'],
            'total_misses': self.cache_stats['misses'],
            'cache_updates': self.cache_stats['updates'],
            'cache_errors': self.cache_stats['errors'],
            'local_cache_size': len(self.local_cache)
        }
```

### 2. é«˜æ€§èƒ½å‘Šè­¦ç”Ÿæˆå™¨
```python
class HighPerformanceAlertGenerator:
    """é«˜æ€§èƒ½å‘Šè­¦ç”Ÿæˆå™¨ - å¼‚æ­¥é˜Ÿåˆ—å¤„ç†"""
    
    def __init__(self):
        self.alert_queue = asyncio.Queue(maxsize=10000)
        self.batch_size = 100
        self.max_wait_time = 2.0
        self.workers = []
        self.rule_engine = AlertRuleEngine()
        self.cache_subscriber = AlertRulesCacheSubscriber()
        
        # æ€§èƒ½ç»Ÿè®¡
        self.performance_stats = {
            'total_processed': 0,
            'total_generated': 0,
            'avg_processing_time': 0.0,
            'queue_size': 0,
            'cache_hit_rate': 0.0
        }
    
    async def start_workers(self, worker_count=4):
        """å¯åŠ¨å¼‚æ­¥å·¥ä½œè€…"""
        for i in range(worker_count):
            worker = asyncio.create_task(self._worker_loop(f"worker-{i}"))
            self.workers.append(worker)
        
        # å¯åŠ¨ç¼“å­˜è®¢é˜…å™¨
        self.cache_subscriber.start_subscriber()
        
        logger.info(f"å‘Šè­¦ç”Ÿæˆå™¨å·²å¯åŠ¨ {worker_count} ä¸ªå·¥ä½œè€…")
    
    async def submit_health_data(self, health_data, health_data_id=None):
        """æäº¤å¥åº·æ•°æ®åˆ°å¤„ç†é˜Ÿåˆ—"""
        try:
            item = {
                'health_data': health_data,
                'health_data_id': health_data_id,
                'timestamp': time.time(),
                'device_sn': health_data.get('deviceSn', '')
            }
            
            await self.alert_queue.put(item)
            return True
            
        except asyncio.QueueFull:
            logger.warning("å‘Šè­¦å¤„ç†é˜Ÿåˆ—å·²æ»¡ï¼Œä¸¢å¼ƒè¯·æ±‚")
            return False
    
    async def _worker_loop(self, worker_name):
        """å·¥ä½œè€…ä¸»å¾ªç¯"""
        batch = []
        last_process_time = time.time()
        
        while True:
            try:
                # æ”¶é›†æ‰¹æ¬¡
                while len(batch) < self.batch_size and (time.time() - last_process_time) < self.max_wait_time:
                    try:
                        item = await asyncio.wait_for(self.alert_queue.get(), timeout=0.5)
                        batch.append(item)
                    except asyncio.TimeoutError:
                        break
                
                # å¤„ç†æ‰¹æ¬¡
                if batch:
                    await self._process_batch(batch, worker_name)
                    batch.clear()
                    last_process_time = time.time()
                    
            except Exception as e:
                logger.error(f"{worker_name} å¼‚å¸¸: {e}")
                batch.clear()
    
    async def _process_batch(self, health_data_batch, worker_name):
        """æ‰¹é‡å¤„ç†å¥åº·æ•°æ®"""
        start_time = time.time()
        processed_count = 0
        generated_alerts = 0
        
        try:
            # æŒ‰customer_idåˆ†ç»„æ‰¹æ¬¡
            customer_batches = defaultdict(list)
            for item in health_data_batch:
                customer_id = item['health_data'].get('customer_id') or item['health_data'].get('customerId')
                customer_batches[customer_id].append(item)
            
            # å¹¶è¡Œå¤„ç†æ¯ä¸ªå®¢æˆ·çš„æ•°æ®
            tasks = []
            for customer_id, customer_data in customer_batches.items():
                task = self._process_customer_batch(customer_id, customer_data)
                tasks.append(task)
            
            results = await asyncio.gather(*tasks, return_exceptions=True)
            
            # ç»Ÿè®¡ç»“æœ
            for result in results:
                if isinstance(result, dict):
                    processed_count += result.get('processed', 0)
                    generated_alerts += result.get('generated', 0)
            
        except Exception as e:
            logger.error(f"{worker_name} æ‰¹é‡å¤„ç†å¼‚å¸¸: {e}")
        
        # æ›´æ–°æ€§èƒ½ç»Ÿè®¡
        processing_time = time.time() - start_time
        self.performance_stats['total_processed'] += processed_count
        self.performance_stats['total_generated'] += generated_alerts
        self.performance_stats['avg_processing_time'] = (
            self.performance_stats['avg_processing_time'] * 0.9 + processing_time * 0.1
        )
        self.performance_stats['queue_size'] = self.alert_queue.qsize()
        
        logger.info(f"{worker_name} æ‰¹é‡å¤„ç†å®Œæˆ: å¤„ç†{processed_count}æ¡, ç”Ÿæˆå‘Šè­¦{generated_alerts}æ¡, è€—æ—¶{processing_time:.3f}s")
    
    async def _process_customer_batch(self, customer_id, health_data_list):
        """å¤„ç†å•ä¸ªå®¢æˆ·çš„å¥åº·æ•°æ®æ‰¹æ¬¡"""
        try:
            # 1. æ‰¹é‡è·å–è§„åˆ™ï¼ˆä¸€æ¬¡æŸ¥è¯¢ï¼‰
            rules = self.cache_subscriber.get_alert_rules(customer_id)
            if not rules:
                return {'processed': len(health_data_list), 'generated': 0}
            
            # 2. ç¼–è¯‘è§„åˆ™ï¼ˆä¸€æ¬¡ç¼–è¯‘ï¼‰
            compiled_rules = self.rule_engine.compile_rules(rules)
            
            # 3. æ‰¹é‡è¯„ä¼°
            generated_alerts = 0
            for item in health_data_list:
                alerts = await self.rule_engine.evaluate_rules_async(
                    item['health_data'], 
                    item['health_data_id'], 
                    compiled_rules
                )
                generated_alerts += len(alerts)
            
            return {'processed': len(health_data_list), 'generated': generated_alerts}
            
        except Exception as e:
            logger.error(f"å¤„ç†å®¢æˆ·æ‰¹æ¬¡å¤±è´¥: customer_id={customer_id}, error={e}")
            return {'processed': 0, 'generated': 0}
    
    def get_performance_stats(self):
        """è·å–æ€§èƒ½ç»Ÿè®¡"""
        cache_stats = self.cache_subscriber.get_cache_stats()
        self.performance_stats['cache_hit_rate'] = cache_stats['hit_rate']
        
        return {
            **self.performance_stats,
            'cache_stats': cache_stats
        }
```

### 3. å¤åˆè§„åˆ™å¼•æ“
```python
class AlertRuleEngine:
    """å‘Šè­¦è§„åˆ™å¼•æ“ - æ”¯æŒå¤åˆæ¡ä»¶"""
    
    def __init__(self):
        self.condition_cache = {}
        self.evaluation_history = defaultdict(list)
        
    def compile_rules(self, rules):
        """è§„åˆ™é¢„ç¼–è¯‘"""
        compiled_rules = {
            'single_rules': defaultdict(list),
            'composite_rules': [],
            'complex_rules': [],
            'priority_index': defaultdict(list)
        }
        
        for rule in rules:
            if not rule.get('is_active', True):
                continue
            
            rule_category = rule.get('rule_category', 'SINGLE')
            priority = rule.get('priority_level', 5)
            
            if rule_category == 'SINGLE':
                physical_sign = rule.get('physical_sign')
                if physical_sign:
                    compiled_rule = self._compile_single_rule(rule)
                    compiled_rules['single_rules'][physical_sign].append(compiled_rule)
                    compiled_rules['priority_index'][priority].append(compiled_rule)
                    
            elif rule_category == 'COMPOSITE':
                compiled_rule = self._compile_composite_rule(rule)
                if compiled_rule:
                    compiled_rules['composite_rules'].append(compiled_rule)
                    compiled_rules['priority_index'][priority].append(compiled_rule)
                    
            elif rule_category == 'COMPLEX':
                compiled_rule = self._compile_complex_rule(rule)
                if compiled_rule:
                    compiled_rules['complex_rules'].append(compiled_rule)
                    compiled_rules['priority_index'][priority].append(compiled_rule)
        
        return compiled_rules
    
    async def evaluate_rules_async(self, health_data, health_data_id, compiled_rules):
        """å¼‚æ­¥è§„åˆ™è¯„ä¼°"""
        triggered_alerts = []
        device_sn = health_data.get('deviceSn', '')
        
        try:
            # 1. æŒ‰ä¼˜å…ˆçº§è¯„ä¼°
            for priority in sorted(compiled_rules['priority_index'].keys()):
                priority_rules = compiled_rules['priority_index'][priority]
                
                for rule in priority_rules:
                    # æ£€æŸ¥ç”Ÿæ•ˆæ—¶é—´
                    if not self._is_rule_effective(rule):
                        continue
                    
                    # æ ¹æ®è§„åˆ™ç±»å‹è¯„ä¼°
                    alert = None
                    if rule['type'] == 'single':
                        alert = await self._evaluate_single_rule_async(rule, health_data, health_data_id)
                    elif rule['type'] == 'composite':
                        alert = await self._evaluate_composite_rule_async(rule, health_data, health_data_id)
                    elif rule['type'] == 'complex':
                        alert = await self._evaluate_complex_rule_async(rule, health_data, health_data_id)
                    
                    if alert:
                        # æ£€æŸ¥å‘Šè­¦æŠ‘åˆ¶
                        if not self._is_suppressed(alert, rule):
                            triggered_alerts.append(alert)
                            # è®¾ç½®å†·å´æœŸ
                            self._set_cooldown(alert, rule)
            
            # 2. æ‰¹é‡ä¿å­˜å‘Šè­¦
            if triggered_alerts:
                await self._save_alerts_batch(triggered_alerts)
            
        except Exception as e:
            logger.error(f"è§„åˆ™è¯„ä¼°å¼‚å¸¸: device_sn={device_sn}, error={e}")
        
        return triggered_alerts
    
    async def _evaluate_composite_rule_async(self, rule, health_data, health_data_id):
        """å¤åˆè§„åˆ™å¼‚æ­¥è¯„ä¼°"""
        try:
            condition_expr = rule.get('condition_expression', {})
            conditions = condition_expr.get('conditions', [])
            logical_op = condition_expr.get('logical_operator', 'AND')
            
            if not conditions:
                return None
            
            # å¹¶è¡Œè¯„ä¼°æ‰€æœ‰æ¡ä»¶
            condition_tasks = []
            for condition in conditions:
                task = self._evaluate_condition_async(condition, health_data)
                condition_tasks.append(task)
            
            condition_results = await asyncio.gather(*condition_tasks)
            
            # é€»è¾‘ç»„åˆ
            if logical_op == 'AND':
                final_result = all(condition_results)
            elif logical_op == 'OR':
                final_result = any(condition_results)
            else:
                final_result = False
            
            if final_result:
                return await self._create_alert_async(rule, health_data, health_data_id, {
                    'condition_results': condition_results,
                    'trigger_type': 'composite'
                })
            
        except Exception as e:
            logger.error(f"å¤åˆè§„åˆ™è¯„ä¼°å¤±è´¥: rule_id={rule.get('id')}, error={e}")
        
        return None
    
    async def _evaluate_condition_async(self, condition, health_data):
        """å¼‚æ­¥æ¡ä»¶è¯„ä¼°"""
        try:
            physical_sign = condition['physical_sign']
            operator = condition['operator']
            threshold = condition['threshold']
            duration = condition.get('duration_seconds', 0)
            
            value = health_data.get(physical_sign)
            if value is None:
                return False
            
            # åŸºç¡€æ¡ä»¶æ£€æŸ¥
            condition_met = self._check_condition(float(value), operator, threshold)
            
            # æŒç»­æ—¶é—´æ£€æŸ¥
            if condition_met and duration > 0:
                condition_met = await self._check_duration_async(
                    health_data, physical_sign, operator, threshold, duration
                )
            
            return condition_met
            
        except Exception as e:
            logger.error(f"æ¡ä»¶è¯„ä¼°å¤±è´¥: condition={condition}, error={e}")
            return False
    
    def _check_condition(self, value, operator, threshold):
        """æ£€æŸ¥å•ä¸ªæ¡ä»¶"""
        if operator == '>':
            return value > threshold
        elif operator == '<':
            return value < threshold
        elif operator == '>=':
            return value >= threshold
        elif operator == '<=':
            return value <= threshold
        elif operator == '==':
            return value == threshold
        else:
            return False
    
    async def _check_duration_async(self, health_data, physical_sign, operator, threshold, duration):
        """å¼‚æ­¥æ£€æŸ¥æŒç»­æ—¶é—´æ¡ä»¶"""
        device_sn = health_data.get('deviceSn', '')
        condition_key = f"{device_sn}:{physical_sign}:{operator}:{threshold}"
        
        # è·å–å†å²è¯„ä¼°è®°å½•
        history = self.evaluation_history[condition_key]
        current_time = time.time()
        
        # æ¸…ç†è¿‡æœŸè®°å½•
        history[:] = [t for t in history if current_time - t < duration]
        
        # æ·»åŠ å½“å‰æ—¶é—´
        history.append(current_time)
        
        # æ£€æŸ¥æ˜¯å¦æ»¡è¶³æŒç»­æ—¶é—´è¦æ±‚
        return len(history) >= 3  # è‡³å°‘3æ¬¡è¿ç»­æ»¡è¶³æ¡ä»¶
    
    async def _save_alerts_batch(self, alerts):
        """æ‰¹é‡ä¿å­˜å‘Šè­¦"""
        try:
            for alert in alerts:
                alert_info = AlertInfo(
                    rule_id=alert['rule_id'],
                    alert_type=alert['alert_type'],
                    device_sn=alert['device_sn'],
                    alert_desc=alert['alert_desc'],
                    severity_level=alert['severity_level'],
                    alert_status='pending',
                    alert_timestamp=get_now(),
                    health_id=alert.get('health_data_id'),
                    user_id=alert.get('user_id'),
                    org_id=alert.get('org_id'),
                    latitude=alert.get('latitude'),
                    longitude=alert.get('longitude'),
                    trigger_conditions=json.dumps(alert.get('trigger_conditions', {})),
                    evaluation_context=json.dumps(alert.get('evaluation_context', {}))
                )
                db.session.add(alert_info)
            
            db.session.commit()
            logger.info(f"æ‰¹é‡ä¿å­˜å‘Šè­¦æˆåŠŸ: {len(alerts)}æ¡")
            
        except Exception as e:
            db.session.rollback()
            logger.error(f"æ‰¹é‡ä¿å­˜å‘Šè­¦å¤±è´¥: {e}")
```

## ğŸ¨ å‰ç«¯ç®¡ç†ç•Œé¢ (ljwx-admin)

### 1. è§„åˆ™é…ç½®å‘å¯¼ç»„ä»¶
```vue
<template>
  <div class="alert-rule-wizard">
    <!-- æ­¥éª¤å¯¼èˆª -->
    <el-steps :active="currentStep" align-center>
      <el-step title="åŸºç¡€ä¿¡æ¯" />
      <el-step title="è§„åˆ™ç±»å‹" />
      <el-step title="æ¡ä»¶é…ç½®" />
      <el-step title="é€šçŸ¥è®¾ç½®" />
      <el-step title="ç”Ÿæ•ˆæ—¶é—´" />
      <el-step title="é¢„è§ˆç¡®è®¤" />
    </el-steps>
    
    <!-- åŸºç¡€ä¿¡æ¯æ­¥éª¤ -->
    <div v-show="currentStep === 0" class="step-content">
      <el-card header="åŸºç¡€ä¿¡æ¯">
        <el-form :model="ruleConfig" label-width="120px">
          <el-form-item label="è§„åˆ™åç§°" required>
            <el-input v-model="ruleConfig.ruleName" placeholder="è¯·è¾“å…¥è§„åˆ™åç§°" />
          </el-form-item>
          
          <el-form-item label="è§„åˆ™æè¿°">
            <el-input type="textarea" v-model="ruleConfig.ruleDescription" 
                     placeholder="è¯·æè¿°æ­¤è§„åˆ™çš„ç”¨é€”" />
          </el-form-item>
          
          <el-form-item label="ä¼˜å…ˆçº§">
            <el-select v-model="ruleConfig.priorityLevel">
              <el-option label="æœ€é«˜ (1)" :value="1" />
              <el-option label="é«˜ (2)" :value="2" />
              <el-option label="ä¸­ (3)" :value="3" />
              <el-option label="ä½ (4)" :value="4" />
              <el-option label="æœ€ä½ (5)" :value="5" />
            </el-select>
          </el-form-item>
          
          <el-form-item label="è§„åˆ™æ ‡ç­¾">
            <el-tag v-for="tag in ruleConfig.ruleTags" :key="tag" closable 
                    @close="removeTag(tag)">{{ tag }}</el-tag>
            <el-input v-model="newTag" @keyup.enter="addTag" 
                     placeholder="è¾“å…¥æ ‡ç­¾æŒ‰å›è½¦æ·»åŠ " style="width: 200px; margin-left: 10px;" />
          </el-form-item>
        </el-form>
      </el-card>
    </div>
    
    <!-- è§„åˆ™ç±»å‹é€‰æ‹© -->
    <div v-show="currentStep === 1" class="step-content">
      <el-card header="é€‰æ‹©è§„åˆ™ç±»å‹">
        <div class="rule-type-grid">
          <div class="rule-type-card" 
               :class="{ active: ruleConfig.ruleCategory === 'SINGLE' }"
               @click="selectRuleType('SINGLE')">
            <el-icon><Monitor /></el-icon>
            <h3>å•ä½“å¾è§„åˆ™</h3>
            <p>åŸºäºå•ä¸ªç”Ÿç†æŒ‡æ ‡çš„é˜ˆå€¼å‘Šè­¦</p>
            <div class="example">ä¾‹ï¼šå¿ƒç‡ > 120 è¿ç»­3æ¬¡</div>
          </div>
          
          <div class="rule-type-card" 
               :class="{ active: ruleConfig.ruleCategory === 'COMPOSITE' }"
               @click="selectRuleType('COMPOSITE')">
            <el-icon><Connection /></el-icon>
            <h3>å¤åˆè§„åˆ™</h3>
            <p>å¤šä¸ªç”Ÿç†æŒ‡æ ‡çš„ç»„åˆæ¡ä»¶</p>
            <div class="example">ä¾‹ï¼šå¿ƒç‡ > 120 ä¸” è¡€æ°§ < 90</div>
          </div>
          
          <div class="rule-type-card" 
               :class="{ active: ruleConfig.ruleCategory === 'COMPLEX' }"
               @click="selectRuleType('COMPLEX')">
            <el-icon><Setting /></el-icon>
            <h3>å¤æ‚è§„åˆ™</h3>
            <p>é«˜çº§é€»è¾‘è¡¨è¾¾å¼å’Œè‡ªå®šä¹‰å…¬å¼</p>
            <div class="example">ä¾‹ï¼šè‡ªå®šä¹‰ç®—æ³•åˆ¤æ–­</div>
          </div>
        </div>
      </el-card>
    </div>
    
    <!-- å•ä½“å¾æ¡ä»¶é…ç½® -->
    <div v-show="currentStep === 2 && ruleConfig.ruleCategory === 'SINGLE'" class="step-content">
      <el-card header="å•ä½“å¾æ¡ä»¶é…ç½®">
        <el-form :model="ruleConfig" label-width="120px">
          <el-form-item label="ç”Ÿç†æŒ‡æ ‡">
            <el-select v-model="ruleConfig.physicalSign" placeholder="é€‰æ‹©ç”Ÿç†æŒ‡æ ‡">
              <el-option v-for="sign in physicalSigns" :key="sign.value" 
                        :label="sign.label" :value="sign.value">
                <span style="float: left">{{ sign.label }}</span>
                <span style="float: right; color: #8492a6; font-size: 13px">{{ sign.unit }}</span>
              </el-option>
            </el-select>
          </el-form-item>
          
          <el-form-item label="æ­£å¸¸èŒƒå›´">
            <div class="threshold-range">
              <el-input-number v-model="ruleConfig.thresholdMin" placeholder="æœ€å°å€¼" />
              <span class="range-separator">è‡³</span>
              <el-input-number v-model="ruleConfig.thresholdMax" placeholder="æœ€å¤§å€¼" />
              <span class="unit">{{ getSelectedSignUnit() }}</span>
            </div>
          </el-form-item>
          
          <el-form-item label="è¿ç»­å¼‚å¸¸æ¬¡æ•°">
            <el-input-number v-model="ruleConfig.trendDuration" :min="1" />
            <span class="help-text">è¿ç»­è¶…å‡ºé˜ˆå€¼å¤šå°‘æ¬¡åè§¦å‘å‘Šè­¦</span>
          </el-form-item>
          
          <el-form-item label="æ—¶é—´çª—å£">
            <el-input-number v-model="ruleConfig.timeWindowSeconds" :min="60" />
            <span class="help-text">ç§’ï¼Œåœ¨æ­¤æ—¶é—´çª—å£å†…ç»Ÿè®¡å¼‚å¸¸æ¬¡æ•°</span>
          </el-form-item>
        </el-form>
      </el-card>
    </div>
    
    <!-- å¤åˆæ¡ä»¶é…ç½® -->
    <div v-show="currentStep === 2 && ruleConfig.ruleCategory === 'COMPOSITE'" class="step-content">
      <el-card header="å¤åˆæ¡ä»¶é…ç½®">
        <div class="composite-conditions">
          <div v-for="(condition, index) in compositeConditions" :key="index" 
               class="condition-item">
            <div class="condition-row">
              <el-select v-model="condition.physicalSign" placeholder="ç”Ÿç†æŒ‡æ ‡">
                <el-option v-for="sign in physicalSigns" :key="sign.value"
                          :label="sign.label" :value="sign.value" />
              </el-select>
              
              <el-select v-model="condition.operator" placeholder="è¿ç®—ç¬¦">
                <el-option label="å¤§äº >" value=">" />
                <el-option label="å°äº <" value="<" />
                <el-option label="ç­‰äº =" value="=" />
                <el-option label="å¤§äºç­‰äº >=" value=">=" />
                <el-option label="å°äºç­‰äº <=" value="<=" />
              </el-select>
              
              <el-input-number v-model="condition.threshold" placeholder="é˜ˆå€¼" />
              
              <el-input-number v-model="condition.durationSeconds" 
                              placeholder="æŒç»­æ—¶é—´(ç§’)" :min="0" />
              
              <el-button @click="removeCondition(index)" type="danger" 
                        icon="el-icon-delete" circle />
            </div>
            
            <!-- é€»è¾‘è¿æ¥ç¬¦ -->
            <div v-if="index < compositeConditions.length - 1" class="logic-connector">
              <el-radio-group v-model="logicalOperator">
                <el-radio-button label="AND">å¹¶ä¸”</el-radio-button>
                <el-radio-button label="OR">æˆ–è€…</el-radio-button>
              </el-radio-group>
            </div>
          </div>
          
          <el-button @click="addCondition" type="primary" icon="el-icon-plus">
            æ·»åŠ æ¡ä»¶
          </el-button>
        </div>
      </el-card>
    </div>
    
    <!-- é€šçŸ¥è®¾ç½® -->
    <div v-show="currentStep === 3" class="step-content">
      <el-card header="é€šçŸ¥è®¾ç½®">
        <el-form :model="ruleConfig" label-width="120px">
          <el-form-item label="ä¸¥é‡ç¨‹åº¦">
            <el-select v-model="ruleConfig.severityLevel">
              <el-option label="ä½ (Low)" value="low" />
              <el-option label="ä¸­ (Medium)" value="medium" />
              <el-option label="é«˜ (High)" value="high" />
              <el-option label="ç´§æ€¥ (Critical)" value="critical" />
            </el-select>
          </el-form-item>
          
          <el-form-item label="é€šçŸ¥æ¸ é“">
            <el-checkbox-group v-model="ruleConfig.enabledChannels">
              <el-checkbox label="wechat">å¾®ä¿¡é€šçŸ¥</el-checkbox>
              <el-checkbox label="message">å†…éƒ¨æ¶ˆæ¯</el-checkbox>
              <el-checkbox label="sms">çŸ­ä¿¡é€šçŸ¥</el-checkbox>
              <el-checkbox label="email">é‚®ä»¶é€šçŸ¥</el-checkbox>
            </el-checkbox-group>
          </el-form-item>
          
          <el-form-item label="å‘Šè­¦æ¶ˆæ¯æ¨¡æ¿">
            <el-input type="textarea" v-model="ruleConfig.alertMessage" 
                     placeholder="å¯ä½¿ç”¨å˜é‡: {user_name}, {device_sn}, {value}, {threshold}" />
          </el-form-item>
          
          <el-form-item label="å†·å´æœŸ">
            <el-input-number v-model="ruleConfig.cooldownSeconds" :min="0" />
            <span class="help-text">ç§’ï¼Œé¿å…é‡å¤å‘Šè­¦çš„å†·å´æ—¶é—´</span>
          </el-form-item>
        </el-form>
      </el-card>
    </div>
    
    <!-- ç”Ÿæ•ˆæ—¶é—´ -->
    <div v-show="currentStep === 4" class="step-content">
      <el-card header="ç”Ÿæ•ˆæ—¶é—´è®¾ç½®">
        <el-form :model="ruleConfig" label-width="120px">
          <el-form-item label="ç”Ÿæ•ˆæ—¶é—´æ®µ">
            <el-time-picker v-model="effectiveTimeRange" is-range 
                           range-separator="è‡³" format="HH:mm" />
          </el-form-item>
          
          <el-form-item label="ç”Ÿæ•ˆæ˜ŸæœŸ">
            <el-checkbox-group v-model="ruleConfig.effectiveDays">
              <el-checkbox label="1">å‘¨ä¸€</el-checkbox>
              <el-checkbox label="2">å‘¨äºŒ</el-checkbox>
              <el-checkbox label="3">å‘¨ä¸‰</el-checkbox>
              <el-checkbox label="4">å‘¨å››</el-checkbox>
              <el-checkbox label="5">å‘¨äº”</el-checkbox>
              <el-checkbox label="6">å‘¨å…­</el-checkbox>
              <el-checkbox label="7">å‘¨æ—¥</el-checkbox>
            </el-checkbox-group>
          </el-form-item>
          
          <el-form-item label="ç«‹å³ç”Ÿæ•ˆ">
            <el-switch v-model="ruleConfig.isActive" />
          </el-form-item>
        </el-form>
      </el-card>
    </div>
    
    <!-- é¢„è§ˆç¡®è®¤ -->
    <div v-show="currentStep === 5" class="step-content">
      <el-card header="è§„åˆ™é¢„è§ˆ">
        <div class="rule-preview">
          <div class="preview-section">
            <h4>åŸºç¡€ä¿¡æ¯</h4>
            <p><strong>è§„åˆ™åç§°ï¼š</strong>{{ ruleConfig.ruleName }}</p>
            <p><strong>è§„åˆ™ç±»å‹ï¼š</strong>{{ getRuleTypeText() }}</p>
            <p><strong>ä¼˜å…ˆçº§ï¼š</strong>{{ getPriorityText() }}</p>
          </div>
          
          <div class="preview-section">
            <h4>è§¦å‘æ¡ä»¶</h4>
            <div class="condition-preview">{{ generateConditionText() }}</div>
          </div>
          
          <div class="preview-section">
            <h4>é€šçŸ¥é…ç½®</h4>
            <p><strong>ä¸¥é‡ç¨‹åº¦ï¼š</strong>{{ ruleConfig.severityLevel }}</p>
            <p><strong>é€šçŸ¥æ¸ é“ï¼š</strong>{{ ruleConfig.enabledChannels.join(', ') }}</p>
            <p><strong>å‘Šè­¦æ¶ˆæ¯ï¼š</strong>{{ ruleConfig.alertMessage }}</p>
          </div>
          
          <div class="preview-section">
            <h4>ç”Ÿæ•ˆæ—¶é—´</h4>
            <p><strong>æ—¶é—´æ®µï¼š</strong>{{ formatEffectiveTime() }}</p>
            <p><strong>ç”Ÿæ•ˆæ—¥æœŸï¼š</strong>{{ formatEffectiveDays() }}</p>
          </div>
        </div>
      </el-card>
    </div>
    
    <!-- æ“ä½œæŒ‰é’® -->
    <div class="wizard-actions">
      <el-button @click="previousStep" :disabled="currentStep === 0">ä¸Šä¸€æ­¥</el-button>
      <el-button @click="nextStep" type="primary" 
                :disabled="!canNextStep" v-if="currentStep < 5">ä¸‹ä¸€æ­¥</el-button>
      <el-button @click="saveRule" type="success" 
                v-if="currentStep === 5" :loading="saving">ä¿å­˜è§„åˆ™</el-button>
    </div>
  </div>
</template>

<script setup>
import { ref, computed, reactive, onMounted } from 'vue'
import { ElMessage } from 'element-plus'
import { Monitor, Connection, Setting } from '@element-plus/icons-vue'

// å“åº”å¼æ•°æ®
const currentStep = ref(0)
const saving = ref(false)
const newTag = ref('')

// è§„åˆ™é…ç½®
const ruleConfig = reactive({
  ruleName: '',
  ruleDescription: '',
  ruleCategory: 'SINGLE',
  physicalSign: '',
  thresholdMin: null,
  thresholdMax: null,
  trendDuration: 1,
  timeWindowSeconds: 300,
  priorityLevel: 3,
  severityLevel: 'medium',
  alertMessage: '',
  enabledChannels: ['message'],
  cooldownSeconds: 600,
  effectiveTimeStart: null,
  effectiveTimeEnd: null,
  effectiveDays: ['1','2','3','4','5','6','7'],
  ruleTags: [],
  isActive: true
})

// å¤åˆæ¡ä»¶
const compositeConditions = ref([
  { physicalSign: '', operator: '>', threshold: 0, durationSeconds: 60 }
])
const logicalOperator = ref('AND')

// ç”Ÿç†æŒ‡æ ‡é€‰é¡¹
const physicalSigns = ref([
  { label: 'å¿ƒç‡', value: 'heart_rate', unit: 'bpm' },
  { label: 'è¡€æ°§', value: 'blood_oxygen', unit: '%' },
  { label: 'ä½“æ¸©', value: 'temperature', unit: 'â„ƒ' },
  { label: 'æ”¶ç¼©å‹', value: 'pressure_high', unit: 'mmHg' },
  { label: 'èˆ’å¼ å‹', value: 'pressure_low', unit: 'mmHg' },
  { label: 'æ­¥æ•°', value: 'step', unit: 'æ­¥' },
  { label: 'å¡è·¯é‡Œ', value: 'calorie', unit: 'kcal' },
  { label: 'è·ç¦»', value: 'distance', unit: 'km' },
  { label: 'å‹åŠ›æŒ‡æ•°', value: 'stress', unit: 'åˆ†' }
])

// è®¡ç®—å±æ€§
const canNextStep = computed(() => {
  switch (currentStep.value) {
    case 0: return ruleConfig.ruleName.trim() !== ''
    case 1: return ruleConfig.ruleCategory !== ''
    case 2: 
      if (ruleConfig.ruleCategory === 'SINGLE') {
        return ruleConfig.physicalSign !== ''
      } else if (ruleConfig.ruleCategory === 'COMPOSITE') {
        return compositeConditions.value.every(c => 
          c.physicalSign && c.operator && c.threshold !== null)
      }
      return true
    case 3: return ruleConfig.severityLevel && ruleConfig.enabledChannels.length > 0
    case 4: return true
    default: return true
  }
})

// æ–¹æ³•
const selectRuleType = (type) => {
  ruleConfig.ruleCategory = type
}

const addCondition = () => {
  compositeConditions.value.push({
    physicalSign: '',
    operator: '>',
    threshold: 0,
    durationSeconds: 60
  })
}

const removeCondition = (index) => {
  if (compositeConditions.value.length > 1) {
    compositeConditions.value.splice(index, 1)
  }
}

const addTag = () => {
  if (newTag.value && !ruleConfig.ruleTags.includes(newTag.value)) {
    ruleConfig.ruleTags.push(newTag.value)
    newTag.value = ''
  }
}

const removeTag = (tag) => {
  const index = ruleConfig.ruleTags.indexOf(tag)
  if (index > -1) {
    ruleConfig.ruleTags.splice(index, 1)
  }
}

const nextStep = () => {
  if (canNextStep.value && currentStep.value < 5) {
    currentStep.value++
  }
}

const previousStep = () => {
  if (currentStep.value > 0) {
    currentStep.value--
  }
}

const saveRule = async () => {
  saving.value = true
  try {
    // æ„å»ºä¿å­˜æ•°æ®
    const saveData = {
      ...ruleConfig,
      conditionExpression: ruleConfig.ruleCategory === 'COMPOSITE' ? {
        conditions: compositeConditions.value,
        logicalOperator: logicalOperator.value
      } : null
    }
    
    // è°ƒç”¨APIä¿å­˜
    await saveAlertRule(saveData)
    
    ElMessage.success('å‘Šè­¦è§„åˆ™ä¿å­˜æˆåŠŸ')
    // è¿”å›è§„åˆ™åˆ—è¡¨é¡µé¢
    
  } catch (error) {
    ElMessage.error('ä¿å­˜å¤±è´¥ï¼š' + error.message)
  } finally {
    saving.value = false
  }
}

// æ ¼å¼åŒ–æ–¹æ³•
const getRuleTypeText = () => {
  const types = {
    'SINGLE': 'å•ä½“å¾è§„åˆ™',
    'COMPOSITE': 'å¤åˆè§„åˆ™', 
    'COMPLEX': 'å¤æ‚è§„åˆ™'
  }
  return types[ruleConfig.ruleCategory] || ''
}

const getPriorityText = () => {
  const priorities = { 1: 'æœ€é«˜', 2: 'é«˜', 3: 'ä¸­', 4: 'ä½', 5: 'æœ€ä½' }
  return priorities[ruleConfig.priorityLevel] || ''
}

const generateConditionText = () => {
  if (ruleConfig.ruleCategory === 'SINGLE') {
    const sign = physicalSigns.value.find(s => s.value === ruleConfig.physicalSign)
    return `${sign?.label || ''} åœ¨ ${ruleConfig.thresholdMin} - ${ruleConfig.thresholdMax} èŒƒå›´å¤–è¿ç»­ ${ruleConfig.trendDuration} æ¬¡`
  } else if (ruleConfig.ruleCategory === 'COMPOSITE') {
    return compositeConditions.value.map(c => {
      const sign = physicalSigns.value.find(s => s.value === c.physicalSign)
      return `${sign?.label || ''} ${c.operator} ${c.threshold}`
    }).join(` ${logicalOperator.value} `)
  }
  return ''
}

const getSelectedSignUnit = () => {
  const sign = physicalSigns.value.find(s => s.value === ruleConfig.physicalSign)
  return sign?.unit || ''
}

const formatEffectiveTime = () => {
  // å®ç°æ—¶é—´æ ¼å¼åŒ–
  return 'å…¨å¤©'
}

const formatEffectiveDays = () => {
  const dayNames = ['å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­', 'å‘¨æ—¥']
  return ruleConfig.effectiveDays.map(d => dayNames[parseInt(d) - 1]).join(', ')
}

// APIè°ƒç”¨
const saveAlertRule = async (ruleData) => {
  // å®ç°APIè°ƒç”¨
  console.log('ä¿å­˜è§„åˆ™æ•°æ®:', ruleData)
}
</script>

<style scoped>
.alert-rule-wizard {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
}

.step-content {
  margin: 20px 0;
  min-height: 400px;
}

.rule-type-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 20px;
  margin: 20px 0;
}

.rule-type-card {
  border: 2px solid #e4e7ed;
  border-radius: 8px;
  padding: 30px;
  text-align: center;
  cursor: pointer;
  transition: all 0.3s;
}

.rule-type-card:hover {
  border-color: #409eff;
  box-shadow: 0 2px 12px rgba(64, 158, 255, 0.2);
}

.rule-type-card.active {
  border-color: #409eff;
  background-color: #f0f9ff;
}

.rule-type-card .el-icon {
  font-size: 48px;
  color: #409eff;
  margin-bottom: 15px;
}

.rule-type-card h3 {
  margin: 15px 0 10px;
  color: #303133;
}

.rule-type-card p {
  color: #606266;
  margin-bottom: 15px;
}

.example {
  background-color: #f5f7fa;
  padding: 8px;
  border-radius: 4px;
  font-size: 12px;
  color: #909399;
}

.threshold-range {
  display: flex;
  align-items: center;
  gap: 10px;
}

.range-separator {
  color: #606266;
}

.unit {
  color: #909399;
  font-size: 12px;
}

.help-text {
  color: #909399;
  font-size: 12px;
  margin-left: 10px;
}

.condition-item {
  border: 1px solid #e4e7ed;
  border-radius: 6px;
  padding: 15px;
  margin-bottom: 15px;
}

.condition-row {
  display: flex;
  gap: 15px;
  align-items: center;
}

.logic-connector {
  text-align: center;
  margin: 10px 0;
}

.rule-preview {
  background-color: #f8f9fa;
  border-radius: 6px;
  padding: 20px;
}

.preview-section {
  margin-bottom: 20px;
}

.preview-section h4 {
  color: #303133;
  margin-bottom: 10px;
  border-bottom: 1px solid #e4e7ed;
  padding-bottom: 5px;
}

.condition-preview {
  background-color: #fff;
  border: 1px solid #e4e7ed;
  border-radius: 4px;
  padding: 10px;
  font-family: 'Monaco', 'Menlo', monospace;
  color: #606266;
}

.wizard-actions {
  text-align: center;
  margin-top: 30px;
  padding-top: 20px;
  border-top: 1px solid #e4e7ed;
}

.wizard-actions .el-button {
  margin: 0 10px;
  min-width: 100px;
}
</style>
```

### 2. è§„åˆ™åˆ—è¡¨ç®¡ç†é¡µé¢
```vue
<template>
  <div class="alert-rules-management">
    <!-- é¡µé¢å¤´éƒ¨ -->
    <div class="page-header">
      <div class="header-left">
        <h2>å‘Šè­¦è§„åˆ™ç®¡ç†</h2>
        <p>ç®¡ç†å’Œé…ç½®ç³»ç»Ÿå‘Šè­¦è§„åˆ™ï¼Œæ”¯æŒå•ä½“å¾ã€å¤åˆå’Œå¤æ‚è§„åˆ™</p>
      </div>
      <div class="header-right">
        <el-button type="primary" @click="createRule">
          <el-icon><Plus /></el-icon>
          æ–°å»ºè§„åˆ™
        </el-button>
      </div>
    </div>
    
    <!-- æœç´¢å’Œè¿‡æ»¤ -->
    <el-card class="filter-card">
      <el-row :gutter="20">
        <el-col :span="6">
          <el-input v-model="searchForm.keyword" placeholder="æœç´¢è§„åˆ™åç§°" clearable>
            <template #prefix>
              <el-icon><Search /></el-icon>
            </template>
          </el-input>
        </el-col>
        <el-col :span="4">
          <el-select v-model="searchForm.ruleCategory" placeholder="è§„åˆ™ç±»å‹" clearable>
            <el-option label="å•ä½“å¾è§„åˆ™" value="SINGLE" />
            <el-option label="å¤åˆè§„åˆ™" value="COMPOSITE" />
            <el-option label="å¤æ‚è§„åˆ™" value="COMPLEX" />
          </el-select>
        </el-col>
        <el-col :span="4">
          <el-select v-model="searchForm.severityLevel" placeholder="ä¸¥é‡ç¨‹åº¦" clearable>
            <el-option label="ä½" value="low" />
            <el-option label="ä¸­" value="medium" />
            <el-option label="é«˜" value="high" />
            <el-option label="ç´§æ€¥" value="critical" />
          </el-select>
        </el-col>
        <el-col :span="4">
          <el-select v-model="searchForm.isActive" placeholder="çŠ¶æ€" clearable>
            <el-option label="å¯ç”¨" :value="true" />
            <el-option label="ç¦ç”¨" :value="false" />
          </el-select>
        </el-col>
        <el-col :span="6">
          <el-button type="primary" @click="searchRules">æŸ¥è¯¢</el-button>
          <el-button @click="resetSearch">é‡ç½®</el-button>
          <el-button type="success" @click="batchEnable" :disabled="!selectedRules.length">
            æ‰¹é‡å¯ç”¨
          </el-button>
          <el-button type="warning" @click="batchDisable" :disabled="!selectedRules.length">
            æ‰¹é‡ç¦ç”¨
          </el-button>
        </el-col>
      </el-row>
    </el-card>
    
    <!-- è§„åˆ™åˆ—è¡¨ -->
    <el-card class="table-card">
      <el-table :data="rulesList" v-loading="loading" 
                @selection-change="handleSelectionChange"
                @sort-change="handleSortChange">
        <el-table-column type="selection" width="50" />
        
        <el-table-column prop="ruleName" label="è§„åˆ™åç§°" min-width="200">
          <template #default="{ row }">
            <div class="rule-name-cell">
              <span class="rule-name">{{ row.ruleName }}</span>
              <div class="rule-tags">
                <el-tag v-for="tag in row.ruleTags" :key="tag" size="small">
                  {{ tag }}
                </el-tag>
              </div>
            </div>
          </template>
        </el-table-column>
        
        <el-table-column prop="ruleCategory" label="è§„åˆ™ç±»å‹" width="120">
          <template #default="{ row }">
            <el-tag :type="getRuleTypeTagType(row.ruleCategory)">
              {{ getRuleTypeText(row.ruleCategory) }}
            </el-tag>
          </template>
        </el-table-column>
        
        <el-table-column prop="physicalSign" label="ç›‘æµ‹æŒ‡æ ‡" width="120">
          <template #default="{ row }">
            <span v-if="row.ruleCategory === 'SINGLE'">
              {{ getPhysicalSignText(row.physicalSign) }}
            </span>
            <span v-else-if="row.ruleCategory === 'COMPOSITE'">
              {{ getCompositeSignsText(row.conditionExpression) }}
            </span>
            <span v-else>-</span>
          </template>
        </el-table-column>
        
        <el-table-column prop="severityLevel" label="ä¸¥é‡ç¨‹åº¦" width="100">
          <template #default="{ row }">
            <el-tag :type="getSeverityTagType(row.severityLevel)">
              {{ getSeverityText(row.severityLevel) }}
            </el-tag>
          </template>
        </el-table-column>
        
        <el-table-column prop="priorityLevel" label="ä¼˜å…ˆçº§" width="80" sortable>
          <template #default="{ row }">
            <el-rate v-model="row.priorityLevel" disabled show-score 
                    text-color="#ff9900" :max="5" />
          </template>
        </el-table-column>
        
        <el-table-column prop="enabledChannels" label="é€šçŸ¥æ¸ é“" width="150">
          <template #default="{ row }">
            <div class="channels">
              <el-icon v-if="row.enabledChannels.includes('wechat')" class="channel-icon wechat">
                <ChatDotRound />
              </el-icon>
              <el-icon v-if="row.enabledChannels.includes('message')" class="channel-icon message">
                <Message />
              </el-icon>
              <el-icon v-if="row.enabledChannels.includes('sms')" class="channel-icon sms">
                <Phone />
              </el-icon>
              <el-icon v-if="row.enabledChannels.includes('email')" class="channel-icon email">
                <Monitor />
              </el-icon>
            </div>
          </template>
        </el-table-column>
        
        <el-table-column prop="isActive" label="çŠ¶æ€" width="80">
          <template #default="{ row }">
            <el-switch v-model="row.isActive" @change="toggleRuleStatus(row)" />
          </template>
        </el-table-column>
        
        <el-table-column prop="updateTime" label="æ›´æ–°æ—¶é—´" width="160" sortable>
          <template #default="{ row }">
            {{ formatTime(row.updateTime) }}
          </template>
        </el-table-column>
        
        <el-table-column label="æ“ä½œ" width="200" fixed="right">
          <template #default="{ row }">
            <el-button size="small" @click="viewRule(row)">è¯¦æƒ…</el-button>
            <el-button size="small" type="primary" @click="editRule(row)">ç¼–è¾‘</el-button>
            <el-button size="small" @click="duplicateRule(row)">å¤åˆ¶</el-button>
            <el-popconfirm title="ç¡®å®šåˆ é™¤æ­¤è§„åˆ™å—ï¼Ÿ" @confirm="deleteRule(row.id)">
              <template #reference>
                <el-button size="small" type="danger">åˆ é™¤</el-button>
              </template>
            </el-popconfirm>
          </template>
        </el-table-column>
      </el-table>
      
      <!-- åˆ†é¡µ -->
      <div class="pagination-wrapper">
        <el-pagination v-model:current-page="pagination.current" 
                      v-model:page-size="pagination.pageSize"
                      :total="pagination.total"
                      :page-sizes="[10, 20, 50, 100]"
                      layout="total, sizes, prev, pager, next, jumper"
                      @size-change="handleSizeChange"
                      @current-change="handleCurrentChange" />
      </div>
    </el-card>
    
    <!-- è§„åˆ™è¯¦æƒ…å¯¹è¯æ¡† -->
    <el-dialog v-model="detailDialogVisible" title="è§„åˆ™è¯¦æƒ…" width="800px">
      <div v-if="selectedRule" class="rule-detail">
        <!-- è§„åˆ™è¯¦æƒ…å†…å®¹ -->
        <el-descriptions :column="2" border>
          <el-descriptions-item label="è§„åˆ™åç§°">{{ selectedRule.ruleName }}</el-descriptions-item>
          <el-descriptions-item label="è§„åˆ™ç±»å‹">{{ getRuleTypeText(selectedRule.ruleCategory) }}</el-descriptions-item>
          <el-descriptions-item label="ä¸¥é‡ç¨‹åº¦">{{ getSeverityText(selectedRule.severityLevel) }}</el-descriptions-item>
          <el-descriptions-item label="ä¼˜å…ˆçº§">{{ selectedRule.priorityLevel }}</el-descriptions-item>
          <el-descriptions-item label="çŠ¶æ€">
            <el-tag :type="selectedRule.isActive ? 'success' : 'danger'">
              {{ selectedRule.isActive ? 'å¯ç”¨' : 'ç¦ç”¨' }}
            </el-tag>
          </el-descriptions-item>
          <el-descriptions-item label="é€šçŸ¥æ¸ é“">{{ selectedRule.enabledChannels.join(', ') }}</el-descriptions-item>
          <el-descriptions-item label="åˆ›å»ºæ—¶é—´" :span="2">{{ formatTime(selectedRule.createTime) }}</el-descriptions-item>
        </el-descriptions>
        
        <!-- æ¡ä»¶è¯¦æƒ… -->
        <div class="condition-detail" v-if="selectedRule.ruleCategory === 'COMPOSITE'">
          <h4>å¤åˆæ¡ä»¶</h4>
          <div class="composite-condition">
            <!-- æ˜¾ç¤ºå¤åˆæ¡ä»¶è¯¦æƒ… -->
          </div>
        </div>
      </div>
    </el-dialog>
  </div>
</template>

<script setup>
import { ref, reactive, onMounted, computed } from 'vue'
import { ElMessage, ElMessageBox } from 'element-plus'
import { Plus, Search, ChatDotRound, Message, Phone, Monitor } from '@element-plus/icons-vue'

// å“åº”å¼æ•°æ®
const loading = ref(false)
const rulesList = ref([])
const selectedRules = ref([])
const detailDialogVisible = ref(false)
const selectedRule = ref(null)

// æœç´¢è¡¨å•
const searchForm = reactive({
  keyword: '',
  ruleCategory: '',
  severityLevel: '',
  isActive: null
})

// åˆ†é¡µ
const pagination = reactive({
  current: 1,
  pageSize: 20,
  total: 0
})

// æ’åº
const sortConfig = reactive({
  prop: '',
  order: ''
})

// ç”Ÿå‘½å‘¨æœŸ
onMounted(() => {
  loadRulesList()
})

// æ–¹æ³•
const loadRulesList = async () => {
  loading.value = true
  try {
    const params = {
      ...searchForm,
      page: pagination.current,
      pageSize: pagination.pageSize,
      sortProp: sortConfig.prop,
      sortOrder: sortConfig.order
    }
    
    const response = await fetchAlertRules(params)
    rulesList.value = response.data.list
    pagination.total = response.data.total
    
  } catch (error) {
    ElMessage.error('åŠ è½½è§„åˆ™åˆ—è¡¨å¤±è´¥ï¼š' + error.message)
  } finally {
    loading.value = false
  }
}

const createRule = () => {
  // è·³è½¬åˆ°è§„åˆ™åˆ›å»ºé¡µé¢
  router.push('/alert-rules/create')
}

const editRule = (rule) => {
  // è·³è½¬åˆ°è§„åˆ™ç¼–è¾‘é¡µé¢
  router.push(`/alert-rules/edit/${rule.id}`)
}

const viewRule = (rule) => {
  selectedRule.value = rule
  detailDialogVisible.value = true
}

const duplicateRule = async (rule) => {
  try {
    await ElMessageBox.confirm('ç¡®å®šå¤åˆ¶æ­¤è§„åˆ™å—ï¼Ÿ', 'ç¡®è®¤æ“ä½œ')
    
    const duplicatedRule = {
      ...rule,
      id: undefined,
      ruleName: rule.ruleName + ' (å‰¯æœ¬)',
      isActive: false
    }
    
    await saveAlertRule(duplicatedRule)
    ElMessage.success('è§„åˆ™å¤åˆ¶æˆåŠŸ')
    loadRulesList()
    
  } catch (error) {
    if (error !== 'cancel') {
      ElMessage.error('å¤åˆ¶å¤±è´¥ï¼š' + error.message)
    }
  }
}

const deleteRule = async (ruleId) => {
  try {
    await deleteAlertRule(ruleId)
    ElMessage.success('åˆ é™¤æˆåŠŸ')
    loadRulesList()
  } catch (error) {
    ElMessage.error('åˆ é™¤å¤±è´¥ï¼š' + error.message)
  }
}

const toggleRuleStatus = async (rule) => {
  try {
    await updateRuleStatus(rule.id, rule.isActive)
    ElMessage.success(rule.isActive ? 'è§„åˆ™å·²å¯ç”¨' : 'è§„åˆ™å·²ç¦ç”¨')
  } catch (error) {
    rule.isActive = !rule.isActive // å›æ»šçŠ¶æ€
    ElMessage.error('çŠ¶æ€æ›´æ–°å¤±è´¥ï¼š' + error.message)
  }
}

const batchEnable = async () => {
  try {
    const ruleIds = selectedRules.value.map(rule => rule.id)
    await batchUpdateRuleStatus(ruleIds, true)
    ElMessage.success('æ‰¹é‡å¯ç”¨æˆåŠŸ')
    loadRulesList()
  } catch (error) {
    ElMessage.error('æ‰¹é‡å¯ç”¨å¤±è´¥ï¼š' + error.message)
  }
}

const batchDisable = async () => {
  try {
    const ruleIds = selectedRules.value.map(rule => rule.id)
    await batchUpdateRuleStatus(ruleIds, false)
    ElMessage.success('æ‰¹é‡ç¦ç”¨æˆåŠŸ')
    loadRulesList()
  } catch (error) {
    ElMessage.error('æ‰¹é‡ç¦ç”¨å¤±è´¥ï¼š' + error.message)
  }
}

const searchRules = () => {
  pagination.current = 1
  loadRulesList()
}

const resetSearch = () => {
  Object.keys(searchForm).forEach(key => {
    searchForm[key] = key === 'isActive' ? null : ''
  })
  searchRules()
}

const handleSelectionChange = (selection) => {
  selectedRules.value = selection
}

const handleSortChange = ({ prop, order }) => {
  sortConfig.prop = prop
  sortConfig.order = order
  loadRulesList()
}

const handleSizeChange = (size) => {
  pagination.pageSize = size
  pagination.current = 1
  loadRulesList()
}

const handleCurrentChange = (page) => {
  pagination.current = page
  loadRulesList()
}

// æ ¼å¼åŒ–æ–¹æ³•
const getRuleTypeText = (category) => {
  const types = {
    'SINGLE': 'å•ä½“å¾',
    'COMPOSITE': 'å¤åˆ',
    'COMPLEX': 'å¤æ‚'
  }
  return types[category] || ''
}

const getRuleTypeTagType = (category) => {
  const types = {
    'SINGLE': '',
    'COMPOSITE': 'success',
    'COMPLEX': 'warning'
  }
  return types[category] || ''
}

const getSeverityText = (level) => {
  const levels = {
    'low': 'ä½',
    'medium': 'ä¸­',
    'high': 'é«˜',
    'critical': 'ç´§æ€¥'
  }
  return levels[level] || ''
}

const getSeverityTagType = (level) => {
  const types = {
    'low': 'info',
    'medium': '',
    'high': 'warning',
    'critical': 'danger'
  }
  return types[level] || ''
}

const getPhysicalSignText = (sign) => {
  const signs = {
    'heart_rate': 'å¿ƒç‡',
    'blood_oxygen': 'è¡€æ°§',
    'temperature': 'ä½“æ¸©',
    'pressure_high': 'æ”¶ç¼©å‹',
    'pressure_low': 'èˆ’å¼ å‹'
  }
  return signs[sign] || sign
}

const getCompositeSignsText = (expression) => {
  if (!expression || !expression.conditions) return '-'
  
  return expression.conditions.map(c => getPhysicalSignText(c.physicalSign)).join(', ')
}

const formatTime = (time) => {
  if (!time) return '-'
  return new Date(time).toLocaleString('zh-CN')
}

// API è°ƒç”¨æ–¹æ³•
const fetchAlertRules = async (params) => {
  // å®ç°APIè°ƒç”¨
  console.log('è·å–è§„åˆ™åˆ—è¡¨:', params)
  return { data: { list: [], total: 0 } }
}

const saveAlertRule = async (rule) => {
  // å®ç°APIè°ƒç”¨
  console.log('ä¿å­˜è§„åˆ™:', rule)
}

const deleteAlertRule = async (ruleId) => {
  // å®ç°APIè°ƒç”¨
  console.log('åˆ é™¤è§„åˆ™:', ruleId)
}

const updateRuleStatus = async (ruleId, isActive) => {
  // å®ç°APIè°ƒç”¨
  console.log('æ›´æ–°è§„åˆ™çŠ¶æ€:', ruleId, isActive)
}

const batchUpdateRuleStatus = async (ruleIds, isActive) => {
  // å®ç°APIè°ƒç”¨
  console.log('æ‰¹é‡æ›´æ–°è§„åˆ™çŠ¶æ€:', ruleIds, isActive)
}
</script>

<style scoped>
.alert-rules-management {
  padding: 20px;
}

.page-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.header-left h2 {
  margin: 0 0 5px 0;
  color: #303133;
}

.header-left p {
  margin: 0;
  color: #606266;
  font-size: 14px;
}

.filter-card {
  margin-bottom: 20px;
}

.table-card {
  margin-bottom: 20px;
}

.rule-name-cell {
  .rule-name {
    font-weight: 500;
    color: #303133;
  }
  
  .rule-tags {
    margin-top: 5px;
    
    .el-tag {
      margin-right: 5px;
    }
  }
}

.channels {
  display: flex;
  gap: 8px;
  
  .channel-icon {
    font-size: 16px;
    
    &.wechat { color: #1aad19; }
    &.message { color: #409eff; }
    &.sms { color: #e6a23c; }
    &.email { color: #909399; }
  }
}

.pagination-wrapper {
  margin-top: 20px;
  text-align: center;
}

.rule-detail {
  .condition-detail {
    margin-top: 20px;
    
    h4 {
      margin-bottom: 10px;
      color: #303133;
    }
  }
}
</style>
```

## ğŸ“Š æ€§èƒ½ç›‘æ§ä¸ç»Ÿè®¡

### 1. æ€§èƒ½ç›‘æ§æ¥å£
```python
@app.route('/api/alert_rules/performance_stats', methods=['GET'])
def get_alert_rules_performance_stats():
    """è·å–å‘Šè­¦è§„åˆ™ç³»ç»Ÿæ€§èƒ½ç»Ÿè®¡"""
    try:
        # è·å–é«˜æ€§èƒ½ç”Ÿæˆå™¨ç»Ÿè®¡
        generator_stats = high_performance_generator.get_performance_stats()
        
        # è·å–ç¼“å­˜ç»Ÿè®¡
        cache_subscriber = get_alert_rules_cache_subscriber()
        cache_stats = cache_subscriber.get_cache_stats()
        
        # è·å–æ•°æ®åº“ç»Ÿè®¡
        db_stats = get_database_performance_stats()
        
        # è·å–å‘Šè­¦ç»Ÿè®¡
        alert_stats = get_alert_generation_stats()
        
        return jsonify({
            'success': True,
            'data': {
                'performance': {
                    'generator': generator_stats,
                    'cache': cache_stats,
                    'database': db_stats,
                    'alerts': alert_stats
                },
                'timestamp': time.time()
            }
        })
        
    except Exception as e:
        logger.error(f"è·å–æ€§èƒ½ç»Ÿè®¡å¤±è´¥: {e}")
        return jsonify({
            'success': False,
            'error': str(e)
        }), 500

def get_database_performance_stats():
    """è·å–æ•°æ®åº“æ€§èƒ½ç»Ÿè®¡"""
    return {
        'connection_pool_size': db.engine.pool.size(),
        'connection_pool_checked_out': db.engine.pool.checkedout(),
        'query_count': getattr(db.engine, '_query_count', 0),
        'avg_query_time': getattr(db.engine, '_avg_query_time', 0)
    }

def get_alert_generation_stats():
    """è·å–å‘Šè­¦ç”Ÿæˆç»Ÿè®¡"""
    today = datetime.now().date()
    
    # ä»Šæ—¥å‘Šè­¦ç»Ÿè®¡
    today_alerts = db.session.query(AlertInfo).filter(
        func.date(AlertInfo.alert_timestamp) == today
    ).count()
    
    # æŒ‰ä¸¥é‡ç¨‹åº¦ç»Ÿè®¡
    severity_stats = db.session.query(
        AlertInfo.severity_level,
        func.count(AlertInfo.id)
    ).filter(
        func.date(AlertInfo.alert_timestamp) == today
    ).group_by(AlertInfo.severity_level).all()
    
    # æŒ‰è§„åˆ™ç±»å‹ç»Ÿè®¡
    rule_type_stats = db.session.query(
        AlertRules.rule_type,
        func.count(AlertInfo.id)
    ).join(
        AlertInfo, AlertRules.id == AlertInfo.rule_id
    ).filter(
        func.date(AlertInfo.alert_timestamp) == today
    ).group_by(AlertRules.rule_type).all()
    
    return {
        'today_total': today_alerts,
        'severity_distribution': dict(severity_stats),
        'rule_type_distribution': dict(rule_type_stats)
    }
```

### 2. ç›‘æ§ä»ªè¡¨æ¿é¡µé¢
```vue
<template>
  <div class="performance-dashboard">
    <el-row :gutter="20">
      <!-- æ•´ä½“æ€§èƒ½å¡ç‰‡ -->
      <el-col :span="6" v-for="metric in overallMetrics" :key="metric.key">
        <el-card class="metric-card">
          <div class="metric-content">
            <div class="metric-icon" :style="{ color: metric.color }">
              <component :is="metric.icon" />
            </div>
            <div class="metric-info">
              <div class="metric-value">{{ metric.value }}</div>
              <div class="metric-label">{{ metric.label }}</div>
              <div class="metric-trend" :class="metric.trendClass">
                {{ metric.trend }}
              </div>
            </div>
          </div>
        </el-card>
      </el-col>
    </el-row>
    
    <el-row :gutter="20" style="margin-top: 20px;">
      <!-- ç¼“å­˜æ€§èƒ½å›¾è¡¨ -->
      <el-col :span="12">
        <el-card title="ç¼“å­˜æ€§èƒ½">
          <div ref="cacheChartRef" style="height: 300px;"></div>
        </el-card>
      </el-col>
      
      <!-- å‘Šè­¦ç”Ÿæˆè¶‹åŠ¿ -->
      <el-col :span="12">
        <el-card title="å‘Šè­¦ç”Ÿæˆè¶‹åŠ¿">
          <div ref="alertTrendChartRef" style="height: 300px;"></div>
        </el-card>
      </el-col>
    </el-row>
    
    <el-row :gutter="20" style="margin-top: 20px;">
      <!-- è§„åˆ™æ‰§è¡Œæ€§èƒ½ -->
      <el-col :span="24">
        <el-card title="è§„åˆ™æ‰§è¡Œæ€§èƒ½">
          <el-table :data="rulePerformanceData" max-height="400">
            <el-table-column prop="ruleName" label="è§„åˆ™åç§°" />
            <el-table-column prop="ruleType" label="è§„åˆ™ç±»å‹" />
            <el-table-column prop="avgExecutionTime" label="å¹³å‡æ‰§è¡Œæ—¶é—´(ms)" />
            <el-table-column prop="totalExecutions" label="æ‰§è¡Œæ¬¡æ•°" />
            <el-table-column prop="successRate" label="æˆåŠŸç‡" />
            <el-table-column prop="lastExecution" label="æœ€åæ‰§è¡Œæ—¶é—´" />
          </el-table>
        </el-card>
      </el-col>
    </el-row>
  </div>
</template>

<script setup>
import { ref, onMounted, onUnmounted } from 'vue'
import * as echarts from 'echarts'
import { TrendChartUp, Timer, CheckCircle, Warning } from '@element-plus/icons-vue'

// å“åº”å¼æ•°æ®
const cacheChartRef = ref(null)
const alertTrendChartRef = ref(null)
const rulePerformanceData = ref([])

// æ€§èƒ½æŒ‡æ ‡
const overallMetrics = ref([
  {
    key: 'processing_speed',
    label: 'å¤„ç†é€Ÿåº¦',
    value: '1,250/s',
    trend: '+15%',
    trendClass: 'trend-up',
    color: '#67c23a',
    icon: TrendChartUp
  },
  {
    key: 'avg_response_time',
    label: 'å¹³å‡å“åº”æ—¶é—´',
    value: '45ms',
    trend: '-8%',
    trendClass: 'trend-down',
    color: '#409eff',
    icon: Timer
  },
  {
    key: 'success_rate',
    label: 'æˆåŠŸç‡',
    value: '99.8%',
    trend: '+0.2%',
    trendClass: 'trend-up',
    color: '#67c23a',
    icon: CheckCircle
  },
  {
    key: 'cache_hit_rate',
    label: 'ç¼“å­˜å‘½ä¸­ç‡',
    value: '94.2%',
    trend: '+12%',
    trendClass: 'trend-up',
    color: '#e6a23c',
    icon: Warning
  }
])

let cacheChart = null
let alertTrendChart = null
let refreshTimer = null

// ç”Ÿå‘½å‘¨æœŸ
onMounted(() => {
  initCharts()
  loadPerformanceData()
  
  // å®šæ—¶åˆ·æ–°
  refreshTimer = setInterval(loadPerformanceData, 30000) // 30ç§’åˆ·æ–°
})

onUnmounted(() => {
  if (cacheChart) cacheChart.dispose()
  if (alertTrendChart) alertTrendChart.dispose()
  if (refreshTimer) clearInterval(refreshTimer)
})

// æ–¹æ³•
const initCharts = () => {
  // åˆå§‹åŒ–ç¼“å­˜æ€§èƒ½å›¾è¡¨
  cacheChart = echarts.init(cacheChartRef.value)
  
  const cacheOption = {
    title: { text: 'ç¼“å­˜å‘½ä¸­ç‡', left: 'center' },
    tooltip: { trigger: 'axis' },
    xAxis: { type: 'category', data: [] },
    yAxis: { type: 'value', max: 100 },
    series: [
      {
        name: 'L1ç¼“å­˜',
        type: 'line',
        data: [],
        smooth: true,
        itemStyle: { color: '#409eff' }
      },
      {
        name: 'L2ç¼“å­˜',
        type: 'line',
        data: [],
        smooth: true,
        itemStyle: { color: '#67c23a' }
      },
      {
        name: 'L3æ•°æ®åº“',
        type: 'line',
        data: [],
        smooth: true,
        itemStyle: { color: '#e6a23c' }
      }
    ]
  }
  
  cacheChart.setOption(cacheOption)
  
  // åˆå§‹åŒ–å‘Šè­¦è¶‹åŠ¿å›¾è¡¨
  alertTrendChart = echarts.init(alertTrendChartRef.value)
  
  const alertOption = {
    title: { text: 'å‘Šè­¦ç”Ÿæˆè¶‹åŠ¿', left: 'center' },
    tooltip: { trigger: 'axis' },
    xAxis: { type: 'category', data: [] },
    yAxis: { type: 'value' },
    series: [
      {
        name: 'æ€»å‘Šè­¦æ•°',
        type: 'bar',
        data: [],
        itemStyle: { color: '#409eff' }
      },
      {
        name: 'ç´§æ€¥å‘Šè­¦',
        type: 'line',
        data: [],
        itemStyle: { color: '#f56c6c' }
      }
    ]
  }
  
  alertTrendChart.setOption(alertOption)
}

const loadPerformanceData = async () => {
  try {
    // è·å–æ€§èƒ½ç»Ÿè®¡æ•°æ®
    const response = await fetch('/api/alert_rules/performance_stats')
    const data = await response.json()
    
    if (data.success) {
      updateMetrics(data.data.performance)
      updateCharts(data.data.performance)
      updateRulePerformanceTable(data.data.performance)
    }
  } catch (error) {
    console.error('åŠ è½½æ€§èƒ½æ•°æ®å¤±è´¥:', error)
  }
}

const updateMetrics = (performanceData) => {
  // æ›´æ–°æ•´ä½“æ€§èƒ½æŒ‡æ ‡
  const generator = performanceData.generator
  const cache = performanceData.cache
  
  overallMetrics.value[0].value = `${Math.round(generator.total_processed / generator.avg_processing_time)}/s`
  overallMetrics.value[1].value = `${Math.round(generator.avg_processing_time * 1000)}ms`
  overallMetrics.value[2].value = `${(generator.total_processed / (generator.total_processed + generator.total_failed) * 100).toFixed(1)}%`
  overallMetrics.value[3].value = `${cache.hit_rate}%`
}

const updateCharts = (performanceData) => {
  // æ›´æ–°å›¾è¡¨æ•°æ®ï¼ˆç¤ºä¾‹æ•°æ®ï¼‰
  const timeLabels = generateTimeLabels()
  
  // æ›´æ–°ç¼“å­˜å›¾è¡¨
  cacheChart.setOption({
    xAxis: { data: timeLabels },
    series: [
      { data: generateRandomData(24, 85, 95) },
      { data: generateRandomData(24, 75, 85) },
      { data: generateRandomData(24, 60, 75) }
    ]
  })
  
  // æ›´æ–°å‘Šè­¦è¶‹åŠ¿å›¾è¡¨
  alertTrendChart.setOption({
    xAxis: { data: timeLabels },
    series: [
      { data: generateRandomData(24, 50, 200) },
      { data: generateRandomData(24, 0, 20) }
    ]
  })
}

const updateRulePerformanceTable = (performanceData) => {
  // æ›´æ–°è§„åˆ™æ€§èƒ½è¡¨æ ¼ï¼ˆç¤ºä¾‹æ•°æ®ï¼‰
  rulePerformanceData.value = [
    {
      ruleName: 'å¿ƒç‡å¼‚å¸¸è§„åˆ™',
      ruleType: 'å•ä½“å¾',
      avgExecutionTime: 12,
      totalExecutions: 1250,
      successRate: '99.8%',
      lastExecution: '2025-09-10 14:30:25'
    },
    {
      ruleName: 'ç»¼åˆå¥åº·è¯„ä¼°',
      ruleType: 'å¤åˆ',
      avgExecutionTime: 28,
      totalExecutions: 680,
      successRate: '99.5%',
      lastExecution: '2025-09-10 14:30:18'
    }
  ]
}

// å·¥å…·å‡½æ•°
const generateTimeLabels = () => {
  const labels = []
  for (let i = 23; i >= 0; i--) {
    const time = new Date()
    time.setHours(time.getHours() - i)
    labels.push(time.getHours() + ':00')
  }
  return labels
}

const generateRandomData = (count, min, max) => {
  return Array.from({ length: count }, () => 
    Math.floor(Math.random() * (max - min + 1)) + min
  )
}
</script>

<style scoped>
.performance-dashboard {
  padding: 20px;
}

.metric-card {
  height: 120px;
}

.metric-content {
  display: flex;
  align-items: center;
  height: 100%;
}

.metric-icon {
  font-size: 36px;
  margin-right: 15px;
}

.metric-info {
  flex: 1;
}

.metric-value {
  font-size: 24px;
  font-weight: bold;
  color: #303133;
  margin-bottom: 5px;
}

.metric-label {
  font-size: 14px;
  color: #606266;
  margin-bottom: 5px;
}

.metric-trend {
  font-size: 12px;
  font-weight: 500;
}

.trend-up {
  color: #67c23a;
}

.trend-down {
  color: #409eff;
}
</style>
```

## ğŸ“‹ å®æ–½è®¡åˆ’ä¸éƒ¨ç½²

### é˜¶æ®µä¸€ï¼šåŸºç¡€è®¾æ–½å‡†å¤‡ (1å‘¨)
1. **æ•°æ®åº“è¡¨ç»“æ„å‡çº§**
   - æ‰§è¡Œè¡¨ç»“æ„å˜æ›´SQL
   - æ•°æ®è¿ç§»å’ŒéªŒè¯
   - ç´¢å¼•ä¼˜åŒ–

2. **Redisé…ç½®ä¼˜åŒ–**
   - TTLè°ƒæ•´ä¸º24å°æ—¶
   - å‘å¸ƒè®¢é˜…é€šé“é…ç½®
   - è¿æ¥æ± ä¼˜åŒ–

3. **åŸºç¡€è®¾æ–½ç›‘æ§**
   - æ€§èƒ½åŸºçº¿å»ºç«‹
   - ç›‘æ§æŒ‡æ ‡é…ç½®

### é˜¶æ®µäºŒï¼šåç«¯æ ¸å¿ƒå®ç° (2å‘¨)
1. **è§„åˆ™å¼•æ“å¼€å‘**
   - å•ä½“å¾è§„åˆ™å…¼å®¹
   - å¤åˆè§„åˆ™å¼•æ“
   - è§„åˆ™é¢„ç¼–è¯‘ä¼˜åŒ–

2. **ç¼“å­˜åŒæ­¥ä¼˜åŒ–**
   - ä¸‰å±‚ç¼“å­˜æ¶æ„
   - è·¨DBè®¢é˜…æœºåˆ¶
   - å®¹é”™å’Œæ¢å¤

3. **æ¶ˆæ¯å‘å¸ƒç»Ÿä¸€**
   - ç»Ÿä¸€æ¶ˆæ¯æ¨¡å‹
   - å¤šæ¸ é“è·¯ç”±
   - å¼‚æ­¥å¤„ç†é˜Ÿåˆ—

### é˜¶æ®µä¸‰ï¼šå‰ç«¯ç•Œé¢å¼€å‘ (2å‘¨)
1. **è§„åˆ™é…ç½®å‘å¯¼**
   - æ­¥éª¤å¼é…ç½®ç•Œé¢
   - å®æ—¶é¢„è§ˆåŠŸèƒ½
   - æ¡ä»¶å¯è§†åŒ–ç¼–è¾‘

2. **è§„åˆ™ç®¡ç†é¡µé¢**
   - åˆ—è¡¨å±•ç¤ºå’Œç­›é€‰
   - æ‰¹é‡æ“ä½œåŠŸèƒ½
   - æ€§èƒ½ç›‘æ§é¢æ¿

3. **æ€§èƒ½ç›‘æ§ä»ªè¡¨æ¿**
   - å®æ—¶æ€§èƒ½å›¾è¡¨
   - å‘Šè­¦ç»Ÿè®¡åˆ†æ
   - ç³»ç»Ÿå¥åº·çŠ¶æ€

### é˜¶æ®µå››ï¼šæ€§èƒ½ä¼˜åŒ–å’Œæµ‹è¯• (1å‘¨)
1. **æ€§èƒ½å‹åŠ›æµ‹è¯•**
   - 1000å¹¶å‘å¤„ç†éªŒè¯
   - å“åº”æ—¶é—´ä¼˜åŒ–
   - å†…å­˜ä½¿ç”¨ä¼˜åŒ–

2. **åŠŸèƒ½é›†æˆæµ‹è¯•**
   - ç«¯åˆ°ç«¯æµç¨‹æµ‹è¯•
   - å¼‚å¸¸åœºæ™¯éªŒè¯
   - å…¼å®¹æ€§æµ‹è¯•

### é˜¶æ®µäº”ï¼šç”Ÿäº§éƒ¨ç½² (1å‘¨)
1. **ç°åº¦å‘å¸ƒ**
   - å°æµé‡éªŒè¯
   - æ€§èƒ½ç›‘æ§
   - é—®é¢˜å¿«é€Ÿå“åº”

2. **å…¨é‡å‘å¸ƒ**
   - é…ç½®è¿ç§»
   - æ•°æ®åŒæ­¥
   - æ€§èƒ½è°ƒä¼˜

## ğŸ¯ é¢„æœŸæ•ˆæœ

### æ€§èƒ½æå‡æŒ‡æ ‡
- **è§„åˆ™è¯„ä¼°é€Ÿåº¦**: æå‡80%ä»¥ä¸Š
- **å¹¶å‘å¤„ç†èƒ½åŠ›**: æ”¯æŒ1000+å¹¶å‘
- **å†…å­˜ä½¿ç”¨**: å‡å°‘40%
- **å“åº”æ—¶é—´**: å¹³å‡50msä»¥ä¸‹

### åŠŸèƒ½å¢å¼ºæ•ˆæœ
- **è§„åˆ™è¡¨è¾¾èƒ½åŠ›**: æ”¯æŒå¤æ‚çš„å¤šä½“å¾å…³è”
- **ç®¡ç†æ•ˆç‡**: å¯è§†åŒ–é…ç½®ï¼Œé™ä½80%é…ç½®æ—¶é—´
- **ç³»ç»Ÿç¨³å®šæ€§**: å‘Šè­¦æŠ‘åˆ¶ï¼Œå‡å°‘90%é‡å¤å‘Šè­¦
- **è¿ç»´ä¾¿åˆ©æ€§**: å®Œæ•´ç›‘æ§ä½“ç³»ï¼Œé—®é¢˜å¿«é€Ÿå®šä½

### ä¸šåŠ¡ä»·å€¼
- **å‘Šè­¦å‡†ç¡®æ€§**: å‡å°‘è¯¯æŠ¥85%ä»¥ä¸Š
- **å“åº”é€Ÿåº¦**: å‘Šè­¦å»¶è¿Ÿé™è‡³ç§’çº§
- **è¿ç»´æˆæœ¬**: å‡å°‘äººå·¥å¹²é¢„60%
- **ç”¨æˆ·ä½“éªŒ**: æ›´ç²¾å‡†çš„å¥åº·ç›‘æŠ¤æœåŠ¡

è¿™ä¸ªå®Œæ•´çš„å®æ–½æ–¹æ¡ˆæ•´åˆäº†æ‰€æœ‰ä¼˜åŒ–ç­–ç•¥ï¼Œæä¾›äº†ä»æ•°æ®åº“è®¾è®¡ã€åç«¯å®ç°ã€å‰ç«¯ç•Œé¢åˆ°éƒ¨ç½²ç›‘æ§çš„å…¨æµç¨‹è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥ç›´æ¥æŒ‰ç…§è®¡åˆ’é€æ­¥å®æ–½è½åœ°ã€‚