# 灵境万象健康管理系统 (LJWX) - 完整功能模块清单

## 文档概述

本文档基于对LJWX系统各模块的深度代码分析，提供了系统的完整功能清单和技术架构说明。LJWX是一套企业级健康监测解决方案，专为工业环境下的可穿戴设备健康数据监控而设计。

---

## 📋 系统架构总览

### 技术栈概览
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   ljwx-watch    │    │   ljwx-phone    │    │   ljwx-admin    │    │ ljwx-bigscreen  │
│  HarmonyOS手表   │ ←→ │  Flutter移动端   │ ←→ │   Vue3管理后台   │ ←→ │  Python大屏监控  │
│                 │    │                 │    │                 │    │                 │
│  • 健康数据采集  │    │  • 设备连接管理  │    │  • 系统管理界面  │    │  • 实时数据展示  │
│  • 实时监测传感器│    │  • 数据同步处理  │    │  • 权限控制管理  │    │  • 告警处理引擎  │
│  • 告警事件处理  │    │  • 用户交互界面  │    │  • 数据可视化    │    │  • WebSocket推送 │
│  • 低功耗优化   │    │  • 认证与授权    │    │  • 配置管理      │    │  • 地图可视化   │
└─────────────────┘    └─────────────────┘    └─────────────────┘    └─────────────────┘
          │                       │                       │                       │
          └───────────────────────┼───────────────────────┼───────────────────────┘
                                  │                       │
                          ┌─────────────────┐    ┌─────────────────┐
                          │   ljwx-boot     │    │   数据存储层     │
                          │  Spring Boot    │◄──▶│ MySQL + Redis   │
                          │  后端API服务     │    │                 │
                          │                 │    │ • 多租户隔离    │
                          │ • RESTful API   │    │ • 分片优化      │
                          │ • 权限控制      │    │ • 缓存加速      │
                          │ • 数据处理      │    │ • 数据备份      │
                          │ • 业务逻辑      │    │                 │
                          └─────────────────┘    └─────────────────┘
```

---

## 1️⃣ ljwx-boot 后端核心服务

### 🏗️ 技术架构
- **框架**: Spring Boot 3.3.2 + Java 21
- **数据库**: MySQL 8.0 + MyBatis-Plus ORM
- **缓存**: Redis 7.2.3
- **安全**: SA-Token 认证框架
- **文档**: Knife4j (Swagger)
- **监控**: Spring Actuator + Prometheus

### 🏥 健康管理模块 (`/modules/health/`)

#### 核心实体与功能
- **TUserHealthData**: 主要健康指标存储
  - 生命体征: 心率、血压、血氧、体温
  - 运动数据: 步数、距离、卡路里、压力指数
  - 位置信息: GPS坐标（经纬度、海拔）
  - 时间戳与设备关联

- **TUserHealthDataDaily/Weekly**: 聚合健康数据
  - 日/周运动汇总
  - 睡眠质量分析
  - 科学睡眠数据处理

- **TDeviceInfo**: IoT设备管理
  - 设备规格 (IMEI、序列号、型号)
  - 网络配置 (WiFi、蓝牙、IP)
  - 电池状态与充电信息
  - 设备与用户/组织关联

- **TAlertRules/TAlertInfo**: 健康告警系统
  - 阈值监控 (最小/最大值)
  - 趋势分析与偏差检测
  - 严重级别与通知类型

#### 关键特性
- **实时健康监控**: 持续采集生命体征
- **健康数据分析**: 睡眠模式、运动指标处理
- **告警系统**: 自动化健康阈值监控
- **设备管理**: IoT设备注册与状态跟踪
- **数据分片**: 大数据集性能优化
- **管理员过滤**: 自动排除管理员设备

### 👥 系统管理模块 (`/modules/system/`)

#### 用户与权限管理
- **SysUser**: 用户账户与设备关联
- **SysRole**: 基于角色的访问控制
- **SysOrgUnits**: 分层组织架构
- **SysMenu**: 动态菜单与权限系统
- **SysPermission**: 细粒度权限管理

#### 核心功能
- **多租户架构**: 基于组织的数据隔离
- **角色访问控制**: 分层权限系统
- **设备用户绑定**: 自动设备关联
- **员工与管理员分离**: 不同用户类别过滤
- **用户生命周期管理**: 注册、更新、删除与设备解绑

### 🏢 客户配置模块 (`/modules/customer/`)
- **TCustomerConfig**: 租户特定配置
- **THealthDataConfig**: 可定制健康数据显示列
- **TInterface**: 外部集成API接口管理

### 📊 监控模块 (`/modules/monitor/`)
- **调度管理**: Quartz任务配置与监控
- **日志管理**: 操作、登录、错误和调度日志
- **系统监控**: 缓存、文件系统和性能指标
- **文件上传管理**: MinIO集成

### 🗺️ 地理围栏模块 (`/modules/geofence/`)
- **TGeofence**: 虚拟边界定义
- **位置跟踪**: GPS坐标监控
- **基于区域告警**: 进入/退出通知

---

## 2️⃣ ljwx-admin 前端管理平台

### 🏗️ 技术架构
- **框架**: Vue 3.5.13 + TypeScript + Composition API
- **UI库**: Naive UI 2.40.3
- **构建工具**: Vite 6.0.3
- **状态管理**: Pinia 2.3.0
- **路由**: Vue Router 4.5.0 + elegant-router
- **图表**: ECharts 5.5.1

### 🏥 健康数据管理模块

#### 健康信息管理 (`/views/health/info/`)
- **实时健康指标**: 心率、血压、血氧、体温监控
- **睡眠与压力**: 睡眠质量、压力水平、卡路里消耗
- **运动追踪**: 距离追踪、步数统计
- **可配置显示**: 通过健康数据配置自定义数据类型
- **Excel导出**: XLSX集成导出功能
- **部门数据过滤**: 基于部门的数据筛选

#### 数据可视化 (`/views/health/chart/`)
- **多指标ECharts集成**: 折线图、仪表盘、饼图
- **时间序列分析**: 日、周、月、年数据分析
- **个人指标组件**: 体温、血氧、心率、血压专项组件
- **交互式探索**: 带搜索过滤的健康数据探索

#### 健康分析与AI (`/views/health/analysis/`)
- **高级健康分析仪表板**
- **AI驱动健康洞察** (`/health/ai`)
- **健康基线管理**: 评分系统
- **雷达图可视化**: 用户健康档案

### 🔧 设备管理模块

#### 设备信息管理 (`/views/device/info/`)
- **IoT设备状态监控**: 基于60秒阈值的活跃/非活跃状态
- **电池状态指示器**: 可视化图标显示
- **设备型号识别**: 从系统软件版本识别
- **可穿戴状态跟踪**: 佩戴/未佩戴状态
- **序列号与系统版本管理**

#### 设备配置 (`/device/config`)
- **设备参数配置**
- **操作设置管理**
- **设备特定定制**

#### 设备消息 (`/views/device/message/`)
- **设备通信日志**
- **消息状态跟踪**
- **实时设备消息监控**

#### 设备用户映射 (`/device/user`)
- **用户设备关系管理**
- **设备分配与重新分配**
- **用户设备历史跟踪**

### 🚨 告警与通知系统

#### 告警信息管理 (`/views/alert/info/`)
- **实时告警监控与管理**
- **告警类型分类**: 字典支持
- **告警状态跟踪**: 活跃、已解决、已确认
- **部门和用户告警过滤**
- **饼图可视化告警分布**

#### 告警规则配置 (`/alert/rules`)
- **可配置告警阈值与条件**
- **基于规则的告警触发**
- **自定义告警标准设置**

#### 微信集成 (`/alert/config/wechat`)
- **微信通知配置**
- **多渠道告警投递**
- **企业消息集成**

### 👥 用户与组织管理

#### 用户管理 (`/views/manage/user/`)
- **分层组织树结构**
- **基于部门的用户组织**
- **用户角色与权限管理**
- **设备分配给用户**
- **用户责任管理**

#### 组织单位 (`/manage/org`)
- **树形组织管理**
- **部门层次配置**
- **组织数据绑定**

#### 角色与权限系统 (`/manage/role`, `/manage/menu`)
- **细粒度权限控制**
- **基于角色的访问控制 (RBAC)**
- **菜单和按钮级权限**
- **基于权限的动态路由生成**

### 📊 系统监控与运维

#### 系统信息监控 (`/views/monitor/system/`)
- **实时CPU使用监控**: 用户/系统
- **内存使用跟踪**: 系统/JVM
- **进度指示器系统性能指标**
- **资源利用可视化**

#### 日志管理 (`/monitor/logs/*`)
- **登录日志跟踪**
- **操作日志审计**
- **错误日志监控**
- **调度日志管理**

### 🗺️ 地理空间功能

#### 地图集成 (`/views/map/`)
- **高德地图集成**: 针对中国市场
- **交互式地图可视化**
- **基于位置的设备跟踪**

#### 地理围栏 (`/views/geofence/`)
- **虚拟边界创建与管理**
- **多边形地理围栏定义**
- **实时地理围栏监控**

### 🏠 仪表板功能 (`/views/home/`)
- **KPI卡片**: 设备数量、用户统计、消息指标、告警摘要
- **时间线图表**: 告警和消息趋势分析
- **交互式组件**: 实时数据刷新与过滤
- **综合分析**: 系统全面概览

---

## 3️⃣ ljwx-bigscreen 大屏监控平台

### 🏗️ 技术架构
- **后端**: Flask + SQLAlchemy + Socket.IO
- **前端**: HTML5 + ECharts 5.x + 原生JavaScript
- **实时通信**: WebSocket (Socket.IO)
- **数据库**: MySQL + Redis缓存
- **性能**: 支持1000+设备并发监控

### 📊 大屏可视化页面

#### 主监控大屏
- **bigscreen_main.html**: 智能健康数据分析平台主屏
- **main_dashboard.html**: 实时统计大屏，关键指标展示
- **device_view.html**: 智能手表设备分析系统
- **health_view.html**: 健康数据监控视图
- **personal.html/personal_3d.html**: 个人健康画像展示

#### 专业监控界面
- **device_dashboard.html**: 专业设备监控大屏
- **alert_view.html**: 告警监控与管理界面
- **health_trends.html**: 健康趋势分析
- **system_monitor.html**: 系统事件监控
- **performance_monitor.html**: 性能监控界面

### 🚨 告警处理引擎 (`alert.py`)

#### 事件分类系统
- **紧急事件**: SOS_EVENT, FALLDOWN_EVENT, ONE_KEY_ALARM
- **状态变更**: WEAR_STATUS_CHANGED
- **生理异常**: 心率、血氧、压力等指标异常

#### 多渠道通知系统
- **微信企业号推送**
- **微信公众号模板消息**
- **系统内消息推送**
- **大屏实时告警显示**

#### Critical级别告警特殊处理
```python
# WebSocket实时推送到大屏
socketio.emit('critical_alert', alert_data, namespace='/')

# 层级通知系统
用户通知 → 部门主管 → 租户管理员
```

### 📈 健康数据分析系统

#### 健康指标分析器 (`health_daping_analyzer.py`)
- **心率**: 60-100 bpm，权重1.5
- **血氧**: 95-100%，权重1.2
- **体温**: 36.3-37.2°C，权重1.0
- **血压**: 收缩压90-140, 舒张压60-90 mmHg，权重1.3
- **压力指数**: 0-70，权重1.1
- **运动数据**: 步数、距离、卡路里

#### 健康画像功能
- **个人健康基线生成** (`health_baseline.py`)
- **组织级健康统计**
- **健康趋势分析和预测**
- **Z-score异常检测**

### 🗺️ 地理可视化功能
- **实时人员位置追踪**
- **告警地点标记**
- **地理围栏监控**
- **3D地图模块支持**

### 🔧 设备状态监控
- **设备在线状态**: ACTIVE/INACTIVE
- **电池电量监控**
- **佩戴状态检测**: WORN/NOT_WORN
- **充电状态**: CHARGING/NOT_CHARGING
- **设备绑定管理**

### ⚡ 性能优化特性
- **数据库优化**: 批量查询替代N+1查询
- **Redis缓存机制**: 3-5分钟缓存
- **分页限制**: 500条/页
- **连接池管理**
- **图表实例管理**: globalCharts

---

## 4️⃣ ljwx-phone 移动应用

### 🏗️ 技术架构
- **框架**: Flutter 3.0+ + Dart
- **状态管理**: Provider模式
- **导航**: GoRouter声明式路由
- **UI**: Material Design + 自定义主题
- **图表**: FL Chart + Flutter Radar Chart
- **本地存储**: SharedPreferences
- **动画**: Flutter Animate + Lottie

### 📱 核心功能模块

#### 用户认证系统 (`/screens/login_screen.dart`)
- **手机号密码认证**
- **自动填充保存的凭据**
- **密码重置功能**
- **持久登录会话**
- **基于角色的认证** (管理员/普通用户)

#### 主页仪表板 (`/screens/home_screen.dart`)
- **个人健康摘要**: 实时生命体征显示
- **设备状态卡片**: 连接设备信息
- **告警信息**: 关键健康告警
- **消息中心**: 系统通知
- **健康数据可视化**: 趋势图表和指标

#### 管理员界面 (`/screens/admin_webview_screen.dart`)
- **嵌入式Web管理**: 移动应用内完整管理面板
- **SHA认证自动登录**: 无缝访问Web界面
- **基于角色的访问控制**: 仅管理员用户可访问
- **员工视图切换**: 管理员和用户界面切换

### 🔵 蓝牙与IoT设备集成

#### 蓝牙服务 (`/services/bluetooth_service.dart`)
- **BLE设备发现**: 扫描附近健康设备
- **自动重连**: 维持持久连接
- **二进制协议支持**: TLV (Type-Length-Value) 数据格式
- **健康数据同步**: 实时数据流
- **电池和状态监控**: 设备健康跟踪

#### 二进制协议处理器 (`/services/ble_binary_protocol.dart`)
```dart
// 健康数据TLV字段
static const int FIELD_HEART_RATE = 0x03;
static const int FIELD_BLOOD_OXYGEN = 0x04;
static const int FIELD_BODY_TEMPERATURE = 0x05;
static const int FIELD_STEP = 0x08;
static const int FIELD_DISTANCE = 0x09;
static const int FIELD_CALORIE = 0x0A;
static const int FIELD_SLEEP_DATA = 0x10;
```

### 📊 健康数据可视化
- **实时指标卡片**: 带趋势指示器
- **历史数据折线图**
- **雷达图**: 综合健康评分
- **颜色编码状态指示器**: 正常/警告/严重

### 🚨 告警与通知系统
- **关键健康阈值告警**
- **设备连接问题告警**
- **电池低电量警告**
- **异常生命体征告警**

### 🔄 数据同步
- **蓝牙模式**: 连接设备实时流式传输
- **WiFi模式**: 本地缓存批量上传
- **混合模式**: 连接类型间自动回退

---

## 5️⃣ ljwx-watch 智能手表应用

### 🏗️ 技术架构
- **平台**: HarmonyOS 3.0+
- **SDK**: HarmonyOS SDK 6.0
- **开发环境**: DevEco Studio 3.0+
- **设备类型**: 可穿戴设备 (智能手表)

### 💓 健康数据采集

#### 支持的健康指标
- **心率**: 5秒间隔持续监控
- **血氧**: 2分钟间隔SpO2监控
- **体温**: 20秒测量间隔
- **血压**: 基于心率数据计算
- **压力水平**: 30分钟测量周期
- **计步器**: 持续步数跟踪
- **距离**: 运动距离计算
- **卡路里**: 能量消耗跟踪
- **睡眠数据**: 24小时睡眠模式分析

#### 统一定时器系统 (电源优化)
```java
// 主定时器5秒基础周期
masterTimer.schedule(new TimerTask() {
    public void run() {
        tick++;
        // 不同传感器在不同间隔采集
        if (stepSupported && tick % stepTickInterval == 0) {
            getStepData(startTime, endTime);
        }
        if (bloodOxygenSupported && tick % bloodOxygenTickInterval == 0) {
            getSpo2(startTime, endTime);
        }
    }
}, 0, basePeriod * 1000);
```

### 📡 设备通信协议

#### 蓝牙低功耗 (BLE) 通信
- **服务UUID**: `00001887-0000-1000-8000-00805f9b34fb`
- **数据特征**: `0000FD10-0000-1000-8000-00805F9B34FB`
- **命令特征**: `0000FD11-0000-1000-8000-00805F9B34FB`
- **MTU大小**: 可配置，默认512字节

#### 高级二进制协议 (TLV格式)
```
+----------+------+--------+---------------+----------+
| version  | type | format | payloadLength | payload  |
|  (1字节) |(1字节)|(1字节) |   (2字节)     | (N字节)  |
+----------+------+--------+---------------+----------+
```

### 🚨 紧急功能
- **SOS按钮**: 一键紧急激活
- **跌倒检测**: 自动跌倒事件识别
- **健康告警**: 关键生命体征通知
- **双击操作**: 快速紧急功能

### 🔋 电池管理与电源优化

#### 电源优化策略
**优化前**:
- 15+独立定时器
- HTTP模式下11小时电池寿命
- 多个并发定时器高CPU使用率

**优化后**:
- 2个统一主定时器
- 预期15-18小时电池寿命
- CPU使用率降低40%

#### 智能数据采集
- **健康数据缓存**: 10分钟批量上传本地存储
- **网络优化**: 减少HTTP请求频率
- **智能调度**: 基于活动的数据采集调整

---

## 🔐 系统安全与权限

### 多租户架构
- **数据隔离**: 基于组织的完全数据隔离
- **权限控制**: 细粒度访问控制
- **角色管理**: RBAC角色基础访问控制
- **API安全**: JWT令牌认证

### 数据安全
- **加密传输**: HTTPS强制数据传输
- **本地加密**: 受保护的敏感信息
- **权限基础访问**: 角色特定功能限制
- **审计日志**: 访问和修改跟踪

---

## 📊 性能与扩展性

### 性能指标
- **响应时间**: <3秒 (1000设备规模)
- **并发处理**: QPS >1400
- **系统可用性**: 99.9%
- **告警及时性**: <5秒 (Critical级别)

### 扩展特性
- **设备支持**: 1000+设备并发
- **多架构**: Docker AMD64/ARM64支持
- **高并发**: 批量处理设计
- **容错设计**: 自动降级机制

---

## 🚀 部署与运维

### 部署方式
- **Docker容器化**: 多架构镜像支持
- **Kubernetes**: 容器编排支持
- **传统部署**: JAR包部署选项
- **一键脚本**: 自动化部署工具

### 监控与日志
- **Prometheus指标**: 性能监控
- **ELK日志栈**: 日志聚合分析
- **健康检查**: 自动化服务监控
- **告警系统**: 系统状态告警

---

## 📈 业务价值与应用场景

### 目标行业
- **工业安全**: 矿工、工厂工人健康监测
- **医疗保健**: 患者远程监控
- **养老护理**: 老年人安全监控
- **企业健康**: 员工健康管理

### 核心价值
1. **实时监控** - 24/7持续健康监测
2. **预防预警** - 健康风险早期识别
3. **应急响应** - 紧急情况快速处置
4. **数据分析** - 健康趋势深度洞察
5. **管理优化** - 企业健康管理效率提升

---

## 🔮 技术创新点

### 1. 多设备协同
- **手表+手机+大屏**: 无缝数据流转
- **实时同步**: 多终端数据一致性
- **智能切换**: 最优连接方式自动选择

### 2. 智能健康分析
- **个人基线**: 自适应健康阈值
- **AI增强**: 智能健康建议
- **趋势预测**: 健康风险预警

### 3. 企业级架构
- **多租户**: 完全数据隔离
- **微服务**: 模块化松耦合设计
- **高可用**: 故障自动恢复

### 4. 用户体验优化
- **零配置**: 开箱即用体验
- **自适应UI**: 响应式界面设计
- **智能提醒**: 个性化健康建议

---

**文档版本**: v1.0  
**创建时间**: 2025-08-16  
**创建者**: Claude Code Assistant  
**基于代码版本**: LJWX v1.3.2