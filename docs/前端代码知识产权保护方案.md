# å‰ç«¯ä»£ç çŸ¥è¯†äº§æƒä¿æŠ¤æ–¹æ¡ˆ

> **ç›®æ ‡**: ä¿æŠ¤å¤§å±å±•ç¤ºé¡µé¢çš„çŸ¥è¯†äº§æƒï¼Œé˜²æ­¢å®¢æˆ·æŸ¥çœ‹æºç   
> **åœºæ™¯**: http://192.168.1.83:5001/main?customerId=1939964806110937090  
> **åˆ›å»ºæ—¶é—´**: 2025-08-31

## ğŸ¯ ä¿æŠ¤ç›®æ ‡

### æ ¸å¿ƒä¿æŠ¤éœ€æ±‚
- âœ… **ç¦ç”¨å³é”®èœå•** - é˜²æ­¢"æŸ¥çœ‹æºä»£ç "
- âœ… **ç¦ç”¨å¼€å‘è€…å·¥å…·** - F12ã€Ctrl+Shift+Iç­‰å¿«æ·é”®
- âœ… **ä»£ç æ··æ·†** - JavaScriptä»£ç éš¾ä»¥é˜…è¯»
- âœ… **èµ„æºåŠ å¯†** - å…³é”®é…ç½®å’Œç®—æ³•åŠ å¯†
- âœ… **ç½‘ç»œè¯·æ±‚ä¿æŠ¤** - APIæ¥å£åŠ å¯†å’Œç­¾åéªŒè¯
- âœ… **é¡µé¢é˜²è°ƒè¯•** - åè°ƒè¯•å’Œåé€†å‘å·¥ç¨‹

## ğŸ›¡ï¸ å¤šå±‚ä¿æŠ¤æ–¹æ¡ˆ

### ç¬¬ä¸€å±‚ï¼šæµè§ˆå™¨è¡Œä¸ºæ§åˆ¶

#### 1. ç¦ç”¨å³é”®èœå•å’Œå¿«æ·é”®
```html
<!-- åœ¨ä¸»é¡µé¢æ·»åŠ ä¿æŠ¤è„šæœ¬ -->
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>çµå¢ƒä¸‡è±¡å¥åº·ç®¡ç†å¤§å±</title>
    <style>
        /* ç¦ç”¨æ–‡æœ¬é€‰æ‹© */
        * {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* éšè—é€‰ä¸­æ–‡æœ¬çš„èƒŒæ™¯ */
        ::selection { background: transparent; }
        ::-moz-selection { background: transparent; }
    </style>
</head>
<body>

<script>
(function() {
    'use strict';
    
    // 1. ç¦ç”¨å³é”®èœå•
    document.addEventListener('contextmenu', function(e) {
        e.preventDefault();
        e.stopPropagation();
        showWarningMessage('ç³»ç»Ÿæç¤ºï¼šæ­¤åŠŸèƒ½å·²ç¦ç”¨');
        return false;
    }, true);
    
    // 2. ç¦ç”¨å¼€å‘è€…å·¥å…·å¿«æ·é”®
    document.addEventListener('keydown', function(e) {
        // F12
        if (e.keyCode === 123) {
            e.preventDefault();
            e.stopPropagation();
            showWarningMessage('ç³»ç»Ÿæç¤ºï¼šå¼€å‘è€…å·¥å…·å·²ç¦ç”¨');
            return false;
        }
        
        // Ctrl+Shift+I (å¼€å‘è€…å·¥å…·)
        if (e.ctrlKey && e.shiftKey && e.keyCode === 73) {
            e.preventDefault();
            e.stopPropagation();
            return false;
        }
        
        // Ctrl+Shift+C (å…ƒç´ é€‰æ‹©)
        if (e.ctrlKey && e.shiftKey && e.keyCode === 67) {
            e.preventDefault();
            e.stopPropagation();
            return false;
        }
        
        // Ctrl+U (æŸ¥çœ‹æºä»£ç )
        if (e.ctrlKey && e.keyCode === 85) {
            e.preventDefault();
            e.stopPropagation();
            showWarningMessage('ç³»ç»Ÿæç¤ºï¼šæŸ¥çœ‹æºä»£ç åŠŸèƒ½å·²ç¦ç”¨');
            return false;
        }
        
        // Ctrl+S (ä¿å­˜é¡µé¢)
        if (e.ctrlKey && e.keyCode === 83) {
            e.preventDefault();
            e.stopPropagation();
            return false;
        }
        
        // Ctrl+A (å…¨é€‰)
        if (e.ctrlKey && e.keyCode === 65) {
            e.preventDefault();
            e.stopPropagation();
            return false;
        }
    }, true);
    
    // 3. æ£€æµ‹å¼€å‘è€…å·¥å…·æ˜¯å¦æ‰“å¼€
    let devtools = {
        open: false,
        orientation: null
    };
    
    setInterval(function() {
        if (window.outerHeight - window.innerHeight > 200) {
            if (!devtools.open) {
                devtools.open = true;
                // æ£€æµ‹åˆ°å¼€å‘è€…å·¥å…·æ‰“å¼€ï¼Œæ‰§è¡Œä¿æŠ¤æªæ–½
                handleDevToolsDetected();
            }
        } else {
            devtools.open = false;
        }
    }, 500);
    
    function handleDevToolsDetected() {
        // æ–¹æ¡ˆ1ï¼šè­¦å‘Šæç¤º
        alert('æ£€æµ‹åˆ°è°ƒè¯•å·¥å…·ï¼Œè¯·å…³é—­åç»§ç»­ä½¿ç”¨');
        
        // æ–¹æ¡ˆ2ï¼šé¡µé¢è·³è½¬æˆ–å…³é—­
        // window.location.href = '/access-denied';
        
        // æ–¹æ¡ˆ3ï¼šé¡µé¢å†…å®¹æ¸…ç©º
        // document.body.innerHTML = '<h1>è®¿é—®å—é™</h1>';
        
        // æ–¹æ¡ˆ4ï¼šæ— é™debugger (è°¨æ…ä½¿ç”¨)
        // setInterval(function() { debugger; }, 100);
    }
    
    // 4. æ˜¾ç¤ºè­¦å‘Šæ¶ˆæ¯
    function showWarningMessage(message) {
        // åˆ›å»ºä¸´æ—¶æç¤ºæ¡†
        const toast = document.createElement('div');
        toast.style.cssText = `
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            z-index: 10000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        `;
        toast.textContent = message;
        document.body.appendChild(toast);
        
        setTimeout(() => {
            document.body.removeChild(toast);
        }, 2000);
    }
    
    // 5. ç¦ç”¨æ‹–æ‹½ä¿å­˜
    document.addEventListener('dragstart', function(e) {
        e.preventDefault();
        return false;
    });
    
    // 6. ç¦ç”¨æ‰“å°
    window.addEventListener('beforeprint', function(e) {
        e.preventDefault();
        showWarningMessage('ç³»ç»Ÿæç¤ºï¼šæ‰“å°åŠŸèƒ½å·²ç¦ç”¨');
        return false;
    });
    
})();
</script>
</body>
</html>
```

### ç¬¬äºŒå±‚ï¼šJavaScriptä»£ç æ··æ·†

#### 1. ä½¿ç”¨ä¸“ä¸šæ··æ·†å·¥å…·
```javascript
// åŸå§‹ä»£ç ç¤ºä¾‹
function calculateHealthScore(data) {
    const weights = {
        heartRate: 0.3,
        bloodPressure: 0.25,
        steps: 0.2,
        sleep: 0.25
    };
    
    return data.heartRate * weights.heartRate + 
           data.bloodPressure * weights.bloodPressure + 
           data.steps * weights.steps + 
           data.sleep * weights.sleep;
}

// æ··æ·†åçš„ä»£ç ï¼ˆç¤ºä¾‹ï¼‰
var _0x1a2b=['heartRate','bloodPressure','steps','sleep'];
function _0x3c4d(_0xe5f6){
    var _0x7g8h={
        [_0x1a2b[0]]:0.3,
        [_0x1a2b[1]]:0.25,
        [_0x1a2b[2]]:0.2,
        [_0x1a2b[3]]:0.25
    };
    return _0xe5f6[_0x1a2b[0]]*_0x7g8h[_0x1a2b[0]]+
           _0xe5f6[_0x1a2b[1]]*_0x7g8h[_0x1a2b[1]]+
           _0xe5f6[_0x1a2b[2]]*_0x7g8h[_0x1a2b[2]]+
           _0xe5f6[_0x1a2b[3]]*_0x7g8h[_0x1a2b[3]];
}
```

#### 2. ä»£ç æ··æ·†æ„å»ºè„šæœ¬
```python
# build_obfuscated.py - è‡ªåŠ¨åŒ–æ··æ·†æ„å»ºè„šæœ¬
import os
import subprocess
import shutil
from datetime import datetime

def obfuscate_javascript():
    """æ··æ·†JavaScriptæ–‡ä»¶"""
    
    print("å¼€å§‹JavaScriptä»£ç æ··æ·†...")
    
    # 1. å®‰è£…javascript-obfuscator (å¦‚æœæœªå®‰è£…)
    try:
        subprocess.run(['npm', 'install', '-g', 'javascript-obfuscator'], check=True)
    except subprocess.CalledProcessError:
        print("è¯·å…ˆå®‰è£…Node.jså’Œnpm")
        return False
    
    # 2. æ··æ·†é…ç½®
    obfuscator_config = {
        "compact": True,
        "controlFlowFlattening": True,
        "controlFlowFlatteningThreshold": 0.75,
        "deadCodeInjection": True,
        "deadCodeInjectionThreshold": 0.4,
        "identifierNamesGenerator": "hexadecimal",
        "rotateStringArray": True,
        "selfDefending": True,
        "stringArray": True,
        "stringArrayThreshold": 0.75,
        "unicodeEscapeSequence": False
    }
    
    # 3. æ··æ·†ä¸»è¦JavaScriptæ–‡ä»¶
    js_files = [
        'static/js/main.js',
        'static/js/charts.js', 
        'static/js/health-analyzer.js',
        'static/js/alert-handler.js'
    ]
    
    for js_file in js_files:
        if os.path.exists(js_file):
            output_file = js_file.replace('.js', '.obfuscated.js')
            cmd = [
                'javascript-obfuscator', 
                js_file,
                '--output', output_file,
                '--options', str(obfuscator_config).replace("'", '"')
            ]
            
            try:
                subprocess.run(cmd, check=True)
                # æ›¿æ¢åŸæ–‡ä»¶
                shutil.move(output_file, js_file)
                print(f"âœ… {js_file} æ··æ·†å®Œæˆ")
            except subprocess.CalledProcessError as e:
                print(f"âŒ {js_file} æ··æ·†å¤±è´¥: {e}")
    
    print("JavaScriptæ··æ·†å®Œæˆ!")
    return True

def obfuscate_templates():
    """æ··æ·†HTMLæ¨¡æ¿æ–‡ä»¶"""
    
    print("å¼€å§‹HTMLæ¨¡æ¿æ··æ·†...")
    
    import html
    import re
    
    template_files = [
        'templates/main.html',
        'templates/health_dashboard.html',
        'templates/charts.html'
    ]
    
    for template_file in template_files:
        if os.path.exists(template_file):
            with open(template_file, 'r', encoding='utf-8') as f:
                content = f.read()
            
            # ç§»é™¤æ³¨é‡Š
            content = re.sub(r'<!--.*?-->', '', content, flags=re.DOTALL)
            
            # å‹ç¼©HTML (ç§»é™¤å¤šä½™ç©ºç™½)
            content = re.sub(r'\s+', ' ', content)
            content = re.sub(r'>\s+<', '><', content)
            
            # æ··æ·†IDå’Œç±»å
            content = re.sub(r'id="([^"]+)"', lambda m: f'id="_{hash(m.group(1)) % 10000}"', content)
            content = re.sub(r'class="([^"]+)"', lambda m: f'class="_{hash(m.group(1)) % 10000}"', content)
            
            with open(template_file, 'w', encoding='utf-8') as f:
                f.write(content)
            
            print(f"âœ… {template_file} æ··æ·†å®Œæˆ")
    
    print("HTMLæ¨¡æ¿æ··æ·†å®Œæˆ!")

if __name__ == "__main__":
    obfuscate_javascript()
    obfuscate_templates()
    print(f"ğŸ‰ ä»£ç æ··æ·†å®Œæˆ! æ—¶é—´: {datetime.now()}")
```

### ç¬¬ä¸‰å±‚ï¼šåè°ƒè¯•å’Œæ£€æµ‹æœºåˆ¶

#### 1. é«˜çº§åè°ƒè¯•æŠ€æœ¯
```javascript
// anti-debug.js - åè°ƒè¯•è„šæœ¬
(function() {
    'use strict';
    
    // 1. æ— é™debuggerå¾ªç¯
    function infiniteDebugger() {
        setInterval(function() {
            debugger;
        }, 50);
    }
    
    // 2. æ§åˆ¶å°æ£€æµ‹
    function detectConsole() {
        let devtools = {
            open: false,
            orientation: null
        };
        
        const threshold = 160;
        setInterval(function() {
            if (window.outerHeight - window.innerHeight > threshold || 
                window.outerWidth - window.innerWidth > threshold) {
                if (!devtools.open) {
                    devtools.open = true;
                    handleDebugDetection();
                }
            } else {
                devtools.open = false;
            }
        }, 500);
    }
    
    // 3. æ—¶é—´å·®æ£€æµ‹
    function detectTimingAttack() {
        let start = performance.now();
        debugger;
        let end = performance.now();
        
        if (end - start > 100) {
            handleDebugDetection();
        }
    }
    
    // 4. å‡½æ•°é‡å†™æ£€æµ‹
    function detectFunctionOverride() {
        const originalLog = console.log;
        const originalWarn = console.warn;
        const originalError = console.error;
        
        // æ£€æŸ¥æ§åˆ¶å°å‡½æ•°æ˜¯å¦è¢«é‡å†™
        if (console.log !== originalLog || 
            console.warn !== originalWarn || 
            console.error !== originalError) {
            handleDebugDetection();
        }
    }
    
    // 5. å¤„ç†è°ƒè¯•æ£€æµ‹
    function handleDebugDetection() {
        // æ–¹æ¡ˆ1: é¡µé¢ç™½å±
        document.body.innerHTML = '<div style="display:flex;justify-content:center;align-items:center;height:100vh;font-size:24px;color:#666;">è®¿é—®å—é™</div>';
        
        // æ–¹æ¡ˆ2: æ— é™å¼¹çª—
        // setInterval(function() { alert('æ£€æµ‹åˆ°è°ƒè¯•å·¥å…·'); }, 1000);
        
        // æ–¹æ¡ˆ3: é¡µé¢è·³è½¬
        // window.location.href = 'about:blank';
        
        // æ–¹æ¡ˆ4: æ¸…ç©ºå…³é”®æ•°æ®
        if (window.healthData) {
            window.healthData = null;
        }
        if (window.chartInstances) {
            Object.keys(window.chartInstances).forEach(key => {
                window.chartInstances[key].clear();
            });
        }
    }
    
    // 6. ä»£ç å®Œæ•´æ€§æ£€æµ‹
    function detectCodeModification() {
        const scripts = document.getElementsByTagName('script');
        let expectedHash = 'your-script-hash-here'; // é¢„è®¡ç®—çš„è„šæœ¬å“ˆå¸Œå€¼
        
        for (let script of scripts) {
            if (script.src) {
                fetch(script.src)
                    .then(response => response.text())
                    .then(text => {
                        const hash = calculateHash(text);
                        if (hash !== expectedHash) {
                            handleDebugDetection();
                        }
                    });
            }
        }
    }
    
    function calculateHash(str) {
        let hash = 0;
        for (let i = 0; i < str.length; i++) {
            const char = str.charCodeAt(i);
            hash = ((hash << 5) - hash) + char;
            hash = hash & hash;
        }
        return hash;
    }
    
    // å¯åŠ¨æ£€æµ‹æœºåˆ¶
    detectConsole();
    setInterval(detectTimingAttack, 1000);
    setInterval(detectFunctionOverride, 2000);
    
    // åœ¨ç”Ÿäº§ç¯å¢ƒå¯ç”¨æ— é™debugger (è°¨æ…ä½¿ç”¨)
    if (location.hostname !== 'localhost' && location.hostname !== '127.0.0.1') {
        // infiniteDebugger(); // å–æ¶ˆæ³¨é‡Šä»¥å¯ç”¨
    }
})();
```

### ç¬¬å››å±‚ï¼šèµ„æºå’ŒAPIä¿æŠ¤

#### 1. å…³é”®é…ç½®åŠ å¯†
```python
# config_encryption.py - é…ç½®æ–‡ä»¶åŠ å¯†
import json
import base64
from cryptography.fernet import Fernet

class ConfigEncryption:
    def __init__(self):
        # ç”Ÿæˆæˆ–åŠ è½½å¯†é’¥
        self.key = self.load_or_generate_key()
        self.fernet = Fernet(self.key)
    
    def load_or_generate_key(self):
        try:
            with open('.encryption_key', 'rb') as f:
                return f.read()
        except FileNotFoundError:
            key = Fernet.generate_key()
            with open('.encryption_key', 'wb') as f:
                f.write(key)
            return key
    
    def encrypt_config(self, config_data):
        """åŠ å¯†é…ç½®æ•°æ®"""
        json_str = json.dumps(config_data)
        encrypted_data = self.fernet.encrypt(json_str.encode())
        return base64.b64encode(encrypted_data).decode()
    
    def decrypt_config(self, encrypted_data):
        """è§£å¯†é…ç½®æ•°æ®"""
        encrypted_bytes = base64.b64decode(encrypted_data.encode())
        decrypted_data = self.fernet.decrypt(encrypted_bytes)
        return json.loads(decrypted_data.decode())

# ä½¿ç”¨ç¤ºä¾‹
encryptor = ConfigEncryption()

# åŠ å¯†æ•æ„Ÿé…ç½®
sensitive_config = {
    "database_url": "mysql://user:pass@host/db",
    "api_keys": {
        "wechat": "your-wechat-key",
        "analysis": "your-analysis-key"
    },
    "algorithm_parameters": {
        "health_weights": [0.3, 0.25, 0.2, 0.25],
        "alert_thresholds": {"high": 150, "low": 60}
    }
}

encrypted_config = encryptor.encrypt_config(sensitive_config)
print(f"åŠ å¯†åçš„é…ç½®: {encrypted_config}")
```

#### 2. APIè¯·æ±‚ç­¾åéªŒè¯
```python
# api_protection.py - APIä¿æŠ¤æœºåˆ¶
import hmac
import hashlib
import time
from flask import request, jsonify

class APIProtection:
    def __init__(self, secret_key):
        self.secret_key = secret_key
    
    def generate_signature(self, data, timestamp):
        """ç”Ÿæˆè¯·æ±‚ç­¾å"""
        message = f"{data}{timestamp}{self.secret_key}"
        return hmac.new(
            self.secret_key.encode(),
            message.encode(),
            hashlib.sha256
        ).hexdigest()
    
    def verify_request(self, f):
        """APIè¯·æ±‚éªŒè¯è£…é¥°å™¨"""
        def decorated_function(*args, **kwargs):
            # 1. æ£€æŸ¥å¿…è¦çš„è¯·æ±‚å¤´
            signature = request.headers.get('X-Signature')
            timestamp = request.headers.get('X-Timestamp')
            customer_id = request.headers.get('X-Customer-ID')
            
            if not all([signature, timestamp, customer_id]):
                return jsonify({'error': 'ç¼ºå°‘å¿…è¦çš„è¯·æ±‚å¤´'}), 401
            
            # 2. æ£€æŸ¥æ—¶é—´æˆ³ (é˜²é‡æ”¾æ”»å‡»)
            current_time = int(time.time())
            if abs(current_time - int(timestamp)) > 300:  # 5åˆ†é’Ÿæœ‰æ•ˆæœŸ
                return jsonify({'error': 'è¯·æ±‚å·²è¿‡æœŸ'}), 401
            
            # 3. éªŒè¯ç­¾å
            request_data = request.get_data().decode('utf-8')
            expected_signature = self.generate_signature(request_data, timestamp)
            
            if not hmac.compare_digest(signature, expected_signature):
                return jsonify({'error': 'ç­¾åéªŒè¯å¤±è´¥'}), 401
            
            # 4. éªŒè¯å®¢æˆ·ID (å¯é€‰)
            if not self.is_valid_customer(customer_id):
                return jsonify({'error': 'æ— æ•ˆçš„å®¢æˆ·ID'}), 403
            
            return f(*args, **kwargs)
        
        decorated_function.__name__ = f.__name__
        return decorated_function
    
    def is_valid_customer(self, customer_id):
        """éªŒè¯å®¢æˆ·IDçš„æœ‰æ•ˆæ€§"""
        # è¿™é‡Œå¯ä»¥æŸ¥è¯¢æ•°æ®åº“æˆ–ç¼“å­˜
        valid_customers = ['1939964806110937090']  # ç¤ºä¾‹
        return customer_id in valid_customers

# ä½¿ç”¨ç¤ºä¾‹
api_protection = APIProtection('your-secret-key-here')

@app.route('/api/health/data')
@api_protection.verify_request
def get_health_data():
    return jsonify({'data': 'protected_data'})
```

### ç¬¬äº”å±‚ï¼šæœåŠ¡ç«¯ä¿æŠ¤

#### 1. Nginxé…ç½®ä¼˜åŒ–
```nginx
# nginx.conf - æœåŠ¡ç«¯ä¿æŠ¤é…ç½®
server {
    listen 5001;
    server_name 192.168.1.83;
    
    # 1. éšè—æœåŠ¡å™¨ä¿¡æ¯
    server_tokens off;
    
    # 2. è®¾ç½®å®‰å…¨å¤´éƒ¨
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;
    add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline';" always;
    
    # 3. é˜²æ­¢ç›´æ¥è®¿é—®é™æ€æ–‡ä»¶
    location ~* \.(js|css)$ {
        # æ£€æŸ¥Referer
        valid_referers server_names ~\.;
        if ($invalid_referer) {
            return 403;
        }
        
        # è®¾ç½®ç¼“å­˜å’Œé˜²ç›—é“¾
        expires 1h;
        add_header Cache-Control "public, no-transform";
    }
    
    # 4. ä¸»é¡µé¢è®¿é—®æ§åˆ¶
    location = /main {
        # åªå…è®¸ç‰¹å®šIPè®¿é—®
        allow 192.168.1.0/24;
        deny all;
        
        # æ£€æŸ¥å¿…è¦å‚æ•°
        if ($args !~* "customerId=") {
            return 403;
        }
        
        proxy_pass http://127.0.0.1:5001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
    
    # 5. ç¦æ­¢è®¿é—®æ•æ„Ÿæ–‡ä»¶
    location ~* \.(log|sql|bak|backup|py)$ {
        deny all;
        return 404;
    }
    
    # 6. é™åˆ¶è¯·æ±‚é¢‘ç‡
    limit_req_zone $binary_remote_addr zone=api:10m rate=10r/s;
    location /api/ {
        limit_req zone=api burst=20 nodelay;
        proxy_pass http://127.0.0.1:5001;
    }
}
```

#### 2. Flaskåº”ç”¨ä¿æŠ¤
```python
# app_protection.py - Flaskåº”ç”¨çº§ä¿æŠ¤
from flask import Flask, render_template, request, session, abort
import os
import hashlib
from datetime import datetime, timedelta

app = Flask(__name__)
app.secret_key = os.urandom(24)

class AppProtection:
    def __init__(self, app):
        self.app = app
        self.setup_protection()
    
    def setup_protection(self):
        """è®¾ç½®åº”ç”¨çº§ä¿æŠ¤"""
        
        # 1. è¯·æ±‚å‰ç½®æ£€æŸ¥
        @self.app.before_request
        def security_check():
            # æ£€æŸ¥IPç™½åå•
            if not self.is_ip_allowed(request.remote_addr):
                abort(403)
            
            # æ£€æŸ¥User-Agent (é˜²æ­¢çˆ¬è™«)
            user_agent = request.headers.get('User-Agent', '')
            if self.is_suspicious_user_agent(user_agent):
                abort(403)
            
            # æ£€æŸ¥Referer (é˜²æ­¢ç›—é“¾)
            if request.path.startswith('/static/') and not self.is_valid_referer():
                abort(403)
        
        # 2. å“åº”åå¤„ç†
        @self.app.after_request
        def add_security_headers(response):
            # é˜²æ­¢ç¼“å­˜æ•æ„Ÿé¡µé¢
            if request.path == '/main':
                response.headers['Cache-Control'] = 'no-cache, no-store, must-revalidate'
                response.headers['Pragma'] = 'no-cache'
                response.headers['Expires'] = '0'
            
            # æ·»åŠ å®‰å…¨å¤´
            response.headers['X-Frame-Options'] = 'DENY'
            response.headers['X-Content-Type-Options'] = 'nosniff'
            
            return response
    
    def is_ip_allowed(self, ip):
        """æ£€æŸ¥IPæ˜¯å¦åœ¨ç™½åå•ä¸­"""
        allowed_ips = [
            '192.168.1.0/24',  # å†…ç½‘IPæ®µ
            '127.0.0.1',       # æœ¬åœ°è®¿é—®
        ]
        # è¿™é‡Œå¯ä»¥å®ç°æ›´å¤æ‚çš„IPæ£€æŸ¥é€»è¾‘
        return True  # ç®€åŒ–å®ç°
    
    def is_suspicious_user_agent(self, user_agent):
        """æ£€æŸ¥å¯ç–‘çš„User-Agent"""
        suspicious_patterns = [
            'curl', 'wget', 'python', 'scrapy', 'bot', 'spider'
        ]
        return any(pattern in user_agent.lower() for pattern in suspicious_patterns)
    
    def is_valid_referer(self):
        """æ£€æŸ¥Refereræ˜¯å¦æœ‰æ•ˆ"""
        referer = request.headers.get('Referer', '')
        return '192.168.1.83:5001' in referer

# åº”ç”¨ä¿æŠ¤
protection = AppProtection(app)

@app.route('/main')
def main_page():
    customer_id = request.args.get('customerId')
    if not customer_id:
        abort(403)
    
    # ç”Ÿæˆé¡µé¢è®¿é—®ä»¤ç‰Œ
    page_token = hashlib.md5(f"{customer_id}{datetime.now()}".encode()).hexdigest()
    session['page_token'] = page_token
    
    return render_template('main_protected.html', 
                         customerId=customer_id,
                         pageToken=page_token)
```

## ğŸš€ å®æ–½æ­¥éª¤

### é˜¶æ®µä¸€ï¼šåŸºç¡€ä¿æŠ¤ (1å‘¨)
1. **éƒ¨ç½²åè°ƒè¯•è„šæœ¬** - æ·»åŠ åˆ°ä¸»é¡µé¢æ¨¡æ¿
2. **é…ç½®Nginxå®‰å…¨è§„åˆ™** - é˜²æ­¢ç›´æ¥è®¿é—®å’Œç›—é“¾
3. **å®æ–½IPç™½åå•** - é™åˆ¶è®¿é—®æ¥æº

### é˜¶æ®µäºŒï¼šä»£ç æ··æ·† (1-2å‘¨)  
1. **JavaScriptæ··æ·†** - ä½¿ç”¨ä¸“ä¸šå·¥å…·æ··æ·†æ ¸å¿ƒä»£ç 
2. **HTMLå‹ç¼©** - ç§»é™¤æ³¨é‡Šå’Œå¤šä½™ç©ºç™½
3. **é…ç½®åŠ å¯†** - åŠ å¯†æ•æ„Ÿé…ç½®ä¿¡æ¯

### é˜¶æ®µä¸‰ï¼šé«˜çº§ä¿æŠ¤ (1-2å‘¨)
1. **APIç­¾åéªŒè¯** - å®æ–½è¯·æ±‚ç­¾åæœºåˆ¶
2. **èµ„æºå®Œæ•´æ€§æ£€æŸ¥** - æ£€æµ‹ä»£ç ç¯¡æ”¹
3. **åŠ¨æ€åè°ƒè¯•** - éƒ¨ç½²é«˜çº§åè°ƒè¯•æŠ€æœ¯

### é˜¶æ®µå››ï¼šç›‘æ§å’Œç»´æŠ¤ (æŒç»­)
1. **è®¿é—®ç›‘æ§** - è®°å½•å’Œåˆ†æå¼‚å¸¸è®¿é—®
2. **å®šæœŸæ›´æ–°** - æ›´æ–°ä¿æŠ¤ç­–ç•¥å’Œå¯†é’¥
3. **æ•ˆæœè¯„ä¼°** - è¯„ä¼°ä¿æŠ¤æ•ˆæœå’Œæ”¹è¿›

## âš ï¸ æ³¨æ„äº‹é¡¹

### ç”¨æˆ·ä½“éªŒå¹³è¡¡
- **é¿å…è¿‡åº¦ä¿æŠ¤** - ä¸å½±å“æ­£å¸¸ç”¨æˆ·ä½¿ç”¨
- **ä¼˜é›…çš„é”™è¯¯å¤„ç†** - å‹å¥½çš„é”™è¯¯æç¤ºä¿¡æ¯
- **æ€§èƒ½è€ƒè™‘** - ä¿æŠ¤æœºåˆ¶ä¸åº”æ˜¾è‘—å½±å“é¡µé¢æ€§èƒ½

### æ³•å¾‹åˆè§„
- **ç”¨æˆ·å‘ŠçŸ¥** - åœ¨åˆé€‚ä½ç½®å‘ŠçŸ¥ç”¨æˆ·ç›¸å…³ä¿æŠ¤æªæ–½
- **åˆè§„æ€§æ£€æŸ¥** - ç¡®ä¿ä¿æŠ¤æªæ–½ç¬¦åˆç›¸å…³æ³•å¾‹æ³•è§„
- **å®¢æˆ·æ²Ÿé€š** - ä¸å®¢æˆ·æ²Ÿé€šä¿æŠ¤æªæ–½çš„å¿…è¦æ€§

### ç»´æŠ¤ç­–ç•¥
- **å¯†é’¥ç®¡ç†** - å®šæœŸæ›´æ¢åŠ å¯†å¯†é’¥
- **æ—¥å¿—å®¡è®¡** - è®°å½•æ‰€æœ‰å®‰å…¨ç›¸å…³äº‹ä»¶
- **åº”æ€¥é¢„æ¡ˆ** - å‡†å¤‡åº”å¯¹ä¿æŠ¤æªæ–½è¢«ç»•è¿‡çš„æƒ…å†µ

---

è¿™å¥—ä¿æŠ¤æ–¹æ¡ˆæä¾›äº†å¤šå±‚çº§çš„çŸ¥è¯†äº§æƒä¿æŠ¤ï¼Œåœ¨ä¸å½±å“ç”¨æˆ·ä½“éªŒçš„å‰æä¸‹ï¼Œæœ€å¤§ç¨‹åº¦åœ°ä¿æŠ¤ä½ çš„å‰ç«¯ä»£ç å’Œä¸šåŠ¡é€»è¾‘ã€‚å»ºè®®åˆ†é˜¶æ®µå®æ–½ï¼Œé€æ­¥åŠ å¼ºä¿æŠ¤åŠ›åº¦ã€‚